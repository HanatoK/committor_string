/* Generated by Cython 0.29.24 */

/* BEGIN: Cython Metadata
{
    "distutils": {
        "depends": [],
        "name": "vcstring",
        "sources": [
            "vcstring.pyx"
        ]
    },
    "module_name": "vcstring"
}
END: Cython Metadata */

#ifndef PY_SSIZE_T_CLEAN
#define PY_SSIZE_T_CLEAN
#endif /* PY_SSIZE_T_CLEAN */
#include "Python.h"
#ifndef Py_PYTHON_H
    #error Python headers needed to compile C extensions, please install development version of Python.
#elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
    #error Cython requires Python 2.6+ or Python 3.3+.
#else
#define CYTHON_ABI "0_29_24"
#define CYTHON_HEX_VERSION 0x001D18F0
#define CYTHON_FUTURE_DIVISION 1
#include <stddef.h>
#ifndef offsetof
  #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
#endif
#if !defined(WIN32) && !defined(MS_WINDOWS)
  #ifndef __stdcall
    #define __stdcall
  #endif
  #ifndef __cdecl
    #define __cdecl
  #endif
  #ifndef __fastcall
    #define __fastcall
  #endif
#endif
#ifndef DL_IMPORT
  #define DL_IMPORT(t) t
#endif
#ifndef DL_EXPORT
  #define DL_EXPORT(t) t
#endif
#define __PYX_COMMA ,
#ifndef HAVE_LONG_LONG
  #if PY_VERSION_HEX >= 0x02070000
    #define HAVE_LONG_LONG
  #endif
#endif
#ifndef PY_LONG_LONG
  #define PY_LONG_LONG LONG_LONG
#endif
#ifndef Py_HUGE_VAL
  #define Py_HUGE_VAL HUGE_VAL
#endif
#ifdef PYPY_VERSION
  #define CYTHON_COMPILING_IN_PYPY 1
  #define CYTHON_COMPILING_IN_PYSTON 0
  #define CYTHON_COMPILING_IN_CPYTHON 0
  #undef CYTHON_USE_TYPE_SLOTS
  #define CYTHON_USE_TYPE_SLOTS 0
  #undef CYTHON_USE_PYTYPE_LOOKUP
  #define CYTHON_USE_PYTYPE_LOOKUP 0
  #if PY_VERSION_HEX < 0x03050000
    #undef CYTHON_USE_ASYNC_SLOTS
    #define CYTHON_USE_ASYNC_SLOTS 0
  #elif !defined(CYTHON_USE_ASYNC_SLOTS)
    #define CYTHON_USE_ASYNC_SLOTS 1
  #endif
  #undef CYTHON_USE_PYLIST_INTERNALS
  #define CYTHON_USE_PYLIST_INTERNALS 0
  #undef CYTHON_USE_UNICODE_INTERNALS
  #define CYTHON_USE_UNICODE_INTERNALS 0
  #undef CYTHON_USE_UNICODE_WRITER
  #define CYTHON_USE_UNICODE_WRITER 0
  #undef CYTHON_USE_PYLONG_INTERNALS
  #define CYTHON_USE_PYLONG_INTERNALS 0
  #undef CYTHON_AVOID_BORROWED_REFS
  #define CYTHON_AVOID_BORROWED_REFS 1
  #undef CYTHON_ASSUME_SAFE_MACROS
  #define CYTHON_ASSUME_SAFE_MACROS 0
  #undef CYTHON_UNPACK_METHODS
  #define CYTHON_UNPACK_METHODS 0
  #undef CYTHON_FAST_THREAD_STATE
  #define CYTHON_FAST_THREAD_STATE 0
  #undef CYTHON_FAST_PYCALL
  #define CYTHON_FAST_PYCALL 0
  #undef CYTHON_PEP489_MULTI_PHASE_INIT
  #define CYTHON_PEP489_MULTI_PHASE_INIT 0
  #undef CYTHON_USE_TP_FINALIZE
  #define CYTHON_USE_TP_FINALIZE 0
  #undef CYTHON_USE_DICT_VERSIONS
  #define CYTHON_USE_DICT_VERSIONS 0
  #undef CYTHON_USE_EXC_INFO_STACK
  #define CYTHON_USE_EXC_INFO_STACK 0
#elif defined(PYSTON_VERSION)
  #define CYTHON_COMPILING_IN_PYPY 0
  #define CYTHON_COMPILING_IN_PYSTON 1
  #define CYTHON_COMPILING_IN_CPYTHON 0
  #ifndef CYTHON_USE_TYPE_SLOTS
    #define CYTHON_USE_TYPE_SLOTS 1
  #endif
  #undef CYTHON_USE_PYTYPE_LOOKUP
  #define CYTHON_USE_PYTYPE_LOOKUP 0
  #undef CYTHON_USE_ASYNC_SLOTS
  #define CYTHON_USE_ASYNC_SLOTS 0
  #undef CYTHON_USE_PYLIST_INTERNALS
  #define CYTHON_USE_PYLIST_INTERNALS 0
  #ifndef CYTHON_USE_UNICODE_INTERNALS
    #define CYTHON_USE_UNICODE_INTERNALS 1
  #endif
  #undef CYTHON_USE_UNICODE_WRITER
  #define CYTHON_USE_UNICODE_WRITER 0
  #undef CYTHON_USE_PYLONG_INTERNALS
  #define CYTHON_USE_PYLONG_INTERNALS 0
  #ifndef CYTHON_AVOID_BORROWED_REFS
    #define CYTHON_AVOID_BORROWED_REFS 0
  #endif
  #ifndef CYTHON_ASSUME_SAFE_MACROS
    #define CYTHON_ASSUME_SAFE_MACROS 1
  #endif
  #ifndef CYTHON_UNPACK_METHODS
    #define CYTHON_UNPACK_METHODS 1
  #endif
  #undef CYTHON_FAST_THREAD_STATE
  #define CYTHON_FAST_THREAD_STATE 0
  #undef CYTHON_FAST_PYCALL
  #define CYTHON_FAST_PYCALL 0
  #undef CYTHON_PEP489_MULTI_PHASE_INIT
  #define CYTHON_PEP489_MULTI_PHASE_INIT 0
  #undef CYTHON_USE_TP_FINALIZE
  #define CYTHON_USE_TP_FINALIZE 0
  #undef CYTHON_USE_DICT_VERSIONS
  #define CYTHON_USE_DICT_VERSIONS 0
  #undef CYTHON_USE_EXC_INFO_STACK
  #define CYTHON_USE_EXC_INFO_STACK 0
#else
  #define CYTHON_COMPILING_IN_PYPY 0
  #define CYTHON_COMPILING_IN_PYSTON 0
  #define CYTHON_COMPILING_IN_CPYTHON 1
  #ifndef CYTHON_USE_TYPE_SLOTS
    #define CYTHON_USE_TYPE_SLOTS 1
  #endif
  #if PY_VERSION_HEX < 0x02070000
    #undef CYTHON_USE_PYTYPE_LOOKUP
    #define CYTHON_USE_PYTYPE_LOOKUP 0
  #elif !defined(CYTHON_USE_PYTYPE_LOOKUP)
    #define CYTHON_USE_PYTYPE_LOOKUP 1
  #endif
  #if PY_MAJOR_VERSION < 3
    #undef CYTHON_USE_ASYNC_SLOTS
    #define CYTHON_USE_ASYNC_SLOTS 0
  #elif !defined(CYTHON_USE_ASYNC_SLOTS)
    #define CYTHON_USE_ASYNC_SLOTS 1
  #endif
  #if PY_VERSION_HEX < 0x02070000
    #undef CYTHON_USE_PYLONG_INTERNALS
    #define CYTHON_USE_PYLONG_INTERNALS 0
  #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
    #define CYTHON_USE_PYLONG_INTERNALS 1
  #endif
  #ifndef CYTHON_USE_PYLIST_INTERNALS
    #define CYTHON_USE_PYLIST_INTERNALS 1
  #endif
  #ifndef CYTHON_USE_UNICODE_INTERNALS
    #define CYTHON_USE_UNICODE_INTERNALS 1
  #endif
  #if PY_VERSION_HEX < 0x030300F0
    #undef CYTHON_USE_UNICODE_WRITER
    #define CYTHON_USE_UNICODE_WRITER 0
  #elif !defined(CYTHON_USE_UNICODE_WRITER)
    #define CYTHON_USE_UNICODE_WRITER 1
  #endif
  #ifndef CYTHON_AVOID_BORROWED_REFS
    #define CYTHON_AVOID_BORROWED_REFS 0
  #endif
  #ifndef CYTHON_ASSUME_SAFE_MACROS
    #define CYTHON_ASSUME_SAFE_MACROS 1
  #endif
  #ifndef CYTHON_UNPACK_METHODS
    #define CYTHON_UNPACK_METHODS 1
  #endif
  #ifndef CYTHON_FAST_THREAD_STATE
    #define CYTHON_FAST_THREAD_STATE 1
  #endif
  #ifndef CYTHON_FAST_PYCALL
    #define CYTHON_FAST_PYCALL 1
  #endif
  #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
    #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
  #endif
  #ifndef CYTHON_USE_TP_FINALIZE
    #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
  #endif
  #ifndef CYTHON_USE_DICT_VERSIONS
    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
  #endif
  #ifndef CYTHON_USE_EXC_INFO_STACK
    #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
  #endif
#endif
#if !defined(CYTHON_FAST_PYCCALL)
#define CYTHON_FAST_PYCCALL  (CYTHON_FAST_PYCALL && PY_VERSION_HEX >= 0x030600B1)
#endif
#if CYTHON_USE_PYLONG_INTERNALS
  #include "longintrepr.h"
  #undef SHIFT
  #undef BASE
  #undef MASK
  #ifdef SIZEOF_VOID_P
    enum { __pyx_check_sizeof_voidp = 1 / (int)(SIZEOF_VOID_P == sizeof(void*)) };
  #endif
#endif
#ifndef __has_attribute
  #define __has_attribute(x) 0
#endif
#ifndef __has_cpp_attribute
  #define __has_cpp_attribute(x) 0
#endif
#ifndef CYTHON_RESTRICT
  #if defined(__GNUC__)
    #define CYTHON_RESTRICT __restrict__
  #elif defined(_MSC_VER) && _MSC_VER >= 1400
    #define CYTHON_RESTRICT __restrict
  #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
    #define CYTHON_RESTRICT restrict
  #else
    #define CYTHON_RESTRICT
  #endif
#endif
#ifndef CYTHON_UNUSED
# if defined(__GNUC__)
#   if !(defined(__cplusplus)) || (__GNUC__ > 3 || (__GNUC__ == 3 && __GNUC_MINOR__ >= 4))
#     define CYTHON_UNUSED __attribute__ ((__unused__))
#   else
#     define CYTHON_UNUSED
#   endif
# elif defined(__ICC) || (defined(__INTEL_COMPILER) && !defined(_MSC_VER))
#   define CYTHON_UNUSED __attribute__ ((__unused__))
# else
#   define CYTHON_UNUSED
# endif
#endif
#ifndef CYTHON_MAYBE_UNUSED_VAR
#  if defined(__cplusplus)
     template<class T> void CYTHON_MAYBE_UNUSED_VAR( const T& ) { }
#  else
#    define CYTHON_MAYBE_UNUSED_VAR(x) (void)(x)
#  endif
#endif
#ifndef CYTHON_NCP_UNUSED
# if CYTHON_COMPILING_IN_CPYTHON
#  define CYTHON_NCP_UNUSED
# else
#  define CYTHON_NCP_UNUSED CYTHON_UNUSED
# endif
#endif
#define __Pyx_void_to_None(void_result) ((void)(void_result), Py_INCREF(Py_None), Py_None)
#ifdef _MSC_VER
    #ifndef _MSC_STDINT_H_
        #if _MSC_VER < 1300
           typedef unsigned char     uint8_t;
           typedef unsigned int      uint32_t;
        #else
           typedef unsigned __int8   uint8_t;
           typedef unsigned __int32  uint32_t;
        #endif
    #endif
#else
   #include <stdint.h>
#endif
#ifndef CYTHON_FALLTHROUGH
  #if defined(__cplusplus) && __cplusplus >= 201103L
    #if __has_cpp_attribute(fallthrough)
      #define CYTHON_FALLTHROUGH [[fallthrough]]
    #elif __has_cpp_attribute(clang::fallthrough)
      #define CYTHON_FALLTHROUGH [[clang::fallthrough]]
    #elif __has_cpp_attribute(gnu::fallthrough)
      #define CYTHON_FALLTHROUGH [[gnu::fallthrough]]
    #endif
  #endif
  #ifndef CYTHON_FALLTHROUGH
    #if __has_attribute(fallthrough)
      #define CYTHON_FALLTHROUGH __attribute__((fallthrough))
    #else
      #define CYTHON_FALLTHROUGH
    #endif
  #endif
  #if defined(__clang__ ) && defined(__apple_build_version__)
    #if __apple_build_version__ < 7000000
      #undef  CYTHON_FALLTHROUGH
      #define CYTHON_FALLTHROUGH
    #endif
  #endif
#endif

#ifndef CYTHON_INLINE
  #if defined(__clang__)
    #define CYTHON_INLINE __inline__ __attribute__ ((__unused__))
  #elif defined(__GNUC__)
    #define CYTHON_INLINE __inline__
  #elif defined(_MSC_VER)
    #define CYTHON_INLINE __inline
  #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
    #define CYTHON_INLINE inline
  #else
    #define CYTHON_INLINE
  #endif
#endif

#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x02070600 && !defined(Py_OptimizeFlag)
  #define Py_OptimizeFlag 0
#endif
#define __PYX_BUILD_PY_SSIZE_T "n"
#define CYTHON_FORMAT_SSIZE_T "z"
#if PY_MAJOR_VERSION < 3
  #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
          PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
  #define __Pyx_DefaultClassType PyClass_Type
#else
  #define __Pyx_BUILTIN_MODULE_NAME "builtins"
#if PY_VERSION_HEX >= 0x030800A4 && PY_VERSION_HEX < 0x030800B2
  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
          PyCode_New(a, 0, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
#else
  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
          PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
#endif
  #define __Pyx_DefaultClassType PyType_Type
#endif
#ifndef Py_TPFLAGS_CHECKTYPES
  #define Py_TPFLAGS_CHECKTYPES 0
#endif
#ifndef Py_TPFLAGS_HAVE_INDEX
  #define Py_TPFLAGS_HAVE_INDEX 0
#endif
#ifndef Py_TPFLAGS_HAVE_NEWBUFFER
  #define Py_TPFLAGS_HAVE_NEWBUFFER 0
#endif
#ifndef Py_TPFLAGS_HAVE_FINALIZE
  #define Py_TPFLAGS_HAVE_FINALIZE 0
#endif
#ifndef METH_STACKLESS
  #define METH_STACKLESS 0
#endif
#if PY_VERSION_HEX <= 0x030700A3 || !defined(METH_FASTCALL)
  #ifndef METH_FASTCALL
     #define METH_FASTCALL 0x80
  #endif
  typedef PyObject *(*__Pyx_PyCFunctionFast) (PyObject *self, PyObject *const *args, Py_ssize_t nargs);
  typedef PyObject *(*__Pyx_PyCFunctionFastWithKeywords) (PyObject *self, PyObject *const *args,
                                                          Py_ssize_t nargs, PyObject *kwnames);
#else
  #define __Pyx_PyCFunctionFast _PyCFunctionFast
  #define __Pyx_PyCFunctionFastWithKeywords _PyCFunctionFastWithKeywords
#endif
#if CYTHON_FAST_PYCCALL
#define __Pyx_PyFastCFunction_Check(func)\
    ((PyCFunction_Check(func) && (METH_FASTCALL == (PyCFunction_GET_FLAGS(func) & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_KEYWORDS | METH_STACKLESS)))))
#else
#define __Pyx_PyFastCFunction_Check(func) 0
#endif
#if CYTHON_COMPILING_IN_PYPY && !defined(PyObject_Malloc)
  #define PyObject_Malloc(s)   PyMem_Malloc(s)
  #define PyObject_Free(p)     PyMem_Free(p)
  #define PyObject_Realloc(p)  PyMem_Realloc(p)
#endif
#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030400A1
  #define PyMem_RawMalloc(n)           PyMem_Malloc(n)
  #define PyMem_RawRealloc(p, n)       PyMem_Realloc(p, n)
  #define PyMem_RawFree(p)             PyMem_Free(p)
#endif
#if CYTHON_COMPILING_IN_PYSTON
  #define __Pyx_PyCode_HasFreeVars(co)  PyCode_HasFreeVars(co)
  #define __Pyx_PyFrame_SetLineNumber(frame, lineno) PyFrame_SetLineNumber(frame, lineno)
#else
  #define __Pyx_PyCode_HasFreeVars(co)  (PyCode_GetNumFree(co) > 0)
  #define __Pyx_PyFrame_SetLineNumber(frame, lineno)  (frame)->f_lineno = (lineno)
#endif
#if !CYTHON_FAST_THREAD_STATE || PY_VERSION_HEX < 0x02070000
  #define __Pyx_PyThreadState_Current PyThreadState_GET()
#elif PY_VERSION_HEX >= 0x03060000
  #define __Pyx_PyThreadState_Current _PyThreadState_UncheckedGet()
#elif PY_VERSION_HEX >= 0x03000000
  #define __Pyx_PyThreadState_Current PyThreadState_GET()
#else
  #define __Pyx_PyThreadState_Current _PyThreadState_Current
#endif
#if PY_VERSION_HEX < 0x030700A2 && !defined(PyThread_tss_create) && !defined(Py_tss_NEEDS_INIT)
#include "pythread.h"
#define Py_tss_NEEDS_INIT 0
typedef int Py_tss_t;
static CYTHON_INLINE int PyThread_tss_create(Py_tss_t *key) {
  *key = PyThread_create_key();
  return 0;
}
static CYTHON_INLINE Py_tss_t * PyThread_tss_alloc(void) {
  Py_tss_t *key = (Py_tss_t *)PyObject_Malloc(sizeof(Py_tss_t));
  *key = Py_tss_NEEDS_INIT;
  return key;
}
static CYTHON_INLINE void PyThread_tss_free(Py_tss_t *key) {
  PyObject_Free(key);
}
static CYTHON_INLINE int PyThread_tss_is_created(Py_tss_t *key) {
  return *key != Py_tss_NEEDS_INIT;
}
static CYTHON_INLINE void PyThread_tss_delete(Py_tss_t *key) {
  PyThread_delete_key(*key);
  *key = Py_tss_NEEDS_INIT;
}
static CYTHON_INLINE int PyThread_tss_set(Py_tss_t *key, void *value) {
  return PyThread_set_key_value(*key, value);
}
static CYTHON_INLINE void * PyThread_tss_get(Py_tss_t *key) {
  return PyThread_get_key_value(*key);
}
#endif
#if CYTHON_COMPILING_IN_CPYTHON || defined(_PyDict_NewPresized)
#define __Pyx_PyDict_NewPresized(n)  ((n <= 8) ? PyDict_New() : _PyDict_NewPresized(n))
#else
#define __Pyx_PyDict_NewPresized(n)  PyDict_New()
#endif
#if PY_MAJOR_VERSION >= 3 || CYTHON_FUTURE_DIVISION
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_TrueDivide(x,y)
  #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceTrueDivide(x,y)
#else
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_Divide(x,y)
  #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceDivide(x,y)
#endif
#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1 && CYTHON_USE_UNICODE_INTERNALS
#define __Pyx_PyDict_GetItemStr(dict, name)  _PyDict_GetItem_KnownHash(dict, name, ((PyASCIIObject *) name)->hash)
#else
#define __Pyx_PyDict_GetItemStr(dict, name)  PyDict_GetItem(dict, name)
#endif
#if PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
  #define CYTHON_PEP393_ENABLED 1
  #if defined(PyUnicode_IS_READY)
  #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
                                              0 : _PyUnicode_Ready((PyObject *)(op)))
  #else
  #define __Pyx_PyUnicode_READY(op)       (0)
  #endif
  #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_LENGTH(u)
  #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_READ_CHAR(u, i)
  #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   PyUnicode_MAX_CHAR_VALUE(u)
  #define __Pyx_PyUnicode_KIND(u)         PyUnicode_KIND(u)
  #define __Pyx_PyUnicode_DATA(u)         PyUnicode_DATA(u)
  #define __Pyx_PyUnicode_READ(k, d, i)   PyUnicode_READ(k, d, i)
  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  PyUnicode_WRITE(k, d, i, ch)
  #if defined(PyUnicode_IS_READY) && defined(PyUnicode_GET_SIZE)
  #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
  #else
  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
  #endif
  #else
  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
  #endif
#else
  #define CYTHON_PEP393_ENABLED 0
  #define PyUnicode_1BYTE_KIND  1
  #define PyUnicode_2BYTE_KIND  2
  #define PyUnicode_4BYTE_KIND  4
  #define __Pyx_PyUnicode_READY(op)       (0)
  #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_SIZE(u)
  #define __Pyx_PyUnicode_READ_CHAR(u, i) ((Py_UCS4)(PyUnicode_AS_UNICODE(u)[i]))
  #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   ((sizeof(Py_UNICODE) == 2) ? 65535 : 1114111)
  #define __Pyx_PyUnicode_KIND(u)         (sizeof(Py_UNICODE))
  #define __Pyx_PyUnicode_DATA(u)         ((void*)PyUnicode_AS_UNICODE(u))
  #define __Pyx_PyUnicode_READ(k, d, i)   ((void)(k), (Py_UCS4)(((Py_UNICODE*)d)[i]))
  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  (((void)(k)), ((Py_UNICODE*)d)[i] = ch)
  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_SIZE(u))
#endif
#if CYTHON_COMPILING_IN_PYPY
  #define __Pyx_PyUnicode_Concat(a, b)      PyNumber_Add(a, b)
  #define __Pyx_PyUnicode_ConcatSafe(a, b)  PyNumber_Add(a, b)
#else
  #define __Pyx_PyUnicode_Concat(a, b)      PyUnicode_Concat(a, b)
  #define __Pyx_PyUnicode_ConcatSafe(a, b)  ((unlikely((a) == Py_None) || unlikely((b) == Py_None)) ?\
      PyNumber_Add(a, b) : __Pyx_PyUnicode_Concat(a, b))
#endif
#if CYTHON_COMPILING_IN_PYPY && !defined(PyUnicode_Contains)
  #define PyUnicode_Contains(u, s)  PySequence_Contains(u, s)
#endif
#if CYTHON_COMPILING_IN_PYPY && !defined(PyByteArray_Check)
  #define PyByteArray_Check(obj)  PyObject_TypeCheck(obj, &PyByteArray_Type)
#endif
#if CYTHON_COMPILING_IN_PYPY && !defined(PyObject_Format)
  #define PyObject_Format(obj, fmt)  PyObject_CallMethod(obj, "__format__", "O", fmt)
#endif
#define __Pyx_PyString_FormatSafe(a, b)   ((unlikely((a) == Py_None || (PyString_Check(b) && !PyString_CheckExact(b)))) ? PyNumber_Remainder(a, b) : __Pyx_PyString_Format(a, b))
#define __Pyx_PyUnicode_FormatSafe(a, b)  ((unlikely((a) == Py_None || (PyUnicode_Check(b) && !PyUnicode_CheckExact(b)))) ? PyNumber_Remainder(a, b) : PyUnicode_Format(a, b))
#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyString_Format(a, b)  PyUnicode_Format(a, b)
#else
  #define __Pyx_PyString_Format(a, b)  PyString_Format(a, b)
#endif
#if PY_MAJOR_VERSION < 3 && !defined(PyObject_ASCII)
  #define PyObject_ASCII(o)            PyObject_Repr(o)
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyBaseString_Type            PyUnicode_Type
  #define PyStringObject               PyUnicodeObject
  #define PyString_Type                PyUnicode_Type
  #define PyString_Check               PyUnicode_Check
  #define PyString_CheckExact          PyUnicode_CheckExact
#ifndef PyObject_Unicode
  #define PyObject_Unicode             PyObject_Str
#endif
#endif
#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyBaseString_Check(obj) PyUnicode_Check(obj)
  #define __Pyx_PyBaseString_CheckExact(obj) PyUnicode_CheckExact(obj)
#else
  #define __Pyx_PyBaseString_Check(obj) (PyString_Check(obj) || PyUnicode_Check(obj))
  #define __Pyx_PyBaseString_CheckExact(obj) (PyString_CheckExact(obj) || PyUnicode_CheckExact(obj))
#endif
#ifndef PySet_CheckExact
  #define PySet_CheckExact(obj)        (Py_TYPE(obj) == &PySet_Type)
#endif
#if PY_VERSION_HEX >= 0x030900A4
  #define __Pyx_SET_REFCNT(obj, refcnt) Py_SET_REFCNT(obj, refcnt)
  #define __Pyx_SET_SIZE(obj, size) Py_SET_SIZE(obj, size)
#else
  #define __Pyx_SET_REFCNT(obj, refcnt) Py_REFCNT(obj) = (refcnt)
  #define __Pyx_SET_SIZE(obj, size) Py_SIZE(obj) = (size)
#endif
#if CYTHON_ASSUME_SAFE_MACROS
  #define __Pyx_PySequence_SIZE(seq)  Py_SIZE(seq)
#else
  #define __Pyx_PySequence_SIZE(seq)  PySequence_Size(seq)
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyIntObject                  PyLongObject
  #define PyInt_Type                   PyLong_Type
  #define PyInt_Check(op)              PyLong_Check(op)
  #define PyInt_CheckExact(op)         PyLong_CheckExact(op)
  #define PyInt_FromString             PyLong_FromString
  #define PyInt_FromUnicode            PyLong_FromUnicode
  #define PyInt_FromLong               PyLong_FromLong
  #define PyInt_FromSize_t             PyLong_FromSize_t
  #define PyInt_FromSsize_t            PyLong_FromSsize_t
  #define PyInt_AsLong                 PyLong_AsLong
  #define PyInt_AS_LONG                PyLong_AS_LONG
  #define PyInt_AsSsize_t              PyLong_AsSsize_t
  #define PyInt_AsUnsignedLongMask     PyLong_AsUnsignedLongMask
  #define PyInt_AsUnsignedLongLongMask PyLong_AsUnsignedLongLongMask
  #define PyNumber_Int                 PyNumber_Long
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyBoolObject                 PyLongObject
#endif
#if PY_MAJOR_VERSION >= 3 && CYTHON_COMPILING_IN_PYPY
  #ifndef PyUnicode_InternFromString
    #define PyUnicode_InternFromString(s) PyUnicode_FromString(s)
  #endif
#endif
#if PY_VERSION_HEX < 0x030200A4
  typedef long Py_hash_t;
  #define __Pyx_PyInt_FromHash_t PyInt_FromLong
  #define __Pyx_PyInt_AsHash_t   PyInt_AsLong
#else
  #define __Pyx_PyInt_FromHash_t PyInt_FromSsize_t
  #define __Pyx_PyInt_AsHash_t   PyInt_AsSsize_t
#endif
#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyMethod_New(func, self, klass) ((self) ? ((void)(klass), PyMethod_New(func, self)) : __Pyx_NewRef(func))
#else
  #define __Pyx_PyMethod_New(func, self, klass) PyMethod_New(func, self, klass)
#endif
#if CYTHON_USE_ASYNC_SLOTS
  #if PY_VERSION_HEX >= 0x030500B1
    #define __Pyx_PyAsyncMethodsStruct PyAsyncMethods
    #define __Pyx_PyType_AsAsync(obj) (Py_TYPE(obj)->tp_as_async)
  #else
    #define __Pyx_PyType_AsAsync(obj) ((__Pyx_PyAsyncMethodsStruct*) (Py_TYPE(obj)->tp_reserved))
  #endif
#else
  #define __Pyx_PyType_AsAsync(obj) NULL
#endif
#ifndef __Pyx_PyAsyncMethodsStruct
    typedef struct {
        unaryfunc am_await;
        unaryfunc am_aiter;
        unaryfunc am_anext;
    } __Pyx_PyAsyncMethodsStruct;
#endif

#if defined(WIN32) || defined(MS_WINDOWS)
  #define _USE_MATH_DEFINES
#endif
#include <math.h>
#ifdef NAN
#define __PYX_NAN() ((float) NAN)
#else
static CYTHON_INLINE float __PYX_NAN() {
  float value;
  memset(&value, 0xFF, sizeof(value));
  return value;
}
#endif
#if defined(__CYGWIN__) && defined(_LDBL_EQ_DBL)
#define __Pyx_truncl trunc
#else
#define __Pyx_truncl truncl
#endif

#define __PYX_MARK_ERR_POS(f_index, lineno) \
    { __pyx_filename = __pyx_f[f_index]; (void)__pyx_filename; __pyx_lineno = lineno; (void)__pyx_lineno; __pyx_clineno = __LINE__; (void)__pyx_clineno; }
#define __PYX_ERR(f_index, lineno, Ln_error) \
    { __PYX_MARK_ERR_POS(f_index, lineno) goto Ln_error; }

#ifndef __PYX_EXTERN_C
  #ifdef __cplusplus
    #define __PYX_EXTERN_C extern "C"
  #else
    #define __PYX_EXTERN_C extern
  #endif
#endif

#define __PYX_HAVE__vcstring
#define __PYX_HAVE_API__vcstring
/* Early includes */
#include <string.h>
#include <stdio.h>
#include "numpy/arrayobject.h"
#include "numpy/ndarrayobject.h"
#include "numpy/ndarraytypes.h"
#include "numpy/arrayscalars.h"
#include "numpy/ufuncobject.h"

    /* NumPy API declarations from "numpy/__init__.pxd" */
    
#ifdef _OPENMP
#include <omp.h>
#endif /* _OPENMP */

#if defined(PYREX_WITHOUT_ASSERTIONS) && !defined(CYTHON_WITHOUT_ASSERTIONS)
#define CYTHON_WITHOUT_ASSERTIONS
#endif

typedef struct {PyObject **p; const char *s; const Py_ssize_t n; const char* encoding;
                const char is_unicode; const char is_str; const char intern; } __Pyx_StringTabEntry;

#define __PYX_DEFAULT_STRING_ENCODING_IS_ASCII 0
#define __PYX_DEFAULT_STRING_ENCODING_IS_UTF8 0
#define __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT (PY_MAJOR_VERSION >= 3 && __PYX_DEFAULT_STRING_ENCODING_IS_UTF8)
#define __PYX_DEFAULT_STRING_ENCODING ""
#define __Pyx_PyObject_FromString __Pyx_PyBytes_FromString
#define __Pyx_PyObject_FromStringAndSize __Pyx_PyBytes_FromStringAndSize
#define __Pyx_uchar_cast(c) ((unsigned char)c)
#define __Pyx_long_cast(x) ((long)x)
#define __Pyx_fits_Py_ssize_t(v, type, is_signed)  (\
    (sizeof(type) < sizeof(Py_ssize_t))  ||\
    (sizeof(type) > sizeof(Py_ssize_t) &&\
          likely(v < (type)PY_SSIZE_T_MAX ||\
                 v == (type)PY_SSIZE_T_MAX)  &&\
          (!is_signed || likely(v > (type)PY_SSIZE_T_MIN ||\
                                v == (type)PY_SSIZE_T_MIN)))  ||\
    (sizeof(type) == sizeof(Py_ssize_t) &&\
          (is_signed || likely(v < (type)PY_SSIZE_T_MAX ||\
                               v == (type)PY_SSIZE_T_MAX)))  )
static CYTHON_INLINE int __Pyx_is_valid_index(Py_ssize_t i, Py_ssize_t limit) {
    return (size_t) i < (size_t) limit;
}
#if defined (__cplusplus) && __cplusplus >= 201103L
    #include <cstdlib>
    #define __Pyx_sst_abs(value) std::abs(value)
#elif SIZEOF_INT >= SIZEOF_SIZE_T
    #define __Pyx_sst_abs(value) abs(value)
#elif SIZEOF_LONG >= SIZEOF_SIZE_T
    #define __Pyx_sst_abs(value) labs(value)
#elif defined (_MSC_VER)
    #define __Pyx_sst_abs(value) ((Py_ssize_t)_abs64(value))
#elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
    #define __Pyx_sst_abs(value) llabs(value)
#elif defined (__GNUC__)
    #define __Pyx_sst_abs(value) __builtin_llabs(value)
#else
    #define __Pyx_sst_abs(value) ((value<0) ? -value : value)
#endif
static CYTHON_INLINE const char* __Pyx_PyObject_AsString(PyObject*);
static CYTHON_INLINE const char* __Pyx_PyObject_AsStringAndSize(PyObject*, Py_ssize_t* length);
#define __Pyx_PyByteArray_FromString(s) PyByteArray_FromStringAndSize((const char*)s, strlen((const char*)s))
#define __Pyx_PyByteArray_FromStringAndSize(s, l) PyByteArray_FromStringAndSize((const char*)s, l)
#define __Pyx_PyBytes_FromString        PyBytes_FromString
#define __Pyx_PyBytes_FromStringAndSize PyBytes_FromStringAndSize
static CYTHON_INLINE PyObject* __Pyx_PyUnicode_FromString(const char*);
#if PY_MAJOR_VERSION < 3
    #define __Pyx_PyStr_FromString        __Pyx_PyBytes_FromString
    #define __Pyx_PyStr_FromStringAndSize __Pyx_PyBytes_FromStringAndSize
#else
    #define __Pyx_PyStr_FromString        __Pyx_PyUnicode_FromString
    #define __Pyx_PyStr_FromStringAndSize __Pyx_PyUnicode_FromStringAndSize
#endif
#define __Pyx_PyBytes_AsWritableString(s)     ((char*) PyBytes_AS_STRING(s))
#define __Pyx_PyBytes_AsWritableSString(s)    ((signed char*) PyBytes_AS_STRING(s))
#define __Pyx_PyBytes_AsWritableUString(s)    ((unsigned char*) PyBytes_AS_STRING(s))
#define __Pyx_PyBytes_AsString(s)     ((const char*) PyBytes_AS_STRING(s))
#define __Pyx_PyBytes_AsSString(s)    ((const signed char*) PyBytes_AS_STRING(s))
#define __Pyx_PyBytes_AsUString(s)    ((const unsigned char*) PyBytes_AS_STRING(s))
#define __Pyx_PyObject_AsWritableString(s)    ((char*) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_AsWritableSString(s)    ((signed char*) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_AsWritableUString(s)    ((unsigned char*) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_AsSString(s)    ((const signed char*) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_AsUString(s)    ((const unsigned char*) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_FromCString(s)  __Pyx_PyObject_FromString((const char*)s)
#define __Pyx_PyBytes_FromCString(s)   __Pyx_PyBytes_FromString((const char*)s)
#define __Pyx_PyByteArray_FromCString(s)   __Pyx_PyByteArray_FromString((const char*)s)
#define __Pyx_PyStr_FromCString(s)     __Pyx_PyStr_FromString((const char*)s)
#define __Pyx_PyUnicode_FromCString(s) __Pyx_PyUnicode_FromString((const char*)s)
static CYTHON_INLINE size_t __Pyx_Py_UNICODE_strlen(const Py_UNICODE *u) {
    const Py_UNICODE *u_end = u;
    while (*u_end++) ;
    return (size_t)(u_end - u - 1);
}
#define __Pyx_PyUnicode_FromUnicode(u)       PyUnicode_FromUnicode(u, __Pyx_Py_UNICODE_strlen(u))
#define __Pyx_PyUnicode_FromUnicodeAndLength PyUnicode_FromUnicode
#define __Pyx_PyUnicode_AsUnicode            PyUnicode_AsUnicode
#define __Pyx_NewRef(obj) (Py_INCREF(obj), obj)
#define __Pyx_Owned_Py_None(b) __Pyx_NewRef(Py_None)
static CYTHON_INLINE PyObject * __Pyx_PyBool_FromLong(long b);
static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject*);
static CYTHON_INLINE int __Pyx_PyObject_IsTrueAndDecref(PyObject*);
static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x);
#define __Pyx_PySequence_Tuple(obj)\
    (likely(PyTuple_CheckExact(obj)) ? __Pyx_NewRef(obj) : PySequence_Tuple(obj))
static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
#if CYTHON_ASSUME_SAFE_MACROS
#define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))
#else
#define __pyx_PyFloat_AsDouble(x) PyFloat_AsDouble(x)
#endif
#define __pyx_PyFloat_AsFloat(x) ((float) __pyx_PyFloat_AsDouble(x))
#if PY_MAJOR_VERSION >= 3
#define __Pyx_PyNumber_Int(x) (PyLong_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Long(x))
#else
#define __Pyx_PyNumber_Int(x) (PyInt_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Int(x))
#endif
#define __Pyx_PyNumber_Float(x) (PyFloat_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Float(x))
#if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
static int __Pyx_sys_getdefaultencoding_not_ascii;
static int __Pyx_init_sys_getdefaultencoding_params(void) {
    PyObject* sys;
    PyObject* default_encoding = NULL;
    PyObject* ascii_chars_u = NULL;
    PyObject* ascii_chars_b = NULL;
    const char* default_encoding_c;
    sys = PyImport_ImportModule("sys");
    if (!sys) goto bad;
    default_encoding = PyObject_CallMethod(sys, (char*) "getdefaultencoding", NULL);
    Py_DECREF(sys);
    if (!default_encoding) goto bad;
    default_encoding_c = PyBytes_AsString(default_encoding);
    if (!default_encoding_c) goto bad;
    if (strcmp(default_encoding_c, "ascii") == 0) {
        __Pyx_sys_getdefaultencoding_not_ascii = 0;
    } else {
        char ascii_chars[128];
        int c;
        for (c = 0; c < 128; c++) {
            ascii_chars[c] = c;
        }
        __Pyx_sys_getdefaultencoding_not_ascii = 1;
        ascii_chars_u = PyUnicode_DecodeASCII(ascii_chars, 128, NULL);
        if (!ascii_chars_u) goto bad;
        ascii_chars_b = PyUnicode_AsEncodedString(ascii_chars_u, default_encoding_c, NULL);
        if (!ascii_chars_b || !PyBytes_Check(ascii_chars_b) || memcmp(ascii_chars, PyBytes_AS_STRING(ascii_chars_b), 128) != 0) {
            PyErr_Format(
                PyExc_ValueError,
                "This module compiled with c_string_encoding=ascii, but default encoding '%.200s' is not a superset of ascii.",
                default_encoding_c);
            goto bad;
        }
        Py_DECREF(ascii_chars_u);
        Py_DECREF(ascii_chars_b);
    }
    Py_DECREF(default_encoding);
    return 0;
bad:
    Py_XDECREF(default_encoding);
    Py_XDECREF(ascii_chars_u);
    Py_XDECREF(ascii_chars_b);
    return -1;
}
#endif
#if __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT && PY_MAJOR_VERSION >= 3
#define __Pyx_PyUnicode_FromStringAndSize(c_str, size) PyUnicode_DecodeUTF8(c_str, size, NULL)
#else
#define __Pyx_PyUnicode_FromStringAndSize(c_str, size) PyUnicode_Decode(c_str, size, __PYX_DEFAULT_STRING_ENCODING, NULL)
#if __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT
static char* __PYX_DEFAULT_STRING_ENCODING;
static int __Pyx_init_sys_getdefaultencoding_params(void) {
    PyObject* sys;
    PyObject* default_encoding = NULL;
    char* default_encoding_c;
    sys = PyImport_ImportModule("sys");
    if (!sys) goto bad;
    default_encoding = PyObject_CallMethod(sys, (char*) (const char*) "getdefaultencoding", NULL);
    Py_DECREF(sys);
    if (!default_encoding) goto bad;
    default_encoding_c = PyBytes_AsString(default_encoding);
    if (!default_encoding_c) goto bad;
    __PYX_DEFAULT_STRING_ENCODING = (char*) malloc(strlen(default_encoding_c) + 1);
    if (!__PYX_DEFAULT_STRING_ENCODING) goto bad;
    strcpy(__PYX_DEFAULT_STRING_ENCODING, default_encoding_c);
    Py_DECREF(default_encoding);
    return 0;
bad:
    Py_XDECREF(default_encoding);
    return -1;
}
#endif
#endif


/* Test for GCC > 2.95 */
#if defined(__GNUC__)     && (__GNUC__ > 2 || (__GNUC__ == 2 && (__GNUC_MINOR__ > 95)))
  #define likely(x)   __builtin_expect(!!(x), 1)
  #define unlikely(x) __builtin_expect(!!(x), 0)
#else /* !__GNUC__ or GCC < 2.95 */
  #define likely(x)   (x)
  #define unlikely(x) (x)
#endif /* __GNUC__ */
static CYTHON_INLINE void __Pyx_pretend_to_initialize(void* ptr) { (void)ptr; }

static PyObject *__pyx_m = NULL;
static PyObject *__pyx_d;
static PyObject *__pyx_b;
static PyObject *__pyx_cython_runtime = NULL;
static PyObject *__pyx_empty_tuple;
static PyObject *__pyx_empty_bytes;
static PyObject *__pyx_empty_unicode;
static int __pyx_lineno;
static int __pyx_clineno = 0;
static const char * __pyx_cfilenm= __FILE__;
static const char *__pyx_filename;

/* Header.proto */
#if !defined(CYTHON_CCOMPLEX)
  #if defined(__cplusplus)
    #define CYTHON_CCOMPLEX 1
  #elif defined(_Complex_I)
    #define CYTHON_CCOMPLEX 1
  #else
    #define CYTHON_CCOMPLEX 0
  #endif
#endif
#if CYTHON_CCOMPLEX
  #ifdef __cplusplus
    #include <complex>
  #else
    #include <complex.h>
  #endif
#endif
#if CYTHON_CCOMPLEX && !defined(__cplusplus) && defined(__sun__) && defined(__GNUC__)
  #undef _Complex_I
  #define _Complex_I 1.0fj
#endif


static const char *__pyx_f[] = {
  "vcstring.pyx",
  "stringsource",
  "__init__.pxd",
  "type.pxd",
};
/* BufferFormatStructs.proto */
#define IS_UNSIGNED(type) (((type) -1) > 0)
struct __Pyx_StructField_;
#define __PYX_BUF_FLAGS_PACKED_STRUCT (1 << 0)
typedef struct {
  const char* name;
  struct __Pyx_StructField_* fields;
  size_t size;
  size_t arraysize[8];
  int ndim;
  char typegroup;
  char is_unsigned;
  int flags;
} __Pyx_TypeInfo;
typedef struct __Pyx_StructField_ {
  __Pyx_TypeInfo* type;
  const char* name;
  size_t offset;
} __Pyx_StructField;
typedef struct {
  __Pyx_StructField* field;
  size_t parent_offset;
} __Pyx_BufFmt_StackElem;
typedef struct {
  __Pyx_StructField root;
  __Pyx_BufFmt_StackElem* head;
  size_t fmt_offset;
  size_t new_count, enc_count;
  size_t struct_alignment;
  int is_complex;
  char enc_type;
  char new_packmode;
  char enc_packmode;
  char is_valid_array;
} __Pyx_BufFmt_Context;


/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":690
 * # in Cython to enable them only on the right systems.
 * 
 * ctypedef npy_int8       int8_t             # <<<<<<<<<<<<<<
 * ctypedef npy_int16      int16_t
 * ctypedef npy_int32      int32_t
 */
typedef npy_int8 __pyx_t_5numpy_int8_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":691
 * 
 * ctypedef npy_int8       int8_t
 * ctypedef npy_int16      int16_t             # <<<<<<<<<<<<<<
 * ctypedef npy_int32      int32_t
 * ctypedef npy_int64      int64_t
 */
typedef npy_int16 __pyx_t_5numpy_int16_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":692
 * ctypedef npy_int8       int8_t
 * ctypedef npy_int16      int16_t
 * ctypedef npy_int32      int32_t             # <<<<<<<<<<<<<<
 * ctypedef npy_int64      int64_t
 * #ctypedef npy_int96      int96_t
 */
typedef npy_int32 __pyx_t_5numpy_int32_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":693
 * ctypedef npy_int16      int16_t
 * ctypedef npy_int32      int32_t
 * ctypedef npy_int64      int64_t             # <<<<<<<<<<<<<<
 * #ctypedef npy_int96      int96_t
 * #ctypedef npy_int128     int128_t
 */
typedef npy_int64 __pyx_t_5numpy_int64_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":697
 * #ctypedef npy_int128     int128_t
 * 
 * ctypedef npy_uint8      uint8_t             # <<<<<<<<<<<<<<
 * ctypedef npy_uint16     uint16_t
 * ctypedef npy_uint32     uint32_t
 */
typedef npy_uint8 __pyx_t_5numpy_uint8_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":698
 * 
 * ctypedef npy_uint8      uint8_t
 * ctypedef npy_uint16     uint16_t             # <<<<<<<<<<<<<<
 * ctypedef npy_uint32     uint32_t
 * ctypedef npy_uint64     uint64_t
 */
typedef npy_uint16 __pyx_t_5numpy_uint16_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":699
 * ctypedef npy_uint8      uint8_t
 * ctypedef npy_uint16     uint16_t
 * ctypedef npy_uint32     uint32_t             # <<<<<<<<<<<<<<
 * ctypedef npy_uint64     uint64_t
 * #ctypedef npy_uint96     uint96_t
 */
typedef npy_uint32 __pyx_t_5numpy_uint32_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":700
 * ctypedef npy_uint16     uint16_t
 * ctypedef npy_uint32     uint32_t
 * ctypedef npy_uint64     uint64_t             # <<<<<<<<<<<<<<
 * #ctypedef npy_uint96     uint96_t
 * #ctypedef npy_uint128    uint128_t
 */
typedef npy_uint64 __pyx_t_5numpy_uint64_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":704
 * #ctypedef npy_uint128    uint128_t
 * 
 * ctypedef npy_float32    float32_t             # <<<<<<<<<<<<<<
 * ctypedef npy_float64    float64_t
 * #ctypedef npy_float80    float80_t
 */
typedef npy_float32 __pyx_t_5numpy_float32_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":705
 * 
 * ctypedef npy_float32    float32_t
 * ctypedef npy_float64    float64_t             # <<<<<<<<<<<<<<
 * #ctypedef npy_float80    float80_t
 * #ctypedef npy_float128   float128_t
 */
typedef npy_float64 __pyx_t_5numpy_float64_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":714
 * # The int types are mapped a bit surprising --
 * # numpy.int corresponds to 'l' and numpy.long to 'q'
 * ctypedef npy_long       int_t             # <<<<<<<<<<<<<<
 * ctypedef npy_longlong   long_t
 * ctypedef npy_longlong   longlong_t
 */
typedef npy_long __pyx_t_5numpy_int_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":715
 * # numpy.int corresponds to 'l' and numpy.long to 'q'
 * ctypedef npy_long       int_t
 * ctypedef npy_longlong   long_t             # <<<<<<<<<<<<<<
 * ctypedef npy_longlong   longlong_t
 * 
 */
typedef npy_longlong __pyx_t_5numpy_long_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":716
 * ctypedef npy_long       int_t
 * ctypedef npy_longlong   long_t
 * ctypedef npy_longlong   longlong_t             # <<<<<<<<<<<<<<
 * 
 * ctypedef npy_ulong      uint_t
 */
typedef npy_longlong __pyx_t_5numpy_longlong_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":718
 * ctypedef npy_longlong   longlong_t
 * 
 * ctypedef npy_ulong      uint_t             # <<<<<<<<<<<<<<
 * ctypedef npy_ulonglong  ulong_t
 * ctypedef npy_ulonglong  ulonglong_t
 */
typedef npy_ulong __pyx_t_5numpy_uint_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":719
 * 
 * ctypedef npy_ulong      uint_t
 * ctypedef npy_ulonglong  ulong_t             # <<<<<<<<<<<<<<
 * ctypedef npy_ulonglong  ulonglong_t
 * 
 */
typedef npy_ulonglong __pyx_t_5numpy_ulong_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":720
 * ctypedef npy_ulong      uint_t
 * ctypedef npy_ulonglong  ulong_t
 * ctypedef npy_ulonglong  ulonglong_t             # <<<<<<<<<<<<<<
 * 
 * ctypedef npy_intp       intp_t
 */
typedef npy_ulonglong __pyx_t_5numpy_ulonglong_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":722
 * ctypedef npy_ulonglong  ulonglong_t
 * 
 * ctypedef npy_intp       intp_t             # <<<<<<<<<<<<<<
 * ctypedef npy_uintp      uintp_t
 * 
 */
typedef npy_intp __pyx_t_5numpy_intp_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":723
 * 
 * ctypedef npy_intp       intp_t
 * ctypedef npy_uintp      uintp_t             # <<<<<<<<<<<<<<
 * 
 * ctypedef npy_double     float_t
 */
typedef npy_uintp __pyx_t_5numpy_uintp_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":725
 * ctypedef npy_uintp      uintp_t
 * 
 * ctypedef npy_double     float_t             # <<<<<<<<<<<<<<
 * ctypedef npy_double     double_t
 * ctypedef npy_longdouble longdouble_t
 */
typedef npy_double __pyx_t_5numpy_float_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":726
 * 
 * ctypedef npy_double     float_t
 * ctypedef npy_double     double_t             # <<<<<<<<<<<<<<
 * ctypedef npy_longdouble longdouble_t
 * 
 */
typedef npy_double __pyx_t_5numpy_double_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":727
 * ctypedef npy_double     float_t
 * ctypedef npy_double     double_t
 * ctypedef npy_longdouble longdouble_t             # <<<<<<<<<<<<<<
 * 
 * ctypedef npy_cfloat      cfloat_t
 */
typedef npy_longdouble __pyx_t_5numpy_longdouble_t;

/* "vcstring.pyx":11
 * np.import_array()
 * DTYPE = np.float64
 * ctypedef np.float64_t DTYPE_t             # <<<<<<<<<<<<<<
 * 
 * cdef class vcstring:
 */
typedef __pyx_t_5numpy_float64_t __pyx_t_8vcstring_DTYPE_t;
/* Declarations.proto */
#if CYTHON_CCOMPLEX
  #ifdef __cplusplus
    typedef ::std::complex< float > __pyx_t_float_complex;
  #else
    typedef float _Complex __pyx_t_float_complex;
  #endif
#else
    typedef struct { float real, imag; } __pyx_t_float_complex;
#endif
static CYTHON_INLINE __pyx_t_float_complex __pyx_t_float_complex_from_parts(float, float);

/* Declarations.proto */
#if CYTHON_CCOMPLEX
  #ifdef __cplusplus
    typedef ::std::complex< double > __pyx_t_double_complex;
  #else
    typedef double _Complex __pyx_t_double_complex;
  #endif
#else
    typedef struct { double real, imag; } __pyx_t_double_complex;
#endif
static CYTHON_INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(double, double);


/*--- Type declarations ---*/
struct __pyx_obj_8vcstring_vcstring;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":729
 * ctypedef npy_longdouble longdouble_t
 * 
 * ctypedef npy_cfloat      cfloat_t             # <<<<<<<<<<<<<<
 * ctypedef npy_cdouble     cdouble_t
 * ctypedef npy_clongdouble clongdouble_t
 */
typedef npy_cfloat __pyx_t_5numpy_cfloat_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":730
 * 
 * ctypedef npy_cfloat      cfloat_t
 * ctypedef npy_cdouble     cdouble_t             # <<<<<<<<<<<<<<
 * ctypedef npy_clongdouble clongdouble_t
 * 
 */
typedef npy_cdouble __pyx_t_5numpy_cdouble_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":731
 * ctypedef npy_cfloat      cfloat_t
 * ctypedef npy_cdouble     cdouble_t
 * ctypedef npy_clongdouble clongdouble_t             # <<<<<<<<<<<<<<
 * 
 * ctypedef npy_cdouble     complex_t
 */
typedef npy_clongdouble __pyx_t_5numpy_clongdouble_t;

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":733
 * ctypedef npy_clongdouble clongdouble_t
 * 
 * ctypedef npy_cdouble     complex_t             # <<<<<<<<<<<<<<
 * 
 * cdef inline object PyArray_MultiIterNew1(a):
 */
typedef npy_cdouble __pyx_t_5numpy_complex_t;
struct __pyx_opt_args_8vcstring_8vcstring_assign_states_ensemble;
struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs;
struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble;
struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg;
struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast;
struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast_v2;
struct __pyx_opt_args_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg;
struct __pyx_opt_args_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg_fast;
struct __pyx_opt_args_8vcstring_8vcstring_finite_diff_corr;
struct __pyx_opt_args_8vcstring_8vcstring_finite_diff_committor;
struct __pyx_opt_args_8vcstring_8vcstring_montecarlo;
struct __pyx_opt_args_8vcstring_8vcstring_montecarlo_symmetric;
struct __pyx_opt_args_8vcstring_elliptical_bounds_params;

/* "vcstring.pyx":161
 * 
 * 
 *     cpdef assign_states_ensemble(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, int t0=0, list weights=None, stride=None):             # <<<<<<<<<<<<<<
 *         """
 *         Assign points to Voronoi cells for ensemble of aggregate trajectories.
 */
struct __pyx_opt_args_8vcstring_8vcstring_assign_states_ensemble {
  int __pyx_n;
  int t0;
  PyObject *weights;
  PyObject *stride;
};

/* "vcstring.pyx":286
 * 
 * 
 *     cpdef calc_coeffs(self, int N, int tau, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=2] ids, symmetric=True):             # <<<<<<<<<<<<<<
 *         """
 *         Solve the linear equation from minimizing the forward steady-state flux.
 */
struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs {
  int __pyx_n;
  PyObject *symmetric;
};

/* "vcstring.pyx":549
 * 
 * 
 *     cpdef calc_coeffs_ensemble(self, int N, int tau, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=2] ids, symmetric=True):             # <<<<<<<<<<<<<<
 *         """
 *         Solve the linear equation from minimizing the forward steady-state flux.
 */
struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble {
  int __pyx_n;
  PyObject *symmetric;
};

/* "vcstring.pyx":650
 * 
 * 
 *     cpdef calc_coeffs_ensemble_timeavg(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, list weights=None, t_final=None, symmetric=True):             # <<<<<<<<<<<<<<
 *         """
 *         Solve the linear equation from minimizing the forward steady-state flux.
 */
struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg {
  int __pyx_n;
  PyObject *weights;
  PyObject *t_final;
  PyObject *symmetric;
};

/* "vcstring.pyx":764
 * 
 * 
 *     cpdef calc_coeffs_ensemble_timeavg_fast(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, list weights=None, symmetric=True):             # <<<<<<<<<<<<<<
 *         """
 *         Solve the linear equation from minimizing the forward steady-state flux.
 */
struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast {
  int __pyx_n;
  PyObject *weights;
  PyObject *symmetric;
};

/* "vcstring.pyx":871
 * 
 * 
 *     cpdef calc_coeffs_ensemble_timeavg_fast_v2(self, int N, list last_frames, int tau, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=2] ids, list weights=None, symmetric=True):             # <<<<<<<<<<<<<<
 *         cdef int i, j, count, t
 *         cdef list x, y, D_0, D_tau, g_0, g_tau
 */
struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast_v2 {
  int __pyx_n;
  PyObject *weights;
  PyObject *symmetric;
};

/* "vcstring.pyx":1129
 * 
 * 
 *     cpdef calc_corr_q2_ensemble_timeavg(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=1] b, list weights=None):             # <<<<<<<<<<<<<<
 *         """
 *         Compute correlation function using committor at time t and t+tau, <[q(tau)-q(0)] ** 2>.
 */
struct __pyx_opt_args_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg {
  int __pyx_n;
  PyObject *weights;
};

/* "vcstring.pyx":1193
 * 
 * 
 *     cpdef calc_corr_q2_ensemble_timeavg_fast(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=1] b, list weights=None):             # <<<<<<<<<<<<<<
 *         """
 *         Compute correlation function using committor at time t and t+tau, <[q(tau)-q(0)] ** 2>.
 */
struct __pyx_opt_args_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg_fast {
  int __pyx_n;
  PyObject *weights;
};

/* "vcstring.pyx":1249
 * 
 * 
 *     cpdef finite_diff_corr(self, int image, int dim, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=2] ids, double delta=0.1):             # <<<<<<<<<<<<<<
 *         """
 *         Calculate the finite difference gradient of the committor correlation function.
 */
struct __pyx_opt_args_8vcstring_8vcstring_finite_diff_corr {
  int __pyx_n;
  double delta;
};

/* "vcstring.pyx":1328
 *         return Cp_list, Cm_list, gradC_list
 * 
 *     cpdef finite_diff_committor(self, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=1] b, list start, double delta=0.1, double epsilon=1.0):             # <<<<<<<<<<<<<<
 *         """Finite difference to get the gradient of the committor"""
 *         cdef np.ndarray[DTYPE_t, ndim=1] dist, dist_p, dist_m, dist_new
 */
struct __pyx_opt_args_8vcstring_8vcstring_finite_diff_committor {
  int __pyx_n;
  double delta;
  double epsilon;
};

/* "vcstring.pyx":1366
 *         return dq_list, z[id_new], b[id_new]
 * 
 *     cpdef montecarlo(self, list images, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, double target, double delta=0.01, int n=100, ensemble_timeavg_v1=False, ensemble_timeavg_v2=False, ensemble_avg=False, stride=None, list weights=None, symmetric=True, manual=False, hx_man=None, hy_man=None, reparm=True, mindist_constraint=False, mindist=0.25, accelerated=False, corr_method='matrix_elements', save=True):             # <<<<<<<<<<<<<<
 *         """
 *         Monte Carlo accept/reject of correlation given a target value.
 */
struct __pyx_opt_args_8vcstring_8vcstring_montecarlo {
  int __pyx_n;
  double delta;
  int n;
  PyObject *ensemble_timeavg_v1;
  PyObject *ensemble_timeavg_v2;
  PyObject *ensemble_avg;
  PyObject *stride;
  PyObject *weights;
  PyObject *symmetric;
  PyObject *manual;
  PyObject *hx_man;
  PyObject *hy_man;
  PyObject *reparm;
  PyObject *mindist_constraint;
  PyObject *mindist;
  PyObject *accelerated;
  PyObject *corr_method;
  PyObject *save;
};

/* "vcstring.pyx":1576
 *         return
 * 
 *     cpdef montecarlo_symmetric(self, list images, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, double target, double delta=0.01, int n=100, manual=False, hx_man=None, hy_man=None, reparm=True, mindist_constraint=False, mindist=0.25, accelerated=False, corr_method='matrix_elements', save=True):             # <<<<<<<<<<<<<<
 *         """
 *         For systems that are symmetric about some axis of rotation.
 */
struct __pyx_opt_args_8vcstring_8vcstring_montecarlo_symmetric {
  int __pyx_n;
  double delta;
  int n;
  PyObject *manual;
  PyObject *hx_man;
  PyObject *hy_man;
  PyObject *reparm;
  PyObject *mindist_constraint;
  PyObject *mindist;
  PyObject *accelerated;
  PyObject *corr_method;
  PyObject *save;
};

/* "vcstring.pyx":1805
 *     return z_new_arr
 * 
 * cpdef elliptical_bounds_params(double ra=1.0, double rb=0.4, double alpha=58.0, double x0_A=-2.2, double y0_A=-2.2, double x0_B=2.2, double y0_B=2.2):             # <<<<<<<<<<<<<<
 *     """
 *     Parameters for defining the  elliptical boundaries at the well minima where the
 */
struct __pyx_opt_args_8vcstring_elliptical_bounds_params {
  int __pyx_n;
  double ra;
  double rb;
  double alpha;
  double x0_A;
  double y0_A;
  double x0_B;
  double y0_B;
};

/* "vcstring.pyx":13
 * ctypedef np.float64_t DTYPE_t
 * 
 * cdef class vcstring:             # <<<<<<<<<<<<<<
 *     cdef str state_assignment
 *     cdef int num_basis
 */
struct __pyx_obj_8vcstring_vcstring {
  PyObject_HEAD
  struct __pyx_vtabstruct_8vcstring_vcstring *__pyx_vtab;
  PyObject *state_assignment;
  int num_basis;
  double cut_A;
  double cut_B;
  double theta_deg;
  double theta;
  double cut;
  double ra_A;
  double rb_A;
  double ra_B;
  double rb_B;
  double alpha_deg_A;
  double alpha_deg_B;
  double alpha_A;
  double alpha_B;
  double x0_A;
  double y0_A;
  double x0_B;
  double y0_B;
};



struct __pyx_vtabstruct_8vcstring_vcstring {
  PyObject *(*intermediate_region)(struct __pyx_obj_8vcstring_vcstring *, int __pyx_skip_dispatch);
  PyObject *(*centroids)(struct __pyx_obj_8vcstring_vcstring *, int __pyx_skip_dispatch);
  PyObject *(*assign_states)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, int, PyArrayObject *, int __pyx_skip_dispatch);
  PyObject *(*assign_states_ensemble)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, int, PyArrayObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_assign_states_ensemble *__pyx_optional_args);
  PyObject *(*calc_coeffs)(struct __pyx_obj_8vcstring_vcstring *, int, int, PyArrayObject *, PyArrayObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs *__pyx_optional_args);
  PyObject *(*calc_coeffs_accelerated)(struct __pyx_obj_8vcstring_vcstring *, int, PyObject *, int, PyArrayObject *, int __pyx_skip_dispatch);
  PyObject *(*calc_coeffs_ensemble)(struct __pyx_obj_8vcstring_vcstring *, int, int, PyArrayObject *, PyArrayObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble *__pyx_optional_args);
  PyObject *(*calc_coeffs_ensemble_timeavg)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, int, PyArrayObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg *__pyx_optional_args);
  PyObject *(*calc_coeffs_ensemble_timeavg_fast)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, int, PyArrayObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast *__pyx_optional_args);
  PyObject *(*calc_coeffs_ensemble_timeavg_fast_v2)(struct __pyx_obj_8vcstring_vcstring *, int, PyObject *, int, PyArrayObject *, PyArrayObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast_v2 *__pyx_optional_args);
  PyObject *(*calc_corr)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, int, PyArrayObject *, PyArrayObject *, PyArrayObject *, PyArrayObject *, PyArrayObject *, int __pyx_skip_dispatch);
  PyObject *(*calc_corr_q2)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, int, PyArrayObject *, PyArrayObject *, int __pyx_skip_dispatch);
  PyObject *(*calc_corr_q2_ensemble)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, int, PyArrayObject *, PyArrayObject *, int __pyx_skip_dispatch);
  PyObject *(*calc_corr_q2_ensemble_timeavg)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, int, PyArrayObject *, PyArrayObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg *__pyx_optional_args);
  PyObject *(*calc_corr_q2_ensemble_timeavg_fast)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, int, PyArrayObject *, PyArrayObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg_fast *__pyx_optional_args);
  PyObject *(*finite_diff_corr)(struct __pyx_obj_8vcstring_vcstring *, int, int, PyObject *, int, PyArrayObject *, PyArrayObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_finite_diff_corr *__pyx_optional_args);
  PyObject *(*finite_diff_committor)(struct __pyx_obj_8vcstring_vcstring *, PyArrayObject *, PyArrayObject *, PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_finite_diff_committor *__pyx_optional_args);
  PyObject *(*montecarlo)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, PyObject *, int, PyArrayObject *, double, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_montecarlo *__pyx_optional_args);
  PyObject *(*montecarlo_symmetric)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, PyObject *, int, PyArrayObject *, double, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_montecarlo_symmetric *__pyx_optional_args);
};
static struct __pyx_vtabstruct_8vcstring_vcstring *__pyx_vtabptr_8vcstring_vcstring;

/* --- Runtime support code (head) --- */
/* Refnanny.proto */
#ifndef CYTHON_REFNANNY
  #define CYTHON_REFNANNY 0
#endif
#if CYTHON_REFNANNY
  typedef struct {
    void (*INCREF)(void*, PyObject*, int);
    void (*DECREF)(void*, PyObject*, int);
    void (*GOTREF)(void*, PyObject*, int);
    void (*GIVEREF)(void*, PyObject*, int);
    void* (*SetupContext)(const char*, int, const char*);
    void (*FinishContext)(void**);
  } __Pyx_RefNannyAPIStruct;
  static __Pyx_RefNannyAPIStruct *__Pyx_RefNanny = NULL;
  static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname);
  #define __Pyx_RefNannyDeclarations void *__pyx_refnanny = NULL;
#ifdef WITH_THREAD
  #define __Pyx_RefNannySetupContext(name, acquire_gil)\
          if (acquire_gil) {\
              PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();\
              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__);\
              PyGILState_Release(__pyx_gilstate_save);\
          } else {\
              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__);\
          }
#else
  #define __Pyx_RefNannySetupContext(name, acquire_gil)\
          __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__)
#endif
  #define __Pyx_RefNannyFinishContext()\
          __Pyx_RefNanny->FinishContext(&__pyx_refnanny)
  #define __Pyx_INCREF(r)  __Pyx_RefNanny->INCREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_DECREF(r)  __Pyx_RefNanny->DECREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_GOTREF(r)  __Pyx_RefNanny->GOTREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_GIVEREF(r) __Pyx_RefNanny->GIVEREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
  #define __Pyx_XINCREF(r)  do { if((r) != NULL) {__Pyx_INCREF(r); }} while(0)
  #define __Pyx_XDECREF(r)  do { if((r) != NULL) {__Pyx_DECREF(r); }} while(0)
  #define __Pyx_XGOTREF(r)  do { if((r) != NULL) {__Pyx_GOTREF(r); }} while(0)
  #define __Pyx_XGIVEREF(r) do { if((r) != NULL) {__Pyx_GIVEREF(r);}} while(0)
#else
  #define __Pyx_RefNannyDeclarations
  #define __Pyx_RefNannySetupContext(name, acquire_gil)
  #define __Pyx_RefNannyFinishContext()
  #define __Pyx_INCREF(r) Py_INCREF(r)
  #define __Pyx_DECREF(r) Py_DECREF(r)
  #define __Pyx_GOTREF(r)
  #define __Pyx_GIVEREF(r)
  #define __Pyx_XINCREF(r) Py_XINCREF(r)
  #define __Pyx_XDECREF(r) Py_XDECREF(r)
  #define __Pyx_XGOTREF(r)
  #define __Pyx_XGIVEREF(r)
#endif
#define __Pyx_XDECREF_SET(r, v) do {\
        PyObject *tmp = (PyObject *) r;\
        r = v; __Pyx_XDECREF(tmp);\
    } while (0)
#define __Pyx_DECREF_SET(r, v) do {\
        PyObject *tmp = (PyObject *) r;\
        r = v; __Pyx_DECREF(tmp);\
    } while (0)
#define __Pyx_CLEAR(r)    do { PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);} while(0)
#define __Pyx_XCLEAR(r)   do { if((r) != NULL) {PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);}} while(0)

/* PyObjectGetAttrStr.proto */
#if CYTHON_USE_TYPE_SLOTS
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name);
#else
#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
#endif

/* GetBuiltinName.proto */
static PyObject *__Pyx_GetBuiltinName(PyObject *name);

/* RaiseArgTupleInvalid.proto */
static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found);

/* RaiseDoubleKeywords.proto */
static void __Pyx_RaiseDoubleKeywordsError(const char* func_name, PyObject* kw_name);

/* ParseKeywords.proto */
static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject **argnames[],\
    PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,\
    const char* function_name);

/* ArgTypeTest.proto */
#define __Pyx_ArgTypeTest(obj, type, none_allowed, name, exact)\
    ((likely((Py_TYPE(obj) == type) | (none_allowed && (obj == Py_None)))) ? 1 :\
        __Pyx__ArgTypeTest(obj, type, name, exact))
static int __Pyx__ArgTypeTest(PyObject *obj, PyTypeObject *type, const char *name, int exact);

/* IncludeStringH.proto */
#include <string.h>

/* BytesEquals.proto */
static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals);

/* UnicodeEquals.proto */
static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals);

/* PyFloatBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyFloat_TrueDivideObjC(PyObject *op1, PyObject *op2, double floatval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyFloat_TrueDivideObjC(op1, op2, floatval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceTrueDivide(op1, op2) : PyNumber_TrueDivide(op1, op2))
#endif

/* PyDictVersioning.proto */
#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
#define __PYX_DICT_VERSION_INIT  ((PY_UINT64_T) -1)
#define __PYX_GET_DICT_VERSION(dict)  (((PyDictObject*)(dict))->ma_version_tag)
#define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)\
    (version_var) = __PYX_GET_DICT_VERSION(dict);\
    (cache_var) = (value);
#define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP) {\
    static PY_UINT64_T __pyx_dict_version = 0;\
    static PyObject *__pyx_dict_cached_value = NULL;\
    if (likely(__PYX_GET_DICT_VERSION(DICT) == __pyx_dict_version)) {\
        (VAR) = __pyx_dict_cached_value;\
    } else {\
        (VAR) = __pyx_dict_cached_value = (LOOKUP);\
        __pyx_dict_version = __PYX_GET_DICT_VERSION(DICT);\
    }\
}
static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj);
static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj);
static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version);
#else
#define __PYX_GET_DICT_VERSION(dict)  (0)
#define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)
#define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP)  (VAR) = (LOOKUP);
#endif

/* GetModuleGlobalName.proto */
#if CYTHON_USE_DICT_VERSIONS
#define __Pyx_GetModuleGlobalName(var, name)  {\
    static PY_UINT64_T __pyx_dict_version = 0;\
    static PyObject *__pyx_dict_cached_value = NULL;\
    (var) = (likely(__pyx_dict_version == __PYX_GET_DICT_VERSION(__pyx_d))) ?\
        (likely(__pyx_dict_cached_value) ? __Pyx_NewRef(__pyx_dict_cached_value) : __Pyx_GetBuiltinName(name)) :\
        __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
}
#define __Pyx_GetModuleGlobalNameUncached(var, name)  {\
    PY_UINT64_T __pyx_dict_version;\
    PyObject *__pyx_dict_cached_value;\
    (var) = __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
}
static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
#else
#define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
#define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
#endif

/* PyFunctionFastCall.proto */
#if CYTHON_FAST_PYCALL
#define __Pyx_PyFunction_FastCall(func, args, nargs)\
    __Pyx_PyFunction_FastCallDict((func), (args), (nargs), NULL)
#if 1 || PY_VERSION_HEX < 0x030600B1
static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs);
#else
#define __Pyx_PyFunction_FastCallDict(func, args, nargs, kwargs) _PyFunction_FastCallDict(func, args, nargs, kwargs)
#endif
#define __Pyx_BUILD_ASSERT_EXPR(cond)\
    (sizeof(char [1 - 2*!(cond)]) - 1)
#ifndef Py_MEMBER_SIZE
#define Py_MEMBER_SIZE(type, member) sizeof(((type *)0)->member)
#endif
  static size_t __pyx_pyframe_localsplus_offset = 0;
  #include "frameobject.h"
  #define __Pxy_PyFrame_Initialize_Offsets()\
    ((void)__Pyx_BUILD_ASSERT_EXPR(sizeof(PyFrameObject) == offsetof(PyFrameObject, f_localsplus) + Py_MEMBER_SIZE(PyFrameObject, f_localsplus)),\
     (void)(__pyx_pyframe_localsplus_offset = ((size_t)PyFrame_Type.tp_basicsize) - Py_MEMBER_SIZE(PyFrameObject, f_localsplus)))
  #define __Pyx_PyFrame_GetLocalsplus(frame)\
    (assert(__pyx_pyframe_localsplus_offset), (PyObject **)(((char *)(frame)) + __pyx_pyframe_localsplus_offset))
#endif

/* PyObjectCall.proto */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
#else
#define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
#endif

/* PyObjectCallMethO.proto */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg);
#endif

/* PyObjectCallNoArg.proto */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func);
#else
#define __Pyx_PyObject_CallNoArg(func) __Pyx_PyObject_Call(func, __pyx_empty_tuple, NULL)
#endif

/* PyCFunctionFastCall.proto */
#if CYTHON_FAST_PYCCALL
static CYTHON_INLINE PyObject *__Pyx_PyCFunction_FastCall(PyObject *func, PyObject **args, Py_ssize_t nargs);
#else
#define __Pyx_PyCFunction_FastCall(func, args, nargs)  (assert(0), NULL)
#endif

/* PyObjectCallOneArg.proto */
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg);

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_SubtractObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_SubtractObjC(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceSubtract(op1, op2) : PyNumber_Subtract(op1, op2))
#endif

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_TrueDivideObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_TrueDivideObjC(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceTrueDivide(op1, op2) : PyNumber_TrueDivide(op1, op2))
#endif

/* PyObjectCall2Args.proto */
static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2);

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_AddObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_AddObjC(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceAdd(op1, op2) : PyNumber_Add(op1, op2))
#endif

/* RaiseTooManyValuesToUnpack.proto */
static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected);

/* RaiseNeedMoreValuesToUnpack.proto */
static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index);

/* IterFinish.proto */
static CYTHON_INLINE int __Pyx_IterFinish(void);

/* UnpackItemEndCheck.proto */
static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected);

/* ExtTypeTest.proto */
static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type);

/* IsLittleEndian.proto */
static CYTHON_INLINE int __Pyx_Is_Little_Endian(void);

/* BufferFormatCheck.proto */
static const char* __Pyx_BufFmt_CheckString(__Pyx_BufFmt_Context* ctx, const char* ts);
static void __Pyx_BufFmt_Init(__Pyx_BufFmt_Context* ctx,
                              __Pyx_BufFmt_StackElem* stack,
                              __Pyx_TypeInfo* type);

/* BufferGetAndValidate.proto */
#define __Pyx_GetBufferAndValidate(buf, obj, dtype, flags, nd, cast, stack)\
    ((obj == Py_None || obj == NULL) ?\
    (__Pyx_ZeroBuffer(buf), 0) :\
    __Pyx__GetBufferAndValidate(buf, obj, dtype, flags, nd, cast, stack))
static int  __Pyx__GetBufferAndValidate(Py_buffer* buf, PyObject* obj,
    __Pyx_TypeInfo* dtype, int flags, int nd, int cast, __Pyx_BufFmt_StackElem* stack);
static void __Pyx_ZeroBuffer(Py_buffer* buf);
static CYTHON_INLINE void __Pyx_SafeReleaseBuffer(Py_buffer* info);
static Py_ssize_t __Pyx_minusones[] = { -1, -1, -1, -1, -1, -1, -1, -1 };
static Py_ssize_t __Pyx_zeros[] = { 0, 0, 0, 0, 0, 0, 0, 0 };

/* BufferFallbackError.proto */
static void __Pyx_RaiseBufferFallbackError(void);

/* GetItemInt.proto */
#define __Pyx_GetItemInt(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
    __Pyx_GetItemInt_Fast(o, (Py_ssize_t)i, is_list, wraparound, boundscheck) :\
    (is_list ? (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL) :\
               __Pyx_GetItemInt_Generic(o, to_py_func(i))))
#define __Pyx_GetItemInt_List(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
    __Pyx_GetItemInt_List_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
    (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL))
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
                                                              int wraparound, int boundscheck);
#define __Pyx_GetItemInt_Tuple(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
    __Pyx_GetItemInt_Tuple_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
    (PyErr_SetString(PyExc_IndexError, "tuple index out of range"), (PyObject*)NULL))
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
                                                              int wraparound, int boundscheck);
static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j);
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i,
                                                     int is_list, int wraparound, int boundscheck);

/* ObjectGetItem.proto */
#if CYTHON_USE_TYPE_SLOTS
static CYTHON_INLINE PyObject *__Pyx_PyObject_GetItem(PyObject *obj, PyObject* key);
#else
#define __Pyx_PyObject_GetItem(obj, key)  PyObject_GetItem(obj, key)
#endif

/* PyThreadStateGet.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_PyThreadState_declare  PyThreadState *__pyx_tstate;
#define __Pyx_PyThreadState_assign  __pyx_tstate = __Pyx_PyThreadState_Current;
#define __Pyx_PyErr_Occurred()  __pyx_tstate->curexc_type
#else
#define __Pyx_PyThreadState_declare
#define __Pyx_PyThreadState_assign
#define __Pyx_PyErr_Occurred()  PyErr_Occurred()
#endif

/* PyErrFetchRestore.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_PyErr_Clear() __Pyx_ErrRestore(NULL, NULL, NULL)
#define __Pyx_ErrRestoreWithState(type, value, tb)  __Pyx_ErrRestoreInState(PyThreadState_GET(), type, value, tb)
#define __Pyx_ErrFetchWithState(type, value, tb)    __Pyx_ErrFetchInState(PyThreadState_GET(), type, value, tb)
#define __Pyx_ErrRestore(type, value, tb)  __Pyx_ErrRestoreInState(__pyx_tstate, type, value, tb)
#define __Pyx_ErrFetch(type, value, tb)    __Pyx_ErrFetchInState(__pyx_tstate, type, value, tb)
static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
#if CYTHON_COMPILING_IN_CPYTHON
#define __Pyx_PyErr_SetNone(exc) (Py_INCREF(exc), __Pyx_ErrRestore((exc), NULL, NULL))
#else
#define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
#endif
#else
#define __Pyx_PyErr_Clear() PyErr_Clear()
#define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
#define __Pyx_ErrRestoreWithState(type, value, tb)  PyErr_Restore(type, value, tb)
#define __Pyx_ErrFetchWithState(type, value, tb)  PyErr_Fetch(type, value, tb)
#define __Pyx_ErrRestoreInState(tstate, type, value, tb)  PyErr_Restore(type, value, tb)
#define __Pyx_ErrFetchInState(tstate, type, value, tb)  PyErr_Fetch(type, value, tb)
#define __Pyx_ErrRestore(type, value, tb)  PyErr_Restore(type, value, tb)
#define __Pyx_ErrFetch(type, value, tb)  PyErr_Fetch(type, value, tb)
#endif

/* ListCompAppend.proto */
#if CYTHON_USE_PYLIST_INTERNALS && CYTHON_ASSUME_SAFE_MACROS
static CYTHON_INLINE int __Pyx_ListComp_Append(PyObject* list, PyObject* x) {
    PyListObject* L = (PyListObject*) list;
    Py_ssize_t len = Py_SIZE(list);
    if (likely(L->allocated > len)) {
        Py_INCREF(x);
        PyList_SET_ITEM(list, len, x);
        __Pyx_SET_SIZE(list, len + 1);
        return 0;
    }
    return PyList_Append(list, x);
}
#else
#define __Pyx_ListComp_Append(L,x) PyList_Append(L,x)
#endif

/* RaiseException.proto */
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);

/* py_abs.proto */
#if CYTHON_USE_PYLONG_INTERNALS
static PyObject *__Pyx_PyLong_AbsNeg(PyObject *num);
#define __Pyx_PyNumber_Absolute(x)\
    ((likely(PyLong_CheckExact(x))) ?\
         (likely(Py_SIZE(x) >= 0) ? (Py_INCREF(x), (x)) : __Pyx_PyLong_AbsNeg(x)) :\
         PyNumber_Absolute(x))
#else
#define __Pyx_PyNumber_Absolute(x)  PyNumber_Absolute(x)
#endif

/* None.proto */
static CYTHON_INLINE void __Pyx_RaiseUnboundLocalError(const char *varname);

/* ListAppend.proto */
#if CYTHON_USE_PYLIST_INTERNALS && CYTHON_ASSUME_SAFE_MACROS
static CYTHON_INLINE int __Pyx_PyList_Append(PyObject* list, PyObject* x) {
    PyListObject* L = (PyListObject*) list;
    Py_ssize_t len = Py_SIZE(list);
    if (likely(L->allocated > len) & likely(len > (L->allocated >> 1))) {
        Py_INCREF(x);
        PyList_SET_ITEM(list, len, x);
        __Pyx_SET_SIZE(list, len + 1);
        return 0;
    }
    return PyList_Append(list, x);
}
#else
#define __Pyx_PyList_Append(L,x) PyList_Append(L,x)
#endif

/* PyObjectGetMethod.proto */
static int __Pyx_PyObject_GetMethod(PyObject *obj, PyObject *name, PyObject **method);

/* PyObjectCallMethod1.proto */
static PyObject* __Pyx_PyObject_CallMethod1(PyObject* obj, PyObject* method_name, PyObject* arg);

/* append.proto */
static CYTHON_INLINE int __Pyx_PyObject_Append(PyObject* L, PyObject* x);

/* BufferIndexError.proto */
static void __Pyx_RaiseBufferIndexError(int axis);

#define __Pyx_BufPtrStrided1d(type, buf, i0, s0) (type)((char*)buf + i0 * s0)
/* DictGetItem.proto */
#if PY_MAJOR_VERSION >= 3 && !CYTHON_COMPILING_IN_PYPY
static PyObject *__Pyx_PyDict_GetItem(PyObject *d, PyObject* key);
#define __Pyx_PyObject_Dict_GetItem(obj, name)\
    (likely(PyDict_CheckExact(obj)) ?\
     __Pyx_PyDict_GetItem(obj, name) : PyObject_GetItem(obj, name))
#else
#define __Pyx_PyDict_GetItem(d, key) PyObject_GetItem(d, key)
#define __Pyx_PyObject_Dict_GetItem(obj, name)  PyObject_GetItem(obj, name)
#endif

/* PySequenceContains.proto */
static CYTHON_INLINE int __Pyx_PySequence_ContainsTF(PyObject* item, PyObject* seq, int eq) {
    int result = PySequence_Contains(seq, item);
    return unlikely(result < 0) ? result : (result == (eq == Py_EQ));
}

/* SetItemInt.proto */
#define __Pyx_SetItemInt(o, i, v, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
    __Pyx_SetItemInt_Fast(o, (Py_ssize_t)i, v, is_list, wraparound, boundscheck) :\
    (is_list ? (PyErr_SetString(PyExc_IndexError, "list assignment index out of range"), -1) :\
               __Pyx_SetItemInt_Generic(o, to_py_func(i), v)))
static int __Pyx_SetItemInt_Generic(PyObject *o, PyObject *j, PyObject *v);
static CYTHON_INLINE int __Pyx_SetItemInt_Fast(PyObject *o, Py_ssize_t i, PyObject *v,
                                               int is_list, int wraparound, int boundscheck);

/* GCCDiagnostics.proto */
#if defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 6))
#define __Pyx_HAS_GCC_DIAGNOSTIC
#endif

/* BuildPyUnicode.proto */
static PyObject* __Pyx_PyUnicode_BuildFromAscii(Py_ssize_t ulength, char* chars, int clength,
                                                int prepend_sign, char padding_char);

/* CIntToPyUnicode.proto */
static CYTHON_INLINE PyObject* __Pyx_PyUnicode_From_int(int value, Py_ssize_t width, char padding_char, char format_char);

/* JoinPyUnicode.proto */
static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
                                      Py_UCS4 max_char);

/* PyFloatBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyFloat_EqObjC(PyObject *op1, PyObject *op2, double floatval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyFloat_EqObjC(op1, op2, floatval, inplace, zerodivision_check)\
    (PyObject_RichCompare(op1, op2, Py_EQ))
    #endif

/* PyErrExceptionMatches.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_PyErr_ExceptionMatches(err) __Pyx_PyErr_ExceptionMatchesInState(__pyx_tstate, err)
static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err);
#else
#define __Pyx_PyErr_ExceptionMatches(err)  PyErr_ExceptionMatches(err)
#endif

/* GetAttr.proto */
static CYTHON_INLINE PyObject *__Pyx_GetAttr(PyObject *, PyObject *);

/* GetAttr3.proto */
static CYTHON_INLINE PyObject *__Pyx_GetAttr3(PyObject *, PyObject *, PyObject *);

/* SliceObject.proto */
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetSlice(
        PyObject* obj, Py_ssize_t cstart, Py_ssize_t cstop,
        PyObject** py_start, PyObject** py_stop, PyObject** py_slice,
        int has_cstart, int has_cstop, int wraparound);

/* Import.proto */
static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level);

/* ImportFrom.proto */
static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name);

/* HasAttr.proto */
static CYTHON_INLINE int __Pyx_HasAttr(PyObject *, PyObject *);

/* GetTopmostException.proto */
#if CYTHON_USE_EXC_INFO_STACK
static _PyErr_StackItem * __Pyx_PyErr_GetTopmostException(PyThreadState *tstate);
#endif

/* SaveResetException.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_ExceptionSave(type, value, tb)  __Pyx__ExceptionSave(__pyx_tstate, type, value, tb)
static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
#define __Pyx_ExceptionReset(type, value, tb)  __Pyx__ExceptionReset(__pyx_tstate, type, value, tb)
static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
#else
#define __Pyx_ExceptionSave(type, value, tb)   PyErr_GetExcInfo(type, value, tb)
#define __Pyx_ExceptionReset(type, value, tb)  PyErr_SetExcInfo(type, value, tb)
#endif

/* GetException.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_GetException(type, value, tb)  __Pyx__GetException(__pyx_tstate, type, value, tb)
static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
#else
static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb);
#endif

/* PyObject_GenericGetAttrNoDict.proto */
#if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
static CYTHON_INLINE PyObject* __Pyx_PyObject_GenericGetAttrNoDict(PyObject* obj, PyObject* attr_name);
#else
#define __Pyx_PyObject_GenericGetAttrNoDict PyObject_GenericGetAttr
#endif

/* PyObject_GenericGetAttr.proto */
#if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
static PyObject* __Pyx_PyObject_GenericGetAttr(PyObject* obj, PyObject* attr_name);
#else
#define __Pyx_PyObject_GenericGetAttr PyObject_GenericGetAttr
#endif

/* SetVTable.proto */
static int __Pyx_SetVtable(PyObject *dict, void *vtable);

/* PyObjectGetAttrStrNoError.proto */
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);

/* SetupReduce.proto */
static int __Pyx_setup_reduce(PyObject* type_obj);

/* TypeImport.proto */
#ifndef __PYX_HAVE_RT_ImportType_proto
#define __PYX_HAVE_RT_ImportType_proto
enum __Pyx_ImportType_CheckSize {
   __Pyx_ImportType_CheckSize_Error = 0,
   __Pyx_ImportType_CheckSize_Warn = 1,
   __Pyx_ImportType_CheckSize_Ignore = 2
};
static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, enum __Pyx_ImportType_CheckSize check_size);
#endif

/* CLineInTraceback.proto */
#ifdef CYTHON_CLINE_IN_TRACEBACK
#define __Pyx_CLineForTraceback(tstate, c_line)  (((CYTHON_CLINE_IN_TRACEBACK)) ? c_line : 0)
#else
static int __Pyx_CLineForTraceback(PyThreadState *tstate, int c_line);
#endif

/* CodeObjectCache.proto */
typedef struct {
    PyCodeObject* code_object;
    int code_line;
} __Pyx_CodeObjectCacheEntry;
struct __Pyx_CodeObjectCache {
    int count;
    int max_count;
    __Pyx_CodeObjectCacheEntry* entries;
};
static struct __Pyx_CodeObjectCache __pyx_code_cache = {0,0,NULL};
static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line);
static PyCodeObject *__pyx_find_code_object(int code_line);
static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object);

/* AddTraceback.proto */
static void __Pyx_AddTraceback(const char *funcname, int c_line,
                               int py_line, const char *filename);

/* BufferStructDeclare.proto */
typedef struct {
  Py_ssize_t shape, strides, suboffsets;
} __Pyx_Buf_DimInfo;
typedef struct {
  size_t refcount;
  Py_buffer pybuffer;
} __Pyx_Buffer;
typedef struct {
  __Pyx_Buffer *rcbuffer;
  char *data;
  __Pyx_Buf_DimInfo diminfo[8];
} __Pyx_LocalBuf_ND;

#if PY_MAJOR_VERSION < 3
    static int __Pyx_GetBuffer(PyObject *obj, Py_buffer *view, int flags);
    static void __Pyx_ReleaseBuffer(Py_buffer *view);
#else
    #define __Pyx_GetBuffer PyObject_GetBuffer
    #define __Pyx_ReleaseBuffer PyBuffer_Release
#endif


/* RealImag.proto */
#if CYTHON_CCOMPLEX
  #ifdef __cplusplus
    #define __Pyx_CREAL(z) ((z).real())
    #define __Pyx_CIMAG(z) ((z).imag())
  #else
    #define __Pyx_CREAL(z) (__real__(z))
    #define __Pyx_CIMAG(z) (__imag__(z))
  #endif
#else
    #define __Pyx_CREAL(z) ((z).real)
    #define __Pyx_CIMAG(z) ((z).imag)
#endif
#if defined(__cplusplus) && CYTHON_CCOMPLEX\
        && (defined(_WIN32) || defined(__clang__) || (defined(__GNUC__) && (__GNUC__ >= 5 || __GNUC__ == 4 && __GNUC_MINOR__ >= 4 )) || __cplusplus >= 201103)
    #define __Pyx_SET_CREAL(z,x) ((z).real(x))
    #define __Pyx_SET_CIMAG(z,y) ((z).imag(y))
#else
    #define __Pyx_SET_CREAL(z,x) __Pyx_CREAL(z) = (x)
    #define __Pyx_SET_CIMAG(z,y) __Pyx_CIMAG(z) = (y)
#endif

/* Arithmetic.proto */
#if CYTHON_CCOMPLEX
    #define __Pyx_c_eq_float(a, b)   ((a)==(b))
    #define __Pyx_c_sum_float(a, b)  ((a)+(b))
    #define __Pyx_c_diff_float(a, b) ((a)-(b))
    #define __Pyx_c_prod_float(a, b) ((a)*(b))
    #define __Pyx_c_quot_float(a, b) ((a)/(b))
    #define __Pyx_c_neg_float(a)     (-(a))
  #ifdef __cplusplus
    #define __Pyx_c_is_zero_float(z) ((z)==(float)0)
    #define __Pyx_c_conj_float(z)    (::std::conj(z))
    #if 1
        #define __Pyx_c_abs_float(z)     (::std::abs(z))
        #define __Pyx_c_pow_float(a, b)  (::std::pow(a, b))
    #endif
  #else
    #define __Pyx_c_is_zero_float(z) ((z)==0)
    #define __Pyx_c_conj_float(z)    (conjf(z))
    #if 1
        #define __Pyx_c_abs_float(z)     (cabsf(z))
        #define __Pyx_c_pow_float(a, b)  (cpowf(a, b))
    #endif
 #endif
#else
    static CYTHON_INLINE int __Pyx_c_eq_float(__pyx_t_float_complex, __pyx_t_float_complex);
    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_sum_float(__pyx_t_float_complex, __pyx_t_float_complex);
    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_diff_float(__pyx_t_float_complex, __pyx_t_float_complex);
    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_prod_float(__pyx_t_float_complex, __pyx_t_float_complex);
    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_quot_float(__pyx_t_float_complex, __pyx_t_float_complex);
    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_neg_float(__pyx_t_float_complex);
    static CYTHON_INLINE int __Pyx_c_is_zero_float(__pyx_t_float_complex);
    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_conj_float(__pyx_t_float_complex);
    #if 1
        static CYTHON_INLINE float __Pyx_c_abs_float(__pyx_t_float_complex);
        static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_pow_float(__pyx_t_float_complex, __pyx_t_float_complex);
    #endif
#endif

/* Arithmetic.proto */
#if CYTHON_CCOMPLEX
    #define __Pyx_c_eq_double(a, b)   ((a)==(b))
    #define __Pyx_c_sum_double(a, b)  ((a)+(b))
    #define __Pyx_c_diff_double(a, b) ((a)-(b))
    #define __Pyx_c_prod_double(a, b) ((a)*(b))
    #define __Pyx_c_quot_double(a, b) ((a)/(b))
    #define __Pyx_c_neg_double(a)     (-(a))
  #ifdef __cplusplus
    #define __Pyx_c_is_zero_double(z) ((z)==(double)0)
    #define __Pyx_c_conj_double(z)    (::std::conj(z))
    #if 1
        #define __Pyx_c_abs_double(z)     (::std::abs(z))
        #define __Pyx_c_pow_double(a, b)  (::std::pow(a, b))
    #endif
  #else
    #define __Pyx_c_is_zero_double(z) ((z)==0)
    #define __Pyx_c_conj_double(z)    (conj(z))
    #if 1
        #define __Pyx_c_abs_double(z)     (cabs(z))
        #define __Pyx_c_pow_double(a, b)  (cpow(a, b))
    #endif
 #endif
#else
    static CYTHON_INLINE int __Pyx_c_eq_double(__pyx_t_double_complex, __pyx_t_double_complex);
    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_sum_double(__pyx_t_double_complex, __pyx_t_double_complex);
    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_diff_double(__pyx_t_double_complex, __pyx_t_double_complex);
    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_prod_double(__pyx_t_double_complex, __pyx_t_double_complex);
    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_quot_double(__pyx_t_double_complex, __pyx_t_double_complex);
    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_neg_double(__pyx_t_double_complex);
    static CYTHON_INLINE int __Pyx_c_is_zero_double(__pyx_t_double_complex);
    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_conj_double(__pyx_t_double_complex);
    #if 1
        static CYTHON_INLINE double __Pyx_c_abs_double(__pyx_t_double_complex);
        static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_pow_double(__pyx_t_double_complex, __pyx_t_double_complex);
    #endif
#endif

/* CIntToPy.proto */
static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value);

/* CIntFromPy.proto */
static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *);

/* CIntFromPy.proto */
static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *);

/* CIntToPy.proto */
static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value);

/* FastTypeChecks.proto */
#if CYTHON_COMPILING_IN_CPYTHON
#define __Pyx_TypeCheck(obj, type) __Pyx_IsSubtype(Py_TYPE(obj), (PyTypeObject *)type)
static CYTHON_INLINE int __Pyx_IsSubtype(PyTypeObject *a, PyTypeObject *b);
static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches(PyObject *err, PyObject *type);
static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches2(PyObject *err, PyObject *type1, PyObject *type2);
#else
#define __Pyx_TypeCheck(obj, type) PyObject_TypeCheck(obj, (PyTypeObject *)type)
#define __Pyx_PyErr_GivenExceptionMatches(err, type) PyErr_GivenExceptionMatches(err, type)
#define __Pyx_PyErr_GivenExceptionMatches2(err, type1, type2) (PyErr_GivenExceptionMatches(err, type1) || PyErr_GivenExceptionMatches(err, type2))
#endif
#define __Pyx_PyException_Check(obj) __Pyx_TypeCheck(obj, PyExc_Exception)

/* CheckBinaryVersion.proto */
static int __Pyx_check_binary_version(void);

/* InitStrings.proto */
static int __Pyx_InitStrings(__Pyx_StringTabEntry *t);

static PyObject *__pyx_f_8vcstring_8vcstring_intermediate_region(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_centroids(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_skip_dispatch); /* proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_assign_states(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, int __pyx_skip_dispatch); /* proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_assign_states_ensemble(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_assign_states_ensemble *__pyx_optional_args); /* proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_coeffs(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_v_N, int __pyx_v_tau, CYTHON_UNUSED PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_ids, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs *__pyx_optional_args); /* proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_coeffs_accelerated(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_v_image, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, int __pyx_skip_dispatch); /* proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_coeffs_ensemble(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_v_N, int __pyx_v_tau, CYTHON_UNUSED PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_ids, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble *__pyx_optional_args); /* proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg *__pyx_optional_args); /* proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast *__pyx_optional_args); /* proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast_v2(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, CYTHON_UNUSED int __pyx_v_N, PyObject *__pyx_v_last_frames, int __pyx_v_tau, CYTHON_UNUSED PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_ids, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast_v2 *__pyx_optional_args); /* proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_corr(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_b, PyArrayObject *__pyx_v_D_0, PyArrayObject *__pyx_v_D_tau, PyArrayObject *__pyx_v_g_0, PyArrayObject *__pyx_v_g_tau, int __pyx_skip_dispatch); /* proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_corr_q2(CYTHON_UNUSED struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_b, PyArrayObject *__pyx_v_ids, int __pyx_skip_dispatch); /* proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_corr_q2_ensemble(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, CYTHON_UNUSED int __pyx_v_tau, PyArrayObject *__pyx_v_b, PyArrayObject *__pyx_v_ids, int __pyx_skip_dispatch); /* proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_b, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg *__pyx_optional_args); /* proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg_fast(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_b, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg_fast *__pyx_optional_args); /* proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_finite_diff_corr(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_v_image, int __pyx_v_dim, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_ids, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_finite_diff_corr *__pyx_optional_args); /* proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_finite_diff_committor(CYTHON_UNUSED struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_b, PyObject *__pyx_v_start, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_finite_diff_committor *__pyx_optional_args); /* proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_montecarlo(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_images, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, double __pyx_v_target, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_montecarlo *__pyx_optional_args); /* proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_montecarlo_symmetric(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_images, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, double __pyx_v_target, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_montecarlo_symmetric *__pyx_optional_args); /* proto*/

/* Module declarations from 'cpython.buffer' */

/* Module declarations from 'libc.string' */

/* Module declarations from 'libc.stdio' */

/* Module declarations from '__builtin__' */

/* Module declarations from 'cpython.type' */
static PyTypeObject *__pyx_ptype_7cpython_4type_type = 0;

/* Module declarations from 'cpython' */

/* Module declarations from 'cpython.object' */

/* Module declarations from 'cpython.ref' */

/* Module declarations from 'cpython.mem' */

/* Module declarations from 'numpy' */

/* Module declarations from 'numpy' */
static PyTypeObject *__pyx_ptype_5numpy_dtype = 0;
static PyTypeObject *__pyx_ptype_5numpy_flatiter = 0;
static PyTypeObject *__pyx_ptype_5numpy_broadcast = 0;
static PyTypeObject *__pyx_ptype_5numpy_ndarray = 0;
static PyTypeObject *__pyx_ptype_5numpy_generic = 0;
static PyTypeObject *__pyx_ptype_5numpy_number = 0;
static PyTypeObject *__pyx_ptype_5numpy_integer = 0;
static PyTypeObject *__pyx_ptype_5numpy_signedinteger = 0;
static PyTypeObject *__pyx_ptype_5numpy_unsignedinteger = 0;
static PyTypeObject *__pyx_ptype_5numpy_inexact = 0;
static PyTypeObject *__pyx_ptype_5numpy_floating = 0;
static PyTypeObject *__pyx_ptype_5numpy_complexfloating = 0;
static PyTypeObject *__pyx_ptype_5numpy_flexible = 0;
static PyTypeObject *__pyx_ptype_5numpy_character = 0;
static PyTypeObject *__pyx_ptype_5numpy_ufunc = 0;
static CYTHON_INLINE int __pyx_f_5numpy_import_array(void); /*proto*/

/* Module declarations from 'vcstring' */
static PyTypeObject *__pyx_ptype_8vcstring_vcstring = 0;
static PyObject *__pyx_f_8vcstring_reparm_string(PyArrayObject *, int __pyx_skip_dispatch); /*proto*/
static PyObject *__pyx_f_8vcstring_elliptical_bounds_params(int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_elliptical_bounds_params *__pyx_optional_args); /*proto*/
static PyObject *__pyx_f_8vcstring___pyx_unpickle_vcstring__set_state(struct __pyx_obj_8vcstring_vcstring *, PyObject *); /*proto*/
static __Pyx_TypeInfo __Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t = { "DTYPE_t", NULL, sizeof(__pyx_t_8vcstring_DTYPE_t), { 0 }, 0, 'R', 0, 0 };
static __Pyx_TypeInfo __Pyx_TypeInfo_long = { "long", NULL, sizeof(long), { 0 }, 0, IS_UNSIGNED(long) ? 'U' : 'I', IS_UNSIGNED(long), 0 };
#define __Pyx_MODULE_NAME "vcstring"
extern int __pyx_module_is_main_vcstring;
int __pyx_module_is_main_vcstring = 0;

/* Implementation of 'vcstring' */
static PyObject *__pyx_builtin_print;
static PyObject *__pyx_builtin_RuntimeError;
static PyObject *__pyx_builtin_range;
static PyObject *__pyx_builtin_TypeError;
static PyObject *__pyx_builtin_sum;
static PyObject *__pyx_builtin_round;
static PyObject *__pyx_builtin_ImportError;
static const char __pyx_k_C[] = "C";
static const char __pyx_k_N[] = "N";
static const char __pyx_k_T[] = "T";
static const char __pyx_k_a[] = "a";
static const char __pyx_k_b[] = "b =";
static const char __pyx_k_c[] = "c_";
static const char __pyx_k_i[] = "i";
static const char __pyx_k_n[] = "n";
static const char __pyx_k_q[] = "q";
static const char __pyx_k_z[] = "z";
static const char __pyx_k_1d[] = "1d";
static const char __pyx_k_Cm[] = "Cm";
static const char __pyx_k_Cp[] = "Cp";
static const char __pyx_k__3[] = "\n=========================";
static const char __pyx_k__6[] = "=========================";
static const char __pyx_k_np[] = "np";
static const char __pyx_k_pi[] = "pi";
static const char __pyx_k_q2[] = "q2";
static const char __pyx_k_ra[] = "ra";
static const char __pyx_k_rb[] = "rb";
static const char __pyx_k_t0[] = "t0";
static const char __pyx_k_x0[] = "x0";
static const char __pyx_k_xp[] = "xp";
static const char __pyx_k_y0[] = "y0";
static const char __pyx_k_yp[] = "yp";
static const char __pyx_k_D_0[] = "D_0 =";
static const char __pyx_k_N_2[] = "N =";
static const char __pyx_k__15[] = "\n===================================";
static const char __pyx_k__18[] = "===================================";
static const char __pyx_k__20[] = "\n======================================";
static const char __pyx_k__23[] = "======================================";
static const char __pyx_k__27[] = "-----------------------------------------------------------";
static const char __pyx_k__34[] = "\n";
static const char __pyx_k__35[] = "\n=================================";
static const char __pyx_k__38[] = "=================================";
static const char __pyx_k__41[] = "----------------------------";
static const char __pyx_k__43[] = "\n\n======================================";
static const char __pyx_k__48[] = "\n\n===============";
static const char __pyx_k__51[] = "===============";
static const char __pyx_k__55[] = "-------------------------";
static const char __pyx_k__58[] = "--------------------";
static const char __pyx_k__60[] = "-------------------------------";
static const char __pyx_k__63[] = "\n================================";
static const char __pyx_k__66[] = "================================";
static const char __pyx_k__69[] = "\n==============================";
static const char __pyx_k__72[] = "==============================";
static const char __pyx_k_b_2[] = "b";
static const char __pyx_k_cos[] = "cos";
static const char __pyx_k_cut[] = "cut";
static const char __pyx_k_dim[] = "dim";
static const char __pyx_k_dot[] = "dot";
static const char __pyx_k_ell[] = "ell";
static const char __pyx_k_exp[] = "exp";
static const char __pyx_k_g_0[] = "g_0 =";
static const char __pyx_k_ids[] = "ids";
static const char __pyx_k_inv[] = "inv";
static const char __pyx_k_log[] = "log";
static const char __pyx_k_new[] = "__new__";
static const char __pyx_k_sin[] = "sin";
static const char __pyx_k_sum[] = "sum";
static const char __pyx_k_sys[] = "sys";
static const char __pyx_k_tan[] = "tan";
static const char __pyx_k_tau[] = "tau";
static const char __pyx_k_Cm_2[] = "Cm =";
static const char __pyx_k_Corr[] = "Corr =";
static const char __pyx_k_Cp_2[] = "\nCp =";
static const char __pyx_k_axis[] = "axis";
static const char __pyx_k_copy[] = "copy";
static const char __pyx_k_dict[] = "__dict__";
static const char __pyx_k_lags[] = "lags";
static const char __pyx_k_last[] = "last";
static const char __pyx_k_load[] = "load";
static const char __pyx_k_main[] = "__main__";
static const char __pyx_k_math[] = "math";
static const char __pyx_k_mean[] = "mean";
static const char __pyx_k_name[] = "__name__";
static const char __pyx_k_ra_A[] = "ra_A";
static const char __pyx_k_ra_B[] = "ra_B";
static const char __pyx_k_rb_A[] = "rb_A";
static const char __pyx_k_rb_B[] = "rb_B";
static const char __pyx_k_save[] = "save";
static const char __pyx_k_sqrt[] = "sqrt";
static const char __pyx_k_t0_2[] = "\nt0:";
static const char __pyx_k_t0_3[] = "t0:";
static const char __pyx_k_test[] = "__test__";
static const char __pyx_k_traj[] = "traj";
static const char __pyx_k_x0_A[] = "x0_A";
static const char __pyx_k_x0_B[] = "x0_B";
static const char __pyx_k_y0_A[] = "y0_A";
static const char __pyx_k_y0_B[] = "y0_B";
static const char __pyx_k_C_avg[] = "C_avg";
static const char __pyx_k_DTYPE[] = "DTYPE";
static const char __pyx_k_D_0_2[] = "D_0";
static const char __pyx_k_D_tau[] = "D_tau =";
static const char __pyx_k_IMAGE[] = "\nIMAGE";
static const char __pyx_k_Image[] = "Image";
static const char __pyx_k_alpha[] = "alpha";
static const char __pyx_k_count[] = "count =";
static const char __pyx_k_cut_A[] = "cut_A";
static const char __pyx_k_cut_B[] = "cut_B";
static const char __pyx_k_delta[] = "delta";
static const char __pyx_k_ell_x[] = "ell_x";
static const char __pyx_k_ell_y[] = "ell_y";
static const char __pyx_k_first[] = "first";
static const char __pyx_k_flush[] = "flush";
static const char __pyx_k_g_0_2[] = "g_0";
static const char __pyx_k_g_tau[] = "g_tau =";
static const char __pyx_k_gradC[] = "gradC:";
static const char __pyx_k_image[] = "image";
static const char __pyx_k_numpy[] = "numpy";
static const char __pyx_k_print[] = "print";
static const char __pyx_k_q_avg[] = "q_avg";
static const char __pyx_k_range[] = "range";
static const char __pyx_k_round[] = "round";
static const char __pyx_k_savez[] = "savez";
static const char __pyx_k_shape[] = "shape";
static const char __pyx_k_start[] = "start";
static const char __pyx_k_where[] = "where";
static const char __pyx_k_zeros[] = "zeros";
static const char __pyx_k_C_list[] = "C_list";
static const char __pyx_k_Corr_2[] = "Corr (+) =";
static const char __pyx_k_Corr_3[] = "Corr (-) =";
static const char __pyx_k_append[] = "append";
static const char __pyx_k_arange[] = "arange";
static const char __pyx_k_argmin[] = "argmin";
static const char __pyx_k_delete[] = "delete";
static const char __pyx_k_format[] = "format";
static const char __pyx_k_hx_man[] = "hx_man";
static const char __pyx_k_hy_man[] = "hy_man";
static const char __pyx_k_images[] = "images";
static const char __pyx_k_import[] = "__import__";
static const char __pyx_k_linalg[] = "linalg";
static const char __pyx_k_manual[] = "manual";
static const char __pyx_k_pickle[] = "pickle";
static const char __pyx_k_q_list[] = "q_list";
static const char __pyx_k_random[] = "random";
static const char __pyx_k_reduce[] = "__reduce__";
static const char __pyx_k_reparm[] = "reparm";
static const char __pyx_k_square[] = "square";
static const char __pyx_k_stdout[] = "stdout";
static const char __pyx_k_stride[] = "stride";
static const char __pyx_k_target[] = "target";
static const char __pyx_k_update[] = "update";
static const char __pyx_k_D_tau_2[] = "D_tau";
static const char __pyx_k_SUMMARY[] = "    SUMMARY    ";
static const char __pyx_k_asarray[] = "asarray";
static const char __pyx_k_average[] = "average";
static const char __pyx_k_ellipse[] = "ellipse";
static const char __pyx_k_epsilon[] = "epsilon";
static const char __pyx_k_float64[] = "float64";
static const char __pyx_k_g_tau_2[] = "g_tau";
static const char __pyx_k_gradC_2[] = "gradC";
static const char __pyx_k_mindist[] = "mindist";
static const char __pyx_k_reshape[] = "reshape";
static const char __pyx_k_savetxt[] = "savetxt";
static const char __pyx_k_t_final[] = "t_final";
static const char __pyx_k_uniform[] = "uniform";
static const char __pyx_k_weights[] = "weights";
static const char __pyx_k_deepcopy[] = "deepcopy";
static const char __pyx_k_getstate[] = "__getstate__";
static const char __pyx_k_lag_time[] = "lag time =";
static const char __pyx_k_linspace[] = "linspace";
static const char __pyx_k_pyx_type[] = "__pyx_type";
static const char __pyx_k_setstate[] = "__setstate__";
static const char __pyx_k_vcstring[] = "vcstring";
static const char __pyx_k_TypeError[] = "TypeError";
static const char __pyx_k_calc_corr[] = "calc_corr";
static const char __pyx_k_centroids[] = "centroids";
static const char __pyx_k_image_dim[] = "image, dim:";
static const char __pyx_k_num_basis[] = "num_basis";
static const char __pyx_k_pyx_state[] = "__pyx_state";
static const char __pyx_k_reduce_ex[] = "__reduce_ex__";
static const char __pyx_k_smoothing[] = "smoothing";
static const char __pyx_k_symmetric[] = "symmetric";
static const char __pyx_k_theta_deg[] = "theta_deg";
static const char __pyx_k_theta_rad[] = "theta rad";
static const char __pyx_k_Input_data[] = "\nInput data";
static const char __pyx_k_New_string[] = "New string =\n";
static const char __pyx_k_Trajectory[] = "\nTrajectory";
static const char __pyx_k_elliptical[] = "elliptical";
static const char __pyx_k_lag_time_2[] = "lag time:";
static const char __pyx_k_montecarlo[] = "montecarlo";
static const char __pyx_k_pyx_result[] = "__pyx_result";
static const char __pyx_k_pyx_vtable[] = "__pyx_vtable__";
static const char __pyx_k_traj_shape[] = "traj shape:";
static const char __pyx_k_ImportError[] = "ImportError";
static const char __pyx_k_PickleError[] = "PickleError";
static const char __pyx_k_accelerated[] = "accelerated";
static const char __pyx_k_alpha_deg_A[] = "alpha_deg_A";
static const char __pyx_k_alpha_deg_B[] = "alpha_deg_B";
static const char __pyx_k_calc_coeffs[] = "calc_coeffs";
static const char __pyx_k_corr_method[] = "corr_method";
static const char __pyx_k_last_frames[] = "last_frames";
static const char __pyx_k_theta_deg_2[] = "theta deg";
static const char __pyx_k_Equidistance[] = "Equidistance:";
static const char __pyx_k_New_position[] = "New position:";
static const char __pyx_k_Old_position[] = "Old position:";
static const char __pyx_k_RuntimeError[] = "RuntimeError";
static const char __pyx_k_calc_corr_q2[] = "calc_corr_q2";
static const char __pyx_k_ensemble_avg[] = "ensemble_avg";
static const char __pyx_k_out_of_index[] = "out of index";
static const char __pyx_k_pyx_checksum[] = "__pyx_checksum";
static const char __pyx_k_stringsource[] = "stringsource";
static const char __pyx_k_vcstring_pyx[] = "vcstring.pyx";
static const char __pyx_k_IMAGE_0_and_1[] = "\nIMAGE {0} and {1}";
static const char __pyx_k_Symmetric_D_0[] = "Symmetric D_0 =";
static const char __pyx_k_Weights_shape[] = "Weights shape =";
static const char __pyx_k_assign_states[] = "assign_states";
static const char __pyx_k_output_mc_txt[] = "output/mc.txt";
static const char __pyx_k_reduce_cython[] = "__reduce_cython__";
static const char __pyx_k_Affected_images[] = "\nAffected images:";
static const char __pyx_k_Input_positions[] = "Input positions:\n";
static const char __pyx_k_Matrix_elements[] = "Matrix elements";
static const char __pyx_k_Number_of_trajs[] = "Number of trajs:";
static const char __pyx_k_Symmetric_D_tau[] = "Symmetric D_tau =";
static const char __pyx_k_matrix_elements[] = "matrix_elements";
static const char __pyx_k_pyx_PickleError[] = "__pyx_PickleError";
static const char __pyx_k_setstate_cython[] = "__setstate_cython__";
static const char __pyx_k_ENSEMBLE_AVERAGE[] = "ENSEMBLE AVERAGE";
static const char __pyx_k_Initial_position[] = "Initial position:";
static const char __pyx_k_Plus_minus_delta[] = "Plus/minus delta:";
static const char __pyx_k_finite_diff_corr[] = "finite_diff_corr";
static const char __pyx_k_output_C_new_txt[] = "output/C_new.txt";
static const char __pyx_k_output_gradC_npz[] = "output/gradC.npz";
static const char __pyx_k_output_q_new_txt[] = "output/q_new.txt";
static const char __pyx_k_output_z_new_txt[] = "output/z_new.txt";
static const char __pyx_k_state_assignment[] = "state_assignment";
static const char __pyx_k_Matrix_elements_2[] = "\nMatrix elements";
static const char __pyx_k_Initial_position_2[] = "\nInitial position:";
static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
static const char __pyx_k_mindist_constraint[] = "mindist_constraint";
static const char __pyx_k_Length_input_output[] = "\nLength input, output:";
static const char __pyx_k_ensemble_timeavg_v1[] = "ensemble_timeavg_v1";
static const char __pyx_k_ensemble_timeavg_v2[] = "ensemble_timeavg_v2";
static const char __pyx_k_intermediate_region[] = "intermediate_region";
static const char __pyx_k_MONTE_CARLO_SAMPLING[] = "MONTE CARLO SAMPLING";
static const char __pyx_k_calc_coeffs_ensemble[] = "calc_coeffs_ensemble";
static const char __pyx_k_montecarlo_symmetric[] = "montecarlo_symmetric";
static const char __pyx_k_Reparametrized_string[] = "\nReparametrized string =\n";
static const char __pyx_k_State_assignment_type[] = "State_assignment type:";
static const char __pyx_k_Using_uniform_weights[] = "Using uniform weights";
static const char __pyx_k_calc_corr_q2_ensemble[] = "calc_corr_q2_ensemble";
static const char __pyx_k_finite_diff_committor[] = "finite_diff_committor";
static const char __pyx_k_orthogonal_projection[] = "orthogonal_projection";
static const char __pyx_k_output_coeffs_new_npz[] = "output/coeffs_new.npz";
static const char __pyx_k_pyx_unpickle_vcstring[] = "__pyx_unpickle_vcstring";
static const char __pyx_k_MONTE_CARLO_PARAMETERS[] = "\nMONTE CARLO PARAMETERS";
static const char __pyx_k_Moving_position_by_0_1[] = "Moving position by {0} , {1}";
static const char __pyx_k_Number_of_trajectories[] = "Number of trajectories:";
static const char __pyx_k_Total_length_of_string[] = "Total length of string:";
static const char __pyx_k_assign_states_ensemble[] = "assign_states_ensemble";
static const char __pyx_k_Distance_between_images[] = "Distance between images:";
static const char __pyx_k_Dividing_D_by_data_size[] = "Dividing D by data size\n";
static const char __pyx_k_Step_change_in_position[] = "Step change in position =";
static const char __pyx_k_calc_coeffs_accelerated[] = "calc_coeffs_accelerated";
static const char __pyx_k_output_coeffs_input_npz[] = "output/coeffs_input.npz";
static const char __pyx_k_REPARAMETRIZE_THE_STRING[] = "REPARAMETRIZE THE STRING";
static const char __pyx_k_Target_for_accept_reject[] = "Target for accept/reject:";
static const char __pyx_k_VORONOI_STATE_ASSIGNMENT[] = "VORONOI STATE ASSIGNMENT";
static const char __pyx_k_Dividing_D_by_data_size_2[] = "Dividing D by data size: ";
static const char __pyx_k_Step_change_in_position_2[] = "Step change in position:";
static const char __pyx_k_Voronoi_centroid_positions[] = "Voronoi centroid positions:\n";
static const char __pyx_k_FINITE_DIFFERENCE_COMPLETED[] = "\nFINITE DIFFERENCE COMPLETED";
static const char __pyx_k_CALCULATING_MONTE_CARLO_STEP[] = "\nCALCULATING MONTE CARLO STEP";
static const char __pyx_k_FINITE_DIFFERENCE_PARAMETERS[] = "\nFINITE DIFFERENCE PARAMETERS";
static const char __pyx_k_New_position_for_image_0_1_2[] = "New position for image {0}: {1} , {2}";
static const char __pyx_k_Number_of_MC_steps_per_image[] = "Number of MC steps per image:";
static const char __pyx_k_Symmetrization_of_D_matrices[] = "Symmetrization of D matrices:";
static const char __pyx_k_Voronoi_assignment_completed[] = "Voronoi assignment completed";
static const char __pyx_k_b_from_ensemble_time_average[] = "\nb from ensemble time average =";
static const char __pyx_k_calc_coeffs_ensemble_timeavg[] = "calc_coeffs_ensemble_timeavg";
static const char __pyx_k_calc_corr_q2_ensemble_timeavg[] = "calc_corr_q2_ensemble_timeavg";
static const char __pyx_k_ENSEMBLE_TIME_AVERAGE_method_1[] = "ENSEMBLE TIME AVERAGE - method 1";
static const char __pyx_k_ENSEMBLE_TIME_AVERAGE_method_2[] = "ENSEMBLE TIME AVERAGE - method 2";
static const char __pyx_k_Image_0_Moving_position_by_1_2[] = "Image {0}: Moving position by {1} , {2}";
static const char __pyx_k_Invalid_lag_time_Use_a_smaller[] = "\nInvalid lag time. Use a smaller lag time.";
static const char __pyx_k_MONTE_CARLO_SAMPLING_SYMMETRIC[] = "MONTE CARLO SAMPLING - SYMMETRIC";
static const char __pyx_k_Performing_Voronoi_tesselation[] = "Performing Voronoi tesselation";
static const char __pyx_k_orthogonal_proj_t_nc_tauection[] = "orthogonal_proj_t, nc_tauection";
static const char __pyx_k_Corr_from_ensemble_time_average[] = "Corr from ensemble time average =";
static const char __pyx_k_Distance_to_neighbhoring_images[] = "Distance to neighbhoring images:";
static const char __pyx_k_Enforcing_minimum_distance_cons[] = "\nEnforcing minimum distance constraint";
static const char __pyx_k_New_position_for_image_0_is_1_2[] = "New position for image {0} is: {1} , {2}";
static const char __pyx_k_SOLVING_LINEAR_BASIS_SET_COEFFI[] = "\nSOLVING LINEAR BASIS SET COEFFICIENTS, ACCELERATED METHOD";
static const char __pyx_k_Starting_Monte_Carlo_calculatio[] = "\nStarting Monte Carlo calculations";
static const char __pyx_k_WARNING_No_values_were_accepted[] = "\nWARNING: No values were accepted. Try increasing the number of MC steps.";
static const char __pyx_k_numpy_core_multiarray_failed_to[] = "numpy.core.multiarray failed to import";
static const char __pyx_k_Accepted_Moved_position_by_0_1_C[] = "Accepted: Moved position by {0} , {1}. Cnew {2} is less than Cmax {3}";
static const char __pyx_k_CALCULATING_CORRELATION_FUNCTION[] = "CALCULATING CORRELATION FUNCTION";
static const char __pyx_k_CALCULATING_FINITE_DIFFERENCE_GR[] = "CALCULATING FINITE DIFFERENCE GRADIENT";
static const char __pyx_k_ERROR_length_of_input_string_out[] = "ERROR, length of input string != output string";
static const char __pyx_k_Incompatible_checksums_s_vs_0xf6[] = "Incompatible checksums (%s vs 0xf65be29 = (alpha_A, alpha_B, alpha_deg_A, alpha_deg_B, cut, cut_A, cut_B, num_basis, ra_A, ra_B, rb_A, rb_B, state_assignment, theta, theta_deg, x0_A, x0_B, y0_A, y0_B))";
static const char __pyx_k_Incorrect_state_assignment_Chose[] = "Incorrect state assignment. Chosen state_assignment method is not available.";
static const char __pyx_k_Length_input_string_output_strin[] = "Length input string = output string:";
static const char __pyx_k_Minimum_distance_allowed_between[] = "Minimum distance allowed between images:";
static const char __pyx_k_Rejected_Moved_position_by_0_1_C[] = "Rejected: Moved position by {0} , {1}. Cnew {2} is greater than Cmax {3}";
static const char __pyx_k_Rejected_Moved_position_by_0_1_T[] = "Rejected: Moved position by {0} , {1}. Too close to neighboring images.";
static const char __pyx_k_SOLVING_LINEAR_BASIS_SET_COEFFIC[] = "SOLVING LINEAR BASIS SET COEFFICIENTS";
static const char __pyx_k_VORONOI_STATE_ASSIGNMENT_ENSEMBL[] = "VORONOI STATE ASSIGNMENT - ENSEMBLE";
static const char __pyx_k_WARNING_THIS_METHOD_IS_NOT_RECOM[] = "WARNING: THIS METHOD IS NOT RECOMMENDED FOR MOST CASES BECAUSE MOVING THE IMAGES MORE THAN A CERTAIN AMOUNT CAN AFFECT THE VORONOI TESSELATION IN FARTHER OUT IMAGES OTHER THAN THE NEAREST NEIGHBORS.";
static const char __pyx_k_calc_coeffs_ensemble_timeavg_fas[] = "calc_coeffs_ensemble_timeavg_fast";
static const char __pyx_k_calc_corr_q2_ensemble_timeavg_fa[] = "calc_corr_q2_ensemble_timeavg_fast";
static const char __pyx_k_numpy_core_umath_failed_to_impor[] = "numpy.core.umath failed to import";
static const char __pyx_k_calc_coeffs_ensemble_timeavg_fas_2[] = "calc_coeffs_ensemble_timeavg_fast_v2";
static PyObject *__pyx_kp_u_1d;
static PyObject *__pyx_kp_u_Accepted_Moved_position_by_0_1_C;
static PyObject *__pyx_kp_u_Affected_images;
static PyObject *__pyx_n_s_C;
static PyObject *__pyx_kp_u_CALCULATING_CORRELATION_FUNCTION;
static PyObject *__pyx_kp_u_CALCULATING_FINITE_DIFFERENCE_GR;
static PyObject *__pyx_kp_u_CALCULATING_MONTE_CARLO_STEP;
static PyObject *__pyx_n_s_C_avg;
static PyObject *__pyx_n_s_C_list;
static PyObject *__pyx_n_s_Cm;
static PyObject *__pyx_kp_u_Cm_2;
static PyObject *__pyx_kp_u_Corr;
static PyObject *__pyx_kp_u_Corr_2;
static PyObject *__pyx_kp_u_Corr_3;
static PyObject *__pyx_kp_u_Corr_from_ensemble_time_average;
static PyObject *__pyx_n_s_Cp;
static PyObject *__pyx_kp_u_Cp_2;
static PyObject *__pyx_n_s_DTYPE;
static PyObject *__pyx_kp_u_D_0;
static PyObject *__pyx_n_s_D_0_2;
static PyObject *__pyx_n_u_D_0_2;
static PyObject *__pyx_kp_u_D_tau;
static PyObject *__pyx_n_s_D_tau_2;
static PyObject *__pyx_n_u_D_tau_2;
static PyObject *__pyx_kp_u_Distance_between_images;
static PyObject *__pyx_kp_u_Distance_to_neighbhoring_images;
static PyObject *__pyx_kp_u_Dividing_D_by_data_size;
static PyObject *__pyx_kp_u_Dividing_D_by_data_size_2;
static PyObject *__pyx_kp_u_ENSEMBLE_AVERAGE;
static PyObject *__pyx_kp_u_ENSEMBLE_TIME_AVERAGE_method_1;
static PyObject *__pyx_kp_u_ENSEMBLE_TIME_AVERAGE_method_2;
static PyObject *__pyx_kp_u_ERROR_length_of_input_string_out;
static PyObject *__pyx_kp_u_Enforcing_minimum_distance_cons;
static PyObject *__pyx_kp_u_Equidistance;
static PyObject *__pyx_kp_u_FINITE_DIFFERENCE_COMPLETED;
static PyObject *__pyx_kp_u_FINITE_DIFFERENCE_PARAMETERS;
static PyObject *__pyx_kp_u_IMAGE;
static PyObject *__pyx_kp_u_IMAGE_0_and_1;
static PyObject *__pyx_n_u_Image;
static PyObject *__pyx_kp_u_Image_0_Moving_position_by_1_2;
static PyObject *__pyx_n_s_ImportError;
static PyObject *__pyx_kp_s_Incompatible_checksums_s_vs_0xf6;
static PyObject *__pyx_kp_u_Incorrect_state_assignment_Chose;
static PyObject *__pyx_kp_u_Initial_position;
static PyObject *__pyx_kp_u_Initial_position_2;
static PyObject *__pyx_kp_u_Input_data;
static PyObject *__pyx_kp_u_Input_positions;
static PyObject *__pyx_kp_u_Invalid_lag_time_Use_a_smaller;
static PyObject *__pyx_kp_u_Length_input_output;
static PyObject *__pyx_kp_u_Length_input_string_output_strin;
static PyObject *__pyx_kp_u_MONTE_CARLO_PARAMETERS;
static PyObject *__pyx_kp_u_MONTE_CARLO_SAMPLING;
static PyObject *__pyx_kp_u_MONTE_CARLO_SAMPLING_SYMMETRIC;
static PyObject *__pyx_kp_u_Matrix_elements;
static PyObject *__pyx_kp_u_Matrix_elements_2;
static PyObject *__pyx_kp_u_Minimum_distance_allowed_between;
static PyObject *__pyx_kp_u_Moving_position_by_0_1;
static PyObject *__pyx_n_s_N;
static PyObject *__pyx_kp_u_N_2;
static PyObject *__pyx_kp_u_New_position;
static PyObject *__pyx_kp_u_New_position_for_image_0_1_2;
static PyObject *__pyx_kp_u_New_position_for_image_0_is_1_2;
static PyObject *__pyx_kp_u_New_string;
static PyObject *__pyx_kp_u_Number_of_MC_steps_per_image;
static PyObject *__pyx_kp_u_Number_of_trajectories;
static PyObject *__pyx_kp_u_Number_of_trajs;
static PyObject *__pyx_kp_u_Old_position;
static PyObject *__pyx_kp_u_Performing_Voronoi_tesselation;
static PyObject *__pyx_n_s_PickleError;
static PyObject *__pyx_kp_u_Plus_minus_delta;
static PyObject *__pyx_kp_u_REPARAMETRIZE_THE_STRING;
static PyObject *__pyx_kp_u_Rejected_Moved_position_by_0_1_C;
static PyObject *__pyx_kp_u_Rejected_Moved_position_by_0_1_T;
static PyObject *__pyx_kp_u_Reparametrized_string;
static PyObject *__pyx_n_s_RuntimeError;
static PyObject *__pyx_kp_u_SOLVING_LINEAR_BASIS_SET_COEFFI;
static PyObject *__pyx_kp_u_SOLVING_LINEAR_BASIS_SET_COEFFIC;
static PyObject *__pyx_kp_u_SUMMARY;
static PyObject *__pyx_kp_u_Starting_Monte_Carlo_calculatio;
static PyObject *__pyx_kp_u_State_assignment_type;
static PyObject *__pyx_kp_u_Step_change_in_position;
static PyObject *__pyx_kp_u_Step_change_in_position_2;
static PyObject *__pyx_kp_u_Symmetric_D_0;
static PyObject *__pyx_kp_u_Symmetric_D_tau;
static PyObject *__pyx_kp_u_Symmetrization_of_D_matrices;
static PyObject *__pyx_n_s_T;
static PyObject *__pyx_kp_u_Target_for_accept_reject;
static PyObject *__pyx_kp_u_Total_length_of_string;
static PyObject *__pyx_kp_u_Trajectory;
static PyObject *__pyx_n_s_TypeError;
static PyObject *__pyx_kp_u_Using_uniform_weights;
static PyObject *__pyx_kp_u_VORONOI_STATE_ASSIGNMENT;
static PyObject *__pyx_kp_u_VORONOI_STATE_ASSIGNMENT_ENSEMBL;
static PyObject *__pyx_kp_u_Voronoi_assignment_completed;
static PyObject *__pyx_kp_u_Voronoi_centroid_positions;
static PyObject *__pyx_kp_u_WARNING_No_values_were_accepted;
static PyObject *__pyx_kp_u_WARNING_THIS_METHOD_IS_NOT_RECOM;
static PyObject *__pyx_kp_u_Weights_shape;
static PyObject *__pyx_kp_u__15;
static PyObject *__pyx_kp_u__18;
static PyObject *__pyx_kp_u__20;
static PyObject *__pyx_kp_u__23;
static PyObject *__pyx_kp_u__27;
static PyObject *__pyx_kp_u__3;
static PyObject *__pyx_kp_u__34;
static PyObject *__pyx_kp_u__35;
static PyObject *__pyx_kp_u__38;
static PyObject *__pyx_kp_u__41;
static PyObject *__pyx_kp_u__43;
static PyObject *__pyx_kp_u__48;
static PyObject *__pyx_kp_u__51;
static PyObject *__pyx_kp_u__55;
static PyObject *__pyx_kp_u__58;
static PyObject *__pyx_kp_u__6;
static PyObject *__pyx_kp_u__60;
static PyObject *__pyx_kp_u__63;
static PyObject *__pyx_kp_u__66;
static PyObject *__pyx_kp_u__69;
static PyObject *__pyx_kp_u__72;
static PyObject *__pyx_n_s_a;
static PyObject *__pyx_n_s_accelerated;
static PyObject *__pyx_n_s_alpha;
static PyObject *__pyx_n_s_alpha_deg_A;
static PyObject *__pyx_n_s_alpha_deg_B;
static PyObject *__pyx_n_s_append;
static PyObject *__pyx_n_s_arange;
static PyObject *__pyx_n_s_argmin;
static PyObject *__pyx_n_s_asarray;
static PyObject *__pyx_n_s_assign_states;
static PyObject *__pyx_n_s_assign_states_ensemble;
static PyObject *__pyx_n_s_average;
static PyObject *__pyx_n_s_axis;
static PyObject *__pyx_kp_u_b;
static PyObject *__pyx_n_s_b_2;
static PyObject *__pyx_n_u_b_2;
static PyObject *__pyx_kp_u_b_from_ensemble_time_average;
static PyObject *__pyx_n_s_c;
static PyObject *__pyx_n_s_calc_coeffs;
static PyObject *__pyx_n_s_calc_coeffs_accelerated;
static PyObject *__pyx_n_s_calc_coeffs_ensemble;
static PyObject *__pyx_n_s_calc_coeffs_ensemble_timeavg;
static PyObject *__pyx_n_s_calc_coeffs_ensemble_timeavg_fas;
static PyObject *__pyx_n_s_calc_coeffs_ensemble_timeavg_fas_2;
static PyObject *__pyx_n_s_calc_corr;
static PyObject *__pyx_n_s_calc_corr_q2;
static PyObject *__pyx_n_s_calc_corr_q2_ensemble;
static PyObject *__pyx_n_s_calc_corr_q2_ensemble_timeavg;
static PyObject *__pyx_n_s_calc_corr_q2_ensemble_timeavg_fa;
static PyObject *__pyx_n_s_centroids;
static PyObject *__pyx_n_s_cline_in_traceback;
static PyObject *__pyx_n_s_copy;
static PyObject *__pyx_n_s_corr_method;
static PyObject *__pyx_n_s_cos;
static PyObject *__pyx_kp_u_count;
static PyObject *__pyx_n_s_cut;
static PyObject *__pyx_n_s_cut_A;
static PyObject *__pyx_n_s_cut_B;
static PyObject *__pyx_n_s_deepcopy;
static PyObject *__pyx_n_s_delete;
static PyObject *__pyx_n_s_delta;
static PyObject *__pyx_n_s_dict;
static PyObject *__pyx_n_s_dim;
static PyObject *__pyx_n_s_dot;
static PyObject *__pyx_n_s_ell;
static PyObject *__pyx_n_s_ell_x;
static PyObject *__pyx_n_s_ell_y;
static PyObject *__pyx_n_u_ellipse;
static PyObject *__pyx_n_s_elliptical;
static PyObject *__pyx_n_s_ensemble_avg;
static PyObject *__pyx_n_s_ensemble_timeavg_v1;
static PyObject *__pyx_n_s_ensemble_timeavg_v2;
static PyObject *__pyx_n_s_epsilon;
static PyObject *__pyx_n_s_exp;
static PyObject *__pyx_n_s_finite_diff_committor;
static PyObject *__pyx_n_s_finite_diff_corr;
static PyObject *__pyx_n_s_first;
static PyObject *__pyx_n_s_float64;
static PyObject *__pyx_n_s_flush;
static PyObject *__pyx_n_s_format;
static PyObject *__pyx_kp_u_g_0;
static PyObject *__pyx_n_s_g_0_2;
static PyObject *__pyx_n_u_g_0_2;
static PyObject *__pyx_kp_u_g_tau;
static PyObject *__pyx_n_s_g_tau_2;
static PyObject *__pyx_n_u_g_tau_2;
static PyObject *__pyx_n_s_getstate;
static PyObject *__pyx_kp_u_gradC;
static PyObject *__pyx_n_s_gradC_2;
static PyObject *__pyx_n_u_gradC_2;
static PyObject *__pyx_n_s_hx_man;
static PyObject *__pyx_n_s_hy_man;
static PyObject *__pyx_n_s_i;
static PyObject *__pyx_n_s_ids;
static PyObject *__pyx_n_s_image;
static PyObject *__pyx_kp_u_image_dim;
static PyObject *__pyx_n_s_images;
static PyObject *__pyx_n_s_import;
static PyObject *__pyx_n_s_intermediate_region;
static PyObject *__pyx_n_s_inv;
static PyObject *__pyx_kp_u_lag_time;
static PyObject *__pyx_kp_u_lag_time_2;
static PyObject *__pyx_n_s_lags;
static PyObject *__pyx_n_s_last;
static PyObject *__pyx_n_s_last_frames;
static PyObject *__pyx_n_s_linalg;
static PyObject *__pyx_n_s_linspace;
static PyObject *__pyx_n_s_load;
static PyObject *__pyx_n_s_log;
static PyObject *__pyx_n_s_main;
static PyObject *__pyx_n_s_manual;
static PyObject *__pyx_n_s_math;
static PyObject *__pyx_n_u_matrix_elements;
static PyObject *__pyx_n_s_mean;
static PyObject *__pyx_n_s_mindist;
static PyObject *__pyx_n_s_mindist_constraint;
static PyObject *__pyx_n_s_montecarlo;
static PyObject *__pyx_n_s_montecarlo_symmetric;
static PyObject *__pyx_n_s_n;
static PyObject *__pyx_n_s_name;
static PyObject *__pyx_n_s_new;
static PyObject *__pyx_n_s_np;
static PyObject *__pyx_n_s_num_basis;
static PyObject *__pyx_n_s_numpy;
static PyObject *__pyx_kp_u_numpy_core_multiarray_failed_to;
static PyObject *__pyx_kp_u_numpy_core_umath_failed_to_impor;
static PyObject *__pyx_kp_u_orthogonal_proj_t_nc_tauection;
static PyObject *__pyx_n_u_orthogonal_projection;
static PyObject *__pyx_kp_u_out_of_index;
static PyObject *__pyx_kp_u_output_C_new_txt;
static PyObject *__pyx_kp_u_output_coeffs_input_npz;
static PyObject *__pyx_kp_u_output_coeffs_new_npz;
static PyObject *__pyx_kp_u_output_gradC_npz;
static PyObject *__pyx_kp_u_output_mc_txt;
static PyObject *__pyx_kp_u_output_q_new_txt;
static PyObject *__pyx_kp_u_output_z_new_txt;
static PyObject *__pyx_n_s_pi;
static PyObject *__pyx_n_s_pickle;
static PyObject *__pyx_n_s_print;
static PyObject *__pyx_n_s_pyx_PickleError;
static PyObject *__pyx_n_s_pyx_checksum;
static PyObject *__pyx_n_s_pyx_result;
static PyObject *__pyx_n_s_pyx_state;
static PyObject *__pyx_n_s_pyx_type;
static PyObject *__pyx_n_s_pyx_unpickle_vcstring;
static PyObject *__pyx_n_s_pyx_vtable;
static PyObject *__pyx_n_s_q;
static PyObject *__pyx_n_u_q2;
static PyObject *__pyx_n_s_q_avg;
static PyObject *__pyx_n_s_q_list;
static PyObject *__pyx_n_s_ra;
static PyObject *__pyx_n_s_ra_A;
static PyObject *__pyx_n_s_ra_B;
static PyObject *__pyx_n_s_random;
static PyObject *__pyx_n_s_range;
static PyObject *__pyx_n_s_rb;
static PyObject *__pyx_n_s_rb_A;
static PyObject *__pyx_n_s_rb_B;
static PyObject *__pyx_n_s_reduce;
static PyObject *__pyx_n_s_reduce_cython;
static PyObject *__pyx_n_s_reduce_ex;
static PyObject *__pyx_n_s_reparm;
static PyObject *__pyx_n_s_reshape;
static PyObject *__pyx_n_s_round;
static PyObject *__pyx_n_s_save;
static PyObject *__pyx_n_s_savetxt;
static PyObject *__pyx_n_s_savez;
static PyObject *__pyx_n_s_setstate;
static PyObject *__pyx_n_s_setstate_cython;
static PyObject *__pyx_n_s_shape;
static PyObject *__pyx_n_s_sin;
static PyObject *__pyx_n_s_smoothing;
static PyObject *__pyx_n_s_sqrt;
static PyObject *__pyx_n_s_square;
static PyObject *__pyx_n_s_start;
static PyObject *__pyx_n_s_state_assignment;
static PyObject *__pyx_n_s_stdout;
static PyObject *__pyx_n_s_stride;
static PyObject *__pyx_kp_s_stringsource;
static PyObject *__pyx_n_s_sum;
static PyObject *__pyx_n_s_symmetric;
static PyObject *__pyx_n_s_sys;
static PyObject *__pyx_n_s_t0;
static PyObject *__pyx_kp_u_t0_2;
static PyObject *__pyx_kp_u_t0_3;
static PyObject *__pyx_n_s_t_final;
static PyObject *__pyx_n_s_tan;
static PyObject *__pyx_n_s_target;
static PyObject *__pyx_n_s_tau;
static PyObject *__pyx_n_s_test;
static PyObject *__pyx_n_s_theta_deg;
static PyObject *__pyx_kp_u_theta_deg_2;
static PyObject *__pyx_kp_u_theta_rad;
static PyObject *__pyx_n_s_traj;
static PyObject *__pyx_kp_u_traj_shape;
static PyObject *__pyx_n_s_uniform;
static PyObject *__pyx_n_s_update;
static PyObject *__pyx_n_s_vcstring;
static PyObject *__pyx_kp_s_vcstring_pyx;
static PyObject *__pyx_n_s_weights;
static PyObject *__pyx_n_s_where;
static PyObject *__pyx_n_s_x0;
static PyObject *__pyx_n_s_x0_A;
static PyObject *__pyx_n_s_x0_B;
static PyObject *__pyx_n_s_xp;
static PyObject *__pyx_n_s_y0;
static PyObject *__pyx_n_s_y0_A;
static PyObject *__pyx_n_s_y0_B;
static PyObject *__pyx_n_s_yp;
static PyObject *__pyx_n_s_z;
static PyObject *__pyx_n_s_zeros;
static int __pyx_pf_8vcstring_8vcstring___init__(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_state_assignment, int __pyx_v_num_basis, PyObject *__pyx_v_cut_A, PyObject *__pyx_v_cut_B, PyObject *__pyx_v_theta_deg, PyObject *__pyx_v_cut, PyObject *__pyx_v_ra_A, PyObject *__pyx_v_rb_A, PyObject *__pyx_v_ra_B, PyObject *__pyx_v_rb_B, PyObject *__pyx_v_alpha_deg_A, PyObject *__pyx_v_alpha_deg_B, PyObject *__pyx_v_x0_A, PyObject *__pyx_v_y0_A, PyObject *__pyx_v_x0_B, PyObject *__pyx_v_y0_B); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_2intermediate_region(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_4centroids(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_6assign_states(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_8assign_states_ensemble(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, int __pyx_v_t0, PyObject *__pyx_v_weights, PyObject *__pyx_v_stride); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_10calc_coeffs(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_v_N, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_ids, PyObject *__pyx_v_symmetric); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_12calc_coeffs_accelerated(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_v_image, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_14calc_coeffs_ensemble(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_v_N, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_ids, PyObject *__pyx_v_symmetric); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_16calc_coeffs_ensemble_timeavg(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyObject *__pyx_v_weights, PyObject *__pyx_v_t_final, PyObject *__pyx_v_symmetric); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_18calc_coeffs_ensemble_timeavg_fast(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyObject *__pyx_v_weights, PyObject *__pyx_v_symmetric); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_20calc_coeffs_ensemble_timeavg_fast_v2(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_v_N, PyObject *__pyx_v_last_frames, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_ids, PyObject *__pyx_v_weights, PyObject *__pyx_v_symmetric); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_22calc_corr(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_b, PyArrayObject *__pyx_v_D_0, PyArrayObject *__pyx_v_D_tau, PyArrayObject *__pyx_v_g_0, PyArrayObject *__pyx_v_g_tau); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_24calc_corr_q2(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_b, PyArrayObject *__pyx_v_ids); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_26calc_corr_q2_ensemble(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_b, PyArrayObject *__pyx_v_ids); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_28calc_corr_q2_ensemble_timeavg(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_b, PyObject *__pyx_v_weights); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_30calc_corr_q2_ensemble_timeavg_fast(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_b, PyObject *__pyx_v_weights); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_32finite_diff_corr(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_v_image, int __pyx_v_dim, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_ids, double __pyx_v_delta); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_34finite_diff_committor(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_b, PyObject *__pyx_v_start, double __pyx_v_delta, double __pyx_v_epsilon); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_36montecarlo(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_images, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, double __pyx_v_target, double __pyx_v_delta, int __pyx_v_n, PyObject *__pyx_v_ensemble_timeavg_v1, PyObject *__pyx_v_ensemble_timeavg_v2, PyObject *__pyx_v_ensemble_avg, PyObject *__pyx_v_stride, PyObject *__pyx_v_weights, PyObject *__pyx_v_symmetric, PyObject *__pyx_v_manual, PyObject *__pyx_v_hx_man, PyObject *__pyx_v_hy_man, PyObject *__pyx_v_reparm, PyObject *__pyx_v_mindist_constraint, PyObject *__pyx_v_mindist, PyObject *__pyx_v_accelerated, PyObject *__pyx_v_corr_method, PyObject *__pyx_v_save); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_38montecarlo_symmetric(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_images, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, double __pyx_v_target, double __pyx_v_delta, int __pyx_v_n, PyObject *__pyx_v_manual, PyObject *__pyx_v_hx_man, PyObject *__pyx_v_hy_man, PyObject *__pyx_v_reparm, PyObject *__pyx_v_mindist_constraint, PyObject *__pyx_v_mindist, PyObject *__pyx_v_accelerated, PyObject *__pyx_v_corr_method, PyObject *__pyx_v_save); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_40__reduce_cython__(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self); /* proto */
static PyObject *__pyx_pf_8vcstring_8vcstring_42__setstate_cython__(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v___pyx_state); /* proto */
static PyObject *__pyx_pf_8vcstring_reparm_string(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_z); /* proto */
static PyObject *__pyx_pf_8vcstring_2elliptical_bounds_params(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_ra, double __pyx_v_rb, double __pyx_v_alpha, double __pyx_v_x0_A, double __pyx_v_y0_A, double __pyx_v_x0_B, double __pyx_v_y0_B); /* proto */
static PyObject *__pyx_pf_8vcstring_4elliptical(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_a, double __pyx_v_b, double __pyx_v_alpha, double __pyx_v_x0, double __pyx_v_y0, PyObject *__pyx_v_xp, PyObject *__pyx_v_yp); /* proto */
static PyObject *__pyx_pf_8vcstring_6smoothing(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_C_list, PyObject *__pyx_v_q_list, PyObject *__pyx_v_lags, PyObject *__pyx_v_first, PyObject *__pyx_v_last, PyObject *__pyx_v_cut); /* proto */
static PyObject *__pyx_pf_8vcstring_8__pyx_unpickle_vcstring(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state); /* proto */
static PyObject *__pyx_tp_new_8vcstring_vcstring(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_float_1_;
static PyObject *__pyx_float_0_0;
static PyObject *__pyx_float_0_5;
static PyObject *__pyx_float_1_0;
static PyObject *__pyx_float_0_25;
static PyObject *__pyx_float_180_0;
static PyObject *__pyx_int_0;
static PyObject *__pyx_int_1;
static PyObject *__pyx_int_2;
static PyObject *__pyx_int_5;
static PyObject *__pyx_int_10;
static PyObject *__pyx_int_258326057;
static PyObject *__pyx_int_neg_1;
static double __pyx_k__81;
static double __pyx_k__82;
static PyObject *__pyx_slice_;
static PyObject *__pyx_slice__2;
static PyObject *__pyx_slice__8;
static PyObject *__pyx_tuple__4;
static PyObject *__pyx_tuple__5;
static PyObject *__pyx_tuple__7;
static PyObject *__pyx_tuple__9;
static PyObject *__pyx_slice__78;
static PyObject *__pyx_tuple__10;
static PyObject *__pyx_tuple__11;
static PyObject *__pyx_tuple__12;
static PyObject *__pyx_tuple__13;
static PyObject *__pyx_tuple__14;
static PyObject *__pyx_tuple__16;
static PyObject *__pyx_tuple__17;
static PyObject *__pyx_tuple__19;
static PyObject *__pyx_tuple__21;
static PyObject *__pyx_tuple__22;
static PyObject *__pyx_tuple__24;
static PyObject *__pyx_tuple__25;
static PyObject *__pyx_tuple__26;
static PyObject *__pyx_tuple__28;
static PyObject *__pyx_tuple__29;
static PyObject *__pyx_tuple__30;
static PyObject *__pyx_tuple__31;
static PyObject *__pyx_tuple__32;
static PyObject *__pyx_tuple__33;
static PyObject *__pyx_tuple__36;
static PyObject *__pyx_tuple__37;
static PyObject *__pyx_tuple__39;
static PyObject *__pyx_tuple__40;
static PyObject *__pyx_tuple__42;
static PyObject *__pyx_tuple__44;
static PyObject *__pyx_tuple__45;
static PyObject *__pyx_tuple__46;
static PyObject *__pyx_tuple__47;
static PyObject *__pyx_tuple__49;
static PyObject *__pyx_tuple__50;
static PyObject *__pyx_tuple__52;
static PyObject *__pyx_tuple__53;
static PyObject *__pyx_tuple__54;
static PyObject *__pyx_tuple__56;
static PyObject *__pyx_tuple__57;
static PyObject *__pyx_tuple__59;
static PyObject *__pyx_tuple__61;
static PyObject *__pyx_tuple__62;
static PyObject *__pyx_tuple__64;
static PyObject *__pyx_tuple__65;
static PyObject *__pyx_tuple__67;
static PyObject *__pyx_tuple__68;
static PyObject *__pyx_tuple__70;
static PyObject *__pyx_tuple__71;
static PyObject *__pyx_tuple__73;
static PyObject *__pyx_tuple__74;
static PyObject *__pyx_tuple__75;
static PyObject *__pyx_tuple__76;
static PyObject *__pyx_tuple__77;
static PyObject *__pyx_tuple__79;
static PyObject *__pyx_tuple__80;
static PyObject *__pyx_tuple__83;
static PyObject *__pyx_tuple__84;
static PyObject *__pyx_tuple__85;
static PyObject *__pyx_tuple__87;
static PyObject *__pyx_tuple__89;
static PyObject *__pyx_codeobj__86;
static PyObject *__pyx_codeobj__88;
static PyObject *__pyx_codeobj__90;
/* Late includes */

/* "vcstring.pyx":20
 *     cdef double ra_A, rb_A, ra_B, rb_B, alpha_deg_A, alpha_deg_B, alpha_A, alpha_B, x0_A, y0_A, x0_B, y0_B
 * 
 *     def __init__(self, str state_assignment, int num_basis, cut_A=None, cut_B=None, theta_deg=None, cut=None, ra_A=None, rb_A=None, ra_B=None, rb_B=None, alpha_deg_A=None, alpha_deg_B=None, x0_A=None, y0_A=None, x0_B=None, y0_B=None):             # <<<<<<<<<<<<<<
 *         """Basis set parameters"""
 *         self.num_basis = num_basis  # Number of basis functions
 */

/* Python wrapper */
static int __pyx_pw_8vcstring_8vcstring_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8vcstring_8vcstring___init__[] = "Basis set parameters";
#if CYTHON_COMPILING_IN_CPYTHON
struct wrapperbase __pyx_wrapperbase_8vcstring_8vcstring___init__;
#endif
static int __pyx_pw_8vcstring_8vcstring_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_state_assignment = 0;
  int __pyx_v_num_basis;
  PyObject *__pyx_v_cut_A = 0;
  PyObject *__pyx_v_cut_B = 0;
  PyObject *__pyx_v_theta_deg = 0;
  PyObject *__pyx_v_cut = 0;
  PyObject *__pyx_v_ra_A = 0;
  PyObject *__pyx_v_rb_A = 0;
  PyObject *__pyx_v_ra_B = 0;
  PyObject *__pyx_v_rb_B = 0;
  PyObject *__pyx_v_alpha_deg_A = 0;
  PyObject *__pyx_v_alpha_deg_B = 0;
  PyObject *__pyx_v_x0_A = 0;
  PyObject *__pyx_v_y0_A = 0;
  PyObject *__pyx_v_x0_B = 0;
  PyObject *__pyx_v_y0_B = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_state_assignment,&__pyx_n_s_num_basis,&__pyx_n_s_cut_A,&__pyx_n_s_cut_B,&__pyx_n_s_theta_deg,&__pyx_n_s_cut,&__pyx_n_s_ra_A,&__pyx_n_s_rb_A,&__pyx_n_s_ra_B,&__pyx_n_s_rb_B,&__pyx_n_s_alpha_deg_A,&__pyx_n_s_alpha_deg_B,&__pyx_n_s_x0_A,&__pyx_n_s_y0_A,&__pyx_n_s_x0_B,&__pyx_n_s_y0_B,0};
    PyObject* values[16] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    values[2] = ((PyObject *)Py_None);
    values[3] = ((PyObject *)Py_None);
    values[4] = ((PyObject *)Py_None);
    values[5] = ((PyObject *)Py_None);
    values[6] = ((PyObject *)Py_None);
    values[7] = ((PyObject *)Py_None);
    values[8] = ((PyObject *)Py_None);
    values[9] = ((PyObject *)Py_None);
    values[10] = ((PyObject *)Py_None);
    values[11] = ((PyObject *)Py_None);
    values[12] = ((PyObject *)Py_None);
    values[13] = ((PyObject *)Py_None);
    values[14] = ((PyObject *)Py_None);
    values[15] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case 16: values[15] = PyTuple_GET_ITEM(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = PyTuple_GET_ITEM(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = PyTuple_GET_ITEM(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = PyTuple_GET_ITEM(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = PyTuple_GET_ITEM(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = PyTuple_GET_ITEM(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = PyTuple_GET_ITEM(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_state_assignment)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_num_basis)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__init__", 0, 2, 16, 1); __PYX_ERR(0, 20, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cut_A);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cut_B);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_theta_deg);
          if (value) { values[4] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cut);
          if (value) { values[5] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ra_A);
          if (value) { values[6] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rb_A);
          if (value) { values[7] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ra_B);
          if (value) { values[8] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rb_B);
          if (value) { values[9] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_alpha_deg_A);
          if (value) { values[10] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_alpha_deg_B);
          if (value) { values[11] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_x0_A);
          if (value) { values[12] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_y0_A);
          if (value) { values[13] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_x0_B);
          if (value) { values[14] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_y0_B);
          if (value) { values[15] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 20, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case 16: values[15] = PyTuple_GET_ITEM(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = PyTuple_GET_ITEM(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = PyTuple_GET_ITEM(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = PyTuple_GET_ITEM(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = PyTuple_GET_ITEM(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = PyTuple_GET_ITEM(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = PyTuple_GET_ITEM(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_state_assignment = ((PyObject*)values[0]);
    __pyx_v_num_basis = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_num_basis == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 20, __pyx_L3_error)
    __pyx_v_cut_A = values[2];
    __pyx_v_cut_B = values[3];
    __pyx_v_theta_deg = values[4];
    __pyx_v_cut = values[5];
    __pyx_v_ra_A = values[6];
    __pyx_v_rb_A = values[7];
    __pyx_v_ra_B = values[8];
    __pyx_v_rb_B = values[9];
    __pyx_v_alpha_deg_A = values[10];
    __pyx_v_alpha_deg_B = values[11];
    __pyx_v_x0_A = values[12];
    __pyx_v_y0_A = values[13];
    __pyx_v_x0_B = values[14];
    __pyx_v_y0_B = values[15];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__init__", 0, 2, 16, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 20, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.vcstring.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_state_assignment), (&PyUnicode_Type), 1, "state_assignment", 1))) __PYX_ERR(0, 20, __pyx_L1_error)
  __pyx_r = __pyx_pf_8vcstring_8vcstring___init__(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self), __pyx_v_state_assignment, __pyx_v_num_basis, __pyx_v_cut_A, __pyx_v_cut_B, __pyx_v_theta_deg, __pyx_v_cut, __pyx_v_ra_A, __pyx_v_rb_A, __pyx_v_ra_B, __pyx_v_rb_B, __pyx_v_alpha_deg_A, __pyx_v_alpha_deg_B, __pyx_v_x0_A, __pyx_v_y0_A, __pyx_v_x0_B, __pyx_v_y0_B);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static int __pyx_pf_8vcstring_8vcstring___init__(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_state_assignment, int __pyx_v_num_basis, PyObject *__pyx_v_cut_A, PyObject *__pyx_v_cut_B, PyObject *__pyx_v_theta_deg, PyObject *__pyx_v_cut, PyObject *__pyx_v_ra_A, PyObject *__pyx_v_rb_A, PyObject *__pyx_v_ra_B, PyObject *__pyx_v_rb_B, PyObject *__pyx_v_alpha_deg_A, PyObject *__pyx_v_alpha_deg_B, PyObject *__pyx_v_x0_A, PyObject *__pyx_v_y0_A, PyObject *__pyx_v_x0_B, PyObject *__pyx_v_y0_B) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  double __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__init__", 0);

  /* "vcstring.pyx":22
 *     def __init__(self, str state_assignment, int num_basis, cut_A=None, cut_B=None, theta_deg=None, cut=None, ra_A=None, rb_A=None, ra_B=None, rb_B=None, alpha_deg_A=None, alpha_deg_B=None, x0_A=None, y0_A=None, x0_B=None, y0_B=None):
 *         """Basis set parameters"""
 *         self.num_basis = num_basis  # Number of basis functions             # <<<<<<<<<<<<<<
 *         self.state_assignment = state_assignment
 *         if state_assignment == '1d':  # for 1-dimensional colvars
 */
  __pyx_v_self->num_basis = __pyx_v_num_basis;

  /* "vcstring.pyx":23
 *         """Basis set parameters"""
 *         self.num_basis = num_basis  # Number of basis functions
 *         self.state_assignment = state_assignment             # <<<<<<<<<<<<<<
 *         if state_assignment == '1d':  # for 1-dimensional colvars
 *             self.cut_A = cut_A
 */
  __Pyx_INCREF(__pyx_v_state_assignment);
  __Pyx_GIVEREF(__pyx_v_state_assignment);
  __Pyx_GOTREF(__pyx_v_self->state_assignment);
  __Pyx_DECREF(__pyx_v_self->state_assignment);
  __pyx_v_self->state_assignment = __pyx_v_state_assignment;

  /* "vcstring.pyx":24
 *         self.num_basis = num_basis  # Number of basis functions
 *         self.state_assignment = state_assignment
 *         if state_assignment == '1d':  # for 1-dimensional colvars             # <<<<<<<<<<<<<<
 *             self.cut_A = cut_A
 *             self.cut_B = cut_B
 */
  __pyx_t_1 = (__Pyx_PyUnicode_Equals(__pyx_v_state_assignment, __pyx_kp_u_1d, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 24, __pyx_L1_error)
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {

    /* "vcstring.pyx":25
 *         self.state_assignment = state_assignment
 *         if state_assignment == '1d':  # for 1-dimensional colvars
 *             self.cut_A = cut_A             # <<<<<<<<<<<<<<
 *             self.cut_B = cut_B
 *         if state_assignment == 'ellipse':
 */
    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_cut_A); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 25, __pyx_L1_error)
    __pyx_v_self->cut_A = __pyx_t_3;

    /* "vcstring.pyx":26
 *         if state_assignment == '1d':  # for 1-dimensional colvars
 *             self.cut_A = cut_A
 *             self.cut_B = cut_B             # <<<<<<<<<<<<<<
 *         if state_assignment == 'ellipse':
 *             self.ra_A = ra_A
 */
    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_cut_B); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 26, __pyx_L1_error)
    __pyx_v_self->cut_B = __pyx_t_3;

    /* "vcstring.pyx":24
 *         self.num_basis = num_basis  # Number of basis functions
 *         self.state_assignment = state_assignment
 *         if state_assignment == '1d':  # for 1-dimensional colvars             # <<<<<<<<<<<<<<
 *             self.cut_A = cut_A
 *             self.cut_B = cut_B
 */
  }

  /* "vcstring.pyx":27
 *             self.cut_A = cut_A
 *             self.cut_B = cut_B
 *         if state_assignment == 'ellipse':             # <<<<<<<<<<<<<<
 *             self.ra_A = ra_A
 *             self.rb_A = rb_A
 */
  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_state_assignment, __pyx_n_u_ellipse, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 27, __pyx_L1_error)
  __pyx_t_1 = (__pyx_t_2 != 0);
  if (__pyx_t_1) {

    /* "vcstring.pyx":28
 *             self.cut_B = cut_B
 *         if state_assignment == 'ellipse':
 *             self.ra_A = ra_A             # <<<<<<<<<<<<<<
 *             self.rb_A = rb_A
 *             self.ra_B = ra_B
 */
    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_ra_A); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 28, __pyx_L1_error)
    __pyx_v_self->ra_A = __pyx_t_3;

    /* "vcstring.pyx":29
 *         if state_assignment == 'ellipse':
 *             self.ra_A = ra_A
 *             self.rb_A = rb_A             # <<<<<<<<<<<<<<
 *             self.ra_B = ra_B
 *             self.rb_B = rb_B
 */
    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_rb_A); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 29, __pyx_L1_error)
    __pyx_v_self->rb_A = __pyx_t_3;

    /* "vcstring.pyx":30
 *             self.ra_A = ra_A
 *             self.rb_A = rb_A
 *             self.ra_B = ra_B             # <<<<<<<<<<<<<<
 *             self.rb_B = rb_B
 *             self.alpha_deg_A = alpha_deg_A
 */
    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_ra_B); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 30, __pyx_L1_error)
    __pyx_v_self->ra_B = __pyx_t_3;

    /* "vcstring.pyx":31
 *             self.rb_A = rb_A
 *             self.ra_B = ra_B
 *             self.rb_B = rb_B             # <<<<<<<<<<<<<<
 *             self.alpha_deg_A = alpha_deg_A
 *             self.alpha_A = alpha_deg_A * np.pi / 180.0
 */
    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_rb_B); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 31, __pyx_L1_error)
    __pyx_v_self->rb_B = __pyx_t_3;

    /* "vcstring.pyx":32
 *             self.ra_B = ra_B
 *             self.rb_B = rb_B
 *             self.alpha_deg_A = alpha_deg_A             # <<<<<<<<<<<<<<
 *             self.alpha_A = alpha_deg_A * np.pi / 180.0
 *             self.alpha_deg_B = alpha_deg_B
 */
    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_alpha_deg_A); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 32, __pyx_L1_error)
    __pyx_v_self->alpha_deg_A = __pyx_t_3;

    /* "vcstring.pyx":33
 *             self.rb_B = rb_B
 *             self.alpha_deg_A = alpha_deg_A
 *             self.alpha_A = alpha_deg_A * np.pi / 180.0             # <<<<<<<<<<<<<<
 *             self.alpha_deg_B = alpha_deg_B
 *             self.alpha_B = alpha_deg_B * np.pi / 180.0
 */
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 33, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_pi); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 33, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyNumber_Multiply(__pyx_v_alpha_deg_A, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 33, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = __Pyx_PyFloat_TrueDivideObjC(__pyx_t_4, __pyx_float_180_0, 180.0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 33, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 33, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_v_self->alpha_A = __pyx_t_3;

    /* "vcstring.pyx":34
 *             self.alpha_deg_A = alpha_deg_A
 *             self.alpha_A = alpha_deg_A * np.pi / 180.0
 *             self.alpha_deg_B = alpha_deg_B             # <<<<<<<<<<<<<<
 *             self.alpha_B = alpha_deg_B * np.pi / 180.0
 *             self.x0_A = x0_A
 */
    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_alpha_deg_B); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 34, __pyx_L1_error)
    __pyx_v_self->alpha_deg_B = __pyx_t_3;

    /* "vcstring.pyx":35
 *             self.alpha_A = alpha_deg_A * np.pi / 180.0
 *             self.alpha_deg_B = alpha_deg_B
 *             self.alpha_B = alpha_deg_B * np.pi / 180.0             # <<<<<<<<<<<<<<
 *             self.x0_A = x0_A
 *             self.y0_A = y0_A
 */
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 35, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_pi); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 35, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = PyNumber_Multiply(__pyx_v_alpha_deg_B, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 35, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyFloat_TrueDivideObjC(__pyx_t_5, __pyx_float_180_0, 180.0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 35, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 35, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_self->alpha_B = __pyx_t_3;

    /* "vcstring.pyx":36
 *             self.alpha_deg_B = alpha_deg_B
 *             self.alpha_B = alpha_deg_B * np.pi / 180.0
 *             self.x0_A = x0_A             # <<<<<<<<<<<<<<
 *             self.y0_A = y0_A
 *             self.x0_B = x0_B
 */
    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_x0_A); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 36, __pyx_L1_error)
    __pyx_v_self->x0_A = __pyx_t_3;

    /* "vcstring.pyx":37
 *             self.alpha_B = alpha_deg_B * np.pi / 180.0
 *             self.x0_A = x0_A
 *             self.y0_A = y0_A             # <<<<<<<<<<<<<<
 *             self.x0_B = x0_B
 *             self.y0_B = y0_B
 */
    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_y0_A); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 37, __pyx_L1_error)
    __pyx_v_self->y0_A = __pyx_t_3;

    /* "vcstring.pyx":38
 *             self.x0_A = x0_A
 *             self.y0_A = y0_A
 *             self.x0_B = x0_B             # <<<<<<<<<<<<<<
 *             self.y0_B = y0_B
 *         elif state_assignment == 'orthogonal_projection':
 */
    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_x0_B); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 38, __pyx_L1_error)
    __pyx_v_self->x0_B = __pyx_t_3;

    /* "vcstring.pyx":39
 *             self.y0_A = y0_A
 *             self.x0_B = x0_B
 *             self.y0_B = y0_B             # <<<<<<<<<<<<<<
 *         elif state_assignment == 'orthogonal_projection':
 *             self.theta_deg = theta_deg  # Degrees
 */
    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_y0_B); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 39, __pyx_L1_error)
    __pyx_v_self->y0_B = __pyx_t_3;

    /* "vcstring.pyx":27
 *             self.cut_A = cut_A
 *             self.cut_B = cut_B
 *         if state_assignment == 'ellipse':             # <<<<<<<<<<<<<<
 *             self.ra_A = ra_A
 *             self.rb_A = rb_A
 */
    goto __pyx_L4;
  }

  /* "vcstring.pyx":40
 *             self.x0_B = x0_B
 *             self.y0_B = y0_B
 *         elif state_assignment == 'orthogonal_projection':             # <<<<<<<<<<<<<<
 *             self.theta_deg = theta_deg  # Degrees
 *             self.theta = theta_deg * pi / 180.0  # Convert to radians
 */
  __pyx_t_1 = (__Pyx_PyUnicode_Equals(__pyx_v_state_assignment, __pyx_n_u_orthogonal_projection, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 40, __pyx_L1_error)
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {

    /* "vcstring.pyx":41
 *             self.y0_B = y0_B
 *         elif state_assignment == 'orthogonal_projection':
 *             self.theta_deg = theta_deg  # Degrees             # <<<<<<<<<<<<<<
 *             self.theta = theta_deg * pi / 180.0  # Convert to radians
 *             self.cut = cut  # Intermediate region cutoff along RC when theta = 0i
 */
    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_theta_deg); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 41, __pyx_L1_error)
    __pyx_v_self->theta_deg = __pyx_t_3;

    /* "vcstring.pyx":42
 *         elif state_assignment == 'orthogonal_projection':
 *             self.theta_deg = theta_deg  # Degrees
 *             self.theta = theta_deg * pi / 180.0  # Convert to radians             # <<<<<<<<<<<<<<
 *             self.cut = cut  # Intermediate region cutoff along RC when theta = 0i
 * 
 */
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_pi); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 42, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = PyNumber_Multiply(__pyx_v_theta_deg, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 42, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyFloat_TrueDivideObjC(__pyx_t_5, __pyx_float_180_0, 180.0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 42, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 42, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_self->theta = __pyx_t_3;

    /* "vcstring.pyx":43
 *             self.theta_deg = theta_deg  # Degrees
 *             self.theta = theta_deg * pi / 180.0  # Convert to radians
 *             self.cut = cut  # Intermediate region cutoff along RC when theta = 0i             # <<<<<<<<<<<<<<
 * 
 *     cpdef intermediate_region(self):
 */
    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_cut); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 43, __pyx_L1_error)
    __pyx_v_self->cut = __pyx_t_3;

    /* "vcstring.pyx":40
 *             self.x0_B = x0_B
 *             self.y0_B = y0_B
 *         elif state_assignment == 'orthogonal_projection':             # <<<<<<<<<<<<<<
 *             self.theta_deg = theta_deg  # Degrees
 *             self.theta = theta_deg * pi / 180.0  # Convert to radians
 */
  }
  __pyx_L4:;

  /* "vcstring.pyx":20
 *     cdef double ra_A, rb_A, ra_B, rb_B, alpha_deg_A, alpha_deg_B, alpha_A, alpha_B, x0_A, y0_A, x0_B, y0_B
 * 
 *     def __init__(self, str state_assignment, int num_basis, cut_A=None, cut_B=None, theta_deg=None, cut=None, ra_A=None, rb_A=None, ra_B=None, rb_B=None, alpha_deg_A=None, alpha_deg_B=None, x0_A=None, y0_A=None, x0_B=None, y0_B=None):             # <<<<<<<<<<<<<<
 *         """Basis set parameters"""
 *         self.num_basis = num_basis  # Number of basis functions
 */

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("vcstring.vcstring.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":45
 *             self.cut = cut  # Intermediate region cutoff along RC when theta = 0i
 * 
 *     cpdef intermediate_region(self):             # <<<<<<<<<<<<<<
 *         """Intermediate region bounds when theta is nonzero."""
 *         cdef double xa, xb
 */

static PyObject *__pyx_pw_8vcstring_8vcstring_3intermediate_region(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_intermediate_region(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_skip_dispatch) {
  double __pyx_v_xa;
  double __pyx_v_xb;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  double __pyx_t_8;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("intermediate_region", 0);
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_intermediate_region); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 45, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_8vcstring_8vcstring_3intermediate_region)) {
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_4)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_4);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 45, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }

  /* "vcstring.pyx":48
 *         """Intermediate region bounds when theta is nonzero."""
 *         cdef double xa, xb
 *         xa = ((tan(self.theta + pi/2) - 1) * self.cut) / (tan(self.theta) - tan(self.theta + pi/2))             # <<<<<<<<<<<<<<
 *         xb = ((-tan(self.theta + pi/2) + 1) * self.cut) / (tan(self.theta) - tan(self.theta + pi/2))
 *         return xa, xb
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_tan); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_pi); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyInt_TrueDivideObjC(__pyx_t_4, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyNumber_Add(__pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_self->cut); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyNumber_Multiply(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_tan); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_5);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_tan); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_pi); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_7 = __Pyx_PyInt_TrueDivideObjC(__pyx_t_6, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyNumber_Add(__pyx_t_3, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
    }
  }
  __pyx_t_2 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_7, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = PyNumber_Subtract(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyNumber_Divide(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_8 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_8 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_xa = __pyx_t_8;

  /* "vcstring.pyx":49
 *         cdef double xa, xb
 *         xa = ((tan(self.theta + pi/2) - 1) * self.cut) / (tan(self.theta) - tan(self.theta + pi/2))
 *         xb = ((-tan(self.theta + pi/2) + 1) * self.cut) / (tan(self.theta) - tan(self.theta + pi/2))             # <<<<<<<<<<<<<<
 *         return xa, xb
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_tan); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_pi); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_6 = __Pyx_PyInt_TrueDivideObjC(__pyx_t_1, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Add(__pyx_t_4, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
    }
  }
  __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_1);
  __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = PyNumber_Negative(__pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_AddObjC(__pyx_t_5, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = PyFloat_FromDouble(__pyx_v_self->cut); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_1 = PyNumber_Multiply(__pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_tan); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_6);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_tan); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_pi); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_3 = __Pyx_PyInt_TrueDivideObjC(__pyx_t_7, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = PyNumber_Add(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_3, __pyx_t_7) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_7);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyNumber_Subtract(__pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyNumber_Divide(__pyx_t_1, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_8 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_8 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_xb = __pyx_t_8;

  /* "vcstring.pyx":50
 *         xa = ((tan(self.theta + pi/2) - 1) * self.cut) / (tan(self.theta) - tan(self.theta + pi/2))
 *         xb = ((-tan(self.theta + pi/2) + 1) * self.cut) / (tan(self.theta) - tan(self.theta + pi/2))
 *         return xa, xb             # <<<<<<<<<<<<<<
 * 
 *     cpdef centroids(self):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_xa); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 50, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = PyFloat_FromDouble(__pyx_v_xb); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 50, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 50, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_6);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_6);
  __pyx_t_2 = 0;
  __pyx_t_6 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "vcstring.pyx":45
 *             self.cut = cut  # Intermediate region cutoff along RC when theta = 0i
 * 
 *     cpdef intermediate_region(self):             # <<<<<<<<<<<<<<
 *         """Intermediate region bounds when theta is nonzero."""
 *         cdef double xa, xb
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("vcstring.vcstring.intermediate_region", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_3intermediate_region(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_8vcstring_8vcstring_2intermediate_region[] = "Intermediate region bounds when theta is nonzero.";
static PyObject *__pyx_pw_8vcstring_8vcstring_3intermediate_region(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("intermediate_region (wrapper)", 0);
  __pyx_r = __pyx_pf_8vcstring_8vcstring_2intermediate_region(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_2intermediate_region(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("intermediate_region", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __pyx_f_8vcstring_8vcstring_intermediate_region(__pyx_v_self, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 45, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("vcstring.vcstring.intermediate_region", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":52
 *         return xa, xb
 * 
 *     cpdef centroids(self):             # <<<<<<<<<<<<<<
 *         """Define centroid positions of the basis functions."""
 *         cdef double xa, xb
 */

static PyObject *__pyx_pw_8vcstring_8vcstring_5centroids(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_centroids(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_skip_dispatch) {
  double __pyx_v_xa;
  double __pyx_v_xb;
  PyArrayObject *__pyx_v_xcenters = 0;
  PyArrayObject *__pyx_v_ycenters = 0;
  PyArrayObject *__pyx_v_z = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_xcenters;
  __Pyx_Buffer __pyx_pybuffer_xcenters;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ycenters;
  __Pyx_Buffer __pyx_pybuffer_ycenters;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *(*__pyx_t_5)(PyObject *);
  double __pyx_t_6;
  double __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_t_10;
  PyObject *__pyx_t_11 = NULL;
  PyArrayObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  PyObject *__pyx_t_14 = NULL;
  PyObject *__pyx_t_15 = NULL;
  PyArrayObject *__pyx_t_16 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("centroids", 0);
  __pyx_pybuffer_xcenters.pybuffer.buf = NULL;
  __pyx_pybuffer_xcenters.refcount = 0;
  __pyx_pybuffernd_xcenters.data = NULL;
  __pyx_pybuffernd_xcenters.rcbuffer = &__pyx_pybuffer_xcenters;
  __pyx_pybuffer_ycenters.pybuffer.buf = NULL;
  __pyx_pybuffer_ycenters.refcount = 0;
  __pyx_pybuffernd_ycenters.data = NULL;
  __pyx_pybuffernd_ycenters.rcbuffer = &__pyx_pybuffer_ycenters;
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_centroids); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 52, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_8vcstring_8vcstring_5centroids)) {
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
          __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
          if (likely(__pyx_t_4)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_4);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_3, function);
          }
        }
        __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 52, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }

  /* "vcstring.pyx":57
 *         cdef np.ndarray[DTYPE_t, ndim=1] xcenters, ycenters
 *         cdef np.ndarray[DTYPE_t, ndim=2] z
 *         xa, xb = self.intermediate_region()             # <<<<<<<<<<<<<<
 *         xcenters = np.linspace(xa, xb, self.num_basis+1)
 *         xcenters = (xcenters[:-1] + xcenters[1:]) / 2
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->intermediate_region(__pyx_v_self, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 57, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
    PyObject* sequence = __pyx_t_1;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 57, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_2 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_t_3);
    #else
    __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 57, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 57, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    #endif
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_4 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 57, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = Py_TYPE(__pyx_t_4)->tp_iternext;
    index = 0; __pyx_t_2 = __pyx_t_5(__pyx_t_4); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_2);
    index = 1; __pyx_t_3 = __pyx_t_5(__pyx_t_4); if (unlikely(!__pyx_t_3)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_3);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_5(__pyx_t_4), 2) < 0) __PYX_ERR(0, 57, __pyx_L1_error)
    __pyx_t_5 = NULL;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L4_unpacking_done;
    __pyx_L3_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 57, __pyx_L1_error)
    __pyx_L4_unpacking_done:;
  }
  __pyx_t_6 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_6 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 57, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_7 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_7 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 57, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_xa = __pyx_t_6;
  __pyx_v_xb = __pyx_t_7;

  /* "vcstring.pyx":58
 *         cdef np.ndarray[DTYPE_t, ndim=2] z
 *         xa, xb = self.intermediate_region()
 *         xcenters = np.linspace(xa, xb, self.num_basis+1)             # <<<<<<<<<<<<<<
 *         xcenters = (xcenters[:-1] + xcenters[1:]) / 2
 *         ycenters = tan(self.theta) * xcenters
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 58, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_linspace); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 58, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_xa); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 58, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_xb); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 58, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_8 = __Pyx_PyInt_From_long((__pyx_v_self->num_basis + 1)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 58, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_9 = NULL;
  __pyx_t_10 = 0;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_9)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_9);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_10 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[4] = {__pyx_t_9, __pyx_t_3, __pyx_t_4, __pyx_t_8};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_10, 3+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 58, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[4] = {__pyx_t_9, __pyx_t_3, __pyx_t_4, __pyx_t_8};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_10, 3+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 58, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  } else
  #endif
  {
    __pyx_t_11 = PyTuple_New(3+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 58, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    if (__pyx_t_9) {
      __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_9); __pyx_t_9 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_10, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_10, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_8);
    PyTuple_SET_ITEM(__pyx_t_11, 2+__pyx_t_10, __pyx_t_8);
    __pyx_t_3 = 0;
    __pyx_t_4 = 0;
    __pyx_t_8 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_11, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 58, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 58, __pyx_L1_error)
  __pyx_t_12 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer);
    __pyx_t_10 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer, (PyObject*)__pyx_t_12, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_10 < 0)) {
      PyErr_Fetch(&__pyx_t_13, &__pyx_t_14, &__pyx_t_15);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer, (PyObject*)__pyx_v_xcenters, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_13, __pyx_t_14, __pyx_t_15);
      }
      __pyx_t_13 = __pyx_t_14 = __pyx_t_15 = 0;
    }
    __pyx_pybuffernd_xcenters.diminfo[0].strides = __pyx_pybuffernd_xcenters.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_xcenters.diminfo[0].shape = __pyx_pybuffernd_xcenters.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 58, __pyx_L1_error)
  }
  __pyx_t_12 = 0;
  __pyx_v_xcenters = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":59
 *         xa, xb = self.intermediate_region()
 *         xcenters = np.linspace(xa, xb, self.num_basis+1)
 *         xcenters = (xcenters[:-1] + xcenters[1:]) / 2             # <<<<<<<<<<<<<<
 *         ycenters = tan(self.theta) * xcenters
 *         z = np.c_[xcenters, ycenters]
 */
  __pyx_t_1 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_xcenters), __pyx_slice_); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 59, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_xcenters), __pyx_slice__2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 59, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_11 = PyNumber_Add(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 59, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_TrueDivideObjC(__pyx_t_11, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 59, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 59, __pyx_L1_error)
  __pyx_t_12 = ((PyArrayObject *)__pyx_t_2);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer);
    __pyx_t_10 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer, (PyObject*)__pyx_t_12, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_10 < 0)) {
      PyErr_Fetch(&__pyx_t_15, &__pyx_t_14, &__pyx_t_13);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer, (PyObject*)__pyx_v_xcenters, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_13);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_15, __pyx_t_14, __pyx_t_13);
      }
      __pyx_t_15 = __pyx_t_14 = __pyx_t_13 = 0;
    }
    __pyx_pybuffernd_xcenters.diminfo[0].strides = __pyx_pybuffernd_xcenters.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_xcenters.diminfo[0].shape = __pyx_pybuffernd_xcenters.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 59, __pyx_L1_error)
  }
  __pyx_t_12 = 0;
  __Pyx_DECREF_SET(__pyx_v_xcenters, ((PyArrayObject *)__pyx_t_2));
  __pyx_t_2 = 0;

  /* "vcstring.pyx":60
 *         xcenters = np.linspace(xa, xb, self.num_basis+1)
 *         xcenters = (xcenters[:-1] + xcenters[1:]) / 2
 *         ycenters = tan(self.theta) * xcenters             # <<<<<<<<<<<<<<
 *         z = np.c_[xcenters, ycenters]
 *         return z
 */
  __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_tan); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 60, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 60, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_8 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_11);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_11, function);
    }
  }
  __pyx_t_2 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_8, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_t_1);
  __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 60, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = PyNumber_Multiply(__pyx_t_2, ((PyObject *)__pyx_v_xcenters)); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 60, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_11) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_11, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 60, __pyx_L1_error)
  __pyx_t_12 = ((PyArrayObject *)__pyx_t_11);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer);
    __pyx_t_10 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer, (PyObject*)__pyx_t_12, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_10 < 0)) {
      PyErr_Fetch(&__pyx_t_13, &__pyx_t_14, &__pyx_t_15);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer, (PyObject*)__pyx_v_ycenters, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_13, __pyx_t_14, __pyx_t_15);
      }
      __pyx_t_13 = __pyx_t_14 = __pyx_t_15 = 0;
    }
    __pyx_pybuffernd_ycenters.diminfo[0].strides = __pyx_pybuffernd_ycenters.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ycenters.diminfo[0].shape = __pyx_pybuffernd_ycenters.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 60, __pyx_L1_error)
  }
  __pyx_t_12 = 0;
  __pyx_v_ycenters = ((PyArrayObject *)__pyx_t_11);
  __pyx_t_11 = 0;

  /* "vcstring.pyx":61
 *         xcenters = (xcenters[:-1] + xcenters[1:]) / 2
 *         ycenters = tan(self.theta) * xcenters
 *         z = np.c_[xcenters, ycenters]             # <<<<<<<<<<<<<<
 *         return z
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 61, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_c); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 61, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = PyTuple_New(2); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 61, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_INCREF(((PyObject *)__pyx_v_xcenters));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_xcenters));
  PyTuple_SET_ITEM(__pyx_t_11, 0, ((PyObject *)__pyx_v_xcenters));
  __Pyx_INCREF(((PyObject *)__pyx_v_ycenters));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_ycenters));
  PyTuple_SET_ITEM(__pyx_t_11, 1, ((PyObject *)__pyx_v_ycenters));
  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 61, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 61, __pyx_L1_error)
  __pyx_t_16 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
    __pyx_t_10 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_t_16, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_10 < 0)) {
      PyErr_Fetch(&__pyx_t_15, &__pyx_t_14, &__pyx_t_13);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_13);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_15, __pyx_t_14, __pyx_t_13);
      }
      __pyx_t_15 = __pyx_t_14 = __pyx_t_13 = 0;
    }
    __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 61, __pyx_L1_error)
  }
  __pyx_t_16 = 0;
  __pyx_v_z = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":62
 *         ycenters = tan(self.theta) * xcenters
 *         z = np.c_[xcenters, ycenters]
 *         return z             # <<<<<<<<<<<<<<
 * 
 *     cpdef assign_states(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_z));
  __pyx_r = ((PyObject *)__pyx_v_z);
  goto __pyx_L0;

  /* "vcstring.pyx":52
 *         return xa, xb
 * 
 *     cpdef centroids(self):             # <<<<<<<<<<<<<<
 *         """Define centroid positions of the basis functions."""
 *         cdef double xa, xb
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_11);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.centroids", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XDECREF((PyObject *)__pyx_v_xcenters);
  __Pyx_XDECREF((PyObject *)__pyx_v_ycenters);
  __Pyx_XDECREF((PyObject *)__pyx_v_z);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_5centroids(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_8vcstring_8vcstring_4centroids[] = "Define centroid positions of the basis functions.";
static PyObject *__pyx_pw_8vcstring_8vcstring_5centroids(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("centroids (wrapper)", 0);
  __pyx_r = __pyx_pf_8vcstring_8vcstring_4centroids(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_4centroids(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("centroids", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __pyx_f_8vcstring_8vcstring_centroids(__pyx_v_self, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 52, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("vcstring.vcstring.centroids", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":64
 *         return z
 * 
 *     cpdef assign_states(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z):             # <<<<<<<<<<<<<<
 *         """
 *         Assign points to Voronoi cells
 */

static PyObject *__pyx_pw_8vcstring_8vcstring_7assign_states(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_assign_states(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, int __pyx_skip_dispatch) {
  double __pyx_v_xa;
  double __pyx_v_xb;
  double __pyx_v_ell_tA;
  double __pyx_v_ell_tB;
  PyArrayObject *__pyx_v_xcenters = 0;
  PyArrayObject *__pyx_v_ycenters = 0;
  int __pyx_v_N;
  int __pyx_v_t;
  PyObject *__pyx_v_x = 0;
  PyObject *__pyx_v_y = 0;
  PyArrayObject *__pyx_v_dist = 0;
  double __pyx_v_x_t;
  double __pyx_v_y_t;
  double __pyx_v_nc;
  double __pyx_v_u_t;
  PyObject *__pyx_v_ids = NULL;
  double __pyx_v_h_I;
  double __pyx_v_h_B;
  PyObject *__pyx_7genexpr__pyx_v_row = NULL;
  PyObject *__pyx_8genexpr1__pyx_v_row = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_dist;
  __Pyx_Buffer __pyx_pybuffer_dist;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_xcenters;
  __Pyx_Buffer __pyx_pybuffer_xcenters;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ycenters;
  __Pyx_Buffer __pyx_pybuffer_ycenters;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  int __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  double __pyx_t_11;
  double __pyx_t_12;
  Py_ssize_t __pyx_t_13;
  PyArrayObject *__pyx_t_14 = NULL;
  PyObject *__pyx_t_15 = NULL;
  PyObject *__pyx_t_16 = NULL;
  PyObject *__pyx_t_17 = NULL;
  int __pyx_t_18;
  int __pyx_t_19;
  PyArrayObject *__pyx_t_20 = NULL;
  int __pyx_t_21;
  PyObject *__pyx_t_22 = NULL;
  PyObject *__pyx_t_23 = NULL;
  PyObject *__pyx_t_24 = NULL;
  PyObject *__pyx_t_25 = NULL;
  PyObject *__pyx_t_26 = NULL;
  int __pyx_t_27;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("assign_states", 0);
  __pyx_pybuffer_xcenters.pybuffer.buf = NULL;
  __pyx_pybuffer_xcenters.refcount = 0;
  __pyx_pybuffernd_xcenters.data = NULL;
  __pyx_pybuffernd_xcenters.rcbuffer = &__pyx_pybuffer_xcenters;
  __pyx_pybuffer_ycenters.pybuffer.buf = NULL;
  __pyx_pybuffer_ycenters.refcount = 0;
  __pyx_pybuffernd_ycenters.data = NULL;
  __pyx_pybuffernd_ycenters.rcbuffer = &__pyx_pybuffer_ycenters;
  __pyx_pybuffer_dist.pybuffer.buf = NULL;
  __pyx_pybuffer_dist.refcount = 0;
  __pyx_pybuffernd_dist.data = NULL;
  __pyx_pybuffernd_dist.rcbuffer = &__pyx_pybuffer_dist;
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 64, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_assign_states); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 64, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_8vcstring_8vcstring_7assign_states)) {
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 64, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
        __pyx_t_6 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
          __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
          if (likely(__pyx_t_5)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
            __Pyx_INCREF(__pyx_t_5);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_4, function);
            __pyx_t_6 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_z)};
          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 64, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_z)};
          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 64, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        } else
        #endif
        {
          __pyx_t_7 = PyTuple_New(3+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 64, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          if (__pyx_t_5) {
            __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
          }
          __Pyx_INCREF(__pyx_v_traj);
          __Pyx_GIVEREF(__pyx_v_traj);
          PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_traj);
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_t_3);
          __Pyx_INCREF(((PyObject *)__pyx_v_z));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
          PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_6, ((PyObject *)__pyx_v_z));
          __pyx_t_3 = 0;
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 64, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        }
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }

  /* "vcstring.pyx":81
 *         cdef np.ndarray[DTYPE_t, ndim=1] g_0_arr, g_tau_arr, g, b
 * 
 *         print('\n=========================')             # <<<<<<<<<<<<<<
 *         print('VORONOI STATE ASSIGNMENT')
 *         print('=========================')
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 81, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":82
 * 
 *         print('\n=========================')
 *         print('VORONOI STATE ASSIGNMENT')             # <<<<<<<<<<<<<<
 *         print('=========================')
 *         print('State_assignment type:', self.state_assignment)
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":83
 *         print('\n=========================')
 *         print('VORONOI STATE ASSIGNMENT')
 *         print('=========================')             # <<<<<<<<<<<<<<
 *         print('State_assignment type:', self.state_assignment)
 *         if self.state_assignment == 'orthogonal_projection':
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 83, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":84
 *         print('VORONOI STATE ASSIGNMENT')
 *         print('=========================')
 *         print('State_assignment type:', self.state_assignment)             # <<<<<<<<<<<<<<
 *         if self.state_assignment == 'orthogonal_projection':
 *             xa, xb = self.intermediate_region()
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 84, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_State_assignment_type);
  __Pyx_GIVEREF(__pyx_kp_u_State_assignment_type);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_State_assignment_type);
  __Pyx_INCREF(__pyx_v_self->state_assignment);
  __Pyx_GIVEREF(__pyx_v_self->state_assignment);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_self->state_assignment);
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 84, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":85
 *         print('=========================')
 *         print('State_assignment type:', self.state_assignment)
 *         if self.state_assignment == 'orthogonal_projection':             # <<<<<<<<<<<<<<
 *             xa, xb = self.intermediate_region()
 * 
 */
  __pyx_t_8 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_n_u_orthogonal_projection, Py_EQ)); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 85, __pyx_L1_error)
  __pyx_t_9 = (__pyx_t_8 != 0);
  if (__pyx_t_9) {

    /* "vcstring.pyx":86
 *         print('State_assignment type:', self.state_assignment)
 *         if self.state_assignment == 'orthogonal_projection':
 *             xa, xb = self.intermediate_region()             # <<<<<<<<<<<<<<
 * 
 *         N = len(traj)       # Length of trajectory
 */
    __pyx_t_2 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->intermediate_region(__pyx_v_self, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 86, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
      PyObject* sequence = __pyx_t_2;
      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        __PYX_ERR(0, 86, __pyx_L1_error)
      }
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
      } else {
        __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
      }
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_4);
      #else
      __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 86, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 86, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      #endif
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_7 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 86, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_10 = Py_TYPE(__pyx_t_7)->tp_iternext;
      index = 0; __pyx_t_1 = __pyx_t_10(__pyx_t_7); if (unlikely(!__pyx_t_1)) goto __pyx_L4_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_1);
      index = 1; __pyx_t_4 = __pyx_t_10(__pyx_t_7); if (unlikely(!__pyx_t_4)) goto __pyx_L4_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_4);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_10(__pyx_t_7), 2) < 0) __PYX_ERR(0, 86, __pyx_L1_error)
      __pyx_t_10 = NULL;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      goto __pyx_L5_unpacking_done;
      __pyx_L4_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_10 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      __PYX_ERR(0, 86, __pyx_L1_error)
      __pyx_L5_unpacking_done:;
    }
    __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 86, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 86, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_xa = __pyx_t_11;
    __pyx_v_xb = __pyx_t_12;

    /* "vcstring.pyx":85
 *         print('=========================')
 *         print('State_assignment type:', self.state_assignment)
 *         if self.state_assignment == 'orthogonal_projection':             # <<<<<<<<<<<<<<
 *             xa, xb = self.intermediate_region()
 * 
 */
  }

  /* "vcstring.pyx":88
 *             xa, xb = self.intermediate_region()
 * 
 *         N = len(traj)       # Length of trajectory             # <<<<<<<<<<<<<<
 *         x = [row[1] for row in traj]
 *         xcenters = z[:, 0]
 */
  if (unlikely(__pyx_v_traj == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
    __PYX_ERR(0, 88, __pyx_L1_error)
  }
  __pyx_t_13 = PyList_GET_SIZE(__pyx_v_traj); if (unlikely(__pyx_t_13 == ((Py_ssize_t)-1))) __PYX_ERR(0, 88, __pyx_L1_error)
  __pyx_v_N = __pyx_t_13;

  /* "vcstring.pyx":89
 * 
 *         N = len(traj)       # Length of trajectory
 *         x = [row[1] for row in traj]             # <<<<<<<<<<<<<<
 *         xcenters = z[:, 0]
 *         if self.state_assignment != '1d':
 */
  { /* enter inner scope */
    __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 89, __pyx_L8_error)
    __Pyx_GOTREF(__pyx_t_2);
    if (unlikely(__pyx_v_traj == Py_None)) {
      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
      __PYX_ERR(0, 89, __pyx_L8_error)
    }
    __pyx_t_4 = __pyx_v_traj; __Pyx_INCREF(__pyx_t_4); __pyx_t_13 = 0;
    for (;;) {
      if (__pyx_t_13 >= PyList_GET_SIZE(__pyx_t_4)) break;
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      __pyx_t_1 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_13); __Pyx_INCREF(__pyx_t_1); __pyx_t_13++; if (unlikely(0 < 0)) __PYX_ERR(0, 89, __pyx_L8_error)
      #else
      __pyx_t_1 = PySequence_ITEM(__pyx_t_4, __pyx_t_13); __pyx_t_13++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 89, __pyx_L8_error)
      __Pyx_GOTREF(__pyx_t_1);
      #endif
      __Pyx_XDECREF_SET(__pyx_7genexpr__pyx_v_row, __pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_GetItemInt(__pyx_7genexpr__pyx_v_row, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 89, __pyx_L8_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (unlikely(__Pyx_ListComp_Append(__pyx_t_2, (PyObject*)__pyx_t_1))) __PYX_ERR(0, 89, __pyx_L8_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_7genexpr__pyx_v_row); __pyx_7genexpr__pyx_v_row = 0;
    goto __pyx_L11_exit_scope;
    __pyx_L8_error:;
    __Pyx_XDECREF(__pyx_7genexpr__pyx_v_row); __pyx_7genexpr__pyx_v_row = 0;
    goto __pyx_L1_error;
    __pyx_L11_exit_scope:;
  } /* exit inner scope */
  __pyx_v_x = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":90
 *         N = len(traj)       # Length of trajectory
 *         x = [row[1] for row in traj]
 *         xcenters = z[:, 0]             # <<<<<<<<<<<<<<
 *         if self.state_assignment != '1d':
 *             ycenters = z[:, 1]  # y coordinates of centroids
 */
  __pyx_t_2 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_z), __pyx_tuple__9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 90, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 90, __pyx_L1_error)
  __pyx_t_14 = ((PyArrayObject *)__pyx_t_2);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer);
    __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer, (PyObject*)__pyx_t_14, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 < 0)) {
      PyErr_Fetch(&__pyx_t_15, &__pyx_t_16, &__pyx_t_17);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer, (PyObject*)__pyx_v_xcenters, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_16); Py_XDECREF(__pyx_t_17);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_15, __pyx_t_16, __pyx_t_17);
      }
      __pyx_t_15 = __pyx_t_16 = __pyx_t_17 = 0;
    }
    __pyx_pybuffernd_xcenters.diminfo[0].strides = __pyx_pybuffernd_xcenters.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_xcenters.diminfo[0].shape = __pyx_pybuffernd_xcenters.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 90, __pyx_L1_error)
  }
  __pyx_t_14 = 0;
  __pyx_v_xcenters = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":91
 *         x = [row[1] for row in traj]
 *         xcenters = z[:, 0]
 *         if self.state_assignment != '1d':             # <<<<<<<<<<<<<<
 *             ycenters = z[:, 1]  # y coordinates of centroids
 *             y = [row[2] for row in traj]
 */
  __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_kp_u_1d, Py_NE)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 91, __pyx_L1_error)
  __pyx_t_8 = (__pyx_t_9 != 0);
  if (__pyx_t_8) {

    /* "vcstring.pyx":92
 *         xcenters = z[:, 0]
 *         if self.state_assignment != '1d':
 *             ycenters = z[:, 1]  # y coordinates of centroids             # <<<<<<<<<<<<<<
 *             y = [row[2] for row in traj]
 *         print('Voronoi centroid positions:\n', z)
 */
    __pyx_t_2 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_z), __pyx_tuple__10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 92, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 92, __pyx_L1_error)
    __pyx_t_14 = ((PyArrayObject *)__pyx_t_2);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer);
      __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer, (PyObject*)__pyx_t_14, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_6 < 0)) {
        PyErr_Fetch(&__pyx_t_17, &__pyx_t_16, &__pyx_t_15);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer, (PyObject*)__pyx_v_ycenters, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_17); Py_XDECREF(__pyx_t_16); Py_XDECREF(__pyx_t_15);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_17, __pyx_t_16, __pyx_t_15);
        }
        __pyx_t_17 = __pyx_t_16 = __pyx_t_15 = 0;
      }
      __pyx_pybuffernd_ycenters.diminfo[0].strides = __pyx_pybuffernd_ycenters.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ycenters.diminfo[0].shape = __pyx_pybuffernd_ycenters.rcbuffer->pybuffer.shape[0];
      if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 92, __pyx_L1_error)
    }
    __pyx_t_14 = 0;
    __pyx_v_ycenters = ((PyArrayObject *)__pyx_t_2);
    __pyx_t_2 = 0;

    /* "vcstring.pyx":93
 *         if self.state_assignment != '1d':
 *             ycenters = z[:, 1]  # y coordinates of centroids
 *             y = [row[2] for row in traj]             # <<<<<<<<<<<<<<
 *         print('Voronoi centroid positions:\n', z)
 * 
 */
    { /* enter inner scope */
      __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 93, __pyx_L15_error)
      __Pyx_GOTREF(__pyx_t_2);
      if (unlikely(__pyx_v_traj == Py_None)) {
        PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
        __PYX_ERR(0, 93, __pyx_L15_error)
      }
      __pyx_t_4 = __pyx_v_traj; __Pyx_INCREF(__pyx_t_4); __pyx_t_13 = 0;
      for (;;) {
        if (__pyx_t_13 >= PyList_GET_SIZE(__pyx_t_4)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_13); __Pyx_INCREF(__pyx_t_1); __pyx_t_13++; if (unlikely(0 < 0)) __PYX_ERR(0, 93, __pyx_L15_error)
        #else
        __pyx_t_1 = PySequence_ITEM(__pyx_t_4, __pyx_t_13); __pyx_t_13++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 93, __pyx_L15_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
        __Pyx_XDECREF_SET(__pyx_8genexpr1__pyx_v_row, __pyx_t_1);
        __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_GetItemInt(__pyx_8genexpr1__pyx_v_row, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 93, __pyx_L15_error)
        __Pyx_GOTREF(__pyx_t_1);
        if (unlikely(__Pyx_ListComp_Append(__pyx_t_2, (PyObject*)__pyx_t_1))) __PYX_ERR(0, 93, __pyx_L15_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_row); __pyx_8genexpr1__pyx_v_row = 0;
      goto __pyx_L18_exit_scope;
      __pyx_L15_error:;
      __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_row); __pyx_8genexpr1__pyx_v_row = 0;
      goto __pyx_L1_error;
      __pyx_L18_exit_scope:;
    } /* exit inner scope */
    __pyx_v_y = ((PyObject*)__pyx_t_2);
    __pyx_t_2 = 0;

    /* "vcstring.pyx":91
 *         x = [row[1] for row in traj]
 *         xcenters = z[:, 0]
 *         if self.state_assignment != '1d':             # <<<<<<<<<<<<<<
 *             ycenters = z[:, 1]  # y coordinates of centroids
 *             y = [row[2] for row in traj]
 */
  }

  /* "vcstring.pyx":94
 *             ycenters = z[:, 1]  # y coordinates of centroids
 *             y = [row[2] for row in traj]
 *         print('Voronoi centroid positions:\n', z)             # <<<<<<<<<<<<<<
 * 
 *         # Check that lag time is smaller than data set size
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 94, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_Voronoi_centroid_positions);
  __Pyx_GIVEREF(__pyx_kp_u_Voronoi_centroid_positions);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_Voronoi_centroid_positions);
  __Pyx_INCREF(((PyObject *)__pyx_v_z));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_z));
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 94, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "vcstring.pyx":97
 * 
 *         # Check that lag time is smaller than data set size
 *         if tau > N:             # <<<<<<<<<<<<<<
 *             raise RuntimeError ("\nInvalid lag time. Use a smaller lag time.")
 *             exit()
 */
  __pyx_t_8 = ((__pyx_v_tau > __pyx_v_N) != 0);
  if (unlikely(__pyx_t_8)) {

    /* "vcstring.pyx":98
 *         # Check that lag time is smaller than data set size
 *         if tau > N:
 *             raise RuntimeError ("\nInvalid lag time. Use a smaller lag time.")             # <<<<<<<<<<<<<<
 *             exit()
 * 
 */
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__11, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 98, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __PYX_ERR(0, 98, __pyx_L1_error)

    /* "vcstring.pyx":97
 * 
 *         # Check that lag time is smaller than data set size
 *         if tau > N:             # <<<<<<<<<<<<<<
 *             raise RuntimeError ("\nInvalid lag time. Use a smaller lag time.")
 *             exit()
 */
  }

  /* "vcstring.pyx":102
 * 
 *         # Assign to Voronoi cell
 *         ids = []             # <<<<<<<<<<<<<<
 *         print('Performing Voronoi tesselation')
 *         sys.stdout.flush()
 */
  __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 102, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_v_ids = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "vcstring.pyx":103
 *         # Assign to Voronoi cell
 *         ids = []
 *         print('Performing Voronoi tesselation')             # <<<<<<<<<<<<<<
 *         sys.stdout.flush()
 *         for t in range(N):
 */
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__12, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 103, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "vcstring.pyx":104
 *         ids = []
 *         print('Performing Voronoi tesselation')
 *         sys.stdout.flush()             # <<<<<<<<<<<<<<
 *         for t in range(N):
 *             # Get snapshot at time t and t + tau
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_sys); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 104, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_stdout); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 104, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_flush); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 104, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_4 = (__pyx_t_1) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_1) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 104, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "vcstring.pyx":105
 *         print('Performing Voronoi tesselation')
 *         sys.stdout.flush()
 *         for t in range(N):             # <<<<<<<<<<<<<<
 *             # Get snapshot at time t and t + tau
 *             h_I = 0.0
 */
  __pyx_t_6 = __pyx_v_N;
  __pyx_t_18 = __pyx_t_6;
  for (__pyx_t_19 = 0; __pyx_t_19 < __pyx_t_18; __pyx_t_19+=1) {
    __pyx_v_t = __pyx_t_19;

    /* "vcstring.pyx":107
 *         for t in range(N):
 *             # Get snapshot at time t and t + tau
 *             h_I = 0.0             # <<<<<<<<<<<<<<
 *             h_B = 0.0
 *             x_t = x[t]
 */
    __pyx_v_h_I = 0.0;

    /* "vcstring.pyx":108
 *             # Get snapshot at time t and t + tau
 *             h_I = 0.0
 *             h_B = 0.0             # <<<<<<<<<<<<<<
 *             x_t = x[t]
 *             if self.state_assignment == '1d':
 */
    __pyx_v_h_B = 0.0;

    /* "vcstring.pyx":109
 *             h_I = 0.0
 *             h_B = 0.0
 *             x_t = x[t]             # <<<<<<<<<<<<<<
 *             if self.state_assignment == '1d':
 *                 dist = abs(x_t - xcenters) # Find nearest Voronoi center
 */
    __pyx_t_4 = __Pyx_GetItemInt_List(__pyx_v_x, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 109, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 109, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_x_t = __pyx_t_12;

    /* "vcstring.pyx":110
 *             h_B = 0.0
 *             x_t = x[t]
 *             if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                 dist = abs(x_t - xcenters) # Find nearest Voronoi center
 *             else:
 */
    __pyx_t_8 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_kp_u_1d, Py_EQ)); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
    __pyx_t_9 = (__pyx_t_8 != 0);
    if (__pyx_t_9) {

      /* "vcstring.pyx":111
 *             x_t = x[t]
 *             if self.state_assignment == '1d':
 *                 dist = abs(x_t - xcenters) # Find nearest Voronoi center             # <<<<<<<<<<<<<<
 *             else:
 *                 y_t = y[t]
 */
      __pyx_t_4 = PyFloat_FromDouble(__pyx_v_x_t); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 111, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_2 = PyNumber_Subtract(__pyx_t_4, ((PyObject *)__pyx_v_xcenters)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 111, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyNumber_Absolute(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 111, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 111, __pyx_L1_error)
      __pyx_t_20 = ((PyArrayObject *)__pyx_t_4);
      {
        __Pyx_BufFmt_StackElem __pyx_stack[1];
        __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist.rcbuffer->pybuffer);
        __pyx_t_21 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist.rcbuffer->pybuffer, (PyObject*)__pyx_t_20, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
        if (unlikely(__pyx_t_21 < 0)) {
          PyErr_Fetch(&__pyx_t_15, &__pyx_t_16, &__pyx_t_17);
          if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist.rcbuffer->pybuffer, (PyObject*)__pyx_v_dist, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
            Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_16); Py_XDECREF(__pyx_t_17);
            __Pyx_RaiseBufferFallbackError();
          } else {
            PyErr_Restore(__pyx_t_15, __pyx_t_16, __pyx_t_17);
          }
          __pyx_t_15 = __pyx_t_16 = __pyx_t_17 = 0;
        }
        __pyx_pybuffernd_dist.diminfo[0].strides = __pyx_pybuffernd_dist.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_dist.diminfo[0].shape = __pyx_pybuffernd_dist.rcbuffer->pybuffer.shape[0];
        if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 111, __pyx_L1_error)
      }
      __pyx_t_20 = 0;
      __Pyx_XDECREF_SET(__pyx_v_dist, ((PyArrayObject *)__pyx_t_4));
      __pyx_t_4 = 0;

      /* "vcstring.pyx":110
 *             h_B = 0.0
 *             x_t = x[t]
 *             if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                 dist = abs(x_t - xcenters) # Find nearest Voronoi center
 *             else:
 */
      goto __pyx_L22;
    }

    /* "vcstring.pyx":113
 *                 dist = abs(x_t - xcenters) # Find nearest Voronoi center
 *             else:
 *                 y_t = y[t]             # <<<<<<<<<<<<<<
 *                 dist = sqrt((x_t - xcenters)**2 + (y_t - ycenters)**2) # Find nearest Voronoi center
 *             nc = np.argmin(dist)  # Get index of nearest Voronoi
 */
    /*else*/ {
      if (unlikely(!__pyx_v_y)) { __Pyx_RaiseUnboundLocalError("y"); __PYX_ERR(0, 113, __pyx_L1_error) }
      __pyx_t_4 = __Pyx_GetItemInt_List(__pyx_v_y, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 113, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 113, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_v_y_t = __pyx_t_12;

      /* "vcstring.pyx":114
 *             else:
 *                 y_t = y[t]
 *                 dist = sqrt((x_t - xcenters)**2 + (y_t - ycenters)**2) # Find nearest Voronoi center             # <<<<<<<<<<<<<<
 *             nc = np.argmin(dist)  # Get index of nearest Voronoi
 * 
 */
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 114, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_x_t); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 114, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_7 = PyNumber_Subtract(__pyx_t_1, ((PyObject *)__pyx_v_xcenters)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 114, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = PyNumber_Power(__pyx_t_7, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 114, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_y_t); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 114, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_3 = PyNumber_Subtract(__pyx_t_7, ((PyObject *)__pyx_v_ycenters)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 114, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = PyNumber_Power(__pyx_t_3, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 114, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 114, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
        }
      }
      __pyx_t_4 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_7, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 114, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 114, __pyx_L1_error)
      __pyx_t_20 = ((PyArrayObject *)__pyx_t_4);
      {
        __Pyx_BufFmt_StackElem __pyx_stack[1];
        __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist.rcbuffer->pybuffer);
        __pyx_t_21 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist.rcbuffer->pybuffer, (PyObject*)__pyx_t_20, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
        if (unlikely(__pyx_t_21 < 0)) {
          PyErr_Fetch(&__pyx_t_17, &__pyx_t_16, &__pyx_t_15);
          if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist.rcbuffer->pybuffer, (PyObject*)__pyx_v_dist, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
            Py_XDECREF(__pyx_t_17); Py_XDECREF(__pyx_t_16); Py_XDECREF(__pyx_t_15);
            __Pyx_RaiseBufferFallbackError();
          } else {
            PyErr_Restore(__pyx_t_17, __pyx_t_16, __pyx_t_15);
          }
          __pyx_t_17 = __pyx_t_16 = __pyx_t_15 = 0;
        }
        __pyx_pybuffernd_dist.diminfo[0].strides = __pyx_pybuffernd_dist.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_dist.diminfo[0].shape = __pyx_pybuffernd_dist.rcbuffer->pybuffer.shape[0];
        if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 114, __pyx_L1_error)
      }
      __pyx_t_20 = 0;
      __Pyx_XDECREF_SET(__pyx_v_dist, ((PyArrayObject *)__pyx_t_4));
      __pyx_t_4 = 0;
    }
    __pyx_L22:;

    /* "vcstring.pyx":115
 *                 y_t = y[t]
 *                 dist = sqrt((x_t - xcenters)**2 + (y_t - ycenters)**2) # Find nearest Voronoi center
 *             nc = np.argmin(dist)  # Get index of nearest Voronoi             # <<<<<<<<<<<<<<
 * 
 *             if self.state_assignment == '1d':
 */
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 115, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_argmin); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 115, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, ((PyObject *)__pyx_v_dist)) : __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_dist));
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 115, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 115, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_nc = __pyx_t_12;

    /* "vcstring.pyx":117
 *             nc = np.argmin(dist)  # Get index of nearest Voronoi
 * 
 *             if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                 if (x_t >= self.cut_A) and (x_t <= self.cut_B):  # State I
 *                     h_I = 1.0
 */
    __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_kp_u_1d, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 117, __pyx_L1_error)
    __pyx_t_8 = (__pyx_t_9 != 0);
    if (__pyx_t_8) {

      /* "vcstring.pyx":118
 * 
 *             if self.state_assignment == '1d':
 *                 if (x_t >= self.cut_A) and (x_t <= self.cut_B):  # State I             # <<<<<<<<<<<<<<
 *                     h_I = 1.0
 *                 elif x_t > self.cut_B:  # State B
 */
      __pyx_t_9 = ((__pyx_v_x_t >= __pyx_v_self->cut_A) != 0);
      if (__pyx_t_9) {
      } else {
        __pyx_t_8 = __pyx_t_9;
        goto __pyx_L25_bool_binop_done;
      }
      __pyx_t_9 = ((__pyx_v_x_t <= __pyx_v_self->cut_B) != 0);
      __pyx_t_8 = __pyx_t_9;
      __pyx_L25_bool_binop_done:;
      if (__pyx_t_8) {

        /* "vcstring.pyx":119
 *             if self.state_assignment == '1d':
 *                 if (x_t >= self.cut_A) and (x_t <= self.cut_B):  # State I
 *                     h_I = 1.0             # <<<<<<<<<<<<<<
 *                 elif x_t > self.cut_B:  # State B
 *                     h_B = 1.0
 */
        __pyx_v_h_I = 1.0;

        /* "vcstring.pyx":118
 * 
 *             if self.state_assignment == '1d':
 *                 if (x_t >= self.cut_A) and (x_t <= self.cut_B):  # State I             # <<<<<<<<<<<<<<
 *                     h_I = 1.0
 *                 elif x_t > self.cut_B:  # State B
 */
        goto __pyx_L24;
      }

      /* "vcstring.pyx":120
 *                 if (x_t >= self.cut_A) and (x_t <= self.cut_B):  # State I
 *                     h_I = 1.0
 *                 elif x_t > self.cut_B:  # State B             # <<<<<<<<<<<<<<
 *                     h_B = 1.0
 * 
 */
      __pyx_t_8 = ((__pyx_v_x_t > __pyx_v_self->cut_B) != 0);
      if (__pyx_t_8) {

        /* "vcstring.pyx":121
 *                     h_I = 1.0
 *                 elif x_t > self.cut_B:  # State B
 *                     h_B = 1.0             # <<<<<<<<<<<<<<
 * 
 *             # Orthogonal projection onto the RC line, then check for x boundary
 */
        __pyx_v_h_B = 1.0;

        /* "vcstring.pyx":120
 *                 if (x_t >= self.cut_A) and (x_t <= self.cut_B):  # State I
 *                     h_I = 1.0
 *                 elif x_t > self.cut_B:  # State B             # <<<<<<<<<<<<<<
 *                     h_B = 1.0
 * 
 */
      }
      __pyx_L24:;

      /* "vcstring.pyx":117
 *             nc = np.argmin(dist)  # Get index of nearest Voronoi
 * 
 *             if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                 if (x_t >= self.cut_A) and (x_t <= self.cut_B):  # State I
 *                     h_I = 1.0
 */
      goto __pyx_L23;
    }

    /* "vcstring.pyx":124
 * 
 *             # Orthogonal projection onto the RC line, then check for x boundary
 *             elif self.state_assignment == 'orthogonal_projection':             # <<<<<<<<<<<<<<
 *                 # Orthogonal projection of (x,y) -> (u,v) onto reaction coordinate
 *                 u_t = (y_t * tan(self.theta) + x_t) / (tan(self.theta)**2 + 1)
 */
    __pyx_t_8 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_n_u_orthogonal_projection, Py_EQ)); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 124, __pyx_L1_error)
    __pyx_t_9 = (__pyx_t_8 != 0);
    if (__pyx_t_9) {

      /* "vcstring.pyx":126
 *             elif self.state_assignment == 'orthogonal_projection':
 *                 # Orthogonal projection of (x,y) -> (u,v) onto reaction coordinate
 *                 u_t = (y_t * tan(self.theta) + x_t) / (tan(self.theta)**2 + 1)             # <<<<<<<<<<<<<<
 * 
 *                 # Check if (u,v) is inside/outside of the intermediate region
 */
      __pyx_t_4 = PyFloat_FromDouble(__pyx_v_y_t); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 126, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_tan); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 126, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 126, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_1 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_1)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_1);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
        }
      }
      __pyx_t_3 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_1, __pyx_t_7) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_7);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 126, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = PyNumber_Multiply(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 126, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_x_t); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 126, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PyNumber_Add(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 126, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_tan); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 126, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 126, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_1 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_1)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_1);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
        }
      }
      __pyx_t_3 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_1, __pyx_t_7) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_7);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 126, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = PyNumber_Power(__pyx_t_3, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 126, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = __Pyx_PyInt_AddObjC(__pyx_t_2, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 126, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyNumber_Divide(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 126, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 126, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_v_u_t = __pyx_t_12;

      /* "vcstring.pyx":130
 *                 # Check if (u,v) is inside/outside of the intermediate region
 *                 # indicator function h=0 in state A, 0.5 in intermediate region, 1 in state B
 *                 if u_t >= xa and u_t <= xb:  # Intermediate region             # <<<<<<<<<<<<<<
 *                     h_I = 1.0
 *                 elif u_t > xb:  # Ouside of intermediate region (state B)
 */
      __pyx_t_8 = ((__pyx_v_u_t >= __pyx_v_xa) != 0);
      if (__pyx_t_8) {
      } else {
        __pyx_t_9 = __pyx_t_8;
        goto __pyx_L28_bool_binop_done;
      }
      __pyx_t_8 = ((__pyx_v_u_t <= __pyx_v_xb) != 0);
      __pyx_t_9 = __pyx_t_8;
      __pyx_L28_bool_binop_done:;
      if (__pyx_t_9) {

        /* "vcstring.pyx":131
 *                 # indicator function h=0 in state A, 0.5 in intermediate region, 1 in state B
 *                 if u_t >= xa and u_t <= xb:  # Intermediate region
 *                     h_I = 1.0             # <<<<<<<<<<<<<<
 *                 elif u_t > xb:  # Ouside of intermediate region (state B)
 *                     h_B = 1.0
 */
        __pyx_v_h_I = 1.0;

        /* "vcstring.pyx":130
 *                 # Check if (u,v) is inside/outside of the intermediate region
 *                 # indicator function h=0 in state A, 0.5 in intermediate region, 1 in state B
 *                 if u_t >= xa and u_t <= xb:  # Intermediate region             # <<<<<<<<<<<<<<
 *                     h_I = 1.0
 *                 elif u_t > xb:  # Ouside of intermediate region (state B)
 */
        goto __pyx_L27;
      }

      /* "vcstring.pyx":132
 *                 if u_t >= xa and u_t <= xb:  # Intermediate region
 *                     h_I = 1.0
 *                 elif u_t > xb:  # Ouside of intermediate region (state B)             # <<<<<<<<<<<<<<
 *                     h_B = 1.0
 * 
 */
      __pyx_t_9 = ((__pyx_v_u_t > __pyx_v_xb) != 0);
      if (__pyx_t_9) {

        /* "vcstring.pyx":133
 *                     h_I = 1.0
 *                 elif u_t > xb:  # Ouside of intermediate region (state B)
 *                     h_B = 1.0             # <<<<<<<<<<<<<<
 * 
 *             # Fits rotated ellipses to the well minima to define states A, B
 */
        __pyx_v_h_B = 1.0;

        /* "vcstring.pyx":132
 *                 if u_t >= xa and u_t <= xb:  # Intermediate region
 *                     h_I = 1.0
 *                 elif u_t > xb:  # Ouside of intermediate region (state B)             # <<<<<<<<<<<<<<
 *                     h_B = 1.0
 * 
 */
      }
      __pyx_L27:;

      /* "vcstring.pyx":124
 * 
 *             # Orthogonal projection onto the RC line, then check for x boundary
 *             elif self.state_assignment == 'orthogonal_projection':             # <<<<<<<<<<<<<<
 *                 # Orthogonal projection of (x,y) -> (u,v) onto reaction coordinate
 *                 u_t = (y_t * tan(self.theta) + x_t) / (tan(self.theta)**2 + 1)
 */
      goto __pyx_L23;
    }

    /* "vcstring.pyx":136
 * 
 *             # Fits rotated ellipses to the well minima to define states A, B
 *             elif self.state_assignment == 'ellipse':             # <<<<<<<<<<<<<<
 *                 # Value of fitted ellipse at point (x_t, y_t) or (x_tau, y_tau)
 *                 ell_tA = elliptical(self.ra_A, self.rb_A, self.alpha_A, self.x0_A, self.y0_A, x_t, y_t)
 */
    __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_n_u_ellipse, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 136, __pyx_L1_error)
    __pyx_t_8 = (__pyx_t_9 != 0);
    if (__pyx_t_8) {

      /* "vcstring.pyx":138
 *             elif self.state_assignment == 'ellipse':
 *                 # Value of fitted ellipse at point (x_t, y_t) or (x_tau, y_tau)
 *                 ell_tA = elliptical(self.ra_A, self.rb_A, self.alpha_A, self.x0_A, self.y0_A, x_t, y_t)             # <<<<<<<<<<<<<<
 *                 ell_tB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_t, y_t)
 * 
 */
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_elliptical); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 138, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PyFloat_FromDouble(__pyx_v_self->ra_A); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 138, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_self->rb_A); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 138, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_self->alpha_A); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 138, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_self->x0_A); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 138, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_22 = PyFloat_FromDouble(__pyx_v_self->y0_A); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 138, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_22);
      __pyx_t_23 = PyFloat_FromDouble(__pyx_v_x_t); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 138, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_23);
      __pyx_t_24 = PyFloat_FromDouble(__pyx_v_y_t); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 138, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_24);
      __pyx_t_25 = NULL;
      __pyx_t_21 = 0;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_25 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_25)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_25);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
          __pyx_t_21 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_3)) {
        PyObject *__pyx_temp[8] = {__pyx_t_25, __pyx_t_4, __pyx_t_7, __pyx_t_1, __pyx_t_5, __pyx_t_22, __pyx_t_23, __pyx_t_24};
        __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_21, 7+__pyx_t_21); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 138, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_25); __pyx_t_25 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
        __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
        __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
        PyObject *__pyx_temp[8] = {__pyx_t_25, __pyx_t_4, __pyx_t_7, __pyx_t_1, __pyx_t_5, __pyx_t_22, __pyx_t_23, __pyx_t_24};
        __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_21, 7+__pyx_t_21); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 138, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_25); __pyx_t_25 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
        __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
        __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
      } else
      #endif
      {
        __pyx_t_26 = PyTuple_New(7+__pyx_t_21); if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 138, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_26);
        if (__pyx_t_25) {
          __Pyx_GIVEREF(__pyx_t_25); PyTuple_SET_ITEM(__pyx_t_26, 0, __pyx_t_25); __pyx_t_25 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_26, 0+__pyx_t_21, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_7);
        PyTuple_SET_ITEM(__pyx_t_26, 1+__pyx_t_21, __pyx_t_7);
        __Pyx_GIVEREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_26, 2+__pyx_t_21, __pyx_t_1);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_26, 3+__pyx_t_21, __pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_22);
        PyTuple_SET_ITEM(__pyx_t_26, 4+__pyx_t_21, __pyx_t_22);
        __Pyx_GIVEREF(__pyx_t_23);
        PyTuple_SET_ITEM(__pyx_t_26, 5+__pyx_t_21, __pyx_t_23);
        __Pyx_GIVEREF(__pyx_t_24);
        PyTuple_SET_ITEM(__pyx_t_26, 6+__pyx_t_21, __pyx_t_24);
        __pyx_t_4 = 0;
        __pyx_t_7 = 0;
        __pyx_t_1 = 0;
        __pyx_t_5 = 0;
        __pyx_t_22 = 0;
        __pyx_t_23 = 0;
        __pyx_t_24 = 0;
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_26, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 138, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_26); __pyx_t_26 = 0;
      }
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 138, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_v_ell_tA = __pyx_t_12;

      /* "vcstring.pyx":139
 *                 # Value of fitted ellipse at point (x_t, y_t) or (x_tau, y_tau)
 *                 ell_tA = elliptical(self.ra_A, self.rb_A, self.alpha_A, self.x0_A, self.y0_A, x_t, y_t)
 *                 ell_tB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_t, y_t)             # <<<<<<<<<<<<<<
 * 
 *                 # Assign to states
 */
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_elliptical); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 139, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_26 = PyFloat_FromDouble(__pyx_v_self->ra_B); if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 139, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_26);
      __pyx_t_24 = PyFloat_FromDouble(__pyx_v_self->rb_B); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 139, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_24);
      __pyx_t_23 = PyFloat_FromDouble(__pyx_v_self->alpha_B); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 139, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_23);
      __pyx_t_22 = PyFloat_FromDouble(__pyx_v_self->x0_B); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 139, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_22);
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_self->y0_B); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 139, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_x_t); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_y_t); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 139, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_4 = NULL;
      __pyx_t_21 = 0;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
          __pyx_t_21 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_3)) {
        PyObject *__pyx_temp[8] = {__pyx_t_4, __pyx_t_26, __pyx_t_24, __pyx_t_23, __pyx_t_22, __pyx_t_5, __pyx_t_1, __pyx_t_7};
        __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_21, 7+__pyx_t_21); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 139, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_26); __pyx_t_26 = 0;
        __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
        __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
        __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
        PyObject *__pyx_temp[8] = {__pyx_t_4, __pyx_t_26, __pyx_t_24, __pyx_t_23, __pyx_t_22, __pyx_t_5, __pyx_t_1, __pyx_t_7};
        __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_21, 7+__pyx_t_21); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 139, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_26); __pyx_t_26 = 0;
        __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
        __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
        __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      } else
      #endif
      {
        __pyx_t_25 = PyTuple_New(7+__pyx_t_21); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 139, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_25);
        if (__pyx_t_4) {
          __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_25, 0, __pyx_t_4); __pyx_t_4 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_26);
        PyTuple_SET_ITEM(__pyx_t_25, 0+__pyx_t_21, __pyx_t_26);
        __Pyx_GIVEREF(__pyx_t_24);
        PyTuple_SET_ITEM(__pyx_t_25, 1+__pyx_t_21, __pyx_t_24);
        __Pyx_GIVEREF(__pyx_t_23);
        PyTuple_SET_ITEM(__pyx_t_25, 2+__pyx_t_21, __pyx_t_23);
        __Pyx_GIVEREF(__pyx_t_22);
        PyTuple_SET_ITEM(__pyx_t_25, 3+__pyx_t_21, __pyx_t_22);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_25, 4+__pyx_t_21, __pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_25, 5+__pyx_t_21, __pyx_t_1);
        __Pyx_GIVEREF(__pyx_t_7);
        PyTuple_SET_ITEM(__pyx_t_25, 6+__pyx_t_21, __pyx_t_7);
        __pyx_t_26 = 0;
        __pyx_t_24 = 0;
        __pyx_t_23 = 0;
        __pyx_t_22 = 0;
        __pyx_t_5 = 0;
        __pyx_t_1 = 0;
        __pyx_t_7 = 0;
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_25, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 139, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_25); __pyx_t_25 = 0;
      }
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_v_ell_tB = __pyx_t_12;

      /* "vcstring.pyx":142
 * 
 *                 # Assign to states
 *                 if ell_tA > 1.0 and ell_tB > 1.0:  # Intermediate state             # <<<<<<<<<<<<<<
 *                     h_I = 1.0
 *                 elif ell_tB <= 1.0:  # Outside intermediate region (state B)
 */
      __pyx_t_9 = ((__pyx_v_ell_tA > 1.0) != 0);
      if (__pyx_t_9) {
      } else {
        __pyx_t_8 = __pyx_t_9;
        goto __pyx_L31_bool_binop_done;
      }
      __pyx_t_9 = ((__pyx_v_ell_tB > 1.0) != 0);
      __pyx_t_8 = __pyx_t_9;
      __pyx_L31_bool_binop_done:;
      if (__pyx_t_8) {

        /* "vcstring.pyx":143
 *                 # Assign to states
 *                 if ell_tA > 1.0 and ell_tB > 1.0:  # Intermediate state
 *                     h_I = 1.0             # <<<<<<<<<<<<<<
 *                 elif ell_tB <= 1.0:  # Outside intermediate region (state B)
 *                     h_B = 1.0
 */
        __pyx_v_h_I = 1.0;

        /* "vcstring.pyx":142
 * 
 *                 # Assign to states
 *                 if ell_tA > 1.0 and ell_tB > 1.0:  # Intermediate state             # <<<<<<<<<<<<<<
 *                     h_I = 1.0
 *                 elif ell_tB <= 1.0:  # Outside intermediate region (state B)
 */
        goto __pyx_L30;
      }

      /* "vcstring.pyx":144
 *                 if ell_tA > 1.0 and ell_tB > 1.0:  # Intermediate state
 *                     h_I = 1.0
 *                 elif ell_tB <= 1.0:  # Outside intermediate region (state B)             # <<<<<<<<<<<<<<
 *                     h_B = 1.0
 * 
 */
      __pyx_t_8 = ((__pyx_v_ell_tB <= 1.0) != 0);
      if (__pyx_t_8) {

        /* "vcstring.pyx":145
 *                     h_I = 1.0
 *                 elif ell_tB <= 1.0:  # Outside intermediate region (state B)
 *                     h_B = 1.0             # <<<<<<<<<<<<<<
 * 
 *             # Append ID assignments at each timestep
 */
        __pyx_v_h_B = 1.0;

        /* "vcstring.pyx":144
 *                 if ell_tA > 1.0 and ell_tB > 1.0:  # Intermediate state
 *                     h_I = 1.0
 *                 elif ell_tB <= 1.0:  # Outside intermediate region (state B)             # <<<<<<<<<<<<<<
 *                     h_B = 1.0
 * 
 */
      }
      __pyx_L30:;

      /* "vcstring.pyx":136
 * 
 *             # Fits rotated ellipses to the well minima to define states A, B
 *             elif self.state_assignment == 'ellipse':             # <<<<<<<<<<<<<<
 *                 # Value of fitted ellipse at point (x_t, y_t) or (x_tau, y_tau)
 *                 ell_tA = elliptical(self.ra_A, self.rb_A, self.alpha_A, self.x0_A, self.y0_A, x_t, y_t)
 */
    }
    __pyx_L23:;

    /* "vcstring.pyx":148
 * 
 *             # Append ID assignments at each timestep
 *             if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                 ids.append([h_I, h_B, nc, x_t])
 *             elif self.state_assignment == 'orthogonal_projection':
 */
    __pyx_t_8 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_kp_u_1d, Py_EQ)); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 148, __pyx_L1_error)
    __pyx_t_9 = (__pyx_t_8 != 0);
    if (__pyx_t_9) {

      /* "vcstring.pyx":149
 *             # Append ID assignments at each timestep
 *             if self.state_assignment == '1d':
 *                 ids.append([h_I, h_B, nc, x_t])             # <<<<<<<<<<<<<<
 *             elif self.state_assignment == 'orthogonal_projection':
 *                 ids.append([h_I, h_B, nc, x_t, y_t])
 */
      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_h_I); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 149, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_h_B); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 149, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_25 = PyFloat_FromDouble(__pyx_v_nc); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 149, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_25);
      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_x_t); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 149, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_1 = PyList_New(4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_2);
      PyList_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_3);
      PyList_SET_ITEM(__pyx_t_1, 1, __pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_25);
      PyList_SET_ITEM(__pyx_t_1, 2, __pyx_t_25);
      __Pyx_GIVEREF(__pyx_t_7);
      PyList_SET_ITEM(__pyx_t_1, 3, __pyx_t_7);
      __pyx_t_2 = 0;
      __pyx_t_3 = 0;
      __pyx_t_25 = 0;
      __pyx_t_7 = 0;
      __pyx_t_27 = __Pyx_PyObject_Append(__pyx_v_ids, __pyx_t_1); if (unlikely(__pyx_t_27 == ((int)-1))) __PYX_ERR(0, 149, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":148
 * 
 *             # Append ID assignments at each timestep
 *             if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                 ids.append([h_I, h_B, nc, x_t])
 *             elif self.state_assignment == 'orthogonal_projection':
 */
      goto __pyx_L33;
    }

    /* "vcstring.pyx":150
 *             if self.state_assignment == '1d':
 *                 ids.append([h_I, h_B, nc, x_t])
 *             elif self.state_assignment == 'orthogonal_projection':             # <<<<<<<<<<<<<<
 *                 ids.append([h_I, h_B, nc, x_t, y_t])
 *             elif self.state_assignment == 'ellipse':
 */
    __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_n_u_orthogonal_projection, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 150, __pyx_L1_error)
    __pyx_t_8 = (__pyx_t_9 != 0);
    if (__pyx_t_8) {

      /* "vcstring.pyx":151
 *                 ids.append([h_I, h_B, nc, x_t])
 *             elif self.state_assignment == 'orthogonal_projection':
 *                 ids.append([h_I, h_B, nc, x_t, y_t])             # <<<<<<<<<<<<<<
 *             elif self.state_assignment == 'ellipse':
 *                 ids.append([h_I, h_B, nc, x_t, y_t, ell_tA, ell_tB]) # state I, state B, Voronoi index, x pos, y pos
 */
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_h_I); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 151, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_h_B); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 151, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_25 = PyFloat_FromDouble(__pyx_v_nc); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 151, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_25);
      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_x_t); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 151, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_y_t); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 151, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_5 = PyList_New(5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 151, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_1);
      PyList_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_7);
      PyList_SET_ITEM(__pyx_t_5, 1, __pyx_t_7);
      __Pyx_GIVEREF(__pyx_t_25);
      PyList_SET_ITEM(__pyx_t_5, 2, __pyx_t_25);
      __Pyx_GIVEREF(__pyx_t_3);
      PyList_SET_ITEM(__pyx_t_5, 3, __pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_2);
      PyList_SET_ITEM(__pyx_t_5, 4, __pyx_t_2);
      __pyx_t_1 = 0;
      __pyx_t_7 = 0;
      __pyx_t_25 = 0;
      __pyx_t_3 = 0;
      __pyx_t_2 = 0;
      __pyx_t_27 = __Pyx_PyObject_Append(__pyx_v_ids, __pyx_t_5); if (unlikely(__pyx_t_27 == ((int)-1))) __PYX_ERR(0, 151, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "vcstring.pyx":150
 *             if self.state_assignment == '1d':
 *                 ids.append([h_I, h_B, nc, x_t])
 *             elif self.state_assignment == 'orthogonal_projection':             # <<<<<<<<<<<<<<
 *                 ids.append([h_I, h_B, nc, x_t, y_t])
 *             elif self.state_assignment == 'ellipse':
 */
      goto __pyx_L33;
    }

    /* "vcstring.pyx":152
 *             elif self.state_assignment == 'orthogonal_projection':
 *                 ids.append([h_I, h_B, nc, x_t, y_t])
 *             elif self.state_assignment == 'ellipse':             # <<<<<<<<<<<<<<
 *                 ids.append([h_I, h_B, nc, x_t, y_t, ell_tA, ell_tB]) # state I, state B, Voronoi index, x pos, y pos
 *             else:
 */
    __pyx_t_8 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_n_u_ellipse, Py_EQ)); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 152, __pyx_L1_error)
    __pyx_t_9 = (__pyx_t_8 != 0);
    if (likely(__pyx_t_9)) {

      /* "vcstring.pyx":153
 *                 ids.append([h_I, h_B, nc, x_t, y_t])
 *             elif self.state_assignment == 'ellipse':
 *                 ids.append([h_I, h_B, nc, x_t, y_t, ell_tA, ell_tB]) # state I, state B, Voronoi index, x pos, y pos             # <<<<<<<<<<<<<<
 *             else:
 *                 raise TypeError('Incorrect state assignment. Chosen state_assignment method is not available.')
 */
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_h_I); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 153, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_h_B); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 153, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_nc); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 153, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_25 = PyFloat_FromDouble(__pyx_v_x_t); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 153, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_25);
      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_y_t); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 153, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_ell_tA); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 153, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_22 = PyFloat_FromDouble(__pyx_v_ell_tB); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 153, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_22);
      __pyx_t_23 = PyList_New(7); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 153, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_23);
      __Pyx_GIVEREF(__pyx_t_5);
      PyList_SET_ITEM(__pyx_t_23, 0, __pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_2);
      PyList_SET_ITEM(__pyx_t_23, 1, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_3);
      PyList_SET_ITEM(__pyx_t_23, 2, __pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_25);
      PyList_SET_ITEM(__pyx_t_23, 3, __pyx_t_25);
      __Pyx_GIVEREF(__pyx_t_7);
      PyList_SET_ITEM(__pyx_t_23, 4, __pyx_t_7);
      __Pyx_GIVEREF(__pyx_t_1);
      PyList_SET_ITEM(__pyx_t_23, 5, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_22);
      PyList_SET_ITEM(__pyx_t_23, 6, __pyx_t_22);
      __pyx_t_5 = 0;
      __pyx_t_2 = 0;
      __pyx_t_3 = 0;
      __pyx_t_25 = 0;
      __pyx_t_7 = 0;
      __pyx_t_1 = 0;
      __pyx_t_22 = 0;
      __pyx_t_27 = __Pyx_PyObject_Append(__pyx_v_ids, __pyx_t_23); if (unlikely(__pyx_t_27 == ((int)-1))) __PYX_ERR(0, 153, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;

      /* "vcstring.pyx":152
 *             elif self.state_assignment == 'orthogonal_projection':
 *                 ids.append([h_I, h_B, nc, x_t, y_t])
 *             elif self.state_assignment == 'ellipse':             # <<<<<<<<<<<<<<
 *                 ids.append([h_I, h_B, nc, x_t, y_t, ell_tA, ell_tB]) # state I, state B, Voronoi index, x pos, y pos
 *             else:
 */
      goto __pyx_L33;
    }

    /* "vcstring.pyx":155
 *                 ids.append([h_I, h_B, nc, x_t, y_t, ell_tA, ell_tB]) # state I, state B, Voronoi index, x pos, y pos
 *             else:
 *                 raise TypeError('Incorrect state assignment. Chosen state_assignment method is not available.')             # <<<<<<<<<<<<<<
 *         ids = np.asarray(ids)
 *         print('Voronoi assignment completed')
 */
    /*else*/ {
      __pyx_t_23 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__13, NULL); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 155, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_23);
      __Pyx_Raise(__pyx_t_23, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
      __PYX_ERR(0, 155, __pyx_L1_error)
    }
    __pyx_L33:;
  }

  /* "vcstring.pyx":156
 *             else:
 *                 raise TypeError('Incorrect state assignment. Chosen state_assignment method is not available.')
 *         ids = np.asarray(ids)             # <<<<<<<<<<<<<<
 *         print('Voronoi assignment completed')
 *         return ids
 */
  __Pyx_GetModuleGlobalName(__pyx_t_22, __pyx_n_s_np); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 156, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_22);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_22, __pyx_n_s_asarray); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 156, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
  __pyx_t_22 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_22 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_22)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_22);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_23 = (__pyx_t_22) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_22, __pyx_v_ids) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_ids);
  __Pyx_XDECREF(__pyx_t_22); __pyx_t_22 = 0;
  if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 156, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_23);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF_SET(__pyx_v_ids, __pyx_t_23);
  __pyx_t_23 = 0;

  /* "vcstring.pyx":157
 *                 raise TypeError('Incorrect state assignment. Chosen state_assignment method is not available.')
 *         ids = np.asarray(ids)
 *         print('Voronoi assignment completed')             # <<<<<<<<<<<<<<
 *         return ids
 * 
 */
  __pyx_t_23 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__14, NULL); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 157, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_23);
  __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;

  /* "vcstring.pyx":158
 *         ids = np.asarray(ids)
 *         print('Voronoi assignment completed')
 *         return ids             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_ids);
  __pyx_r = __pyx_v_ids;
  goto __pyx_L0;

  /* "vcstring.pyx":64
 *         return z
 * 
 *     cpdef assign_states(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z):             # <<<<<<<<<<<<<<
 *         """
 *         Assign points to Voronoi cells
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_22);
  __Pyx_XDECREF(__pyx_t_23);
  __Pyx_XDECREF(__pyx_t_24);
  __Pyx_XDECREF(__pyx_t_25);
  __Pyx_XDECREF(__pyx_t_26);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.assign_states", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XDECREF((PyObject *)__pyx_v_xcenters);
  __Pyx_XDECREF((PyObject *)__pyx_v_ycenters);
  __Pyx_XDECREF(__pyx_v_x);
  __Pyx_XDECREF(__pyx_v_y);
  __Pyx_XDECREF((PyObject *)__pyx_v_dist);
  __Pyx_XDECREF(__pyx_v_ids);
  __Pyx_XDECREF(__pyx_7genexpr__pyx_v_row);
  __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_row);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_7assign_states(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8vcstring_8vcstring_6assign_states[] = "\n        Assign points to Voronoi cells\n        ";
static PyObject *__pyx_pw_8vcstring_8vcstring_7assign_states(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_traj = 0;
  int __pyx_v_tau;
  PyArrayObject *__pyx_v_z = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("assign_states (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_traj,&__pyx_n_s_tau,&__pyx_n_s_z,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_traj)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tau)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("assign_states", 1, 3, 3, 1); __PYX_ERR(0, 64, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("assign_states", 1, 3, 3, 2); __PYX_ERR(0, 64, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "assign_states") < 0)) __PYX_ERR(0, 64, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v_traj = ((PyObject*)values[0]);
    __pyx_v_tau = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_tau == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 64, __pyx_L3_error)
    __pyx_v_z = ((PyArrayObject *)values[2]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("assign_states", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 64, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.vcstring.assign_states", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_traj), (&PyList_Type), 1, "traj", 1))) __PYX_ERR(0, 64, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_z), __pyx_ptype_5numpy_ndarray, 1, "z", 0))) __PYX_ERR(0, 64, __pyx_L1_error)
  __pyx_r = __pyx_pf_8vcstring_8vcstring_6assign_states(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self), __pyx_v_traj, __pyx_v_tau, __pyx_v_z);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_6assign_states(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("assign_states", 0);
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 64, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __pyx_f_8vcstring_8vcstring_assign_states(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, __pyx_v_z, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 64, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.assign_states", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":161
 * 
 * 
 *     cpdef assign_states_ensemble(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, int t0=0, list weights=None, stride=None):             # <<<<<<<<<<<<<<
 *         """
 *         Assign points to Voronoi cells for ensemble of aggregate trajectories.
 */

static PyObject *__pyx_pw_8vcstring_8vcstring_9assign_states_ensemble(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_assign_states_ensemble(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_assign_states_ensemble *__pyx_optional_args) {
  int __pyx_v_t0 = ((int)0);
  PyObject *__pyx_v_weights = ((PyObject*)Py_None);
  PyObject *__pyx_v_stride = ((PyObject *)Py_None);
  double __pyx_v_xa;
  double __pyx_v_xb;
  double __pyx_v_ell_tA;
  double __pyx_v_ell_tauA;
  double __pyx_v_ell_tB;
  double __pyx_v_ell_tauB;
  PyArrayObject *__pyx_v_xcenters = 0;
  PyArrayObject *__pyx_v_ycenters = 0;
  int __pyx_v_N;
  int __pyx_v_t;
  double __pyx_v_x_t;
  double __pyx_v_y_t;
  double __pyx_v_u_t;
  double __pyx_v_h_I0;
  double __pyx_v_h_B0;
  double __pyx_v_h_Itau;
  double __pyx_v_h_Btau;
  PyObject *__pyx_v_ids = NULL;
  PyObject *__pyx_v_count = NULL;
  PyObject *__pyx_v_x_tau = NULL;
  PyObject *__pyx_v_dist_t = NULL;
  PyObject *__pyx_v_dist_tau = NULL;
  PyObject *__pyx_v_y_tau = NULL;
  PyObject *__pyx_v_nc_t = NULL;
  PyObject *__pyx_v_nc_tau = NULL;
  PyObject *__pyx_v_u_tau = NULL;
  PyObject *__pyx_8genexpr2__pyx_v_row = NULL;
  PyObject *__pyx_8genexpr3__pyx_v_row = NULL;
  PyObject *__pyx_8genexpr4__pyx_v_row = NULL;
  PyObject *__pyx_8genexpr5__pyx_v_row = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_xcenters;
  __Pyx_Buffer __pyx_pybuffer_xcenters;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ycenters;
  __Pyx_Buffer __pyx_pybuffer_ycenters;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  int __pyx_t_10;
  PyObject *(*__pyx_t_11)(PyObject *);
  double __pyx_t_12;
  double __pyx_t_13;
  Py_ssize_t __pyx_t_14;
  PyArrayObject *__pyx_t_15 = NULL;
  PyObject *__pyx_t_16 = NULL;
  PyObject *__pyx_t_17 = NULL;
  PyObject *__pyx_t_18 = NULL;
  int __pyx_t_19;
  int __pyx_t_20;
  PyObject *(*__pyx_t_21)(PyObject *);
  int __pyx_t_22;
  PyObject *__pyx_t_23 = NULL;
  PyObject *__pyx_t_24 = NULL;
  PyObject *__pyx_t_25 = NULL;
  PyObject *__pyx_t_26 = NULL;
  int __pyx_t_27;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("assign_states_ensemble", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args->__pyx_n > 0) {
      __pyx_v_t0 = __pyx_optional_args->t0;
      if (__pyx_optional_args->__pyx_n > 1) {
        __pyx_v_weights = __pyx_optional_args->weights;
        if (__pyx_optional_args->__pyx_n > 2) {
          __pyx_v_stride = __pyx_optional_args->stride;
        }
      }
    }
  }
  __Pyx_INCREF(__pyx_v_weights);
  __Pyx_INCREF(__pyx_v_stride);
  __pyx_pybuffer_xcenters.pybuffer.buf = NULL;
  __pyx_pybuffer_xcenters.refcount = 0;
  __pyx_pybuffernd_xcenters.data = NULL;
  __pyx_pybuffernd_xcenters.rcbuffer = &__pyx_pybuffer_xcenters;
  __pyx_pybuffer_ycenters.pybuffer.buf = NULL;
  __pyx_pybuffer_ycenters.refcount = 0;
  __pyx_pybuffernd_ycenters.data = NULL;
  __pyx_pybuffernd_ycenters.rcbuffer = &__pyx_pybuffer_ycenters;
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 161, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_assign_states_ensemble); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 161, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_8vcstring_8vcstring_9assign_states_ensemble)) {
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 161, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_t0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 161, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_5 = __pyx_t_1; __pyx_t_6 = NULL;
        __pyx_t_7 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
          __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
          if (likely(__pyx_t_6)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
            __Pyx_INCREF(__pyx_t_6);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_5, function);
            __pyx_t_7 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[7] = {__pyx_t_6, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_z), __pyx_t_4, __pyx_v_weights, __pyx_v_stride};
          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 6+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 161, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[7] = {__pyx_t_6, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_z), __pyx_t_4, __pyx_v_weights, __pyx_v_stride};
          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 6+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 161, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        } else
        #endif
        {
          __pyx_t_8 = PyTuple_New(6+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 161, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          if (__pyx_t_6) {
            __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
          }
          __Pyx_INCREF(__pyx_v_traj);
          __Pyx_GIVEREF(__pyx_v_traj);
          PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_v_traj);
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_t_3);
          __Pyx_INCREF(((PyObject *)__pyx_v_z));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
          PyTuple_SET_ITEM(__pyx_t_8, 2+__pyx_t_7, ((PyObject *)__pyx_v_z));
          __Pyx_GIVEREF(__pyx_t_4);
          PyTuple_SET_ITEM(__pyx_t_8, 3+__pyx_t_7, __pyx_t_4);
          __Pyx_INCREF(__pyx_v_weights);
          __Pyx_GIVEREF(__pyx_v_weights);
          PyTuple_SET_ITEM(__pyx_t_8, 4+__pyx_t_7, __pyx_v_weights);
          __Pyx_INCREF(__pyx_v_stride);
          __Pyx_GIVEREF(__pyx_v_stride);
          PyTuple_SET_ITEM(__pyx_t_8, 5+__pyx_t_7, __pyx_v_stride);
          __pyx_t_3 = 0;
          __pyx_t_4 = 0;
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 161, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        }
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }

  /* "vcstring.pyx":178
 *         cdef np.ndarray[DTYPE_t, ndim=1] g_0_arr, g_tau_arr, g, b
 * 
 *         print('\n===================================')             # <<<<<<<<<<<<<<
 *         print('VORONOI STATE ASSIGNMENT - ENSEMBLE')
 *         print('===================================')
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__16, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 178, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":179
 * 
 *         print('\n===================================')
 *         print('VORONOI STATE ASSIGNMENT - ENSEMBLE')             # <<<<<<<<<<<<<<
 *         print('===================================')
 *         print('Voronoi centroid positions:\n', z)
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__17, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 179, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":180
 *         print('\n===================================')
 *         print('VORONOI STATE ASSIGNMENT - ENSEMBLE')
 *         print('===================================')             # <<<<<<<<<<<<<<
 *         print('Voronoi centroid positions:\n', z)
 *         print('State_assignment type:', self.state_assignment)
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__19, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 180, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":181
 *         print('VORONOI STATE ASSIGNMENT - ENSEMBLE')
 *         print('===================================')
 *         print('Voronoi centroid positions:\n', z)             # <<<<<<<<<<<<<<
 *         print('State_assignment type:', self.state_assignment)
 *         if self.state_assignment == 'orthogonal_projection':
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 181, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_Voronoi_centroid_positions);
  __Pyx_GIVEREF(__pyx_kp_u_Voronoi_centroid_positions);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Voronoi_centroid_positions);
  __Pyx_INCREF(((PyObject *)__pyx_v_z));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_z));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 181, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":182
 *         print('===================================')
 *         print('Voronoi centroid positions:\n', z)
 *         print('State_assignment type:', self.state_assignment)             # <<<<<<<<<<<<<<
 *         if self.state_assignment == 'orthogonal_projection':
 *             xa, xb = self.intermediate_region()
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 182, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_State_assignment_type);
  __Pyx_GIVEREF(__pyx_kp_u_State_assignment_type);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_State_assignment_type);
  __Pyx_INCREF(__pyx_v_self->state_assignment);
  __Pyx_GIVEREF(__pyx_v_self->state_assignment);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_self->state_assignment);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 182, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":183
 *         print('Voronoi centroid positions:\n', z)
 *         print('State_assignment type:', self.state_assignment)
 *         if self.state_assignment == 'orthogonal_projection':             # <<<<<<<<<<<<<<
 *             xa, xb = self.intermediate_region()
 * 
 */
  __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_n_u_orthogonal_projection, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 183, __pyx_L1_error)
  __pyx_t_10 = (__pyx_t_9 != 0);
  if (__pyx_t_10) {

    /* "vcstring.pyx":184
 *         print('State_assignment type:', self.state_assignment)
 *         if self.state_assignment == 'orthogonal_projection':
 *             xa, xb = self.intermediate_region()             # <<<<<<<<<<<<<<
 * 
 *         if stride == None:
 */
    __pyx_t_1 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->intermediate_region(__pyx_v_self, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
      PyObject* sequence = __pyx_t_1;
      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        __PYX_ERR(0, 184, __pyx_L1_error)
      }
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_5 = PyTuple_GET_ITEM(sequence, 1); 
      } else {
        __pyx_t_2 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_5 = PyList_GET_ITEM(sequence, 1); 
      }
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      #else
      __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 184, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_5 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 184, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_8 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 184, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_11 = Py_TYPE(__pyx_t_8)->tp_iternext;
      index = 0; __pyx_t_2 = __pyx_t_11(__pyx_t_8); if (unlikely(!__pyx_t_2)) goto __pyx_L4_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_2);
      index = 1; __pyx_t_5 = __pyx_t_11(__pyx_t_8); if (unlikely(!__pyx_t_5)) goto __pyx_L4_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_5);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_11(__pyx_t_8), 2) < 0) __PYX_ERR(0, 184, __pyx_L1_error)
      __pyx_t_11 = NULL;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      goto __pyx_L5_unpacking_done;
      __pyx_L4_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_11 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      __PYX_ERR(0, 184, __pyx_L1_error)
      __pyx_L5_unpacking_done:;
    }
    __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 184, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_13 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely((__pyx_t_13 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 184, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_v_xa = __pyx_t_12;
    __pyx_v_xb = __pyx_t_13;

    /* "vcstring.pyx":183
 *         print('Voronoi centroid positions:\n', z)
 *         print('State_assignment type:', self.state_assignment)
 *         if self.state_assignment == 'orthogonal_projection':             # <<<<<<<<<<<<<<
 *             xa, xb = self.intermediate_region()
 * 
 */
  }

  /* "vcstring.pyx":186
 *             xa, xb = self.intermediate_region()
 * 
 *         if stride == None:             # <<<<<<<<<<<<<<
 *             stride = 1
 *         N = len(traj)       # Number of aggregate trajectories in ensemble
 */
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_stride, Py_None, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 186, __pyx_L1_error)
  __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 186, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_10) {

    /* "vcstring.pyx":187
 * 
 *         if stride == None:
 *             stride = 1             # <<<<<<<<<<<<<<
 *         N = len(traj)       # Number of aggregate trajectories in ensemble
 *         if weights == None:
 */
    __Pyx_INCREF(__pyx_int_1);
    __Pyx_DECREF_SET(__pyx_v_stride, __pyx_int_1);

    /* "vcstring.pyx":186
 *             xa, xb = self.intermediate_region()
 * 
 *         if stride == None:             # <<<<<<<<<<<<<<
 *             stride = 1
 *         N = len(traj)       # Number of aggregate trajectories in ensemble
 */
  }

  /* "vcstring.pyx":188
 *         if stride == None:
 *             stride = 1
 *         N = len(traj)       # Number of aggregate trajectories in ensemble             # <<<<<<<<<<<<<<
 *         if weights == None:
 *             weights = [1.] * N
 */
  if (unlikely(__pyx_v_traj == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
    __PYX_ERR(0, 188, __pyx_L1_error)
  }
  __pyx_t_14 = PyList_GET_SIZE(__pyx_v_traj); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 188, __pyx_L1_error)
  __pyx_v_N = __pyx_t_14;

  /* "vcstring.pyx":189
 *             stride = 1
 *         N = len(traj)       # Number of aggregate trajectories in ensemble
 *         if weights == None:             # <<<<<<<<<<<<<<
 *             weights = [1.] * N
 *         else:
 */
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_weights, Py_None, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
  __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 189, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_10) {

    /* "vcstring.pyx":190
 *         N = len(traj)       # Number of aggregate trajectories in ensemble
 *         if weights == None:
 *             weights = [1.] * N             # <<<<<<<<<<<<<<
 *         else:
 *             print('Weights shape =', np.shape(weights))
 */
    __pyx_t_1 = PyList_New(1 * ((__pyx_v_N<0) ? 0:__pyx_v_N)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 190, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    { Py_ssize_t __pyx_temp;
      for (__pyx_temp=0; __pyx_temp < __pyx_v_N; __pyx_temp++) {
        __Pyx_INCREF(__pyx_float_1_);
        __Pyx_GIVEREF(__pyx_float_1_);
        PyList_SET_ITEM(__pyx_t_1, __pyx_temp, __pyx_float_1_);
      }
    }
    __Pyx_DECREF_SET(__pyx_v_weights, ((PyObject*)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "vcstring.pyx":189
 *             stride = 1
 *         N = len(traj)       # Number of aggregate trajectories in ensemble
 *         if weights == None:             # <<<<<<<<<<<<<<
 *             weights = [1.] * N
 *         else:
 */
    goto __pyx_L7;
  }

  /* "vcstring.pyx":192
 *             weights = [1.] * N
 *         else:
 *             print('Weights shape =', np.shape(weights))             # <<<<<<<<<<<<<<
 *         xcenters = z[:, 0]
 *         if self.state_assignment != '1d':
 */
  /*else*/ {
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 192, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_shape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 192, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_v_weights) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_weights);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 192, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 192, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_kp_u_Weights_shape);
    __Pyx_GIVEREF(__pyx_kp_u_Weights_shape);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_Weights_shape);
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 192, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_L7:;

  /* "vcstring.pyx":193
 *         else:
 *             print('Weights shape =', np.shape(weights))
 *         xcenters = z[:, 0]             # <<<<<<<<<<<<<<
 *         if self.state_assignment != '1d':
 *             ycenters = z[:, 1]  # y coordinates of centroids
 */
  __pyx_t_1 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_z), __pyx_tuple__9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 193, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 193, __pyx_L1_error)
  __pyx_t_15 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer, (PyObject*)__pyx_t_15, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_16, &__pyx_t_17, &__pyx_t_18);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer, (PyObject*)__pyx_v_xcenters, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_16); Py_XDECREF(__pyx_t_17); Py_XDECREF(__pyx_t_18);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_16, __pyx_t_17, __pyx_t_18);
      }
      __pyx_t_16 = __pyx_t_17 = __pyx_t_18 = 0;
    }
    __pyx_pybuffernd_xcenters.diminfo[0].strides = __pyx_pybuffernd_xcenters.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_xcenters.diminfo[0].shape = __pyx_pybuffernd_xcenters.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 193, __pyx_L1_error)
  }
  __pyx_t_15 = 0;
  __pyx_v_xcenters = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":194
 *             print('Weights shape =', np.shape(weights))
 *         xcenters = z[:, 0]
 *         if self.state_assignment != '1d':             # <<<<<<<<<<<<<<
 *             ycenters = z[:, 1]  # y coordinates of centroids
 * 
 */
  __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_kp_u_1d, Py_NE)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 194, __pyx_L1_error)
  __pyx_t_9 = (__pyx_t_10 != 0);
  if (__pyx_t_9) {

    /* "vcstring.pyx":195
 *         xcenters = z[:, 0]
 *         if self.state_assignment != '1d':
 *             ycenters = z[:, 1]  # y coordinates of centroids             # <<<<<<<<<<<<<<
 * 
 *         # Check that lag time is smaller than data set size
 */
    __pyx_t_1 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_z), __pyx_tuple__10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 195, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 195, __pyx_L1_error)
    __pyx_t_15 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer);
      __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer, (PyObject*)__pyx_t_15, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_7 < 0)) {
        PyErr_Fetch(&__pyx_t_18, &__pyx_t_17, &__pyx_t_16);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer, (PyObject*)__pyx_v_ycenters, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_17); Py_XDECREF(__pyx_t_16);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_18, __pyx_t_17, __pyx_t_16);
        }
        __pyx_t_18 = __pyx_t_17 = __pyx_t_16 = 0;
      }
      __pyx_pybuffernd_ycenters.diminfo[0].strides = __pyx_pybuffernd_ycenters.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ycenters.diminfo[0].shape = __pyx_pybuffernd_ycenters.rcbuffer->pybuffer.shape[0];
      if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 195, __pyx_L1_error)
    }
    __pyx_t_15 = 0;
    __pyx_v_ycenters = ((PyArrayObject *)__pyx_t_1);
    __pyx_t_1 = 0;

    /* "vcstring.pyx":194
 *             print('Weights shape =', np.shape(weights))
 *         xcenters = z[:, 0]
 *         if self.state_assignment != '1d':             # <<<<<<<<<<<<<<
 *             ycenters = z[:, 1]  # y coordinates of centroids
 * 
 */
  }

  /* "vcstring.pyx":198
 * 
 *         # Check that lag time is smaller than data set size
 *         if tau > len(traj[0]):             # <<<<<<<<<<<<<<
 *             raise RuntimeError ("\nInvalid lag time. Use a smaller lag time.")
 *             exit()
 */
  if (unlikely(__pyx_v_traj == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(0, 198, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_v_traj, 0, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 198, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_14 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 198, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_9 = ((__pyx_v_tau > __pyx_t_14) != 0);
  if (unlikely(__pyx_t_9)) {

    /* "vcstring.pyx":199
 *         # Check that lag time is smaller than data set size
 *         if tau > len(traj[0]):
 *             raise RuntimeError ("\nInvalid lag time. Use a smaller lag time.")             # <<<<<<<<<<<<<<
 *             exit()
 * 
 */
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__11, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 199, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __PYX_ERR(0, 199, __pyx_L1_error)

    /* "vcstring.pyx":198
 * 
 *         # Check that lag time is smaller than data set size
 *         if tau > len(traj[0]):             # <<<<<<<<<<<<<<
 *             raise RuntimeError ("\nInvalid lag time. Use a smaller lag time.")
 *             exit()
 */
  }

  /* "vcstring.pyx":203
 * 
 *         # Assign to Voronoi cell
 *         ids = []             # <<<<<<<<<<<<<<
 *         # print('Performing Voronoi tesselation')
 *         sys.stdout.flush()
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 203, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_ids = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "vcstring.pyx":205
 *         ids = []
 *         # print('Performing Voronoi tesselation')
 *         sys.stdout.flush()             # <<<<<<<<<<<<<<
 *         count = 0
 *         for t in range(N):
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_sys); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 205, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_stdout); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 205, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_flush); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 205, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 205, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":206
 *         # print('Performing Voronoi tesselation')
 *         sys.stdout.flush()
 *         count = 0             # <<<<<<<<<<<<<<
 *         for t in range(N):
 *             # Get snapshot at time t and t + tau
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_v_count = __pyx_int_0;

  /* "vcstring.pyx":207
 *         sys.stdout.flush()
 *         count = 0
 *         for t in range(N):             # <<<<<<<<<<<<<<
 *             # Get snapshot at time t and t + tau
 *             h_I0, h_Itau = 0., 0.
 */
  __pyx_t_7 = __pyx_v_N;
  __pyx_t_19 = __pyx_t_7;
  for (__pyx_t_20 = 0; __pyx_t_20 < __pyx_t_19; __pyx_t_20+=1) {
    __pyx_v_t = __pyx_t_20;

    /* "vcstring.pyx":209
 *         for t in range(N):
 *             # Get snapshot at time t and t + tau
 *             h_I0, h_Itau = 0., 0.             # <<<<<<<<<<<<<<
 *             h_B0, h_Btau = 0., 0.
 * 
 */
    __pyx_t_13 = 0.;
    __pyx_t_12 = 0.;
    __pyx_v_h_I0 = __pyx_t_13;
    __pyx_v_h_Itau = __pyx_t_12;

    /* "vcstring.pyx":210
 *             # Get snapshot at time t and t + tau
 *             h_I0, h_Itau = 0., 0.
 *             h_B0, h_Btau = 0., 0.             # <<<<<<<<<<<<<<
 * 
 *             # Get frame coordinates and closest Voronoi at time 0 and time tau
 */
    __pyx_t_12 = 0.;
    __pyx_t_13 = 0.;
    __pyx_v_h_B0 = __pyx_t_12;
    __pyx_v_h_Btau = __pyx_t_13;

    /* "vcstring.pyx":213
 * 
 *             # Get frame coordinates and closest Voronoi at time 0 and time tau
 *             x_t = [row[1] for row in traj[t]][::stride][t0]             # <<<<<<<<<<<<<<
 *             x_tau = [row[1] for row in traj[t]][::stride][t0+tau]
 *             if self.state_assignment == '1d':
 */
    { /* enter inner scope */
      __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 213, __pyx_L14_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (unlikely(__pyx_v_traj == Py_None)) {
        PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
        __PYX_ERR(0, 213, __pyx_L14_error)
      }
      __pyx_t_2 = __Pyx_GetItemInt_List(__pyx_v_traj, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 213, __pyx_L14_error)
      __Pyx_GOTREF(__pyx_t_2);
      if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
        __pyx_t_5 = __pyx_t_2; __Pyx_INCREF(__pyx_t_5); __pyx_t_14 = 0;
        __pyx_t_21 = NULL;
      } else {
        __pyx_t_14 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 213, __pyx_L14_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_21 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 213, __pyx_L14_error)
      }
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      for (;;) {
        if (likely(!__pyx_t_21)) {
          if (likely(PyList_CheckExact(__pyx_t_5))) {
            if (__pyx_t_14 >= PyList_GET_SIZE(__pyx_t_5)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_2 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_14); __Pyx_INCREF(__pyx_t_2); __pyx_t_14++; if (unlikely(0 < 0)) __PYX_ERR(0, 213, __pyx_L14_error)
            #else
            __pyx_t_2 = PySequence_ITEM(__pyx_t_5, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 213, __pyx_L14_error)
            __Pyx_GOTREF(__pyx_t_2);
            #endif
          } else {
            if (__pyx_t_14 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_14); __Pyx_INCREF(__pyx_t_2); __pyx_t_14++; if (unlikely(0 < 0)) __PYX_ERR(0, 213, __pyx_L14_error)
            #else
            __pyx_t_2 = PySequence_ITEM(__pyx_t_5, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 213, __pyx_L14_error)
            __Pyx_GOTREF(__pyx_t_2);
            #endif
          }
        } else {
          __pyx_t_2 = __pyx_t_21(__pyx_t_5);
          if (unlikely(!__pyx_t_2)) {
            PyObject* exc_type = PyErr_Occurred();
            if (exc_type) {
              if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
              else __PYX_ERR(0, 213, __pyx_L14_error)
            }
            break;
          }
          __Pyx_GOTREF(__pyx_t_2);
        }
        __Pyx_XDECREF_SET(__pyx_8genexpr2__pyx_v_row, __pyx_t_2);
        __pyx_t_2 = 0;
        __pyx_t_2 = __Pyx_GetItemInt(__pyx_8genexpr2__pyx_v_row, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 213, __pyx_L14_error)
        __Pyx_GOTREF(__pyx_t_2);
        if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_2))) __PYX_ERR(0, 213, __pyx_L14_error)
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      }
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_8genexpr2__pyx_v_row); __pyx_8genexpr2__pyx_v_row = 0;
      goto __pyx_L17_exit_scope;
      __pyx_L14_error:;
      __Pyx_XDECREF(__pyx_8genexpr2__pyx_v_row); __pyx_8genexpr2__pyx_v_row = 0;
      goto __pyx_L1_error;
      __pyx_L17_exit_scope:;
    } /* exit inner scope */
    __pyx_t_5 = PySlice_New(Py_None, Py_None, __pyx_v_stride); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 213, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 213, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = __Pyx_GetItemInt_List(__pyx_t_2, __pyx_v_t0, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 213, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_13 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely((__pyx_t_13 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 213, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_v_x_t = __pyx_t_13;

    /* "vcstring.pyx":214
 *             # Get frame coordinates and closest Voronoi at time 0 and time tau
 *             x_t = [row[1] for row in traj[t]][::stride][t0]
 *             x_tau = [row[1] for row in traj[t]][::stride][t0+tau]             # <<<<<<<<<<<<<<
 *             if self.state_assignment == '1d':
 *                 dist_t = abs(x_t - xcenters) # Find nearest Voronoi center
 */
    { /* enter inner scope */
      __pyx_t_5 = PyList_New(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 214, __pyx_L20_error)
      __Pyx_GOTREF(__pyx_t_5);
      if (unlikely(__pyx_v_traj == Py_None)) {
        PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
        __PYX_ERR(0, 214, __pyx_L20_error)
      }
      __pyx_t_2 = __Pyx_GetItemInt_List(__pyx_v_traj, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 214, __pyx_L20_error)
      __Pyx_GOTREF(__pyx_t_2);
      if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
        __pyx_t_1 = __pyx_t_2; __Pyx_INCREF(__pyx_t_1); __pyx_t_14 = 0;
        __pyx_t_21 = NULL;
      } else {
        __pyx_t_14 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 214, __pyx_L20_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_21 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 214, __pyx_L20_error)
      }
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      for (;;) {
        if (likely(!__pyx_t_21)) {
          if (likely(PyList_CheckExact(__pyx_t_1))) {
            if (__pyx_t_14 >= PyList_GET_SIZE(__pyx_t_1)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_14); __Pyx_INCREF(__pyx_t_2); __pyx_t_14++; if (unlikely(0 < 0)) __PYX_ERR(0, 214, __pyx_L20_error)
            #else
            __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 214, __pyx_L20_error)
            __Pyx_GOTREF(__pyx_t_2);
            #endif
          } else {
            if (__pyx_t_14 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_14); __Pyx_INCREF(__pyx_t_2); __pyx_t_14++; if (unlikely(0 < 0)) __PYX_ERR(0, 214, __pyx_L20_error)
            #else
            __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 214, __pyx_L20_error)
            __Pyx_GOTREF(__pyx_t_2);
            #endif
          }
        } else {
          __pyx_t_2 = __pyx_t_21(__pyx_t_1);
          if (unlikely(!__pyx_t_2)) {
            PyObject* exc_type = PyErr_Occurred();
            if (exc_type) {
              if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
              else __PYX_ERR(0, 214, __pyx_L20_error)
            }
            break;
          }
          __Pyx_GOTREF(__pyx_t_2);
        }
        __Pyx_XDECREF_SET(__pyx_8genexpr3__pyx_v_row, __pyx_t_2);
        __pyx_t_2 = 0;
        __pyx_t_2 = __Pyx_GetItemInt(__pyx_8genexpr3__pyx_v_row, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 214, __pyx_L20_error)
        __Pyx_GOTREF(__pyx_t_2);
        if (unlikely(__Pyx_ListComp_Append(__pyx_t_5, (PyObject*)__pyx_t_2))) __PYX_ERR(0, 214, __pyx_L20_error)
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF(__pyx_8genexpr3__pyx_v_row); __pyx_8genexpr3__pyx_v_row = 0;
      goto __pyx_L23_exit_scope;
      __pyx_L20_error:;
      __Pyx_XDECREF(__pyx_8genexpr3__pyx_v_row); __pyx_8genexpr3__pyx_v_row = 0;
      goto __pyx_L1_error;
      __pyx_L23_exit_scope:;
    } /* exit inner scope */
    __pyx_t_1 = PySlice_New(Py_None, Py_None, __pyx_v_stride); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 214, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 214, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_22 = (__pyx_v_t0 + __pyx_v_tau);
    __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_t_2, __pyx_t_22, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 214, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF_SET(__pyx_v_x_tau, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "vcstring.pyx":215
 *             x_t = [row[1] for row in traj[t]][::stride][t0]
 *             x_tau = [row[1] for row in traj[t]][::stride][t0+tau]
 *             if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                 dist_t = abs(x_t - xcenters) # Find nearest Voronoi center
 *                 dist_tau = abs(x_tau - xcenters)
 */
    __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_kp_u_1d, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 215, __pyx_L1_error)
    __pyx_t_10 = (__pyx_t_9 != 0);
    if (__pyx_t_10) {

      /* "vcstring.pyx":216
 *             x_tau = [row[1] for row in traj[t]][::stride][t0+tau]
 *             if self.state_assignment == '1d':
 *                 dist_t = abs(x_t - xcenters) # Find nearest Voronoi center             # <<<<<<<<<<<<<<
 *                 dist_tau = abs(x_tau - xcenters)
 *             else:
 */
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_x_t); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 216, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = PyNumber_Subtract(__pyx_t_1, ((PyObject *)__pyx_v_xcenters)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 216, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyNumber_Absolute(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 216, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF_SET(__pyx_v_dist_t, __pyx_t_1);
      __pyx_t_1 = 0;

      /* "vcstring.pyx":217
 *             if self.state_assignment == '1d':
 *                 dist_t = abs(x_t - xcenters) # Find nearest Voronoi center
 *                 dist_tau = abs(x_tau - xcenters)             # <<<<<<<<<<<<<<
 *             else:
 *                 y_t = [row[2] for row in traj[t]][::stride][t0]
 */
      __pyx_t_1 = PyNumber_Subtract(__pyx_v_x_tau, ((PyObject *)__pyx_v_xcenters)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 217, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = __Pyx_PyNumber_Absolute(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 217, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF_SET(__pyx_v_dist_tau, __pyx_t_2);
      __pyx_t_2 = 0;

      /* "vcstring.pyx":215
 *             x_t = [row[1] for row in traj[t]][::stride][t0]
 *             x_tau = [row[1] for row in traj[t]][::stride][t0+tau]
 *             if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                 dist_t = abs(x_t - xcenters) # Find nearest Voronoi center
 *                 dist_tau = abs(x_tau - xcenters)
 */
      goto __pyx_L24;
    }

    /* "vcstring.pyx":219
 *                 dist_tau = abs(x_tau - xcenters)
 *             else:
 *                 y_t = [row[2] for row in traj[t]][::stride][t0]             # <<<<<<<<<<<<<<
 *                 y_tau = [row[2] for row in traj[t]][::stride][t0+tau]
 *                 dist_t = sqrt((x_t - xcenters)**2 + (y_t - ycenters)**2)  # Find nearest Voronoi center
 */
    /*else*/ {
      { /* enter inner scope */
        __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 219, __pyx_L27_error)
        __Pyx_GOTREF(__pyx_t_2);
        if (unlikely(__pyx_v_traj == Py_None)) {
          PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
          __PYX_ERR(0, 219, __pyx_L27_error)
        }
        __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_v_traj, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 219, __pyx_L27_error)
        __Pyx_GOTREF(__pyx_t_1);
        if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
          __pyx_t_5 = __pyx_t_1; __Pyx_INCREF(__pyx_t_5); __pyx_t_14 = 0;
          __pyx_t_21 = NULL;
        } else {
          __pyx_t_14 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 219, __pyx_L27_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_21 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 219, __pyx_L27_error)
        }
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        for (;;) {
          if (likely(!__pyx_t_21)) {
            if (likely(PyList_CheckExact(__pyx_t_5))) {
              if (__pyx_t_14 >= PyList_GET_SIZE(__pyx_t_5)) break;
              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_1 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely(0 < 0)) __PYX_ERR(0, 219, __pyx_L27_error)
              #else
              __pyx_t_1 = PySequence_ITEM(__pyx_t_5, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 219, __pyx_L27_error)
              __Pyx_GOTREF(__pyx_t_1);
              #endif
            } else {
              if (__pyx_t_14 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely(0 < 0)) __PYX_ERR(0, 219, __pyx_L27_error)
              #else
              __pyx_t_1 = PySequence_ITEM(__pyx_t_5, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 219, __pyx_L27_error)
              __Pyx_GOTREF(__pyx_t_1);
              #endif
            }
          } else {
            __pyx_t_1 = __pyx_t_21(__pyx_t_5);
            if (unlikely(!__pyx_t_1)) {
              PyObject* exc_type = PyErr_Occurred();
              if (exc_type) {
                if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                else __PYX_ERR(0, 219, __pyx_L27_error)
              }
              break;
            }
            __Pyx_GOTREF(__pyx_t_1);
          }
          __Pyx_XDECREF_SET(__pyx_8genexpr4__pyx_v_row, __pyx_t_1);
          __pyx_t_1 = 0;
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_8genexpr4__pyx_v_row, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 219, __pyx_L27_error)
          __Pyx_GOTREF(__pyx_t_1);
          if (unlikely(__Pyx_ListComp_Append(__pyx_t_2, (PyObject*)__pyx_t_1))) __PYX_ERR(0, 219, __pyx_L27_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        }
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_XDECREF(__pyx_8genexpr4__pyx_v_row); __pyx_8genexpr4__pyx_v_row = 0;
        goto __pyx_L30_exit_scope;
        __pyx_L27_error:;
        __Pyx_XDECREF(__pyx_8genexpr4__pyx_v_row); __pyx_8genexpr4__pyx_v_row = 0;
        goto __pyx_L1_error;
        __pyx_L30_exit_scope:;
      } /* exit inner scope */
      __pyx_t_5 = PySlice_New(Py_None, Py_None, __pyx_v_stride); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 219, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 219, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = __Pyx_GetItemInt_List(__pyx_t_1, __pyx_v_t0, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 219, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_13 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely((__pyx_t_13 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 219, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_v_y_t = __pyx_t_13;

      /* "vcstring.pyx":220
 *             else:
 *                 y_t = [row[2] for row in traj[t]][::stride][t0]
 *                 y_tau = [row[2] for row in traj[t]][::stride][t0+tau]             # <<<<<<<<<<<<<<
 *                 dist_t = sqrt((x_t - xcenters)**2 + (y_t - ycenters)**2)  # Find nearest Voronoi center
 *                 dist_tau = sqrt((x_tau - xcenters)**2 + (y_tau - ycenters)**2)
 */
      { /* enter inner scope */
        __pyx_t_5 = PyList_New(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 220, __pyx_L33_error)
        __Pyx_GOTREF(__pyx_t_5);
        if (unlikely(__pyx_v_traj == Py_None)) {
          PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
          __PYX_ERR(0, 220, __pyx_L33_error)
        }
        __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_v_traj, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L33_error)
        __Pyx_GOTREF(__pyx_t_1);
        if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
          __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_14 = 0;
          __pyx_t_21 = NULL;
        } else {
          __pyx_t_14 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 220, __pyx_L33_error)
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_21 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 220, __pyx_L33_error)
        }
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        for (;;) {
          if (likely(!__pyx_t_21)) {
            if (likely(PyList_CheckExact(__pyx_t_2))) {
              if (__pyx_t_14 >= PyList_GET_SIZE(__pyx_t_2)) break;
              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely(0 < 0)) __PYX_ERR(0, 220, __pyx_L33_error)
              #else
              __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L33_error)
              __Pyx_GOTREF(__pyx_t_1);
              #endif
            } else {
              if (__pyx_t_14 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely(0 < 0)) __PYX_ERR(0, 220, __pyx_L33_error)
              #else
              __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L33_error)
              __Pyx_GOTREF(__pyx_t_1);
              #endif
            }
          } else {
            __pyx_t_1 = __pyx_t_21(__pyx_t_2);
            if (unlikely(!__pyx_t_1)) {
              PyObject* exc_type = PyErr_Occurred();
              if (exc_type) {
                if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                else __PYX_ERR(0, 220, __pyx_L33_error)
              }
              break;
            }
            __Pyx_GOTREF(__pyx_t_1);
          }
          __Pyx_XDECREF_SET(__pyx_8genexpr5__pyx_v_row, __pyx_t_1);
          __pyx_t_1 = 0;
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_8genexpr5__pyx_v_row, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L33_error)
          __Pyx_GOTREF(__pyx_t_1);
          if (unlikely(__Pyx_ListComp_Append(__pyx_t_5, (PyObject*)__pyx_t_1))) __PYX_ERR(0, 220, __pyx_L33_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        }
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_XDECREF(__pyx_8genexpr5__pyx_v_row); __pyx_8genexpr5__pyx_v_row = 0;
        goto __pyx_L36_exit_scope;
        __pyx_L33_error:;
        __Pyx_XDECREF(__pyx_8genexpr5__pyx_v_row); __pyx_8genexpr5__pyx_v_row = 0;
        goto __pyx_L1_error;
        __pyx_L36_exit_scope:;
      } /* exit inner scope */
      __pyx_t_2 = PySlice_New(Py_None, Py_None, __pyx_v_stride); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 220, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_22 = (__pyx_v_t0 + __pyx_v_tau);
      __pyx_t_2 = __Pyx_GetItemInt_List(__pyx_t_1, __pyx_t_22, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 220, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF_SET(__pyx_v_y_tau, __pyx_t_2);
      __pyx_t_2 = 0;

      /* "vcstring.pyx":221
 *                 y_t = [row[2] for row in traj[t]][::stride][t0]
 *                 y_tau = [row[2] for row in traj[t]][::stride][t0+tau]
 *                 dist_t = sqrt((x_t - xcenters)**2 + (y_t - ycenters)**2)  # Find nearest Voronoi center             # <<<<<<<<<<<<<<
 *                 dist_tau = sqrt((x_tau - xcenters)**2 + (y_tau - ycenters)**2)
 *             nc_t = np.argmin(dist_t)  # Get index of nearest Voronoi
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 221, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_x_t); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 221, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_8 = PyNumber_Subtract(__pyx_t_5, ((PyObject *)__pyx_v_xcenters)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 221, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = PyNumber_Power(__pyx_t_8, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 221, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = PyFloat_FromDouble(__pyx_v_y_t); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 221, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_4 = PyNumber_Subtract(__pyx_t_8, ((PyObject *)__pyx_v_ycenters)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 221, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = PyNumber_Power(__pyx_t_4, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 221, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyNumber_Add(__pyx_t_5, __pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 221, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_8)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_8);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
        }
      }
      __pyx_t_2 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_8, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_4);
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 221, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF_SET(__pyx_v_dist_t, __pyx_t_2);
      __pyx_t_2 = 0;

      /* "vcstring.pyx":222
 *                 y_tau = [row[2] for row in traj[t]][::stride][t0+tau]
 *                 dist_t = sqrt((x_t - xcenters)**2 + (y_t - ycenters)**2)  # Find nearest Voronoi center
 *                 dist_tau = sqrt((x_tau - xcenters)**2 + (y_tau - ycenters)**2)             # <<<<<<<<<<<<<<
 *             nc_t = np.argmin(dist_t)  # Get index of nearest Voronoi
 *             nc_tau = np.argmin(dist_tau)
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 222, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = PyNumber_Subtract(__pyx_v_x_tau, ((PyObject *)__pyx_v_xcenters)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 222, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_8 = PyNumber_Power(__pyx_t_4, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 222, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyNumber_Subtract(__pyx_v_y_tau, ((PyObject *)__pyx_v_ycenters)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 222, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyNumber_Power(__pyx_t_4, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 222, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyNumber_Add(__pyx_t_8, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 222, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_5)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_5);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
        }
      }
      __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_4);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 222, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF_SET(__pyx_v_dist_tau, __pyx_t_2);
      __pyx_t_2 = 0;
    }
    __pyx_L24:;

    /* "vcstring.pyx":223
 *                 dist_t = sqrt((x_t - xcenters)**2 + (y_t - ycenters)**2)  # Find nearest Voronoi center
 *                 dist_tau = sqrt((x_tau - xcenters)**2 + (y_tau - ycenters)**2)
 *             nc_t = np.argmin(dist_t)  # Get index of nearest Voronoi             # <<<<<<<<<<<<<<
 *             nc_tau = np.argmin(dist_tau)
 * 
 */
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 223, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_argmin); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 223, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_2 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_1, __pyx_v_dist_t) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_dist_t);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 223, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF_SET(__pyx_v_nc_t, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "vcstring.pyx":224
 *                 dist_tau = sqrt((x_tau - xcenters)**2 + (y_tau - ycenters)**2)
 *             nc_t = np.argmin(dist_t)  # Get index of nearest Voronoi
 *             nc_tau = np.argmin(dist_tau)             # <<<<<<<<<<<<<<
 * 
 *             # Assign states given boundary definitions
 */
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 224, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_argmin); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 224, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_4, __pyx_v_dist_tau) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_dist_tau);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 224, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF_SET(__pyx_v_nc_tau, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "vcstring.pyx":228
 *             # Assign states given boundary definitions
 *             # If 1-dimensional system
 *             if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                 if (x_t >= self.cut_A) and (x_t <= self.cut_B):  # State I
 *                     h_I0 = 1.
 */
    __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_kp_u_1d, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 228, __pyx_L1_error)
    __pyx_t_9 = (__pyx_t_10 != 0);
    if (__pyx_t_9) {

      /* "vcstring.pyx":229
 *             # If 1-dimensional system
 *             if self.state_assignment == '1d':
 *                 if (x_t >= self.cut_A) and (x_t <= self.cut_B):  # State I             # <<<<<<<<<<<<<<
 *                     h_I0 = 1.
 *                 elif x_t > self.cut_B:  # State B
 */
      __pyx_t_10 = ((__pyx_v_x_t >= __pyx_v_self->cut_A) != 0);
      if (__pyx_t_10) {
      } else {
        __pyx_t_9 = __pyx_t_10;
        goto __pyx_L39_bool_binop_done;
      }
      __pyx_t_10 = ((__pyx_v_x_t <= __pyx_v_self->cut_B) != 0);
      __pyx_t_9 = __pyx_t_10;
      __pyx_L39_bool_binop_done:;
      if (__pyx_t_9) {

        /* "vcstring.pyx":230
 *             if self.state_assignment == '1d':
 *                 if (x_t >= self.cut_A) and (x_t <= self.cut_B):  # State I
 *                     h_I0 = 1.             # <<<<<<<<<<<<<<
 *                 elif x_t > self.cut_B:  # State B
 *                     h_B0 = 1.
 */
        __pyx_v_h_I0 = 1.;

        /* "vcstring.pyx":229
 *             # If 1-dimensional system
 *             if self.state_assignment == '1d':
 *                 if (x_t >= self.cut_A) and (x_t <= self.cut_B):  # State I             # <<<<<<<<<<<<<<
 *                     h_I0 = 1.
 *                 elif x_t > self.cut_B:  # State B
 */
        goto __pyx_L38;
      }

      /* "vcstring.pyx":231
 *                 if (x_t >= self.cut_A) and (x_t <= self.cut_B):  # State I
 *                     h_I0 = 1.
 *                 elif x_t > self.cut_B:  # State B             # <<<<<<<<<<<<<<
 *                     h_B0 = 1.
 *                 if (x_tau >= self.cut_A) and (x_tau <= self.cut_B):  # State I
 */
      __pyx_t_9 = ((__pyx_v_x_t > __pyx_v_self->cut_B) != 0);
      if (__pyx_t_9) {

        /* "vcstring.pyx":232
 *                     h_I0 = 1.
 *                 elif x_t > self.cut_B:  # State B
 *                     h_B0 = 1.             # <<<<<<<<<<<<<<
 *                 if (x_tau >= self.cut_A) and (x_tau <= self.cut_B):  # State I
 *                     h_Itau = 1.
 */
        __pyx_v_h_B0 = 1.;

        /* "vcstring.pyx":231
 *                 if (x_t >= self.cut_A) and (x_t <= self.cut_B):  # State I
 *                     h_I0 = 1.
 *                 elif x_t > self.cut_B:  # State B             # <<<<<<<<<<<<<<
 *                     h_B0 = 1.
 *                 if (x_tau >= self.cut_A) and (x_tau <= self.cut_B):  # State I
 */
      }
      __pyx_L38:;

      /* "vcstring.pyx":233
 *                 elif x_t > self.cut_B:  # State B
 *                     h_B0 = 1.
 *                 if (x_tau >= self.cut_A) and (x_tau <= self.cut_B):  # State I             # <<<<<<<<<<<<<<
 *                     h_Itau = 1.
 *                 elif x_tau > self.cut_B:  # State B
 */
      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_self->cut_A); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 233, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = PyObject_RichCompare(__pyx_v_x_tau, __pyx_t_2, Py_GE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 233, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 233, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_10) {
      } else {
        __pyx_t_9 = __pyx_t_10;
        goto __pyx_L42_bool_binop_done;
      }
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_self->cut_B); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 233, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = PyObject_RichCompare(__pyx_v_x_tau, __pyx_t_1, Py_LE); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 233, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 233, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_9 = __pyx_t_10;
      __pyx_L42_bool_binop_done:;
      if (__pyx_t_9) {

        /* "vcstring.pyx":234
 *                     h_B0 = 1.
 *                 if (x_tau >= self.cut_A) and (x_tau <= self.cut_B):  # State I
 *                     h_Itau = 1.             # <<<<<<<<<<<<<<
 *                 elif x_tau > self.cut_B:  # State B
 *                     h_Btau = 1.
 */
        __pyx_v_h_Itau = 1.;

        /* "vcstring.pyx":233
 *                 elif x_t > self.cut_B:  # State B
 *                     h_B0 = 1.
 *                 if (x_tau >= self.cut_A) and (x_tau <= self.cut_B):  # State I             # <<<<<<<<<<<<<<
 *                     h_Itau = 1.
 *                 elif x_tau > self.cut_B:  # State B
 */
        goto __pyx_L41;
      }

      /* "vcstring.pyx":235
 *                 if (x_tau >= self.cut_A) and (x_tau <= self.cut_B):  # State I
 *                     h_Itau = 1.
 *                 elif x_tau > self.cut_B:  # State B             # <<<<<<<<<<<<<<
 *                     h_Btau = 1.
 * 
 */
      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_self->cut_B); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 235, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = PyObject_RichCompare(__pyx_v_x_tau, __pyx_t_2, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 235, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 235, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_9) {

        /* "vcstring.pyx":236
 *                     h_Itau = 1.
 *                 elif x_tau > self.cut_B:  # State B
 *                     h_Btau = 1.             # <<<<<<<<<<<<<<
 * 
 *             # Orthogonal projection onto the RC line, then check for x boundary
 */
        __pyx_v_h_Btau = 1.;

        /* "vcstring.pyx":235
 *                 if (x_tau >= self.cut_A) and (x_tau <= self.cut_B):  # State I
 *                     h_Itau = 1.
 *                 elif x_tau > self.cut_B:  # State B             # <<<<<<<<<<<<<<
 *                     h_Btau = 1.
 * 
 */
      }
      __pyx_L41:;

      /* "vcstring.pyx":228
 *             # Assign states given boundary definitions
 *             # If 1-dimensional system
 *             if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                 if (x_t >= self.cut_A) and (x_t <= self.cut_B):  # State I
 *                     h_I0 = 1.
 */
      goto __pyx_L37;
    }

    /* "vcstring.pyx":239
 * 
 *             # Orthogonal projection onto the RC line, then check for x boundary
 *             elif self.state_assignment == 'orthogonal_projection':             # <<<<<<<<<<<<<<
 *                 # Orthogonal projection of (x,y) -> (u,v) onto reaction coordinate
 *                 u_t = (y_t * tan(self.theta) + x_t) / (tan(self.theta)**2 + 1)
 */
    __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_n_u_orthogonal_projection, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 239, __pyx_L1_error)
    __pyx_t_10 = (__pyx_t_9 != 0);
    if (__pyx_t_10) {

      /* "vcstring.pyx":241
 *             elif self.state_assignment == 'orthogonal_projection':
 *                 # Orthogonal projection of (x,y) -> (u,v) onto reaction coordinate
 *                 u_t = (y_t * tan(self.theta) + x_t) / (tan(self.theta)**2 + 1)             # <<<<<<<<<<<<<<
 *                 u_tau = (y_tau * tan(self.theta) + x_tau) / (tan(self.theta)**2 + 1)
 *                 # Check if (u,v) is inside/outside of the intermediate region
 */
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_y_t); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 241, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_tan); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 241, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 241, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_8 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_8)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_8);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
        }
      }
      __pyx_t_2 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_8, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5);
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 241, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyNumber_Multiply(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 241, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_x_t); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 241, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = PyNumber_Add(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 241, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_tan); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 241, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 241, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_8 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_8)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_8);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
        }
      }
      __pyx_t_2 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_8, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5);
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 241, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyNumber_Power(__pyx_t_2, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 241, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyInt_AddObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 241, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyNumber_Divide(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 241, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_13 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_13 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 241, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_v_u_t = __pyx_t_13;

      /* "vcstring.pyx":242
 *                 # Orthogonal projection of (x,y) -> (u,v) onto reaction coordinate
 *                 u_t = (y_t * tan(self.theta) + x_t) / (tan(self.theta)**2 + 1)
 *                 u_tau = (y_tau * tan(self.theta) + x_tau) / (tan(self.theta)**2 + 1)             # <<<<<<<<<<<<<<
 *                 # Check if (u,v) is inside/outside of the intermediate region
 *                 # indicator function h=0 in state A, 0.5 in intermediate region, 1 in state B
 */
      if (unlikely(!__pyx_v_y_tau)) { __Pyx_RaiseUnboundLocalError("y_tau"); __PYX_ERR(0, 242, __pyx_L1_error) }
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_tan); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 242, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 242, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_5)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_5);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
        }
      }
      __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_1);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 242, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = PyNumber_Multiply(__pyx_v_y_tau, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 242, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyNumber_Add(__pyx_t_2, __pyx_v_x_tau); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 242, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_tan); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 242, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 242, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_8 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_8)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_8);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
        }
      }
      __pyx_t_2 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_8, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_5);
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 242, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = PyNumber_Power(__pyx_t_2, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 242, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyInt_AddObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 242, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 242, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF_SET(__pyx_v_u_tau, __pyx_t_1);
      __pyx_t_1 = 0;

      /* "vcstring.pyx":245
 *                 # Check if (u,v) is inside/outside of the intermediate region
 *                 # indicator function h=0 in state A, 0.5 in intermediate region, 1 in state B
 *                 if u_t >= xa and u_t <= xb:  # Intermediate region             # <<<<<<<<<<<<<<
 *                     h_I0 = 1.0
 *                 elif u_t > xb:  # Ouside of intermediate region (state B)
 */
      __pyx_t_9 = ((__pyx_v_u_t >= __pyx_v_xa) != 0);
      if (__pyx_t_9) {
      } else {
        __pyx_t_10 = __pyx_t_9;
        goto __pyx_L45_bool_binop_done;
      }
      __pyx_t_9 = ((__pyx_v_u_t <= __pyx_v_xb) != 0);
      __pyx_t_10 = __pyx_t_9;
      __pyx_L45_bool_binop_done:;
      if (__pyx_t_10) {

        /* "vcstring.pyx":246
 *                 # indicator function h=0 in state A, 0.5 in intermediate region, 1 in state B
 *                 if u_t >= xa and u_t <= xb:  # Intermediate region
 *                     h_I0 = 1.0             # <<<<<<<<<<<<<<
 *                 elif u_t > xb:  # Ouside of intermediate region (state B)
 *                     h_B0 = 1.0
 */
        __pyx_v_h_I0 = 1.0;

        /* "vcstring.pyx":245
 *                 # Check if (u,v) is inside/outside of the intermediate region
 *                 # indicator function h=0 in state A, 0.5 in intermediate region, 1 in state B
 *                 if u_t >= xa and u_t <= xb:  # Intermediate region             # <<<<<<<<<<<<<<
 *                     h_I0 = 1.0
 *                 elif u_t > xb:  # Ouside of intermediate region (state B)
 */
        goto __pyx_L44;
      }

      /* "vcstring.pyx":247
 *                 if u_t >= xa and u_t <= xb:  # Intermediate region
 *                     h_I0 = 1.0
 *                 elif u_t > xb:  # Ouside of intermediate region (state B)             # <<<<<<<<<<<<<<
 *                     h_B0 = 1.0
 *                 if u_tau >= xa and u_tau <= xb:  # Intermediate region
 */
      __pyx_t_10 = ((__pyx_v_u_t > __pyx_v_xb) != 0);
      if (__pyx_t_10) {

        /* "vcstring.pyx":248
 *                     h_I0 = 1.0
 *                 elif u_t > xb:  # Ouside of intermediate region (state B)
 *                     h_B0 = 1.0             # <<<<<<<<<<<<<<
 *                 if u_tau >= xa and u_tau <= xb:  # Intermediate region
 *                     h_Itau = 1.0
 */
        __pyx_v_h_B0 = 1.0;

        /* "vcstring.pyx":247
 *                 if u_t >= xa and u_t <= xb:  # Intermediate region
 *                     h_I0 = 1.0
 *                 elif u_t > xb:  # Ouside of intermediate region (state B)             # <<<<<<<<<<<<<<
 *                     h_B0 = 1.0
 *                 if u_tau >= xa and u_tau <= xb:  # Intermediate region
 */
      }
      __pyx_L44:;

      /* "vcstring.pyx":249
 *                 elif u_t > xb:  # Ouside of intermediate region (state B)
 *                     h_B0 = 1.0
 *                 if u_tau >= xa and u_tau <= xb:  # Intermediate region             # <<<<<<<<<<<<<<
 *                     h_Itau = 1.0
 *                 elif u_tau > xb:  # Ouside of intermediate region (state B)
 */
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_xa); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 249, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = PyObject_RichCompare(__pyx_v_u_tau, __pyx_t_1, Py_GE); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 249, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 249, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (__pyx_t_9) {
      } else {
        __pyx_t_10 = __pyx_t_9;
        goto __pyx_L48_bool_binop_done;
      }
      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_xb); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 249, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = PyObject_RichCompare(__pyx_v_u_tau, __pyx_t_2, Py_LE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 249, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 249, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_10 = __pyx_t_9;
      __pyx_L48_bool_binop_done:;
      if (__pyx_t_10) {

        /* "vcstring.pyx":250
 *                     h_B0 = 1.0
 *                 if u_tau >= xa and u_tau <= xb:  # Intermediate region
 *                     h_Itau = 1.0             # <<<<<<<<<<<<<<
 *                 elif u_tau > xb:  # Ouside of intermediate region (state B)
 *                     h_Btau = 1.0
 */
        __pyx_v_h_Itau = 1.0;

        /* "vcstring.pyx":249
 *                 elif u_t > xb:  # Ouside of intermediate region (state B)
 *                     h_B0 = 1.0
 *                 if u_tau >= xa and u_tau <= xb:  # Intermediate region             # <<<<<<<<<<<<<<
 *                     h_Itau = 1.0
 *                 elif u_tau > xb:  # Ouside of intermediate region (state B)
 */
        goto __pyx_L47;
      }

      /* "vcstring.pyx":251
 *                 if u_tau >= xa and u_tau <= xb:  # Intermediate region
 *                     h_Itau = 1.0
 *                 elif u_tau > xb:  # Ouside of intermediate region (state B)             # <<<<<<<<<<<<<<
 *                     h_Btau = 1.0
 * 
 */
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_xb); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 251, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = PyObject_RichCompare(__pyx_v_u_tau, __pyx_t_1, Py_GT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 251, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 251, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (__pyx_t_10) {

        /* "vcstring.pyx":252
 *                     h_Itau = 1.0
 *                 elif u_tau > xb:  # Ouside of intermediate region (state B)
 *                     h_Btau = 1.0             # <<<<<<<<<<<<<<
 * 
 *             # Fits rotated ellipses to the well minima to define states A, B
 */
        __pyx_v_h_Btau = 1.0;

        /* "vcstring.pyx":251
 *                 if u_tau >= xa and u_tau <= xb:  # Intermediate region
 *                     h_Itau = 1.0
 *                 elif u_tau > xb:  # Ouside of intermediate region (state B)             # <<<<<<<<<<<<<<
 *                     h_Btau = 1.0
 * 
 */
      }
      __pyx_L47:;

      /* "vcstring.pyx":239
 * 
 *             # Orthogonal projection onto the RC line, then check for x boundary
 *             elif self.state_assignment == 'orthogonal_projection':             # <<<<<<<<<<<<<<
 *                 # Orthogonal projection of (x,y) -> (u,v) onto reaction coordinate
 *                 u_t = (y_t * tan(self.theta) + x_t) / (tan(self.theta)**2 + 1)
 */
      goto __pyx_L37;
    }

    /* "vcstring.pyx":255
 * 
 *             # Fits rotated ellipses to the well minima to define states A, B
 *             elif self.state_assignment == 'ellipse':             # <<<<<<<<<<<<<<
 *                 # Value of fitted ellipse at point (x_t, y_t) or (x_tau, y_tau)
 *                 ell_tA = elliptical(self.ra_A, self.rb_A, self.alpha_A, self.x0_A, self.y0_A, x_t, y_t)
 */
    __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_n_u_ellipse, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 255, __pyx_L1_error)
    __pyx_t_9 = (__pyx_t_10 != 0);
    if (__pyx_t_9) {

      /* "vcstring.pyx":257
 *             elif self.state_assignment == 'ellipse':
 *                 # Value of fitted ellipse at point (x_t, y_t) or (x_tau, y_tau)
 *                 ell_tA = elliptical(self.ra_A, self.rb_A, self.alpha_A, self.x0_A, self.y0_A, x_t, y_t)             # <<<<<<<<<<<<<<
 *                 ell_tB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_t, y_t)
 *                 ell_tauA = elliptical(self.ra_A, self.rb_A, self.alpha_A, self.x0_A, self.y0_A, x_tau, y_tau)
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_elliptical); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 257, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = PyFloat_FromDouble(__pyx_v_self->ra_A); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 257, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_self->rb_A); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 257, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_8 = PyFloat_FromDouble(__pyx_v_self->alpha_A); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 257, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_self->x0_A); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 257, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_6 = PyFloat_FromDouble(__pyx_v_self->y0_A); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 257, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_23 = PyFloat_FromDouble(__pyx_v_x_t); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 257, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_23);
      __pyx_t_24 = PyFloat_FromDouble(__pyx_v_y_t); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 257, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_24);
      __pyx_t_25 = NULL;
      __pyx_t_22 = 0;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_25 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_25)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_25);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_22 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[8] = {__pyx_t_25, __pyx_t_4, __pyx_t_5, __pyx_t_8, __pyx_t_3, __pyx_t_6, __pyx_t_23, __pyx_t_24};
        __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_22, 7+__pyx_t_22); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 257, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_25); __pyx_t_25 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
        __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[8] = {__pyx_t_25, __pyx_t_4, __pyx_t_5, __pyx_t_8, __pyx_t_3, __pyx_t_6, __pyx_t_23, __pyx_t_24};
        __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_22, 7+__pyx_t_22); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 257, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_25); __pyx_t_25 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
        __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
      } else
      #endif
      {
        __pyx_t_26 = PyTuple_New(7+__pyx_t_22); if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 257, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_26);
        if (__pyx_t_25) {
          __Pyx_GIVEREF(__pyx_t_25); PyTuple_SET_ITEM(__pyx_t_26, 0, __pyx_t_25); __pyx_t_25 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_26, 0+__pyx_t_22, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_26, 1+__pyx_t_22, __pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_8);
        PyTuple_SET_ITEM(__pyx_t_26, 2+__pyx_t_22, __pyx_t_8);
        __Pyx_GIVEREF(__pyx_t_3);
        PyTuple_SET_ITEM(__pyx_t_26, 3+__pyx_t_22, __pyx_t_3);
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_26, 4+__pyx_t_22, __pyx_t_6);
        __Pyx_GIVEREF(__pyx_t_23);
        PyTuple_SET_ITEM(__pyx_t_26, 5+__pyx_t_22, __pyx_t_23);
        __Pyx_GIVEREF(__pyx_t_24);
        PyTuple_SET_ITEM(__pyx_t_26, 6+__pyx_t_22, __pyx_t_24);
        __pyx_t_4 = 0;
        __pyx_t_5 = 0;
        __pyx_t_8 = 0;
        __pyx_t_3 = 0;
        __pyx_t_6 = 0;
        __pyx_t_23 = 0;
        __pyx_t_24 = 0;
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_26, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 257, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_26); __pyx_t_26 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_13 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_13 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 257, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_v_ell_tA = __pyx_t_13;

      /* "vcstring.pyx":258
 *                 # Value of fitted ellipse at point (x_t, y_t) or (x_tau, y_tau)
 *                 ell_tA = elliptical(self.ra_A, self.rb_A, self.alpha_A, self.x0_A, self.y0_A, x_t, y_t)
 *                 ell_tB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_t, y_t)             # <<<<<<<<<<<<<<
 *                 ell_tauA = elliptical(self.ra_A, self.rb_A, self.alpha_A, self.x0_A, self.y0_A, x_tau, y_tau)
 *                 ell_tauB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_tau, y_tau)
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_elliptical); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 258, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_26 = PyFloat_FromDouble(__pyx_v_self->ra_B); if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 258, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_26);
      __pyx_t_24 = PyFloat_FromDouble(__pyx_v_self->rb_B); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 258, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_24);
      __pyx_t_23 = PyFloat_FromDouble(__pyx_v_self->alpha_B); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 258, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_23);
      __pyx_t_6 = PyFloat_FromDouble(__pyx_v_self->x0_B); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 258, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_self->y0_B); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 258, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_8 = PyFloat_FromDouble(__pyx_v_x_t); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 258, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_y_t); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 258, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = NULL;
      __pyx_t_22 = 0;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_22 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[8] = {__pyx_t_4, __pyx_t_26, __pyx_t_24, __pyx_t_23, __pyx_t_6, __pyx_t_3, __pyx_t_8, __pyx_t_5};
        __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_22, 7+__pyx_t_22); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 258, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_26); __pyx_t_26 = 0;
        __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
        __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[8] = {__pyx_t_4, __pyx_t_26, __pyx_t_24, __pyx_t_23, __pyx_t_6, __pyx_t_3, __pyx_t_8, __pyx_t_5};
        __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_22, 7+__pyx_t_22); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 258, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_26); __pyx_t_26 = 0;
        __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
        __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      } else
      #endif
      {
        __pyx_t_25 = PyTuple_New(7+__pyx_t_22); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 258, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_25);
        if (__pyx_t_4) {
          __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_25, 0, __pyx_t_4); __pyx_t_4 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_26);
        PyTuple_SET_ITEM(__pyx_t_25, 0+__pyx_t_22, __pyx_t_26);
        __Pyx_GIVEREF(__pyx_t_24);
        PyTuple_SET_ITEM(__pyx_t_25, 1+__pyx_t_22, __pyx_t_24);
        __Pyx_GIVEREF(__pyx_t_23);
        PyTuple_SET_ITEM(__pyx_t_25, 2+__pyx_t_22, __pyx_t_23);
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_25, 3+__pyx_t_22, __pyx_t_6);
        __Pyx_GIVEREF(__pyx_t_3);
        PyTuple_SET_ITEM(__pyx_t_25, 4+__pyx_t_22, __pyx_t_3);
        __Pyx_GIVEREF(__pyx_t_8);
        PyTuple_SET_ITEM(__pyx_t_25, 5+__pyx_t_22, __pyx_t_8);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_25, 6+__pyx_t_22, __pyx_t_5);
        __pyx_t_26 = 0;
        __pyx_t_24 = 0;
        __pyx_t_23 = 0;
        __pyx_t_6 = 0;
        __pyx_t_3 = 0;
        __pyx_t_8 = 0;
        __pyx_t_5 = 0;
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_25, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 258, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_25); __pyx_t_25 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_13 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_13 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 258, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_v_ell_tB = __pyx_t_13;

      /* "vcstring.pyx":259
 *                 ell_tA = elliptical(self.ra_A, self.rb_A, self.alpha_A, self.x0_A, self.y0_A, x_t, y_t)
 *                 ell_tB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_t, y_t)
 *                 ell_tauA = elliptical(self.ra_A, self.rb_A, self.alpha_A, self.x0_A, self.y0_A, x_tau, y_tau)             # <<<<<<<<<<<<<<
 *                 ell_tauB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_tau, y_tau)
 *                 if ell_tA > 1.0 and ell_tB > 1.0:  # Intermediate state
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_elliptical); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_25 = PyFloat_FromDouble(__pyx_v_self->ra_A); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 259, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_25);
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_self->rb_A); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 259, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_8 = PyFloat_FromDouble(__pyx_v_self->alpha_A); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 259, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_self->x0_A); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 259, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_6 = PyFloat_FromDouble(__pyx_v_self->y0_A); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 259, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      if (unlikely(!__pyx_v_y_tau)) { __Pyx_RaiseUnboundLocalError("y_tau"); __PYX_ERR(0, 259, __pyx_L1_error) }
      __pyx_t_23 = NULL;
      __pyx_t_22 = 0;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_23 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_23)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_23);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_22 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[8] = {__pyx_t_23, __pyx_t_25, __pyx_t_5, __pyx_t_8, __pyx_t_3, __pyx_t_6, __pyx_v_x_tau, __pyx_v_y_tau};
        __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_22, 7+__pyx_t_22); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 259, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_23); __pyx_t_23 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_25); __pyx_t_25 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[8] = {__pyx_t_23, __pyx_t_25, __pyx_t_5, __pyx_t_8, __pyx_t_3, __pyx_t_6, __pyx_v_x_tau, __pyx_v_y_tau};
        __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_22, 7+__pyx_t_22); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 259, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_23); __pyx_t_23 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_25); __pyx_t_25 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      {
        __pyx_t_24 = PyTuple_New(7+__pyx_t_22); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 259, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_24);
        if (__pyx_t_23) {
          __Pyx_GIVEREF(__pyx_t_23); PyTuple_SET_ITEM(__pyx_t_24, 0, __pyx_t_23); __pyx_t_23 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_25);
        PyTuple_SET_ITEM(__pyx_t_24, 0+__pyx_t_22, __pyx_t_25);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_24, 1+__pyx_t_22, __pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_8);
        PyTuple_SET_ITEM(__pyx_t_24, 2+__pyx_t_22, __pyx_t_8);
        __Pyx_GIVEREF(__pyx_t_3);
        PyTuple_SET_ITEM(__pyx_t_24, 3+__pyx_t_22, __pyx_t_3);
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_24, 4+__pyx_t_22, __pyx_t_6);
        __Pyx_INCREF(__pyx_v_x_tau);
        __Pyx_GIVEREF(__pyx_v_x_tau);
        PyTuple_SET_ITEM(__pyx_t_24, 5+__pyx_t_22, __pyx_v_x_tau);
        __Pyx_INCREF(__pyx_v_y_tau);
        __Pyx_GIVEREF(__pyx_v_y_tau);
        PyTuple_SET_ITEM(__pyx_t_24, 6+__pyx_t_22, __pyx_v_y_tau);
        __pyx_t_25 = 0;
        __pyx_t_5 = 0;
        __pyx_t_8 = 0;
        __pyx_t_3 = 0;
        __pyx_t_6 = 0;
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_24, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 259, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_13 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_13 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 259, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_v_ell_tauA = __pyx_t_13;

      /* "vcstring.pyx":260
 *                 ell_tB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_t, y_t)
 *                 ell_tauA = elliptical(self.ra_A, self.rb_A, self.alpha_A, self.x0_A, self.y0_A, x_tau, y_tau)
 *                 ell_tauB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_tau, y_tau)             # <<<<<<<<<<<<<<
 *                 if ell_tA > 1.0 and ell_tB > 1.0:  # Intermediate state
 *                     h_I0 = 1.0
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_elliptical); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 260, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_24 = PyFloat_FromDouble(__pyx_v_self->ra_B); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 260, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_24);
      __pyx_t_6 = PyFloat_FromDouble(__pyx_v_self->rb_B); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 260, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_self->alpha_B); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 260, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_8 = PyFloat_FromDouble(__pyx_v_self->x0_B); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 260, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_self->y0_B); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 260, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      if (unlikely(!__pyx_v_y_tau)) { __Pyx_RaiseUnboundLocalError("y_tau"); __PYX_ERR(0, 260, __pyx_L1_error) }
      __pyx_t_25 = NULL;
      __pyx_t_22 = 0;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_25 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_25)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_25);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_22 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[8] = {__pyx_t_25, __pyx_t_24, __pyx_t_6, __pyx_t_3, __pyx_t_8, __pyx_t_5, __pyx_v_x_tau, __pyx_v_y_tau};
        __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_22, 7+__pyx_t_22); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 260, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_25); __pyx_t_25 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[8] = {__pyx_t_25, __pyx_t_24, __pyx_t_6, __pyx_t_3, __pyx_t_8, __pyx_t_5, __pyx_v_x_tau, __pyx_v_y_tau};
        __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_22, 7+__pyx_t_22); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 260, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_25); __pyx_t_25 = 0;
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      } else
      #endif
      {
        __pyx_t_23 = PyTuple_New(7+__pyx_t_22); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 260, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_23);
        if (__pyx_t_25) {
          __Pyx_GIVEREF(__pyx_t_25); PyTuple_SET_ITEM(__pyx_t_23, 0, __pyx_t_25); __pyx_t_25 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_24);
        PyTuple_SET_ITEM(__pyx_t_23, 0+__pyx_t_22, __pyx_t_24);
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_23, 1+__pyx_t_22, __pyx_t_6);
        __Pyx_GIVEREF(__pyx_t_3);
        PyTuple_SET_ITEM(__pyx_t_23, 2+__pyx_t_22, __pyx_t_3);
        __Pyx_GIVEREF(__pyx_t_8);
        PyTuple_SET_ITEM(__pyx_t_23, 3+__pyx_t_22, __pyx_t_8);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_23, 4+__pyx_t_22, __pyx_t_5);
        __Pyx_INCREF(__pyx_v_x_tau);
        __Pyx_GIVEREF(__pyx_v_x_tau);
        PyTuple_SET_ITEM(__pyx_t_23, 5+__pyx_t_22, __pyx_v_x_tau);
        __Pyx_INCREF(__pyx_v_y_tau);
        __Pyx_GIVEREF(__pyx_v_y_tau);
        PyTuple_SET_ITEM(__pyx_t_23, 6+__pyx_t_22, __pyx_v_y_tau);
        __pyx_t_24 = 0;
        __pyx_t_6 = 0;
        __pyx_t_3 = 0;
        __pyx_t_8 = 0;
        __pyx_t_5 = 0;
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_23, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 260, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_13 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_13 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 260, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_v_ell_tauB = __pyx_t_13;

      /* "vcstring.pyx":261
 *                 ell_tauA = elliptical(self.ra_A, self.rb_A, self.alpha_A, self.x0_A, self.y0_A, x_tau, y_tau)
 *                 ell_tauB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_tau, y_tau)
 *                 if ell_tA > 1.0 and ell_tB > 1.0:  # Intermediate state             # <<<<<<<<<<<<<<
 *                     h_I0 = 1.0
 *                 elif ell_tB <= 1.0:  # State B
 */
      __pyx_t_10 = ((__pyx_v_ell_tA > 1.0) != 0);
      if (__pyx_t_10) {
      } else {
        __pyx_t_9 = __pyx_t_10;
        goto __pyx_L51_bool_binop_done;
      }
      __pyx_t_10 = ((__pyx_v_ell_tB > 1.0) != 0);
      __pyx_t_9 = __pyx_t_10;
      __pyx_L51_bool_binop_done:;
      if (__pyx_t_9) {

        /* "vcstring.pyx":262
 *                 ell_tauB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_tau, y_tau)
 *                 if ell_tA > 1.0 and ell_tB > 1.0:  # Intermediate state
 *                     h_I0 = 1.0             # <<<<<<<<<<<<<<
 *                 elif ell_tB <= 1.0:  # State B
 *                     h_B0 = 1.0
 */
        __pyx_v_h_I0 = 1.0;

        /* "vcstring.pyx":261
 *                 ell_tauA = elliptical(self.ra_A, self.rb_A, self.alpha_A, self.x0_A, self.y0_A, x_tau, y_tau)
 *                 ell_tauB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_tau, y_tau)
 *                 if ell_tA > 1.0 and ell_tB > 1.0:  # Intermediate state             # <<<<<<<<<<<<<<
 *                     h_I0 = 1.0
 *                 elif ell_tB <= 1.0:  # State B
 */
        goto __pyx_L50;
      }

      /* "vcstring.pyx":263
 *                 if ell_tA > 1.0 and ell_tB > 1.0:  # Intermediate state
 *                     h_I0 = 1.0
 *                 elif ell_tB <= 1.0:  # State B             # <<<<<<<<<<<<<<
 *                     h_B0 = 1.0
 *                 if ell_tauA > 1.0 and ell_tauB > 1.0:  # Intermediate state
 */
      __pyx_t_9 = ((__pyx_v_ell_tB <= 1.0) != 0);
      if (__pyx_t_9) {

        /* "vcstring.pyx":264
 *                     h_I0 = 1.0
 *                 elif ell_tB <= 1.0:  # State B
 *                     h_B0 = 1.0             # <<<<<<<<<<<<<<
 *                 if ell_tauA > 1.0 and ell_tauB > 1.0:  # Intermediate state
 *                     h_Itau = 1.0
 */
        __pyx_v_h_B0 = 1.0;

        /* "vcstring.pyx":263
 *                 if ell_tA > 1.0 and ell_tB > 1.0:  # Intermediate state
 *                     h_I0 = 1.0
 *                 elif ell_tB <= 1.0:  # State B             # <<<<<<<<<<<<<<
 *                     h_B0 = 1.0
 *                 if ell_tauA > 1.0 and ell_tauB > 1.0:  # Intermediate state
 */
      }
      __pyx_L50:;

      /* "vcstring.pyx":265
 *                 elif ell_tB <= 1.0:  # State B
 *                     h_B0 = 1.0
 *                 if ell_tauA > 1.0 and ell_tauB > 1.0:  # Intermediate state             # <<<<<<<<<<<<<<
 *                     h_Itau = 1.0
 *                 elif ell_tauB <= 1.0:  # State B
 */
      __pyx_t_10 = ((__pyx_v_ell_tauA > 1.0) != 0);
      if (__pyx_t_10) {
      } else {
        __pyx_t_9 = __pyx_t_10;
        goto __pyx_L54_bool_binop_done;
      }
      __pyx_t_10 = ((__pyx_v_ell_tauB > 1.0) != 0);
      __pyx_t_9 = __pyx_t_10;
      __pyx_L54_bool_binop_done:;
      if (__pyx_t_9) {

        /* "vcstring.pyx":266
 *                     h_B0 = 1.0
 *                 if ell_tauA > 1.0 and ell_tauB > 1.0:  # Intermediate state
 *                     h_Itau = 1.0             # <<<<<<<<<<<<<<
 *                 elif ell_tauB <= 1.0:  # State B
 *                     h_Btau = 1.0
 */
        __pyx_v_h_Itau = 1.0;

        /* "vcstring.pyx":265
 *                 elif ell_tB <= 1.0:  # State B
 *                     h_B0 = 1.0
 *                 if ell_tauA > 1.0 and ell_tauB > 1.0:  # Intermediate state             # <<<<<<<<<<<<<<
 *                     h_Itau = 1.0
 *                 elif ell_tauB <= 1.0:  # State B
 */
        goto __pyx_L53;
      }

      /* "vcstring.pyx":267
 *                 if ell_tauA > 1.0 and ell_tauB > 1.0:  # Intermediate state
 *                     h_Itau = 1.0
 *                 elif ell_tauB <= 1.0:  # State B             # <<<<<<<<<<<<<<
 *                     h_Btau = 1.0
 * 
 */
      __pyx_t_9 = ((__pyx_v_ell_tauB <= 1.0) != 0);
      if (__pyx_t_9) {

        /* "vcstring.pyx":268
 *                     h_Itau = 1.0
 *                 elif ell_tauB <= 1.0:  # State B
 *                     h_Btau = 1.0             # <<<<<<<<<<<<<<
 * 
 *             # Append ID assignments for each trajectory
 */
        __pyx_v_h_Btau = 1.0;

        /* "vcstring.pyx":267
 *                 if ell_tauA > 1.0 and ell_tauB > 1.0:  # Intermediate state
 *                     h_Itau = 1.0
 *                 elif ell_tauB <= 1.0:  # State B             # <<<<<<<<<<<<<<
 *                     h_Btau = 1.0
 * 
 */
      }
      __pyx_L53:;

      /* "vcstring.pyx":255
 * 
 *             # Fits rotated ellipses to the well minima to define states A, B
 *             elif self.state_assignment == 'ellipse':             # <<<<<<<<<<<<<<
 *                 # Value of fitted ellipse at point (x_t, y_t) or (x_tau, y_tau)
 *                 ell_tA = elliptical(self.ra_A, self.rb_A, self.alpha_A, self.x0_A, self.y0_A, x_t, y_t)
 */
    }
    __pyx_L37:;

    /* "vcstring.pyx":272
 *             # Append ID assignments for each trajectory
 *             # h_I0(0), h_B(0), h_I0(tau), h_B(tau), Voronoi index, x(0), y(0), x(tau), y(tau)
 *             if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                 ids.append([h_I0, h_B0, h_Itau, h_Btau, nc_t, nc_tau, x_t, x_tau, weights[count]])
 *             elif self.state_assignment == 'orthogonal_proj_t, nc_tauection':
 */
    __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_kp_u_1d, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 272, __pyx_L1_error)
    __pyx_t_10 = (__pyx_t_9 != 0);
    if (__pyx_t_10) {

      /* "vcstring.pyx":273
 *             # h_I0(0), h_B(0), h_I0(tau), h_B(tau), Voronoi index, x(0), y(0), x(tau), y(tau)
 *             if self.state_assignment == '1d':
 *                 ids.append([h_I0, h_B0, h_Itau, h_Btau, nc_t, nc_tau, x_t, x_tau, weights[count]])             # <<<<<<<<<<<<<<
 *             elif self.state_assignment == 'orthogonal_proj_t, nc_tauection':
 *                 ids.append([h_I0, h_B0, h_Itau, h_Btau, nc_t, nc_tau, x_t, y_t, x_tau, y_tau, weights[count]])
 */
      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_h_I0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 273, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_h_B0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 273, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_23 = PyFloat_FromDouble(__pyx_v_h_Itau); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 273, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_23);
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_h_Btau); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 273, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_8 = PyFloat_FromDouble(__pyx_v_x_t); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 273, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      if (unlikely(__pyx_v_weights == Py_None)) {
        PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
        __PYX_ERR(0, 273, __pyx_L1_error)
      }
      __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_weights, __pyx_v_count); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 273, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_6 = PyList_New(9); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 273, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_GIVEREF(__pyx_t_2);
      PyList_SET_ITEM(__pyx_t_6, 0, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_1);
      PyList_SET_ITEM(__pyx_t_6, 1, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_23);
      PyList_SET_ITEM(__pyx_t_6, 2, __pyx_t_23);
      __Pyx_GIVEREF(__pyx_t_5);
      PyList_SET_ITEM(__pyx_t_6, 3, __pyx_t_5);
      __Pyx_INCREF(__pyx_v_nc_t);
      __Pyx_GIVEREF(__pyx_v_nc_t);
      PyList_SET_ITEM(__pyx_t_6, 4, __pyx_v_nc_t);
      __Pyx_INCREF(__pyx_v_nc_tau);
      __Pyx_GIVEREF(__pyx_v_nc_tau);
      PyList_SET_ITEM(__pyx_t_6, 5, __pyx_v_nc_tau);
      __Pyx_GIVEREF(__pyx_t_8);
      PyList_SET_ITEM(__pyx_t_6, 6, __pyx_t_8);
      __Pyx_INCREF(__pyx_v_x_tau);
      __Pyx_GIVEREF(__pyx_v_x_tau);
      PyList_SET_ITEM(__pyx_t_6, 7, __pyx_v_x_tau);
      __Pyx_GIVEREF(__pyx_t_3);
      PyList_SET_ITEM(__pyx_t_6, 8, __pyx_t_3);
      __pyx_t_2 = 0;
      __pyx_t_1 = 0;
      __pyx_t_23 = 0;
      __pyx_t_5 = 0;
      __pyx_t_8 = 0;
      __pyx_t_3 = 0;
      __pyx_t_27 = __Pyx_PyObject_Append(__pyx_v_ids, __pyx_t_6); if (unlikely(__pyx_t_27 == ((int)-1))) __PYX_ERR(0, 273, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

      /* "vcstring.pyx":272
 *             # Append ID assignments for each trajectory
 *             # h_I0(0), h_B(0), h_I0(tau), h_B(tau), Voronoi index, x(0), y(0), x(tau), y(tau)
 *             if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                 ids.append([h_I0, h_B0, h_Itau, h_Btau, nc_t, nc_tau, x_t, x_tau, weights[count]])
 *             elif self.state_assignment == 'orthogonal_proj_t, nc_tauection':
 */
      goto __pyx_L56;
    }

    /* "vcstring.pyx":274
 *             if self.state_assignment == '1d':
 *                 ids.append([h_I0, h_B0, h_Itau, h_Btau, nc_t, nc_tau, x_t, x_tau, weights[count]])
 *             elif self.state_assignment == 'orthogonal_proj_t, nc_tauection':             # <<<<<<<<<<<<<<
 *                 ids.append([h_I0, h_B0, h_Itau, h_Btau, nc_t, nc_tau, x_t, y_t, x_tau, y_tau, weights[count]])
 *             elif self.state_assignment == 'ellipse':
 */
    __pyx_t_10 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_kp_u_orthogonal_proj_t_nc_tauection, Py_EQ)); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 274, __pyx_L1_error)
    __pyx_t_9 = (__pyx_t_10 != 0);
    if (__pyx_t_9) {

      /* "vcstring.pyx":275
 *                 ids.append([h_I0, h_B0, h_Itau, h_Btau, nc_t, nc_tau, x_t, x_tau, weights[count]])
 *             elif self.state_assignment == 'orthogonal_proj_t, nc_tauection':
 *                 ids.append([h_I0, h_B0, h_Itau, h_Btau, nc_t, nc_tau, x_t, y_t, x_tau, y_tau, weights[count]])             # <<<<<<<<<<<<<<
 *             elif self.state_assignment == 'ellipse':
 *                 ids.append([h_I0, h_B0, h_Itau, h_Btau, nc_t, nc_tau, x_t, y_t, x_tau, y_tau, weights[count], ell_tA, ell_tB])
 */
      __pyx_t_6 = PyFloat_FromDouble(__pyx_v_h_I0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 275, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_h_B0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 275, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_8 = PyFloat_FromDouble(__pyx_v_h_Itau); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 275, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_h_Btau); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 275, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_23 = PyFloat_FromDouble(__pyx_v_x_t); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 275, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_23);
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_y_t); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 275, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (unlikely(!__pyx_v_y_tau)) { __Pyx_RaiseUnboundLocalError("y_tau"); __PYX_ERR(0, 275, __pyx_L1_error) }
      if (unlikely(__pyx_v_weights == Py_None)) {
        PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
        __PYX_ERR(0, 275, __pyx_L1_error)
      }
      __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_weights, __pyx_v_count); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 275, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_24 = PyList_New(11); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 275, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_24);
      __Pyx_GIVEREF(__pyx_t_6);
      PyList_SET_ITEM(__pyx_t_24, 0, __pyx_t_6);
      __Pyx_GIVEREF(__pyx_t_3);
      PyList_SET_ITEM(__pyx_t_24, 1, __pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_8);
      PyList_SET_ITEM(__pyx_t_24, 2, __pyx_t_8);
      __Pyx_GIVEREF(__pyx_t_5);
      PyList_SET_ITEM(__pyx_t_24, 3, __pyx_t_5);
      __Pyx_INCREF(__pyx_v_nc_t);
      __Pyx_GIVEREF(__pyx_v_nc_t);
      PyList_SET_ITEM(__pyx_t_24, 4, __pyx_v_nc_t);
      __Pyx_INCREF(__pyx_v_nc_tau);
      __Pyx_GIVEREF(__pyx_v_nc_tau);
      PyList_SET_ITEM(__pyx_t_24, 5, __pyx_v_nc_tau);
      __Pyx_GIVEREF(__pyx_t_23);
      PyList_SET_ITEM(__pyx_t_24, 6, __pyx_t_23);
      __Pyx_GIVEREF(__pyx_t_1);
      PyList_SET_ITEM(__pyx_t_24, 7, __pyx_t_1);
      __Pyx_INCREF(__pyx_v_x_tau);
      __Pyx_GIVEREF(__pyx_v_x_tau);
      PyList_SET_ITEM(__pyx_t_24, 8, __pyx_v_x_tau);
      __Pyx_INCREF(__pyx_v_y_tau);
      __Pyx_GIVEREF(__pyx_v_y_tau);
      PyList_SET_ITEM(__pyx_t_24, 9, __pyx_v_y_tau);
      __Pyx_GIVEREF(__pyx_t_2);
      PyList_SET_ITEM(__pyx_t_24, 10, __pyx_t_2);
      __pyx_t_6 = 0;
      __pyx_t_3 = 0;
      __pyx_t_8 = 0;
      __pyx_t_5 = 0;
      __pyx_t_23 = 0;
      __pyx_t_1 = 0;
      __pyx_t_2 = 0;
      __pyx_t_27 = __Pyx_PyObject_Append(__pyx_v_ids, __pyx_t_24); if (unlikely(__pyx_t_27 == ((int)-1))) __PYX_ERR(0, 275, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;

      /* "vcstring.pyx":274
 *             if self.state_assignment == '1d':
 *                 ids.append([h_I0, h_B0, h_Itau, h_Btau, nc_t, nc_tau, x_t, x_tau, weights[count]])
 *             elif self.state_assignment == 'orthogonal_proj_t, nc_tauection':             # <<<<<<<<<<<<<<
 *                 ids.append([h_I0, h_B0, h_Itau, h_Btau, nc_t, nc_tau, x_t, y_t, x_tau, y_tau, weights[count]])
 *             elif self.state_assignment == 'ellipse':
 */
      goto __pyx_L56;
    }

    /* "vcstring.pyx":276
 *             elif self.state_assignment == 'orthogonal_proj_t, nc_tauection':
 *                 ids.append([h_I0, h_B0, h_Itau, h_Btau, nc_t, nc_tau, x_t, y_t, x_tau, y_tau, weights[count]])
 *             elif self.state_assignment == 'ellipse':             # <<<<<<<<<<<<<<
 *                 ids.append([h_I0, h_B0, h_Itau, h_Btau, nc_t, nc_tau, x_t, y_t, x_tau, y_tau, weights[count], ell_tA, ell_tB])
 *             else:
 */
    __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_n_u_ellipse, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 276, __pyx_L1_error)
    __pyx_t_10 = (__pyx_t_9 != 0);
    if (likely(__pyx_t_10)) {

      /* "vcstring.pyx":277
 *                 ids.append([h_I0, h_B0, h_Itau, h_Btau, nc_t, nc_tau, x_t, y_t, x_tau, y_tau, weights[count]])
 *             elif self.state_assignment == 'ellipse':
 *                 ids.append([h_I0, h_B0, h_Itau, h_Btau, nc_t, nc_tau, x_t, y_t, x_tau, y_tau, weights[count], ell_tA, ell_tB])             # <<<<<<<<<<<<<<
 *             else:
 *                 raise TypeError('Incorrect state assignment. Chosen state_assignment method is not available.')
 */
      __pyx_t_24 = PyFloat_FromDouble(__pyx_v_h_I0); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 277, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_24);
      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_h_B0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 277, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_h_Itau); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 277, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_23 = PyFloat_FromDouble(__pyx_v_h_Btau); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 277, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_23);
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_x_t); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 277, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_8 = PyFloat_FromDouble(__pyx_v_y_t); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 277, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      if (unlikely(!__pyx_v_y_tau)) { __Pyx_RaiseUnboundLocalError("y_tau"); __PYX_ERR(0, 277, __pyx_L1_error) }
      if (unlikely(__pyx_v_weights == Py_None)) {
        PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
        __PYX_ERR(0, 277, __pyx_L1_error)
      }
      __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_weights, __pyx_v_count); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 277, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_6 = PyFloat_FromDouble(__pyx_v_ell_tA); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 277, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_25 = PyFloat_FromDouble(__pyx_v_ell_tB); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 277, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_25);
      __pyx_t_26 = PyList_New(13); if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 277, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_26);
      __Pyx_GIVEREF(__pyx_t_24);
      PyList_SET_ITEM(__pyx_t_26, 0, __pyx_t_24);
      __Pyx_GIVEREF(__pyx_t_2);
      PyList_SET_ITEM(__pyx_t_26, 1, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_1);
      PyList_SET_ITEM(__pyx_t_26, 2, __pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_23);
      PyList_SET_ITEM(__pyx_t_26, 3, __pyx_t_23);
      __Pyx_INCREF(__pyx_v_nc_t);
      __Pyx_GIVEREF(__pyx_v_nc_t);
      PyList_SET_ITEM(__pyx_t_26, 4, __pyx_v_nc_t);
      __Pyx_INCREF(__pyx_v_nc_tau);
      __Pyx_GIVEREF(__pyx_v_nc_tau);
      PyList_SET_ITEM(__pyx_t_26, 5, __pyx_v_nc_tau);
      __Pyx_GIVEREF(__pyx_t_5);
      PyList_SET_ITEM(__pyx_t_26, 6, __pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_8);
      PyList_SET_ITEM(__pyx_t_26, 7, __pyx_t_8);
      __Pyx_INCREF(__pyx_v_x_tau);
      __Pyx_GIVEREF(__pyx_v_x_tau);
      PyList_SET_ITEM(__pyx_t_26, 8, __pyx_v_x_tau);
      __Pyx_INCREF(__pyx_v_y_tau);
      __Pyx_GIVEREF(__pyx_v_y_tau);
      PyList_SET_ITEM(__pyx_t_26, 9, __pyx_v_y_tau);
      __Pyx_GIVEREF(__pyx_t_3);
      PyList_SET_ITEM(__pyx_t_26, 10, __pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_6);
      PyList_SET_ITEM(__pyx_t_26, 11, __pyx_t_6);
      __Pyx_GIVEREF(__pyx_t_25);
      PyList_SET_ITEM(__pyx_t_26, 12, __pyx_t_25);
      __pyx_t_24 = 0;
      __pyx_t_2 = 0;
      __pyx_t_1 = 0;
      __pyx_t_23 = 0;
      __pyx_t_5 = 0;
      __pyx_t_8 = 0;
      __pyx_t_3 = 0;
      __pyx_t_6 = 0;
      __pyx_t_25 = 0;
      __pyx_t_27 = __Pyx_PyObject_Append(__pyx_v_ids, __pyx_t_26); if (unlikely(__pyx_t_27 == ((int)-1))) __PYX_ERR(0, 277, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_26); __pyx_t_26 = 0;

      /* "vcstring.pyx":276
 *             elif self.state_assignment == 'orthogonal_proj_t, nc_tauection':
 *                 ids.append([h_I0, h_B0, h_Itau, h_Btau, nc_t, nc_tau, x_t, y_t, x_tau, y_tau, weights[count]])
 *             elif self.state_assignment == 'ellipse':             # <<<<<<<<<<<<<<
 *                 ids.append([h_I0, h_B0, h_Itau, h_Btau, nc_t, nc_tau, x_t, y_t, x_tau, y_tau, weights[count], ell_tA, ell_tB])
 *             else:
 */
      goto __pyx_L56;
    }

    /* "vcstring.pyx":279
 *                 ids.append([h_I0, h_B0, h_Itau, h_Btau, nc_t, nc_tau, x_t, y_t, x_tau, y_tau, weights[count], ell_tA, ell_tB])
 *             else:
 *                 raise TypeError('Incorrect state assignment. Chosen state_assignment method is not available.')             # <<<<<<<<<<<<<<
 *             count += 1
 *         ids = np.asarray(ids)
 */
    /*else*/ {
      __pyx_t_26 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__13, NULL); if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 279, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_26);
      __Pyx_Raise(__pyx_t_26, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_26); __pyx_t_26 = 0;
      __PYX_ERR(0, 279, __pyx_L1_error)
    }
    __pyx_L56:;

    /* "vcstring.pyx":280
 *             else:
 *                 raise TypeError('Incorrect state assignment. Chosen state_assignment method is not available.')
 *             count += 1             # <<<<<<<<<<<<<<
 *         ids = np.asarray(ids)
 *         print('Voronoi assignment completed')
 */
    __pyx_t_26 = __Pyx_PyInt_AddObjC(__pyx_v_count, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 280, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_26);
    __Pyx_DECREF_SET(__pyx_v_count, __pyx_t_26);
    __pyx_t_26 = 0;
  }

  /* "vcstring.pyx":281
 *                 raise TypeError('Incorrect state assignment. Chosen state_assignment method is not available.')
 *             count += 1
 *         ids = np.asarray(ids)             # <<<<<<<<<<<<<<
 *         print('Voronoi assignment completed')
 *         return ids
 */
  __Pyx_GetModuleGlobalName(__pyx_t_25, __pyx_n_s_np); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 281, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_25);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_25, __pyx_n_s_asarray); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 281, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_25); __pyx_t_25 = 0;
  __pyx_t_25 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_25 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_25)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_25);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
    }
  }
  __pyx_t_26 = (__pyx_t_25) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_25, __pyx_v_ids) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_ids);
  __Pyx_XDECREF(__pyx_t_25); __pyx_t_25 = 0;
  if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 281, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_26);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF_SET(__pyx_v_ids, __pyx_t_26);
  __pyx_t_26 = 0;

  /* "vcstring.pyx":282
 *             count += 1
 *         ids = np.asarray(ids)
 *         print('Voronoi assignment completed')             # <<<<<<<<<<<<<<
 *         return ids
 * 
 */
  __pyx_t_26 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__14, NULL); if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 282, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_26);
  __Pyx_DECREF(__pyx_t_26); __pyx_t_26 = 0;

  /* "vcstring.pyx":283
 *         ids = np.asarray(ids)
 *         print('Voronoi assignment completed')
 *         return ids             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_ids);
  __pyx_r = __pyx_v_ids;
  goto __pyx_L0;

  /* "vcstring.pyx":161
 * 
 * 
 *     cpdef assign_states_ensemble(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, int t0=0, list weights=None, stride=None):             # <<<<<<<<<<<<<<
 *         """
 *         Assign points to Voronoi cells for ensemble of aggregate trajectories.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_23);
  __Pyx_XDECREF(__pyx_t_24);
  __Pyx_XDECREF(__pyx_t_25);
  __Pyx_XDECREF(__pyx_t_26);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.assign_states_ensemble", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XDECREF((PyObject *)__pyx_v_xcenters);
  __Pyx_XDECREF((PyObject *)__pyx_v_ycenters);
  __Pyx_XDECREF(__pyx_v_ids);
  __Pyx_XDECREF(__pyx_v_count);
  __Pyx_XDECREF(__pyx_v_x_tau);
  __Pyx_XDECREF(__pyx_v_dist_t);
  __Pyx_XDECREF(__pyx_v_dist_tau);
  __Pyx_XDECREF(__pyx_v_y_tau);
  __Pyx_XDECREF(__pyx_v_nc_t);
  __Pyx_XDECREF(__pyx_v_nc_tau);
  __Pyx_XDECREF(__pyx_v_u_tau);
  __Pyx_XDECREF(__pyx_8genexpr2__pyx_v_row);
  __Pyx_XDECREF(__pyx_8genexpr3__pyx_v_row);
  __Pyx_XDECREF(__pyx_8genexpr4__pyx_v_row);
  __Pyx_XDECREF(__pyx_8genexpr5__pyx_v_row);
  __Pyx_XDECREF(__pyx_v_weights);
  __Pyx_XDECREF(__pyx_v_stride);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_9assign_states_ensemble(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8vcstring_8vcstring_8assign_states_ensemble[] = "\n        Assign points to Voronoi cells for ensemble of aggregate trajectories.\n        ";
static PyObject *__pyx_pw_8vcstring_8vcstring_9assign_states_ensemble(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_traj = 0;
  int __pyx_v_tau;
  PyArrayObject *__pyx_v_z = 0;
  int __pyx_v_t0;
  PyObject *__pyx_v_weights = 0;
  PyObject *__pyx_v_stride = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("assign_states_ensemble (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_traj,&__pyx_n_s_tau,&__pyx_n_s_z,&__pyx_n_s_t0,&__pyx_n_s_weights,&__pyx_n_s_stride,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    values[4] = ((PyObject*)Py_None);
    values[5] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_traj)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tau)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("assign_states_ensemble", 0, 3, 6, 1); __PYX_ERR(0, 161, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("assign_states_ensemble", 0, 3, 6, 2); __PYX_ERR(0, 161, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_t0);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weights);
          if (value) { values[4] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_stride);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "assign_states_ensemble") < 0)) __PYX_ERR(0, 161, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_traj = ((PyObject*)values[0]);
    __pyx_v_tau = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_tau == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 161, __pyx_L3_error)
    __pyx_v_z = ((PyArrayObject *)values[2]);
    if (values[3]) {
      __pyx_v_t0 = __Pyx_PyInt_As_int(values[3]); if (unlikely((__pyx_v_t0 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 161, __pyx_L3_error)
    } else {
      __pyx_v_t0 = ((int)0);
    }
    __pyx_v_weights = ((PyObject*)values[4]);
    __pyx_v_stride = values[5];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("assign_states_ensemble", 0, 3, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 161, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.vcstring.assign_states_ensemble", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_traj), (&PyList_Type), 1, "traj", 1))) __PYX_ERR(0, 161, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_z), __pyx_ptype_5numpy_ndarray, 1, "z", 0))) __PYX_ERR(0, 161, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_weights), (&PyList_Type), 1, "weights", 1))) __PYX_ERR(0, 161, __pyx_L1_error)
  __pyx_r = __pyx_pf_8vcstring_8vcstring_8assign_states_ensemble(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self), __pyx_v_traj, __pyx_v_tau, __pyx_v_z, __pyx_v_t0, __pyx_v_weights, __pyx_v_stride);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_8assign_states_ensemble(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, int __pyx_v_t0, PyObject *__pyx_v_weights, PyObject *__pyx_v_stride) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  struct __pyx_opt_args_8vcstring_8vcstring_assign_states_ensemble __pyx_t_2;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("assign_states_ensemble", 0);
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 161, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2.__pyx_n = 3;
  __pyx_t_2.t0 = __pyx_v_t0;
  __pyx_t_2.weights = __pyx_v_weights;
  __pyx_t_2.stride = __pyx_v_stride;
  __pyx_t_1 = __pyx_vtabptr_8vcstring_vcstring->assign_states_ensemble(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, __pyx_v_z, 1, &__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 161, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.assign_states_ensemble", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":286
 * 
 * 
 *     cpdef calc_coeffs(self, int N, int tau, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=2] ids, symmetric=True):             # <<<<<<<<<<<<<<
 *         """
 *         Solve the linear equation from minimizing the forward steady-state flux.
 */

static PyObject *__pyx_pw_8vcstring_8vcstring_11calc_coeffs(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_coeffs(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_v_N, int __pyx_v_tau, CYTHON_UNUSED PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_ids, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs *__pyx_optional_args) {
  PyObject *__pyx_v_symmetric = ((PyObject *)Py_True);
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_t;
  PyArrayObject *__pyx_v_centroid = 0;
  PyObject *__pyx_v_D_0 = 0;
  PyObject *__pyx_v_D_tau = 0;
  PyObject *__pyx_v_g_0 = 0;
  PyObject *__pyx_v_g_tau = 0;
  double __pyx_v_val_g_0;
  double __pyx_v_val_g_tau;
  double __pyx_v_val_D_0;
  double __pyx_v_val_D_tau;
  double __pyx_v_f_i0;
  double __pyx_v_f_itau;
  double __pyx_v_f_j;
  double __pyx_v_h_I0;
  double __pyx_v_h_B0;
  double __pyx_v_h_Itau;
  double __pyx_v_h_Btau;
  PyArrayObject *__pyx_v_D_0_arr = 0;
  PyArrayObject *__pyx_v_D_tau_arr = 0;
  PyArrayObject *__pyx_v_D = 0;
  PyArrayObject *__pyx_v_g_0_arr = 0;
  PyArrayObject *__pyx_v_g_tau_arr = 0;
  PyArrayObject *__pyx_v_g = 0;
  PyArrayObject *__pyx_v_b = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D;
  __Pyx_Buffer __pyx_pybuffer_D;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_0_arr;
  __Pyx_Buffer __pyx_pybuffer_D_0_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_tau_arr;
  __Pyx_Buffer __pyx_pybuffer_D_tau_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_centroid;
  __Pyx_Buffer __pyx_pybuffer_centroid;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g;
  __Pyx_Buffer __pyx_pybuffer_g;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_0_arr;
  __Pyx_Buffer __pyx_pybuffer_g_0_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_tau_arr;
  __Pyx_Buffer __pyx_pybuffer_g_tau_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ids;
  __Pyx_Buffer __pyx_pybuffer_ids;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyArrayObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  int __pyx_t_13;
  int __pyx_t_14;
  double __pyx_t_15;
  double __pyx_t_16;
  int __pyx_t_17;
  int __pyx_t_18;
  int __pyx_t_19;
  int __pyx_t_20;
  int __pyx_t_21;
  int __pyx_t_22;
  double __pyx_t_23;
  int __pyx_t_24;
  Py_ssize_t __pyx_t_25;
  int __pyx_t_26;
  int __pyx_t_27;
  PyArrayObject *__pyx_t_28 = NULL;
  PyArrayObject *__pyx_t_29 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_coeffs", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args->__pyx_n > 0) {
      __pyx_v_symmetric = __pyx_optional_args->symmetric;
    }
  }
  __pyx_pybuffer_centroid.pybuffer.buf = NULL;
  __pyx_pybuffer_centroid.refcount = 0;
  __pyx_pybuffernd_centroid.data = NULL;
  __pyx_pybuffernd_centroid.rcbuffer = &__pyx_pybuffer_centroid;
  __pyx_pybuffer_D_0_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_D_0_arr.refcount = 0;
  __pyx_pybuffernd_D_0_arr.data = NULL;
  __pyx_pybuffernd_D_0_arr.rcbuffer = &__pyx_pybuffer_D_0_arr;
  __pyx_pybuffer_D_tau_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_D_tau_arr.refcount = 0;
  __pyx_pybuffernd_D_tau_arr.data = NULL;
  __pyx_pybuffernd_D_tau_arr.rcbuffer = &__pyx_pybuffer_D_tau_arr;
  __pyx_pybuffer_D.pybuffer.buf = NULL;
  __pyx_pybuffer_D.refcount = 0;
  __pyx_pybuffernd_D.data = NULL;
  __pyx_pybuffernd_D.rcbuffer = &__pyx_pybuffer_D;
  __pyx_pybuffer_g_0_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_g_0_arr.refcount = 0;
  __pyx_pybuffernd_g_0_arr.data = NULL;
  __pyx_pybuffernd_g_0_arr.rcbuffer = &__pyx_pybuffer_g_0_arr;
  __pyx_pybuffer_g_tau_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_g_tau_arr.refcount = 0;
  __pyx_pybuffernd_g_tau_arr.data = NULL;
  __pyx_pybuffernd_g_tau_arr.rcbuffer = &__pyx_pybuffer_g_tau_arr;
  __pyx_pybuffer_g.pybuffer.buf = NULL;
  __pyx_pybuffer_g.refcount = 0;
  __pyx_pybuffernd_g.data = NULL;
  __pyx_pybuffernd_g.rcbuffer = &__pyx_pybuffer_g;
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  __pyx_pybuffer_ids.pybuffer.buf = NULL;
  __pyx_pybuffer_ids.refcount = 0;
  __pyx_pybuffernd_ids.data = NULL;
  __pyx_pybuffernd_ids.rcbuffer = &__pyx_pybuffer_ids;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 286, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 286, __pyx_L1_error)
  }
  __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_calc_coeffs); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 286, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_8vcstring_8vcstring_11calc_coeffs)) {
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_N); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 286, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 286, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_5 = __pyx_t_1; __pyx_t_6 = NULL;
        __pyx_t_7 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
          __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
          if (likely(__pyx_t_6)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
            __Pyx_INCREF(__pyx_t_6);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_5, function);
            __pyx_t_7 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[6] = {__pyx_t_6, __pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_v_z), ((PyObject *)__pyx_v_ids), __pyx_v_symmetric};
          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 5+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 286, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[6] = {__pyx_t_6, __pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_v_z), ((PyObject *)__pyx_v_ids), __pyx_v_symmetric};
          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 5+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 286, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        } else
        #endif
        {
          __pyx_t_8 = PyTuple_New(5+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 286, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          if (__pyx_t_6) {
            __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
          }
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_4);
          PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_t_4);
          __Pyx_INCREF(((PyObject *)__pyx_v_z));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
          PyTuple_SET_ITEM(__pyx_t_8, 2+__pyx_t_7, ((PyObject *)__pyx_v_z));
          __Pyx_INCREF(((PyObject *)__pyx_v_ids));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_ids));
          PyTuple_SET_ITEM(__pyx_t_8, 3+__pyx_t_7, ((PyObject *)__pyx_v_ids));
          __Pyx_INCREF(__pyx_v_symmetric);
          __Pyx_GIVEREF(__pyx_v_symmetric);
          PyTuple_SET_ITEM(__pyx_t_8, 4+__pyx_t_7, __pyx_v_symmetric);
          __pyx_t_3 = 0;
          __pyx_t_4 = 0;
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 286, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        }
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }

  /* "vcstring.pyx":314
 *         cdef np.ndarray[DTYPE_t, ndim=1] g_0_arr, g_tau_arr, g, b
 * 
 *         print('\n======================================')             # <<<<<<<<<<<<<<
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')
 *         print('======================================')
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__21, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 314, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":315
 * 
 *         print('\n======================================')
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')             # <<<<<<<<<<<<<<
 *         print('======================================')
 *         print('lag time =', tau)
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__22, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 315, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":316
 *         print('\n======================================')
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')
 *         print('======================================')             # <<<<<<<<<<<<<<
 *         print('lag time =', tau)
 *         print('Symmetrization of D matrices:', symmetric)
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__24, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 316, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":317
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')
 *         print('======================================')
 *         print('lag time =', tau)             # <<<<<<<<<<<<<<
 *         print('Symmetrization of D matrices:', symmetric)
 *         centroid = ids[:, 2]  # Indices for Voronoi centroid assignment
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 317, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 317, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_lag_time);
  __Pyx_GIVEREF(__pyx_kp_u_lag_time);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_lag_time);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 317, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":318
 *         print('======================================')
 *         print('lag time =', tau)
 *         print('Symmetrization of D matrices:', symmetric)             # <<<<<<<<<<<<<<
 *         centroid = ids[:, 2]  # Indices for Voronoi centroid assignment
 *         D_0 = []
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 318, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_Symmetrization_of_D_matrices);
  __Pyx_GIVEREF(__pyx_kp_u_Symmetrization_of_D_matrices);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Symmetrization_of_D_matrices);
  __Pyx_INCREF(__pyx_v_symmetric);
  __Pyx_GIVEREF(__pyx_v_symmetric);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_symmetric);
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 318, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":319
 *         print('lag time =', tau)
 *         print('Symmetrization of D matrices:', symmetric)
 *         centroid = ids[:, 2]  # Indices for Voronoi centroid assignment             # <<<<<<<<<<<<<<
 *         D_0 = []
 *         D_tau = []
 */
  __pyx_t_2 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_ids), __pyx_tuple__25); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 319, __pyx_L1_error)
  __pyx_t_9 = ((PyArrayObject *)__pyx_t_2);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_centroid.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_centroid.rcbuffer->pybuffer, (PyObject*)__pyx_t_9, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_10, &__pyx_t_11, &__pyx_t_12);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_centroid.rcbuffer->pybuffer, (PyObject*)__pyx_v_centroid, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_12);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_10, __pyx_t_11, __pyx_t_12);
      }
      __pyx_t_10 = __pyx_t_11 = __pyx_t_12 = 0;
    }
    __pyx_pybuffernd_centroid.diminfo[0].strides = __pyx_pybuffernd_centroid.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_centroid.diminfo[0].shape = __pyx_pybuffernd_centroid.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 319, __pyx_L1_error)
  }
  __pyx_t_9 = 0;
  __pyx_v_centroid = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":320
 *         print('Symmetrization of D matrices:', symmetric)
 *         centroid = ids[:, 2]  # Indices for Voronoi centroid assignment
 *         D_0 = []             # <<<<<<<<<<<<<<
 *         D_tau = []
 *         g_0 = []
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 320, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_D_0 = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":321
 *         centroid = ids[:, 2]  # Indices for Voronoi centroid assignment
 *         D_0 = []
 *         D_tau = []             # <<<<<<<<<<<<<<
 *         g_0 = []
 *         g_tau = []
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 321, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_D_tau = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":322
 *         D_0 = []
 *         D_tau = []
 *         g_0 = []             # <<<<<<<<<<<<<<
 *         g_tau = []
 *         for i in range(self.num_basis):
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 322, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_g_0 = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":323
 *         D_tau = []
 *         g_0 = []
 *         g_tau = []             # <<<<<<<<<<<<<<
 *         for i in range(self.num_basis):
 *             val_g_0, val_g_tau = 0.0, 0.0
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 323, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_g_tau = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":324
 *         g_0 = []
 *         g_tau = []
 *         for i in range(self.num_basis):             # <<<<<<<<<<<<<<
 *             val_g_0, val_g_tau = 0.0, 0.0
 *             # test = []  # for testing
 */
  __pyx_t_7 = __pyx_v_self->num_basis;
  __pyx_t_13 = __pyx_t_7;
  for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
    __pyx_v_i = __pyx_t_14;

    /* "vcstring.pyx":325
 *         g_tau = []
 *         for i in range(self.num_basis):
 *             val_g_0, val_g_tau = 0.0, 0.0             # <<<<<<<<<<<<<<
 *             # test = []  # for testing
 *             for j in range(self.num_basis):
 */
    __pyx_t_15 = 0.0;
    __pyx_t_16 = 0.0;
    __pyx_v_val_g_0 = __pyx_t_15;
    __pyx_v_val_g_tau = __pyx_t_16;

    /* "vcstring.pyx":327
 *             val_g_0, val_g_tau = 0.0, 0.0
 *             # test = []  # for testing
 *             for j in range(self.num_basis):             # <<<<<<<<<<<<<<
 *                 print("Matrix elements", i, j)
 *                 sys.stdout.flush()
 */
    __pyx_t_17 = __pyx_v_self->num_basis;
    __pyx_t_18 = __pyx_t_17;
    for (__pyx_t_19 = 0; __pyx_t_19 < __pyx_t_18; __pyx_t_19+=1) {
      __pyx_v_j = __pyx_t_19;

      /* "vcstring.pyx":328
 *             # test = []  # for testing
 *             for j in range(self.num_basis):
 *                 print("Matrix elements", i, j)             # <<<<<<<<<<<<<<
 *                 sys.stdout.flush()
 *                 val_D_0, val_D_tau = 0.0, 0.0
 */
      __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 328, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_j); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 328, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 328, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_INCREF(__pyx_kp_u_Matrix_elements);
      __Pyx_GIVEREF(__pyx_kp_u_Matrix_elements);
      PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_kp_u_Matrix_elements);
      __Pyx_GIVEREF(__pyx_t_2);
      PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_t_1);
      __pyx_t_2 = 0;
      __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 328, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":329
 *             for j in range(self.num_basis):
 *                 print("Matrix elements", i, j)
 *                 sys.stdout.flush()             # <<<<<<<<<<<<<<
 *                 val_D_0, val_D_tau = 0.0, 0.0
 *                 for t in range(N-tau):
 */
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sys); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 329, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_stdout); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 329, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_flush); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 329, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_2)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_2);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
        }
      }
      __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 329, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":330
 *                 print("Matrix elements", i, j)
 *                 sys.stdout.flush()
 *                 val_D_0, val_D_tau = 0.0, 0.0             # <<<<<<<<<<<<<<
 *                 for t in range(N-tau):
 *                     f_i0, f_itau, f_j = 0.0, 0.0, 0.0
 */
      __pyx_t_16 = 0.0;
      __pyx_t_15 = 0.0;
      __pyx_v_val_D_0 = __pyx_t_16;
      __pyx_v_val_D_tau = __pyx_t_15;

      /* "vcstring.pyx":331
 *                 sys.stdout.flush()
 *                 val_D_0, val_D_tau = 0.0, 0.0
 *                 for t in range(N-tau):             # <<<<<<<<<<<<<<
 *                     f_i0, f_itau, f_j = 0.0, 0.0, 0.0
 *                     h_I0 = ids[:, 0][t]
 */
      __pyx_t_20 = (__pyx_v_N - __pyx_v_tau);
      __pyx_t_21 = __pyx_t_20;
      for (__pyx_t_22 = 0; __pyx_t_22 < __pyx_t_21; __pyx_t_22+=1) {
        __pyx_v_t = __pyx_t_22;

        /* "vcstring.pyx":332
 *                 val_D_0, val_D_tau = 0.0, 0.0
 *                 for t in range(N-tau):
 *                     f_i0, f_itau, f_j = 0.0, 0.0, 0.0             # <<<<<<<<<<<<<<
 *                     h_I0 = ids[:, 0][t]
 *                     h_Itau = ids[:, 0][t + tau]
 */
        __pyx_t_15 = 0.0;
        __pyx_t_16 = 0.0;
        __pyx_t_23 = 0.0;
        __pyx_v_f_i0 = __pyx_t_15;
        __pyx_v_f_itau = __pyx_t_16;
        __pyx_v_f_j = __pyx_t_23;

        /* "vcstring.pyx":333
 *                 for t in range(N-tau):
 *                     f_i0, f_itau, f_j = 0.0, 0.0, 0.0
 *                     h_I0 = ids[:, 0][t]             # <<<<<<<<<<<<<<
 *                     h_Itau = ids[:, 0][t + tau]
 *                     h_B0 = ids[:, 1][t]
 */
        __pyx_t_1 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_ids), __pyx_tuple__9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 333, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 333, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_23 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely((__pyx_t_23 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 333, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_v_h_I0 = __pyx_t_23;

        /* "vcstring.pyx":334
 *                     f_i0, f_itau, f_j = 0.0, 0.0, 0.0
 *                     h_I0 = ids[:, 0][t]
 *                     h_Itau = ids[:, 0][t + tau]             # <<<<<<<<<<<<<<
 *                     h_B0 = ids[:, 1][t]
 *                     h_Btau = ids[:, 1][t + tau]
 */
        __pyx_t_5 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_ids), __pyx_tuple__9); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 334, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_24 = (__pyx_v_t + __pyx_v_tau);
        __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_5, __pyx_t_24, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 334, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_23 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_23 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 334, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_v_h_Itau = __pyx_t_23;

        /* "vcstring.pyx":335
 *                     h_I0 = ids[:, 0][t]
 *                     h_Itau = ids[:, 0][t + tau]
 *                     h_B0 = ids[:, 1][t]             # <<<<<<<<<<<<<<
 *                     h_Btau = ids[:, 1][t + tau]
 *                     if centroid[t] == i:
 */
        __pyx_t_1 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_ids), __pyx_tuple__10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 335, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 335, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_23 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely((__pyx_t_23 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 335, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_v_h_B0 = __pyx_t_23;

        /* "vcstring.pyx":336
 *                     h_Itau = ids[:, 0][t + tau]
 *                     h_B0 = ids[:, 1][t]
 *                     h_Btau = ids[:, 1][t + tau]             # <<<<<<<<<<<<<<
 *                     if centroid[t] == i:
 *                         f_i0 = 1.0
 */
        __pyx_t_5 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_ids), __pyx_tuple__10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 336, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_24 = (__pyx_v_t + __pyx_v_tau);
        __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_5, __pyx_t_24, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 336, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_23 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_23 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 336, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_v_h_Btau = __pyx_t_23;

        /* "vcstring.pyx":337
 *                     h_B0 = ids[:, 1][t]
 *                     h_Btau = ids[:, 1][t + tau]
 *                     if centroid[t] == i:             # <<<<<<<<<<<<<<
 *                         f_i0 = 1.0
 *                     if centroid[t+tau] == i:
 */
        __pyx_t_25 = __pyx_v_t;
        __pyx_t_24 = -1;
        if (__pyx_t_25 < 0) {
          __pyx_t_25 += __pyx_pybuffernd_centroid.diminfo[0].shape;
          if (unlikely(__pyx_t_25 < 0)) __pyx_t_24 = 0;
        } else if (unlikely(__pyx_t_25 >= __pyx_pybuffernd_centroid.diminfo[0].shape)) __pyx_t_24 = 0;
        if (unlikely(__pyx_t_24 != -1)) {
          __Pyx_RaiseBufferIndexError(__pyx_t_24);
          __PYX_ERR(0, 337, __pyx_L1_error)
        }
        __pyx_t_26 = (((*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_centroid.rcbuffer->pybuffer.buf, __pyx_t_25, __pyx_pybuffernd_centroid.diminfo[0].strides)) == __pyx_v_i) != 0);
        if (__pyx_t_26) {

          /* "vcstring.pyx":338
 *                     h_Btau = ids[:, 1][t + tau]
 *                     if centroid[t] == i:
 *                         f_i0 = 1.0             # <<<<<<<<<<<<<<
 *                     if centroid[t+tau] == i:
 *                         f_itau = 1.0
 */
          __pyx_v_f_i0 = 1.0;

          /* "vcstring.pyx":337
 *                     h_B0 = ids[:, 1][t]
 *                     h_Btau = ids[:, 1][t + tau]
 *                     if centroid[t] == i:             # <<<<<<<<<<<<<<
 *                         f_i0 = 1.0
 *                     if centroid[t+tau] == i:
 */
        }

        /* "vcstring.pyx":339
 *                     if centroid[t] == i:
 *                         f_i0 = 1.0
 *                     if centroid[t+tau] == i:             # <<<<<<<<<<<<<<
 *                         f_itau = 1.0
 *                     if centroid[t] == j:
 */
        __pyx_t_25 = (__pyx_v_t + __pyx_v_tau);
        __pyx_t_24 = -1;
        if (__pyx_t_25 < 0) {
          __pyx_t_25 += __pyx_pybuffernd_centroid.diminfo[0].shape;
          if (unlikely(__pyx_t_25 < 0)) __pyx_t_24 = 0;
        } else if (unlikely(__pyx_t_25 >= __pyx_pybuffernd_centroid.diminfo[0].shape)) __pyx_t_24 = 0;
        if (unlikely(__pyx_t_24 != -1)) {
          __Pyx_RaiseBufferIndexError(__pyx_t_24);
          __PYX_ERR(0, 339, __pyx_L1_error)
        }
        __pyx_t_26 = (((*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_centroid.rcbuffer->pybuffer.buf, __pyx_t_25, __pyx_pybuffernd_centroid.diminfo[0].strides)) == __pyx_v_i) != 0);
        if (__pyx_t_26) {

          /* "vcstring.pyx":340
 *                         f_i0 = 1.0
 *                     if centroid[t+tau] == i:
 *                         f_itau = 1.0             # <<<<<<<<<<<<<<
 *                     if centroid[t] == j:
 *                         f_j = 1.0
 */
          __pyx_v_f_itau = 1.0;

          /* "vcstring.pyx":339
 *                     if centroid[t] == i:
 *                         f_i0 = 1.0
 *                     if centroid[t+tau] == i:             # <<<<<<<<<<<<<<
 *                         f_itau = 1.0
 *                     if centroid[t] == j:
 */
        }

        /* "vcstring.pyx":341
 *                     if centroid[t+tau] == i:
 *                         f_itau = 1.0
 *                     if centroid[t] == j:             # <<<<<<<<<<<<<<
 *                         f_j = 1.0
 * 
 */
        __pyx_t_25 = __pyx_v_t;
        __pyx_t_24 = -1;
        if (__pyx_t_25 < 0) {
          __pyx_t_25 += __pyx_pybuffernd_centroid.diminfo[0].shape;
          if (unlikely(__pyx_t_25 < 0)) __pyx_t_24 = 0;
        } else if (unlikely(__pyx_t_25 >= __pyx_pybuffernd_centroid.diminfo[0].shape)) __pyx_t_24 = 0;
        if (unlikely(__pyx_t_24 != -1)) {
          __Pyx_RaiseBufferIndexError(__pyx_t_24);
          __PYX_ERR(0, 341, __pyx_L1_error)
        }
        __pyx_t_26 = (((*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_centroid.rcbuffer->pybuffer.buf, __pyx_t_25, __pyx_pybuffernd_centroid.diminfo[0].strides)) == __pyx_v_j) != 0);
        if (__pyx_t_26) {

          /* "vcstring.pyx":342
 *                         f_itau = 1.0
 *                     if centroid[t] == j:
 *                         f_j = 1.0             # <<<<<<<<<<<<<<
 * 
 *                     # Summation of terms
 */
          __pyx_v_f_j = 1.0;

          /* "vcstring.pyx":341
 *                     if centroid[t+tau] == i:
 *                         f_itau = 1.0
 *                     if centroid[t] == j:             # <<<<<<<<<<<<<<
 *                         f_j = 1.0
 * 
 */
        }

        /* "vcstring.pyx":345
 * 
 *                     # Summation of terms
 *                     val_D_0 += h_I0 * h_I0 * f_i0 * f_j             # <<<<<<<<<<<<<<
 *                     val_D_tau += h_Itau * h_I0 * f_itau * f_j
 *                     if j == 0:
 */
        __pyx_v_val_D_0 = (__pyx_v_val_D_0 + (((__pyx_v_h_I0 * __pyx_v_h_I0) * __pyx_v_f_i0) * __pyx_v_f_j));

        /* "vcstring.pyx":346
 *                     # Summation of terms
 *                     val_D_0 += h_I0 * h_I0 * f_i0 * f_j
 *                     val_D_tau += h_Itau * h_I0 * f_itau * f_j             # <<<<<<<<<<<<<<
 *                     if j == 0:
 *                         val_g_0 += (h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)
 */
        __pyx_v_val_D_tau = (__pyx_v_val_D_tau + (((__pyx_v_h_Itau * __pyx_v_h_I0) * __pyx_v_f_itau) * __pyx_v_f_j));

        /* "vcstring.pyx":347
 *                     val_D_0 += h_I0 * h_I0 * f_i0 * f_j
 *                     val_D_tau += h_Itau * h_I0 * f_itau * f_j
 *                     if j == 0:             # <<<<<<<<<<<<<<
 *                         val_g_0 += (h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)
 *                         val_g_tau += (h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)
 */
        __pyx_t_26 = ((__pyx_v_j == 0) != 0);
        if (__pyx_t_26) {

          /* "vcstring.pyx":348
 *                     val_D_tau += h_Itau * h_I0 * f_itau * f_j
 *                     if j == 0:
 *                         val_g_0 += (h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)             # <<<<<<<<<<<<<<
 *                         val_g_tau += (h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)
 * 
 */
          __pyx_v_val_g_0 = (__pyx_v_val_g_0 + (((__pyx_v_h_I0 * __pyx_v_f_i0) * __pyx_v_h_B0) + ((__pyx_v_h_B0 * __pyx_v_h_I0) * __pyx_v_f_i0)));

          /* "vcstring.pyx":349
 *                     if j == 0:
 *                         val_g_0 += (h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)
 *                         val_g_tau += (h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)             # <<<<<<<<<<<<<<
 * 
 *                 # Divide by data size
 */
          __pyx_v_val_g_tau = (__pyx_v_val_g_tau + (((__pyx_v_h_Itau * __pyx_v_f_itau) * __pyx_v_h_B0) + ((__pyx_v_h_Btau * __pyx_v_h_I0) * __pyx_v_f_i0)));

          /* "vcstring.pyx":347
 *                     val_D_0 += h_I0 * h_I0 * f_i0 * f_j
 *                     val_D_tau += h_Itau * h_I0 * f_itau * f_j
 *                     if j == 0:             # <<<<<<<<<<<<<<
 *                         val_g_0 += (h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)
 *                         val_g_tau += (h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)
 */
        }
      }

      /* "vcstring.pyx":352
 * 
 *                 # Divide by data size
 *                 D_0.append(val_D_0 / (N - tau))             # <<<<<<<<<<<<<<
 *                 D_tau.append(val_D_tau / (N - tau))
 *             g_0.append(val_g_0 / (N - tau))
 */
      __pyx_t_20 = (__pyx_v_N - __pyx_v_tau);
      if (unlikely(__pyx_t_20 == 0)) {
        PyErr_SetString(PyExc_ZeroDivisionError, "float division");
        __PYX_ERR(0, 352, __pyx_L1_error)
      }
      __pyx_t_1 = PyFloat_FromDouble((__pyx_v_val_D_0 / ((double)__pyx_t_20))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 352, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_27 = __Pyx_PyList_Append(__pyx_v_D_0, __pyx_t_1); if (unlikely(__pyx_t_27 == ((int)-1))) __PYX_ERR(0, 352, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":353
 *                 # Divide by data size
 *                 D_0.append(val_D_0 / (N - tau))
 *                 D_tau.append(val_D_tau / (N - tau))             # <<<<<<<<<<<<<<
 *             g_0.append(val_g_0 / (N - tau))
 *             g_tau.append(val_g_tau / (N - tau))
 */
      __pyx_t_20 = (__pyx_v_N - __pyx_v_tau);
      if (unlikely(__pyx_t_20 == 0)) {
        PyErr_SetString(PyExc_ZeroDivisionError, "float division");
        __PYX_ERR(0, 353, __pyx_L1_error)
      }
      __pyx_t_1 = PyFloat_FromDouble((__pyx_v_val_D_tau / ((double)__pyx_t_20))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 353, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_27 = __Pyx_PyList_Append(__pyx_v_D_tau, __pyx_t_1); if (unlikely(__pyx_t_27 == ((int)-1))) __PYX_ERR(0, 353, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }

    /* "vcstring.pyx":354
 *                 D_0.append(val_D_0 / (N - tau))
 *                 D_tau.append(val_D_tau / (N - tau))
 *             g_0.append(val_g_0 / (N - tau))             # <<<<<<<<<<<<<<
 *             g_tau.append(val_g_tau / (N - tau))
 * 
 */
    __pyx_t_17 = (__pyx_v_N - __pyx_v_tau);
    if (unlikely(__pyx_t_17 == 0)) {
      PyErr_SetString(PyExc_ZeroDivisionError, "float division");
      __PYX_ERR(0, 354, __pyx_L1_error)
    }
    __pyx_t_1 = PyFloat_FromDouble((__pyx_v_val_g_0 / ((double)__pyx_t_17))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 354, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_27 = __Pyx_PyList_Append(__pyx_v_g_0, __pyx_t_1); if (unlikely(__pyx_t_27 == ((int)-1))) __PYX_ERR(0, 354, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "vcstring.pyx":355
 *                 D_tau.append(val_D_tau / (N - tau))
 *             g_0.append(val_g_0 / (N - tau))
 *             g_tau.append(val_g_tau / (N - tau))             # <<<<<<<<<<<<<<
 * 
 *         # Reshape into appropriate matrix size
 */
    __pyx_t_17 = (__pyx_v_N - __pyx_v_tau);
    if (unlikely(__pyx_t_17 == 0)) {
      PyErr_SetString(PyExc_ZeroDivisionError, "float division");
      __PYX_ERR(0, 355, __pyx_L1_error)
    }
    __pyx_t_1 = PyFloat_FromDouble((__pyx_v_val_g_tau / ((double)__pyx_t_17))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 355, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_27 = __Pyx_PyList_Append(__pyx_v_g_tau, __pyx_t_1); if (unlikely(__pyx_t_27 == ((int)-1))) __PYX_ERR(0, 355, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }

  /* "vcstring.pyx":358
 * 
 *         # Reshape into appropriate matrix size
 *         D_0_arr = np.asarray(D_0).reshape(self.num_basis, self.num_basis)             # <<<<<<<<<<<<<<
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 358, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 358, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
    }
  }
  __pyx_t_5 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_2, __pyx_v_D_0) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_v_D_0);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 358, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_reshape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 358, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 358, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 358, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_5, __pyx_t_2};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 358, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_5, __pyx_t_2};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 358, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else
  #endif
  {
    __pyx_t_3 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 358, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (__pyx_t_4) {
      __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4); __pyx_t_4 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_7, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_7, __pyx_t_2);
    __pyx_t_5 = 0;
    __pyx_t_2 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 358, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 358, __pyx_L1_error)
  __pyx_t_28 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_28, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_12, &__pyx_t_11, &__pyx_t_10);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_12); Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_12, __pyx_t_11, __pyx_t_10);
      }
      __pyx_t_12 = __pyx_t_11 = __pyx_t_10 = 0;
    }
    __pyx_pybuffernd_D_0_arr.diminfo[0].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0_arr.diminfo[0].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0_arr.diminfo[1].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0_arr.diminfo[1].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 358, __pyx_L1_error)
  }
  __pyx_t_28 = 0;
  __pyx_v_D_0_arr = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":359
 *         # Reshape into appropriate matrix size
 *         D_0_arr = np.asarray(D_0).reshape(self.num_basis, self.num_basis)
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)             # <<<<<<<<<<<<<<
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_asarray); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_8 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_D_tau) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_D_tau);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_reshape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_8, __pyx_t_3};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 359, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_8, __pyx_t_3};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 359, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  {
    __pyx_t_4 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 359, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    if (__pyx_t_5) {
      __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_8);
    PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_7, __pyx_t_8);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_7, __pyx_t_3);
    __pyx_t_8 = 0;
    __pyx_t_3 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 359, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 359, __pyx_L1_error)
  __pyx_t_28 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_28, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_10, &__pyx_t_11, &__pyx_t_12);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_12);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_10, __pyx_t_11, __pyx_t_12);
      }
      __pyx_t_10 = __pyx_t_11 = __pyx_t_12 = 0;
    }
    __pyx_pybuffernd_D_tau_arr.diminfo[0].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau_arr.diminfo[0].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau_arr.diminfo[1].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau_arr.diminfo[1].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 359, __pyx_L1_error)
  }
  __pyx_t_28 = 0;
  __pyx_v_D_tau_arr = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":360
 *         D_0_arr = np.asarray(D_0).reshape(self.num_basis, self.num_basis)
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)             # <<<<<<<<<<<<<<
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 *         print('D_0 =', D_0_arr)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 360, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 360, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_v_g_0) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_g_0);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 360, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 360, __pyx_L1_error)
  __pyx_t_29 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_29, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_12, &__pyx_t_11, &__pyx_t_10);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_0_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_12); Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_12, __pyx_t_11, __pyx_t_10);
      }
      __pyx_t_12 = __pyx_t_11 = __pyx_t_10 = 0;
    }
    __pyx_pybuffernd_g_0_arr.diminfo[0].strides = __pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_0_arr.diminfo[0].shape = __pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 360, __pyx_L1_error)
  }
  __pyx_t_29 = 0;
  __pyx_v_g_0_arr = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":361
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)             # <<<<<<<<<<<<<<
 *         print('D_0 =', D_0_arr)
 *         print('D_tau =', D_tau_arr)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 361, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_asarray); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 361, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_v_g_tau) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_g_tau);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 361, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 361, __pyx_L1_error)
  __pyx_t_29 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_29, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_10, &__pyx_t_11, &__pyx_t_12);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_tau_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_12);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_10, __pyx_t_11, __pyx_t_12);
      }
      __pyx_t_10 = __pyx_t_11 = __pyx_t_12 = 0;
    }
    __pyx_pybuffernd_g_tau_arr.diminfo[0].strides = __pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_tau_arr.diminfo[0].shape = __pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 361, __pyx_L1_error)
  }
  __pyx_t_29 = 0;
  __pyx_v_g_tau_arr = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":362
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 *         print('D_0 =', D_0_arr)             # <<<<<<<<<<<<<<
 *         print('D_tau =', D_tau_arr)
 *         print('g_0 =', g_0_arr)
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 362, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_D_0);
  __Pyx_GIVEREF(__pyx_kp_u_D_0);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_D_0);
  __Pyx_INCREF(((PyObject *)__pyx_v_D_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_0_arr));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_D_0_arr));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 362, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":363
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 *         print('D_0 =', D_0_arr)
 *         print('D_tau =', D_tau_arr)             # <<<<<<<<<<<<<<
 *         print('g_0 =', g_0_arr)
 *         print('g_tau =', g_tau_arr)
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 363, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_D_tau);
  __Pyx_GIVEREF(__pyx_kp_u_D_tau);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_D_tau);
  __Pyx_INCREF(((PyObject *)__pyx_v_D_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_D_tau_arr));
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 363, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":364
 *         print('D_0 =', D_0_arr)
 *         print('D_tau =', D_tau_arr)
 *         print('g_0 =', g_0_arr)             # <<<<<<<<<<<<<<
 *         print('g_tau =', g_tau_arr)
 * 
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 364, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_g_0);
  __Pyx_GIVEREF(__pyx_kp_u_g_0);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_g_0);
  __Pyx_INCREF(((PyObject *)__pyx_v_g_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_0_arr));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_g_0_arr));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 364, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":365
 *         print('D_tau =', D_tau_arr)
 *         print('g_0 =', g_0_arr)
 *         print('g_tau =', g_tau_arr)             # <<<<<<<<<<<<<<
 * 
 *         # Symmetrize for reversible dynamics
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 365, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_g_tau);
  __Pyx_GIVEREF(__pyx_kp_u_g_tau);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_g_tau);
  __Pyx_INCREF(((PyObject *)__pyx_v_g_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_g_tau_arr));
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 365, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":368
 * 
 *         # Symmetrize for reversible dynamics
 *         if symmetric == True:             # <<<<<<<<<<<<<<
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 */
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_symmetric, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 368, __pyx_L1_error)
  __pyx_t_26 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_26 < 0)) __PYX_ERR(0, 368, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_26) {

    /* "vcstring.pyx":369
 *         # Symmetrize for reversible dynamics
 *         if symmetric == True:
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)             # <<<<<<<<<<<<<<
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 *             print('Symmetric D_0 =', D_0_arr)
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_D_0_arr), __pyx_n_s_T); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 369, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_Add(((PyObject *)__pyx_v_D_0_arr), __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 369, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyNumber_Multiply(__pyx_float_0_5, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 369, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 369, __pyx_L1_error)
    __pyx_t_28 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
      __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_28, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
      if (unlikely(__pyx_t_7 < 0)) {
        PyErr_Fetch(&__pyx_t_12, &__pyx_t_11, &__pyx_t_10);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_12); Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_12, __pyx_t_11, __pyx_t_10);
        }
        __pyx_t_12 = __pyx_t_11 = __pyx_t_10 = 0;
      }
      __pyx_pybuffernd_D_0_arr.diminfo[0].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0_arr.diminfo[0].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0_arr.diminfo[1].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0_arr.diminfo[1].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[1];
      if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 369, __pyx_L1_error)
    }
    __pyx_t_28 = 0;
    __Pyx_DECREF_SET(__pyx_v_D_0_arr, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "vcstring.pyx":370
 *         if symmetric == True:
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)             # <<<<<<<<<<<<<<
 *             print('Symmetric D_0 =', D_0_arr)
 *             print('Symmetric D_tau =', D_tau_arr)
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_D_tau_arr), __pyx_n_s_T); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 370, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_Add(((PyObject *)__pyx_v_D_tau_arr), __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 370, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyNumber_Multiply(__pyx_float_0_5, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 370, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 370, __pyx_L1_error)
    __pyx_t_28 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
      __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_28, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
      if (unlikely(__pyx_t_7 < 0)) {
        PyErr_Fetch(&__pyx_t_10, &__pyx_t_11, &__pyx_t_12);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_12);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_10, __pyx_t_11, __pyx_t_12);
        }
        __pyx_t_10 = __pyx_t_11 = __pyx_t_12 = 0;
      }
      __pyx_pybuffernd_D_tau_arr.diminfo[0].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau_arr.diminfo[0].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau_arr.diminfo[1].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau_arr.diminfo[1].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[1];
      if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 370, __pyx_L1_error)
    }
    __pyx_t_28 = 0;
    __Pyx_DECREF_SET(__pyx_v_D_tau_arr, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "vcstring.pyx":371
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 *             print('Symmetric D_0 =', D_0_arr)             # <<<<<<<<<<<<<<
 *             print('Symmetric D_tau =', D_tau_arr)
 * 
 */
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 371, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_kp_u_Symmetric_D_0);
    __Pyx_GIVEREF(__pyx_kp_u_Symmetric_D_0);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Symmetric_D_0);
    __Pyx_INCREF(((PyObject *)__pyx_v_D_0_arr));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_D_0_arr));
    PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_D_0_arr));
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 371, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "vcstring.pyx":372
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 *             print('Symmetric D_0 =', D_0_arr)
 *             print('Symmetric D_tau =', D_tau_arr)             # <<<<<<<<<<<<<<
 * 
 *         # Calculate committor coefficients, b
 */
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 372, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_kp_u_Symmetric_D_tau);
    __Pyx_GIVEREF(__pyx_kp_u_Symmetric_D_tau);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_Symmetric_D_tau);
    __Pyx_INCREF(((PyObject *)__pyx_v_D_tau_arr));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_D_tau_arr));
    PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_D_tau_arr));
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 372, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "vcstring.pyx":368
 * 
 *         # Symmetrize for reversible dynamics
 *         if symmetric == True:             # <<<<<<<<<<<<<<
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 */
  }

  /* "vcstring.pyx":375
 * 
 *         # Calculate committor coefficients, b
 *         D = D_0_arr - D_tau_arr             # <<<<<<<<<<<<<<
 *         g = g_tau_arr - g_0_arr
 *         b = 0.5 * np.linalg.inv(D).dot(g)
 */
  __pyx_t_1 = PyNumber_Subtract(((PyObject *)__pyx_v_D_0_arr), ((PyObject *)__pyx_v_D_tau_arr)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 375, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 375, __pyx_L1_error)
  __pyx_t_28 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D.rcbuffer->pybuffer, (PyObject*)__pyx_t_28, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_12, &__pyx_t_11, &__pyx_t_10);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D.rcbuffer->pybuffer, (PyObject*)__pyx_v_D, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_12); Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_12, __pyx_t_11, __pyx_t_10);
      }
      __pyx_t_12 = __pyx_t_11 = __pyx_t_10 = 0;
    }
    __pyx_pybuffernd_D.diminfo[0].strides = __pyx_pybuffernd_D.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D.diminfo[0].shape = __pyx_pybuffernd_D.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D.diminfo[1].strides = __pyx_pybuffernd_D.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D.diminfo[1].shape = __pyx_pybuffernd_D.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 375, __pyx_L1_error)
  }
  __pyx_t_28 = 0;
  __pyx_v_D = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":376
 *         # Calculate committor coefficients, b
 *         D = D_0_arr - D_tau_arr
 *         g = g_tau_arr - g_0_arr             # <<<<<<<<<<<<<<
 *         b = 0.5 * np.linalg.inv(D).dot(g)
 *         print('b =', b)
 */
  __pyx_t_1 = PyNumber_Subtract(((PyObject *)__pyx_v_g_tau_arr), ((PyObject *)__pyx_v_g_0_arr)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 376, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 376, __pyx_L1_error)
  __pyx_t_29 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g.rcbuffer->pybuffer, (PyObject*)__pyx_t_29, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_10, &__pyx_t_11, &__pyx_t_12);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g.rcbuffer->pybuffer, (PyObject*)__pyx_v_g, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_12);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_10, __pyx_t_11, __pyx_t_12);
      }
      __pyx_t_10 = __pyx_t_11 = __pyx_t_12 = 0;
    }
    __pyx_pybuffernd_g.diminfo[0].strides = __pyx_pybuffernd_g.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g.diminfo[0].shape = __pyx_pybuffernd_g.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 376, __pyx_L1_error)
  }
  __pyx_t_29 = 0;
  __pyx_v_g = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":377
 *         D = D_0_arr - D_tau_arr
 *         g = g_tau_arr - g_0_arr
 *         b = 0.5 * np.linalg.inv(D).dot(g)             # <<<<<<<<<<<<<<
 *         print('b =', b)
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 377, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_linalg); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 377, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_inv); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 377, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, ((PyObject *)__pyx_v_D)) : __Pyx_PyObject_CallOneArg(__pyx_t_4, ((PyObject *)__pyx_v_D));
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 377, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_dot); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 377, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, ((PyObject *)__pyx_v_g)) : __Pyx_PyObject_CallOneArg(__pyx_t_4, ((PyObject *)__pyx_v_g));
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 377, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyNumber_Multiply(__pyx_float_0_5, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 377, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 377, __pyx_L1_error)
  __pyx_t_29 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_t_29, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_12, &__pyx_t_11, &__pyx_t_10);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_12); Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_12, __pyx_t_11, __pyx_t_10);
      }
      __pyx_t_12 = __pyx_t_11 = __pyx_t_10 = 0;
    }
    __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 377, __pyx_L1_error)
  }
  __pyx_t_29 = 0;
  __pyx_v_b = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "vcstring.pyx":378
 *         g = g_tau_arr - g_0_arr
 *         b = 0.5 * np.linalg.inv(D).dot(g)
 *         print('b =', b)             # <<<<<<<<<<<<<<
 * 
 *         return b, D_0_arr, D_tau_arr, g_0_arr, g_tau_arr
 */
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 378, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_kp_u_b);
  __Pyx_GIVEREF(__pyx_kp_u_b);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_b);
  __Pyx_INCREF(((PyObject *)__pyx_v_b));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
  PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_b));
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 378, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":380
 *         print('b =', b)
 * 
 *         return b, D_0_arr, D_tau_arr, g_0_arr, g_tau_arr             # <<<<<<<<<<<<<<
 * 
 *     cpdef calc_coeffs_accelerated(self, int image, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 380, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_v_b));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_b));
  __Pyx_INCREF(((PyObject *)__pyx_v_D_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_0_arr));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_D_0_arr));
  __Pyx_INCREF(((PyObject *)__pyx_v_D_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_1, 2, ((PyObject *)__pyx_v_D_tau_arr));
  __Pyx_INCREF(((PyObject *)__pyx_v_g_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_0_arr));
  PyTuple_SET_ITEM(__pyx_t_1, 3, ((PyObject *)__pyx_v_g_0_arr));
  __Pyx_INCREF(((PyObject *)__pyx_v_g_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_1, 4, ((PyObject *)__pyx_v_g_tau_arr));
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "vcstring.pyx":286
 * 
 * 
 *     cpdef calc_coeffs(self, int N, int tau, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=2] ids, symmetric=True):             # <<<<<<<<<<<<<<
 *         """
 *         Solve the linear equation from minimizing the forward steady-state flux.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_centroid.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_coeffs", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_centroid.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XDECREF((PyObject *)__pyx_v_centroid);
  __Pyx_XDECREF(__pyx_v_D_0);
  __Pyx_XDECREF(__pyx_v_D_tau);
  __Pyx_XDECREF(__pyx_v_g_0);
  __Pyx_XDECREF(__pyx_v_g_tau);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_0_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_tau_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_D);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_0_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_tau_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_g);
  __Pyx_XDECREF((PyObject *)__pyx_v_b);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_11calc_coeffs(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8vcstring_8vcstring_10calc_coeffs[] = "\n        Solve the linear equation from minimizing the forward steady-state flux.\n        Calculates D matrices, g vectors, and b coefficients.\n\n        Parameters\n        ----------\n        traj :  trajectory with shape (T, d), where T is number of time steps and d is dimensions.\n        tau  :  lag time (units step)\n\n        Returns:\n        --------\n        - Symmetric square Matrices D_0_sym and D_tau_sym\n        - Vectors g_0 and g_tau\n        - A vector of the coefficients b for the trial committor expressed as a basis set expansion\n        ";
static PyObject *__pyx_pw_8vcstring_8vcstring_11calc_coeffs(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_N;
  int __pyx_v_tau;
  PyArrayObject *__pyx_v_z = 0;
  PyArrayObject *__pyx_v_ids = 0;
  PyObject *__pyx_v_symmetric = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("calc_coeffs (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_N,&__pyx_n_s_tau,&__pyx_n_s_z,&__pyx_n_s_ids,&__pyx_n_s_symmetric,0};
    PyObject* values[5] = {0,0,0,0,0};
    values[4] = ((PyObject *)Py_True);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_N)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tau)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_coeffs", 0, 4, 5, 1); __PYX_ERR(0, 286, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_coeffs", 0, 4, 5, 2); __PYX_ERR(0, 286, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ids)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_coeffs", 0, 4, 5, 3); __PYX_ERR(0, 286, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_symmetric);
          if (value) { values[4] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "calc_coeffs") < 0)) __PYX_ERR(0, 286, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_N = __Pyx_PyInt_As_int(values[0]); if (unlikely((__pyx_v_N == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 286, __pyx_L3_error)
    __pyx_v_tau = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_tau == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 286, __pyx_L3_error)
    __pyx_v_z = ((PyArrayObject *)values[2]);
    __pyx_v_ids = ((PyArrayObject *)values[3]);
    __pyx_v_symmetric = values[4];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("calc_coeffs", 0, 4, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 286, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.vcstring.calc_coeffs", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_z), __pyx_ptype_5numpy_ndarray, 1, "z", 0))) __PYX_ERR(0, 286, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ids), __pyx_ptype_5numpy_ndarray, 1, "ids", 0))) __PYX_ERR(0, 286, __pyx_L1_error)
  __pyx_r = __pyx_pf_8vcstring_8vcstring_10calc_coeffs(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self), __pyx_v_N, __pyx_v_tau, __pyx_v_z, __pyx_v_ids, __pyx_v_symmetric);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_10calc_coeffs(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_v_N, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_ids, PyObject *__pyx_v_symmetric) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ids;
  __Pyx_Buffer __pyx_pybuffer_ids;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs __pyx_t_2;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_coeffs", 0);
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  __pyx_pybuffer_ids.pybuffer.buf = NULL;
  __pyx_pybuffer_ids.refcount = 0;
  __pyx_pybuffernd_ids.data = NULL;
  __pyx_pybuffernd_ids.rcbuffer = &__pyx_pybuffer_ids;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 286, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 286, __pyx_L1_error)
  }
  __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2.__pyx_n = 1;
  __pyx_t_2.symmetric = __pyx_v_symmetric;
  __pyx_t_1 = __pyx_vtabptr_8vcstring_vcstring->calc_coeffs(__pyx_v_self, __pyx_v_N, __pyx_v_tau, __pyx_v_z, __pyx_v_ids, 1, &__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 286, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_coeffs", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":382
 *         return b, D_0_arr, D_tau_arr, g_0_arr, g_tau_arr
 * 
 *     cpdef calc_coeffs_accelerated(self, int image, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z):             # <<<<<<<<<<<<<<
 *         """
 *         Solve the linear equation from minimizing the forward steady-state flux.
 */

static PyObject *__pyx_pw_8vcstring_8vcstring_13calc_coeffs_accelerated(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_coeffs_accelerated(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_v_image, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, int __pyx_skip_dispatch) {
  double __pyx_v_xa;
  double __pyx_v_xb;
  PyArrayObject *__pyx_v_xcenters = 0;
  PyArrayObject *__pyx_v_ycenters = 0;
  int __pyx_v_N;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_t;
  PyObject *__pyx_v_x = 0;
  PyObject *__pyx_v_y = 0;
  PyObject *__pyx_v_affected_images = 0;
  PyArrayObject *__pyx_v_D_0 = 0;
  PyArrayObject *__pyx_v_D_tau = 0;
  PyArrayObject *__pyx_v_g_0 = 0;
  PyArrayObject *__pyx_v_g_tau = 0;
  PyArrayObject *__pyx_v_dist_t = 0;
  PyArrayObject *__pyx_v_dist_tau = 0;
  double __pyx_v_x_t;
  double __pyx_v_y_t;
  double __pyx_v_x_tau;
  double __pyx_v_y_tau;
  double __pyx_v_nc_t;
  double __pyx_v_nc_tau;
  double __pyx_v_u_t;
  double __pyx_v_u_tau;
  double __pyx_v_f_i0;
  double __pyx_v_f_itau;
  double __pyx_v_f_j;
  double __pyx_v_h_I0;
  double __pyx_v_h_B0;
  double __pyx_v_h_Itau;
  double __pyx_v_h_Btau;
  PyArrayObject *__pyx_v_D_0_arr = 0;
  PyArrayObject *__pyx_v_D_tau_arr = 0;
  PyArrayObject *__pyx_v_D = 0;
  PyArrayObject *__pyx_v_g_0_arr = 0;
  PyArrayObject *__pyx_v_g_tau_arr = 0;
  PyArrayObject *__pyx_v_g = 0;
  PyArrayObject *__pyx_v_b = 0;
  PyObject *__pyx_v_dat = NULL;
  PyObject *__pyx_8genexpr6__pyx_v_row = NULL;
  PyObject *__pyx_8genexpr7__pyx_v_row = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D;
  __Pyx_Buffer __pyx_pybuffer_D;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_0;
  __Pyx_Buffer __pyx_pybuffer_D_0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_0_arr;
  __Pyx_Buffer __pyx_pybuffer_D_0_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_tau;
  __Pyx_Buffer __pyx_pybuffer_D_tau;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_tau_arr;
  __Pyx_Buffer __pyx_pybuffer_D_tau_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_dist_t;
  __Pyx_Buffer __pyx_pybuffer_dist_t;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_dist_tau;
  __Pyx_Buffer __pyx_pybuffer_dist_tau;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g;
  __Pyx_Buffer __pyx_pybuffer_g;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_0;
  __Pyx_Buffer __pyx_pybuffer_g_0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_0_arr;
  __Pyx_Buffer __pyx_pybuffer_g_0_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_tau;
  __Pyx_Buffer __pyx_pybuffer_g_tau;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_tau_arr;
  __Pyx_Buffer __pyx_pybuffer_g_tau_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_xcenters;
  __Pyx_Buffer __pyx_pybuffer_xcenters;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ycenters;
  __Pyx_Buffer __pyx_pybuffer_ycenters;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *(*__pyx_t_9)(PyObject *);
  double __pyx_t_10;
  double __pyx_t_11;
  PyArrayObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  PyObject *__pyx_t_14 = NULL;
  PyObject *__pyx_t_15 = NULL;
  Py_ssize_t __pyx_t_16;
  int __pyx_t_17;
  PyArrayObject *__pyx_t_18 = NULL;
  PyArrayObject *__pyx_t_19 = NULL;
  PyArrayObject *__pyx_t_20 = NULL;
  Py_ssize_t __pyx_t_21;
  Py_ssize_t __pyx_t_22;
  Py_ssize_t __pyx_t_23;
  int __pyx_t_24;
  int __pyx_t_25;
  int __pyx_t_26;
  __pyx_t_8vcstring_DTYPE_t __pyx_t_27;
  Py_ssize_t __pyx_t_28;
  int __pyx_t_29;
  int __pyx_t_30;
  int __pyx_t_31;
  int __pyx_t_32;
  PyArrayObject *__pyx_t_33 = NULL;
  double __pyx_t_34;
  double __pyx_t_35;
  int __pyx_t_36;
  PyArrayObject *__pyx_t_37 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_coeffs_accelerated", 0);
  __pyx_pybuffer_xcenters.pybuffer.buf = NULL;
  __pyx_pybuffer_xcenters.refcount = 0;
  __pyx_pybuffernd_xcenters.data = NULL;
  __pyx_pybuffernd_xcenters.rcbuffer = &__pyx_pybuffer_xcenters;
  __pyx_pybuffer_ycenters.pybuffer.buf = NULL;
  __pyx_pybuffer_ycenters.refcount = 0;
  __pyx_pybuffernd_ycenters.data = NULL;
  __pyx_pybuffernd_ycenters.rcbuffer = &__pyx_pybuffer_ycenters;
  __pyx_pybuffer_D_0.pybuffer.buf = NULL;
  __pyx_pybuffer_D_0.refcount = 0;
  __pyx_pybuffernd_D_0.data = NULL;
  __pyx_pybuffernd_D_0.rcbuffer = &__pyx_pybuffer_D_0;
  __pyx_pybuffer_D_tau.pybuffer.buf = NULL;
  __pyx_pybuffer_D_tau.refcount = 0;
  __pyx_pybuffernd_D_tau.data = NULL;
  __pyx_pybuffernd_D_tau.rcbuffer = &__pyx_pybuffer_D_tau;
  __pyx_pybuffer_g_0.pybuffer.buf = NULL;
  __pyx_pybuffer_g_0.refcount = 0;
  __pyx_pybuffernd_g_0.data = NULL;
  __pyx_pybuffernd_g_0.rcbuffer = &__pyx_pybuffer_g_0;
  __pyx_pybuffer_g_tau.pybuffer.buf = NULL;
  __pyx_pybuffer_g_tau.refcount = 0;
  __pyx_pybuffernd_g_tau.data = NULL;
  __pyx_pybuffernd_g_tau.rcbuffer = &__pyx_pybuffer_g_tau;
  __pyx_pybuffer_dist_t.pybuffer.buf = NULL;
  __pyx_pybuffer_dist_t.refcount = 0;
  __pyx_pybuffernd_dist_t.data = NULL;
  __pyx_pybuffernd_dist_t.rcbuffer = &__pyx_pybuffer_dist_t;
  __pyx_pybuffer_dist_tau.pybuffer.buf = NULL;
  __pyx_pybuffer_dist_tau.refcount = 0;
  __pyx_pybuffernd_dist_tau.data = NULL;
  __pyx_pybuffernd_dist_tau.rcbuffer = &__pyx_pybuffer_dist_tau;
  __pyx_pybuffer_D_0_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_D_0_arr.refcount = 0;
  __pyx_pybuffernd_D_0_arr.data = NULL;
  __pyx_pybuffernd_D_0_arr.rcbuffer = &__pyx_pybuffer_D_0_arr;
  __pyx_pybuffer_D_tau_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_D_tau_arr.refcount = 0;
  __pyx_pybuffernd_D_tau_arr.data = NULL;
  __pyx_pybuffernd_D_tau_arr.rcbuffer = &__pyx_pybuffer_D_tau_arr;
  __pyx_pybuffer_D.pybuffer.buf = NULL;
  __pyx_pybuffer_D.refcount = 0;
  __pyx_pybuffernd_D.data = NULL;
  __pyx_pybuffernd_D.rcbuffer = &__pyx_pybuffer_D;
  __pyx_pybuffer_g_0_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_g_0_arr.refcount = 0;
  __pyx_pybuffernd_g_0_arr.data = NULL;
  __pyx_pybuffernd_g_0_arr.rcbuffer = &__pyx_pybuffer_g_0_arr;
  __pyx_pybuffer_g_tau_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_g_tau_arr.refcount = 0;
  __pyx_pybuffernd_g_tau_arr.data = NULL;
  __pyx_pybuffernd_g_tau_arr.rcbuffer = &__pyx_pybuffer_g_tau_arr;
  __pyx_pybuffer_g.pybuffer.buf = NULL;
  __pyx_pybuffer_g.refcount = 0;
  __pyx_pybuffernd_g.data = NULL;
  __pyx_pybuffernd_g.rcbuffer = &__pyx_pybuffer_g;
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 382, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_calc_coeffs_accelerated); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 382, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_8vcstring_8vcstring_13calc_coeffs_accelerated)) {
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_image); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 382, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 382, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_5 = __pyx_t_1; __pyx_t_6 = NULL;
        __pyx_t_7 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
          __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
          if (likely(__pyx_t_6)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
            __Pyx_INCREF(__pyx_t_6);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_5, function);
            __pyx_t_7 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[5] = {__pyx_t_6, __pyx_t_3, __pyx_v_traj, __pyx_t_4, ((PyObject *)__pyx_v_z)};
          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 4+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 382, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[5] = {__pyx_t_6, __pyx_t_3, __pyx_v_traj, __pyx_t_4, ((PyObject *)__pyx_v_z)};
          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 4+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 382, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        } else
        #endif
        {
          __pyx_t_8 = PyTuple_New(4+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 382, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          if (__pyx_t_6) {
            __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
          }
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_t_3);
          __Pyx_INCREF(__pyx_v_traj);
          __Pyx_GIVEREF(__pyx_v_traj);
          PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_v_traj);
          __Pyx_GIVEREF(__pyx_t_4);
          PyTuple_SET_ITEM(__pyx_t_8, 2+__pyx_t_7, __pyx_t_4);
          __Pyx_INCREF(((PyObject *)__pyx_v_z));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
          PyTuple_SET_ITEM(__pyx_t_8, 3+__pyx_t_7, ((PyObject *)__pyx_v_z));
          __pyx_t_3 = 0;
          __pyx_t_4 = 0;
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 382, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        }
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }

  /* "vcstring.pyx":421
 *         cdef np.ndarray[DTYPE_t, ndim=1] g_0_arr, g_tau_arr, g, b
 * 
 *         print('\nSOLVING LINEAR BASIS SET COEFFICIENTS, ACCELERATED METHOD')             # <<<<<<<<<<<<<<
 *         print('-----------------------------------------------------------')
 *         print("WARNING: THIS METHOD IS NOT RECOMMENDED FOR MOST CASES BECAUSE MOVING THE IMAGES MORE THAN A CERTAIN AMOUNT CAN AFFECT THE VORONOI TESSELATION IN FARTHER OUT IMAGES OTHER THAN THE NEAREST NEIGHBORS.")
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__26, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 421, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":422
 * 
 *         print('\nSOLVING LINEAR BASIS SET COEFFICIENTS, ACCELERATED METHOD')
 *         print('-----------------------------------------------------------')             # <<<<<<<<<<<<<<
 *         print("WARNING: THIS METHOD IS NOT RECOMMENDED FOR MOST CASES BECAUSE MOVING THE IMAGES MORE THAN A CERTAIN AMOUNT CAN AFFECT THE VORONOI TESSELATION IN FARTHER OUT IMAGES OTHER THAN THE NEAREST NEIGHBORS.")
 *         xa, xb = self.intermediate_region()
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__28, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 422, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":423
 *         print('\nSOLVING LINEAR BASIS SET COEFFICIENTS, ACCELERATED METHOD')
 *         print('-----------------------------------------------------------')
 *         print("WARNING: THIS METHOD IS NOT RECOMMENDED FOR MOST CASES BECAUSE MOVING THE IMAGES MORE THAN A CERTAIN AMOUNT CAN AFFECT THE VORONOI TESSELATION IN FARTHER OUT IMAGES OTHER THAN THE NEAREST NEIGHBORS.")             # <<<<<<<<<<<<<<
 *         xa, xb = self.intermediate_region()
 *         xcenters = z[:, 0]  # x coordinates of centroids
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__29, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 423, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":424
 *         print('-----------------------------------------------------------')
 *         print("WARNING: THIS METHOD IS NOT RECOMMENDED FOR MOST CASES BECAUSE MOVING THE IMAGES MORE THAN A CERTAIN AMOUNT CAN AFFECT THE VORONOI TESSELATION IN FARTHER OUT IMAGES OTHER THAN THE NEAREST NEIGHBORS.")
 *         xa, xb = self.intermediate_region()             # <<<<<<<<<<<<<<
 *         xcenters = z[:, 0]  # x coordinates of centroids
 *         ycenters = z[:, 1]  # y coordinates of centroids
 */
  __pyx_t_1 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->intermediate_region(__pyx_v_self, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 424, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
    PyObject* sequence = __pyx_t_1;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 424, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_5 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_2 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_5 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_t_5);
    #else
    __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 424, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 424, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    #endif
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_8 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 424, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_9 = Py_TYPE(__pyx_t_8)->tp_iternext;
    index = 0; __pyx_t_2 = __pyx_t_9(__pyx_t_8); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_2);
    index = 1; __pyx_t_5 = __pyx_t_9(__pyx_t_8); if (unlikely(!__pyx_t_5)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_5);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_9(__pyx_t_8), 2) < 0) __PYX_ERR(0, 424, __pyx_L1_error)
    __pyx_t_9 = NULL;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    goto __pyx_L4_unpacking_done;
    __pyx_L3_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_9 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 424, __pyx_L1_error)
    __pyx_L4_unpacking_done:;
  }
  __pyx_t_10 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_10 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 424, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 424, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_xa = __pyx_t_10;
  __pyx_v_xb = __pyx_t_11;

  /* "vcstring.pyx":425
 *         print("WARNING: THIS METHOD IS NOT RECOMMENDED FOR MOST CASES BECAUSE MOVING THE IMAGES MORE THAN A CERTAIN AMOUNT CAN AFFECT THE VORONOI TESSELATION IN FARTHER OUT IMAGES OTHER THAN THE NEAREST NEIGHBORS.")
 *         xa, xb = self.intermediate_region()
 *         xcenters = z[:, 0]  # x coordinates of centroids             # <<<<<<<<<<<<<<
 *         ycenters = z[:, 1]  # y coordinates of centroids
 *         print('Image', image)
 */
  __pyx_t_1 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_z), __pyx_tuple__9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 425, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 425, __pyx_L1_error)
  __pyx_t_12 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer, (PyObject*)__pyx_t_12, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_13, &__pyx_t_14, &__pyx_t_15);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer, (PyObject*)__pyx_v_xcenters, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_13, __pyx_t_14, __pyx_t_15);
      }
      __pyx_t_13 = __pyx_t_14 = __pyx_t_15 = 0;
    }
    __pyx_pybuffernd_xcenters.diminfo[0].strides = __pyx_pybuffernd_xcenters.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_xcenters.diminfo[0].shape = __pyx_pybuffernd_xcenters.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 425, __pyx_L1_error)
  }
  __pyx_t_12 = 0;
  __pyx_v_xcenters = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":426
 *         xa, xb = self.intermediate_region()
 *         xcenters = z[:, 0]  # x coordinates of centroids
 *         ycenters = z[:, 1]  # y coordinates of centroids             # <<<<<<<<<<<<<<
 *         print('Image', image)
 *         print('Voronoi centroid positions:\n', z)
 */
  __pyx_t_1 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_z), __pyx_tuple__10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 426, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 426, __pyx_L1_error)
  __pyx_t_12 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer, (PyObject*)__pyx_t_12, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_15, &__pyx_t_14, &__pyx_t_13);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer, (PyObject*)__pyx_v_ycenters, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_13);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_15, __pyx_t_14, __pyx_t_13);
      }
      __pyx_t_15 = __pyx_t_14 = __pyx_t_13 = 0;
    }
    __pyx_pybuffernd_ycenters.diminfo[0].strides = __pyx_pybuffernd_ycenters.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ycenters.diminfo[0].shape = __pyx_pybuffernd_ycenters.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 426, __pyx_L1_error)
  }
  __pyx_t_12 = 0;
  __pyx_v_ycenters = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":427
 *         xcenters = z[:, 0]  # x coordinates of centroids
 *         ycenters = z[:, 1]  # y coordinates of centroids
 *         print('Image', image)             # <<<<<<<<<<<<<<
 *         print('Voronoi centroid positions:\n', z)
 *         print('theta deg', self.theta_deg)
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_image); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 427, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 427, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_INCREF(__pyx_n_u_Image);
  __Pyx_GIVEREF(__pyx_n_u_Image);
  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_n_u_Image);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 427, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":428
 *         ycenters = z[:, 1]  # y coordinates of centroids
 *         print('Image', image)
 *         print('Voronoi centroid positions:\n', z)             # <<<<<<<<<<<<<<
 *         print('theta deg', self.theta_deg)
 *         print('theta rad', self.theta)
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_Voronoi_centroid_positions);
  __Pyx_GIVEREF(__pyx_kp_u_Voronoi_centroid_positions);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Voronoi_centroid_positions);
  __Pyx_INCREF(((PyObject *)__pyx_v_z));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_z));
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 428, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "vcstring.pyx":429
 *         print('Image', image)
 *         print('Voronoi centroid positions:\n', z)
 *         print('theta deg', self.theta_deg)             # <<<<<<<<<<<<<<
 *         print('theta rad', self.theta)
 * 
 */
  __pyx_t_5 = PyFloat_FromDouble(__pyx_v_self->theta_deg); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 429, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 429, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_theta_deg_2);
  __Pyx_GIVEREF(__pyx_kp_u_theta_deg_2);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_theta_deg_2);
  __Pyx_GIVEREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 429, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "vcstring.pyx":430
 *         print('Voronoi centroid positions:\n', z)
 *         print('theta deg', self.theta_deg)
 *         print('theta rad', self.theta)             # <<<<<<<<<<<<<<
 * 
 *         N = len(traj)       # Length of trajectory
 */
  __pyx_t_5 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 430, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 430, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_theta_rad);
  __Pyx_GIVEREF(__pyx_kp_u_theta_rad);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_theta_rad);
  __Pyx_GIVEREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 430, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "vcstring.pyx":432
 *         print('theta rad', self.theta)
 * 
 *         N = len(traj)       # Length of trajectory             # <<<<<<<<<<<<<<
 *         x = [row[1] for row in traj]
 *         y = [row[2] for row in traj]
 */
  if (unlikely(__pyx_v_traj == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
    __PYX_ERR(0, 432, __pyx_L1_error)
  }
  __pyx_t_16 = PyList_GET_SIZE(__pyx_v_traj); if (unlikely(__pyx_t_16 == ((Py_ssize_t)-1))) __PYX_ERR(0, 432, __pyx_L1_error)
  __pyx_v_N = __pyx_t_16;

  /* "vcstring.pyx":433
 * 
 *         N = len(traj)       # Length of trajectory
 *         x = [row[1] for row in traj]             # <<<<<<<<<<<<<<
 *         y = [row[2] for row in traj]
 * 
 */
  { /* enter inner scope */
    __pyx_t_5 = PyList_New(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 433, __pyx_L7_error)
    __Pyx_GOTREF(__pyx_t_5);
    if (unlikely(__pyx_v_traj == Py_None)) {
      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
      __PYX_ERR(0, 433, __pyx_L7_error)
    }
    __pyx_t_1 = __pyx_v_traj; __Pyx_INCREF(__pyx_t_1); __pyx_t_16 = 0;
    for (;;) {
      if (__pyx_t_16 >= PyList_GET_SIZE(__pyx_t_1)) break;
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_16); __Pyx_INCREF(__pyx_t_2); __pyx_t_16++; if (unlikely(0 < 0)) __PYX_ERR(0, 433, __pyx_L7_error)
      #else
      __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_16); __pyx_t_16++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 433, __pyx_L7_error)
      __Pyx_GOTREF(__pyx_t_2);
      #endif
      __Pyx_XDECREF_SET(__pyx_8genexpr6__pyx_v_row, __pyx_t_2);
      __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_GetItemInt(__pyx_8genexpr6__pyx_v_row, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 433, __pyx_L7_error)
      __Pyx_GOTREF(__pyx_t_2);
      if (unlikely(__Pyx_ListComp_Append(__pyx_t_5, (PyObject*)__pyx_t_2))) __PYX_ERR(0, 433, __pyx_L7_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF(__pyx_8genexpr6__pyx_v_row); __pyx_8genexpr6__pyx_v_row = 0;
    goto __pyx_L10_exit_scope;
    __pyx_L7_error:;
    __Pyx_XDECREF(__pyx_8genexpr6__pyx_v_row); __pyx_8genexpr6__pyx_v_row = 0;
    goto __pyx_L1_error;
    __pyx_L10_exit_scope:;
  } /* exit inner scope */
  __pyx_v_x = ((PyObject*)__pyx_t_5);
  __pyx_t_5 = 0;

  /* "vcstring.pyx":434
 *         N = len(traj)       # Length of trajectory
 *         x = [row[1] for row in traj]
 *         y = [row[2] for row in traj]             # <<<<<<<<<<<<<<
 * 
 *         # Check that lag time is smaller than data set size
 */
  { /* enter inner scope */
    __pyx_t_5 = PyList_New(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 434, __pyx_L13_error)
    __Pyx_GOTREF(__pyx_t_5);
    if (unlikely(__pyx_v_traj == Py_None)) {
      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
      __PYX_ERR(0, 434, __pyx_L13_error)
    }
    __pyx_t_1 = __pyx_v_traj; __Pyx_INCREF(__pyx_t_1); __pyx_t_16 = 0;
    for (;;) {
      if (__pyx_t_16 >= PyList_GET_SIZE(__pyx_t_1)) break;
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_16); __Pyx_INCREF(__pyx_t_2); __pyx_t_16++; if (unlikely(0 < 0)) __PYX_ERR(0, 434, __pyx_L13_error)
      #else
      __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_16); __pyx_t_16++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 434, __pyx_L13_error)
      __Pyx_GOTREF(__pyx_t_2);
      #endif
      __Pyx_XDECREF_SET(__pyx_8genexpr7__pyx_v_row, __pyx_t_2);
      __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_GetItemInt(__pyx_8genexpr7__pyx_v_row, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 434, __pyx_L13_error)
      __Pyx_GOTREF(__pyx_t_2);
      if (unlikely(__Pyx_ListComp_Append(__pyx_t_5, (PyObject*)__pyx_t_2))) __PYX_ERR(0, 434, __pyx_L13_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF(__pyx_8genexpr7__pyx_v_row); __pyx_8genexpr7__pyx_v_row = 0;
    goto __pyx_L16_exit_scope;
    __pyx_L13_error:;
    __Pyx_XDECREF(__pyx_8genexpr7__pyx_v_row); __pyx_8genexpr7__pyx_v_row = 0;
    goto __pyx_L1_error;
    __pyx_L16_exit_scope:;
  } /* exit inner scope */
  __pyx_v_y = ((PyObject*)__pyx_t_5);
  __pyx_t_5 = 0;

  /* "vcstring.pyx":437
 * 
 *         # Check that lag time is smaller than data set size
 *         if tau > N:             # <<<<<<<<<<<<<<
 *             raise RuntimeError ("\nInvalid lag time. Use a smaller lag time.")
 *             exit()
 */
  __pyx_t_17 = ((__pyx_v_tau > __pyx_v_N) != 0);
  if (unlikely(__pyx_t_17)) {

    /* "vcstring.pyx":438
 *         # Check that lag time is smaller than data set size
 *         if tau > N:
 *             raise RuntimeError ("\nInvalid lag time. Use a smaller lag time.")             # <<<<<<<<<<<<<<
 *             exit()
 * 
 */
    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__11, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 438, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_Raise(__pyx_t_5, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __PYX_ERR(0, 438, __pyx_L1_error)

    /* "vcstring.pyx":437
 * 
 *         # Check that lag time is smaller than data set size
 *         if tau > N:             # <<<<<<<<<<<<<<
 *             raise RuntimeError ("\nInvalid lag time. Use a smaller lag time.")
 *             exit()
 */
  }

  /* "vcstring.pyx":442
 * 
 *         # Compute matrix/vector elements
 *         dat = np.load('output/coeffs_input.npz')             # <<<<<<<<<<<<<<
 *         D_0 = dat['D_0']
 *         D_tau = dat['D_tau']
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 442, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_load); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 442, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_5 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_1, __pyx_kp_u_output_coeffs_input_npz) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_kp_u_output_coeffs_input_npz);
  __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 442, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_dat = __pyx_t_5;
  __pyx_t_5 = 0;

  /* "vcstring.pyx":443
 *         # Compute matrix/vector elements
 *         dat = np.load('output/coeffs_input.npz')
 *         D_0 = dat['D_0']             # <<<<<<<<<<<<<<
 *         D_tau = dat['D_tau']
 *         g_0 = dat['g_0']
 */
  __pyx_t_5 = __Pyx_PyObject_Dict_GetItem(__pyx_v_dat, __pyx_n_u_D_0_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 443, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 443, __pyx_L1_error)
  __pyx_t_18 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_18, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_13, &__pyx_t_14, &__pyx_t_15);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_13, __pyx_t_14, __pyx_t_15);
      }
      __pyx_t_13 = __pyx_t_14 = __pyx_t_15 = 0;
    }
    __pyx_pybuffernd_D_0.diminfo[0].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0.diminfo[0].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0.diminfo[1].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0.diminfo[1].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 443, __pyx_L1_error)
  }
  __pyx_t_18 = 0;
  __pyx_v_D_0 = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;

  /* "vcstring.pyx":444
 *         dat = np.load('output/coeffs_input.npz')
 *         D_0 = dat['D_0']
 *         D_tau = dat['D_tau']             # <<<<<<<<<<<<<<
 *         g_0 = dat['g_0']
 *         g_tau = dat['g_tau']
 */
  __pyx_t_5 = __Pyx_PyObject_Dict_GetItem(__pyx_v_dat, __pyx_n_u_D_tau_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 444, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 444, __pyx_L1_error)
  __pyx_t_18 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_18, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_15, &__pyx_t_14, &__pyx_t_13);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_13);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_15, __pyx_t_14, __pyx_t_13);
      }
      __pyx_t_15 = __pyx_t_14 = __pyx_t_13 = 0;
    }
    __pyx_pybuffernd_D_tau.diminfo[0].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau.diminfo[0].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau.diminfo[1].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau.diminfo[1].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 444, __pyx_L1_error)
  }
  __pyx_t_18 = 0;
  __pyx_v_D_tau = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;

  /* "vcstring.pyx":445
 *         D_0 = dat['D_0']
 *         D_tau = dat['D_tau']
 *         g_0 = dat['g_0']             # <<<<<<<<<<<<<<
 *         g_tau = dat['g_tau']
 *         b = dat['b']
 */
  __pyx_t_5 = __Pyx_PyObject_Dict_GetItem(__pyx_v_dat, __pyx_n_u_g_0_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 445, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 445, __pyx_L1_error)
  __pyx_t_19 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_19, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_13, &__pyx_t_14, &__pyx_t_15);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_13, __pyx_t_14, __pyx_t_15);
      }
      __pyx_t_13 = __pyx_t_14 = __pyx_t_15 = 0;
    }
    __pyx_pybuffernd_g_0.diminfo[0].strides = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_0.diminfo[0].shape = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 445, __pyx_L1_error)
  }
  __pyx_t_19 = 0;
  __pyx_v_g_0 = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;

  /* "vcstring.pyx":446
 *         D_tau = dat['D_tau']
 *         g_0 = dat['g_0']
 *         g_tau = dat['g_tau']             # <<<<<<<<<<<<<<
 *         b = dat['b']
 *         print('\nInput data')
 */
  __pyx_t_5 = __Pyx_PyObject_Dict_GetItem(__pyx_v_dat, __pyx_n_u_g_tau_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 446, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 446, __pyx_L1_error)
  __pyx_t_19 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_19, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_15, &__pyx_t_14, &__pyx_t_13);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_13);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_15, __pyx_t_14, __pyx_t_13);
      }
      __pyx_t_15 = __pyx_t_14 = __pyx_t_13 = 0;
    }
    __pyx_pybuffernd_g_tau.diminfo[0].strides = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_tau.diminfo[0].shape = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 446, __pyx_L1_error)
  }
  __pyx_t_19 = 0;
  __pyx_v_g_tau = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;

  /* "vcstring.pyx":447
 *         g_0 = dat['g_0']
 *         g_tau = dat['g_tau']
 *         b = dat['b']             # <<<<<<<<<<<<<<
 *         print('\nInput data')
 *         print('D_0 =', D_0)
 */
  __pyx_t_5 = __Pyx_PyObject_Dict_GetItem(__pyx_v_dat, __pyx_n_u_b_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 447, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 447, __pyx_L1_error)
  __pyx_t_20 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_t_20, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_13, &__pyx_t_14, &__pyx_t_15);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_13, __pyx_t_14, __pyx_t_15);
      }
      __pyx_t_13 = __pyx_t_14 = __pyx_t_15 = 0;
    }
    __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 447, __pyx_L1_error)
  }
  __pyx_t_20 = 0;
  __pyx_v_b = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;

  /* "vcstring.pyx":448
 *         g_tau = dat['g_tau']
 *         b = dat['b']
 *         print('\nInput data')             # <<<<<<<<<<<<<<
 *         print('D_0 =', D_0)
 *         print('D_tau =', D_tau)
 */
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__30, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 448, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "vcstring.pyx":449
 *         b = dat['b']
 *         print('\nInput data')
 *         print('D_0 =', D_0)             # <<<<<<<<<<<<<<
 *         print('D_tau =', D_tau)
 *         print('g_0 =', g_0)
 */
  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 449, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_INCREF(__pyx_kp_u_D_0);
  __Pyx_GIVEREF(__pyx_kp_u_D_0);
  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_kp_u_D_0);
  __Pyx_INCREF(((PyObject *)__pyx_v_D_0));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_0));
  PyTuple_SET_ITEM(__pyx_t_5, 1, ((PyObject *)__pyx_v_D_0));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_5, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 449, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":450
 *         print('\nInput data')
 *         print('D_0 =', D_0)
 *         print('D_tau =', D_tau)             # <<<<<<<<<<<<<<
 *         print('g_0 =', g_0)
 *         print('g_tau =', g_tau)
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 450, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_D_tau);
  __Pyx_GIVEREF(__pyx_kp_u_D_tau);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_D_tau);
  __Pyx_INCREF(((PyObject *)__pyx_v_D_tau));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_tau));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_D_tau));
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 450, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "vcstring.pyx":451
 *         print('D_0 =', D_0)
 *         print('D_tau =', D_tau)
 *         print('g_0 =', g_0)             # <<<<<<<<<<<<<<
 *         print('g_tau =', g_tau)
 *         print('b =', b)
 */
  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 451, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_INCREF(__pyx_kp_u_g_0);
  __Pyx_GIVEREF(__pyx_kp_u_g_0);
  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_kp_u_g_0);
  __Pyx_INCREF(((PyObject *)__pyx_v_g_0));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_0));
  PyTuple_SET_ITEM(__pyx_t_5, 1, ((PyObject *)__pyx_v_g_0));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_5, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 451, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":452
 *         print('D_tau =', D_tau)
 *         print('g_0 =', g_0)
 *         print('g_tau =', g_tau)             # <<<<<<<<<<<<<<
 *         print('b =', b)
 * 
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 452, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_g_tau);
  __Pyx_GIVEREF(__pyx_kp_u_g_tau);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_g_tau);
  __Pyx_INCREF(((PyObject *)__pyx_v_g_tau));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_tau));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_g_tau));
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 452, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "vcstring.pyx":453
 *         print('g_0 =', g_0)
 *         print('g_tau =', g_tau)
 *         print('b =', b)             # <<<<<<<<<<<<<<
 * 
 *         # Find the images that cause changes to matrix/vector elements
 */
  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 453, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_INCREF(__pyx_kp_u_b);
  __Pyx_GIVEREF(__pyx_kp_u_b);
  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_kp_u_b);
  __Pyx_INCREF(((PyObject *)__pyx_v_b));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
  PyTuple_SET_ITEM(__pyx_t_5, 1, ((PyObject *)__pyx_v_b));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_5, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 453, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":457
 *         # Find the images that cause changes to matrix/vector elements
 *         # indices should be the specified image and it's nearest neighbors: image-1, image, image+1
 *         if image == 0:             # <<<<<<<<<<<<<<
 *             affected_images = [image, image+1]
 *         elif image == self.num_basis-1:
 */
  __pyx_t_17 = ((__pyx_v_image == 0) != 0);
  if (__pyx_t_17) {

    /* "vcstring.pyx":458
 *         # indices should be the specified image and it's nearest neighbors: image-1, image, image+1
 *         if image == 0:
 *             affected_images = [image, image+1]             # <<<<<<<<<<<<<<
 *         elif image == self.num_basis-1:
 *             affected_images = [image-1, image]
 */
    __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_image); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 458, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = __Pyx_PyInt_From_long((__pyx_v_image + 1)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 458, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_1 = PyList_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 458, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_2);
    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_5);
    PyList_SET_ITEM(__pyx_t_1, 1, __pyx_t_5);
    __pyx_t_2 = 0;
    __pyx_t_5 = 0;
    __pyx_v_affected_images = ((PyObject*)__pyx_t_1);
    __pyx_t_1 = 0;

    /* "vcstring.pyx":457
 *         # Find the images that cause changes to matrix/vector elements
 *         # indices should be the specified image and it's nearest neighbors: image-1, image, image+1
 *         if image == 0:             # <<<<<<<<<<<<<<
 *             affected_images = [image, image+1]
 *         elif image == self.num_basis-1:
 */
    goto __pyx_L18;
  }

  /* "vcstring.pyx":459
 *         if image == 0:
 *             affected_images = [image, image+1]
 *         elif image == self.num_basis-1:             # <<<<<<<<<<<<<<
 *             affected_images = [image-1, image]
 *         else:
 */
  __pyx_t_17 = ((__pyx_v_image == (__pyx_v_self->num_basis - 1)) != 0);
  if (__pyx_t_17) {

    /* "vcstring.pyx":460
 *             affected_images = [image, image+1]
 *         elif image == self.num_basis-1:
 *             affected_images = [image-1, image]             # <<<<<<<<<<<<<<
 *         else:
 *             affected_images = [image-1, image, image+1]
 */
    __pyx_t_1 = __Pyx_PyInt_From_long((__pyx_v_image - 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 460, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_image); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 460, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_2 = PyList_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 460, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_1);
    PyList_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_5);
    PyList_SET_ITEM(__pyx_t_2, 1, __pyx_t_5);
    __pyx_t_1 = 0;
    __pyx_t_5 = 0;
    __pyx_v_affected_images = ((PyObject*)__pyx_t_2);
    __pyx_t_2 = 0;

    /* "vcstring.pyx":459
 *         if image == 0:
 *             affected_images = [image, image+1]
 *         elif image == self.num_basis-1:             # <<<<<<<<<<<<<<
 *             affected_images = [image-1, image]
 *         else:
 */
    goto __pyx_L18;
  }

  /* "vcstring.pyx":462
 *             affected_images = [image-1, image]
 *         else:
 *             affected_images = [image-1, image, image+1]             # <<<<<<<<<<<<<<
 *         print('\nAffected images:', affected_images)
 * 
 */
  /*else*/ {
    __pyx_t_2 = __Pyx_PyInt_From_long((__pyx_v_image - 1)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 462, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_image); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 462, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_1 = __Pyx_PyInt_From_long((__pyx_v_image + 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 462, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = PyList_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 462, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_GIVEREF(__pyx_t_2);
    PyList_SET_ITEM(__pyx_t_8, 0, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_5);
    PyList_SET_ITEM(__pyx_t_8, 1, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_1);
    PyList_SET_ITEM(__pyx_t_8, 2, __pyx_t_1);
    __pyx_t_2 = 0;
    __pyx_t_5 = 0;
    __pyx_t_1 = 0;
    __pyx_v_affected_images = ((PyObject*)__pyx_t_8);
    __pyx_t_8 = 0;
  }
  __pyx_L18:;

  /* "vcstring.pyx":463
 *         else:
 *             affected_images = [image-1, image, image+1]
 *         print('\nAffected images:', affected_images)             # <<<<<<<<<<<<<<
 * 
 *         for i in range(len(xcenters)):
 */
  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 463, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_INCREF(__pyx_kp_u_Affected_images);
  __Pyx_GIVEREF(__pyx_kp_u_Affected_images);
  PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_kp_u_Affected_images);
  __Pyx_INCREF(__pyx_v_affected_images);
  __Pyx_GIVEREF(__pyx_v_affected_images);
  PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_v_affected_images);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 463, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":465
 *         print('\nAffected images:', affected_images)
 * 
 *         for i in range(len(xcenters)):             # <<<<<<<<<<<<<<
 *             # val_g_0, val_g_tau = 0.0, 0.0
 *             for j in range(len(xcenters)):
 */
  __pyx_t_16 = PyObject_Length(((PyObject *)__pyx_v_xcenters)); if (unlikely(__pyx_t_16 == ((Py_ssize_t)-1))) __PYX_ERR(0, 465, __pyx_L1_error)
  __pyx_t_21 = __pyx_t_16;
  for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_21; __pyx_t_7+=1) {
    __pyx_v_i = __pyx_t_7;

    /* "vcstring.pyx":467
 *         for i in range(len(xcenters)):
 *             # val_g_0, val_g_tau = 0.0, 0.0
 *             for j in range(len(xcenters)):             # <<<<<<<<<<<<<<
 *                 if i in affected_images or j in affected_images: # Update specific elements
 *                     print("Matrix elements", i, j)
 */
    __pyx_t_22 = PyObject_Length(((PyObject *)__pyx_v_xcenters)); if (unlikely(__pyx_t_22 == ((Py_ssize_t)-1))) __PYX_ERR(0, 467, __pyx_L1_error)
    __pyx_t_23 = __pyx_t_22;
    for (__pyx_t_24 = 0; __pyx_t_24 < __pyx_t_23; __pyx_t_24+=1) {
      __pyx_v_j = __pyx_t_24;

      /* "vcstring.pyx":468
 *             # val_g_0, val_g_tau = 0.0, 0.0
 *             for j in range(len(xcenters)):
 *                 if i in affected_images or j in affected_images: # Update specific elements             # <<<<<<<<<<<<<<
 *                     print("Matrix elements", i, j)
 *                     sys.stdout.flush()
 */
      __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 468, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_25 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_v_affected_images, Py_EQ)); if (unlikely(__pyx_t_25 < 0)) __PYX_ERR(0, 468, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_26 = (__pyx_t_25 != 0);
      if (!__pyx_t_26) {
      } else {
        __pyx_t_17 = __pyx_t_26;
        goto __pyx_L24_bool_binop_done;
      }
      __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_j); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 468, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_26 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_v_affected_images, Py_EQ)); if (unlikely(__pyx_t_26 < 0)) __PYX_ERR(0, 468, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_25 = (__pyx_t_26 != 0);
      __pyx_t_17 = __pyx_t_25;
      __pyx_L24_bool_binop_done:;
      if (__pyx_t_17) {

        /* "vcstring.pyx":469
 *             for j in range(len(xcenters)):
 *                 if i in affected_images or j in affected_images: # Update specific elements
 *                     print("Matrix elements", i, j)             # <<<<<<<<<<<<<<
 *                     sys.stdout.flush()
 *                     D_0[i][j] = 0.0
 */
        __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 469, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_j); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 469, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 469, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_INCREF(__pyx_kp_u_Matrix_elements);
        __Pyx_GIVEREF(__pyx_kp_u_Matrix_elements);
        PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_kp_u_Matrix_elements);
        __Pyx_GIVEREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_1);
        __Pyx_GIVEREF(__pyx_t_8);
        PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_t_8);
        __pyx_t_1 = 0;
        __pyx_t_8 = 0;
        __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_5, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 469, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

        /* "vcstring.pyx":470
 *                 if i in affected_images or j in affected_images: # Update specific elements
 *                     print("Matrix elements", i, j)
 *                     sys.stdout.flush()             # <<<<<<<<<<<<<<
 *                     D_0[i][j] = 0.0
 *                     D_tau[i][j] = 0.0
 */
        __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sys); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 470, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_stdout); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 470, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_flush); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 470, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = NULL;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
          __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_5);
          if (likely(__pyx_t_1)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
            __Pyx_INCREF(__pyx_t_1);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_5, function);
          }
        }
        __pyx_t_8 = (__pyx_t_1) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_1) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
        __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
        if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 470, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

        /* "vcstring.pyx":471
 *                     print("Matrix elements", i, j)
 *                     sys.stdout.flush()
 *                     D_0[i][j] = 0.0             # <<<<<<<<<<<<<<
 *                     D_tau[i][j] = 0.0
 *                     if j == 0:
 */
        __pyx_t_8 = __Pyx_GetItemInt(((PyObject *)__pyx_v_D_0), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 471, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        if (unlikely(__Pyx_SetItemInt(__pyx_t_8, __pyx_v_j, __pyx_float_0_0, int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 471, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

        /* "vcstring.pyx":472
 *                     sys.stdout.flush()
 *                     D_0[i][j] = 0.0
 *                     D_tau[i][j] = 0.0             # <<<<<<<<<<<<<<
 *                     if j == 0:
 *                         g_0[i] = np.sum(g_0[0:i])
 */
        __pyx_t_8 = __Pyx_GetItemInt(((PyObject *)__pyx_v_D_tau), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 472, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        if (unlikely(__Pyx_SetItemInt(__pyx_t_8, __pyx_v_j, __pyx_float_0_0, int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 472, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

        /* "vcstring.pyx":473
 *                     D_0[i][j] = 0.0
 *                     D_tau[i][j] = 0.0
 *                     if j == 0:             # <<<<<<<<<<<<<<
 *                         g_0[i] = np.sum(g_0[0:i])
 *                         g_tau[i] = np.sum(g_tau[0:i])
 */
        __pyx_t_17 = ((__pyx_v_j == 0) != 0);
        if (__pyx_t_17) {

          /* "vcstring.pyx":474
 *                     D_tau[i][j] = 0.0
 *                     if j == 0:
 *                         g_0[i] = np.sum(g_0[0:i])             # <<<<<<<<<<<<<<
 *                         g_tau[i] = np.sum(g_tau[0:i])
 * 
 */
          __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 474, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_sum); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 474, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 474, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_2 = PySlice_New(__pyx_int_0, __pyx_t_5, Py_None); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 474, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_g_0), __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 474, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
            __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
            if (likely(__pyx_t_2)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
              __Pyx_INCREF(__pyx_t_2);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_1, function);
            }
          }
          __pyx_t_8 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_2, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_5);
          __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 474, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_27 = __pyx_PyFloat_AsDouble(__pyx_t_8); if (unlikely((__pyx_t_27 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 474, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_t_28 = __pyx_v_i;
          __pyx_t_29 = -1;
          if (__pyx_t_28 < 0) {
            __pyx_t_28 += __pyx_pybuffernd_g_0.diminfo[0].shape;
            if (unlikely(__pyx_t_28 < 0)) __pyx_t_29 = 0;
          } else if (unlikely(__pyx_t_28 >= __pyx_pybuffernd_g_0.diminfo[0].shape)) __pyx_t_29 = 0;
          if (unlikely(__pyx_t_29 != -1)) {
            __Pyx_RaiseBufferIndexError(__pyx_t_29);
            __PYX_ERR(0, 474, __pyx_L1_error)
          }
          *__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_g_0.rcbuffer->pybuffer.buf, __pyx_t_28, __pyx_pybuffernd_g_0.diminfo[0].strides) = __pyx_t_27;

          /* "vcstring.pyx":475
 *                     if j == 0:
 *                         g_0[i] = np.sum(g_0[0:i])
 *                         g_tau[i] = np.sum(g_tau[0:i])             # <<<<<<<<<<<<<<
 * 
 *                     for t in range(N - tau):
 */
          __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 475, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_sum); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 475, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 475, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_2 = PySlice_New(__pyx_int_0, __pyx_t_1, Py_None); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 475, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_g_tau), __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 475, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
            __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_5);
            if (likely(__pyx_t_2)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
              __Pyx_INCREF(__pyx_t_2);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_5, function);
            }
          }
          __pyx_t_8 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_2, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_1);
          __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 475, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_27 = __pyx_PyFloat_AsDouble(__pyx_t_8); if (unlikely((__pyx_t_27 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 475, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_t_28 = __pyx_v_i;
          __pyx_t_29 = -1;
          if (__pyx_t_28 < 0) {
            __pyx_t_28 += __pyx_pybuffernd_g_tau.diminfo[0].shape;
            if (unlikely(__pyx_t_28 < 0)) __pyx_t_29 = 0;
          } else if (unlikely(__pyx_t_28 >= __pyx_pybuffernd_g_tau.diminfo[0].shape)) __pyx_t_29 = 0;
          if (unlikely(__pyx_t_29 != -1)) {
            __Pyx_RaiseBufferIndexError(__pyx_t_29);
            __PYX_ERR(0, 475, __pyx_L1_error)
          }
          *__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.buf, __pyx_t_28, __pyx_pybuffernd_g_tau.diminfo[0].strides) = __pyx_t_27;

          /* "vcstring.pyx":473
 *                     D_0[i][j] = 0.0
 *                     D_tau[i][j] = 0.0
 *                     if j == 0:             # <<<<<<<<<<<<<<
 *                         g_0[i] = np.sum(g_0[0:i])
 *                         g_tau[i] = np.sum(g_tau[0:i])
 */
        }

        /* "vcstring.pyx":477
 *                         g_tau[i] = np.sum(g_tau[0:i])
 * 
 *                     for t in range(N - tau):             # <<<<<<<<<<<<<<
 *                         # Get snapshot at time t and t + tau
 *                         x_t = x[t]
 */
        __pyx_t_29 = (__pyx_v_N - __pyx_v_tau);
        __pyx_t_30 = __pyx_t_29;
        for (__pyx_t_31 = 0; __pyx_t_31 < __pyx_t_30; __pyx_t_31+=1) {
          __pyx_v_t = __pyx_t_31;

          /* "vcstring.pyx":479
 *                     for t in range(N - tau):
 *                         # Get snapshot at time t and t + tau
 *                         x_t = x[t]             # <<<<<<<<<<<<<<
 *                         y_t = y[t]
 *                         x_tau = x[t + tau]
 */
          __pyx_t_8 = __Pyx_GetItemInt_List(__pyx_v_x, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 479, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_8); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 479, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_v_x_t = __pyx_t_11;

          /* "vcstring.pyx":480
 *                         # Get snapshot at time t and t + tau
 *                         x_t = x[t]
 *                         y_t = y[t]             # <<<<<<<<<<<<<<
 *                         x_tau = x[t + tau]
 *                         y_tau = y[t + tau]
 */
          __pyx_t_8 = __Pyx_GetItemInt_List(__pyx_v_y, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 480, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_8); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 480, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_v_y_t = __pyx_t_11;

          /* "vcstring.pyx":481
 *                         x_t = x[t]
 *                         y_t = y[t]
 *                         x_tau = x[t + tau]             # <<<<<<<<<<<<<<
 *                         y_tau = y[t + tau]
 * 
 */
          __pyx_t_32 = (__pyx_v_t + __pyx_v_tau);
          __pyx_t_8 = __Pyx_GetItemInt_List(__pyx_v_x, __pyx_t_32, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 481, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_8); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 481, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_v_x_tau = __pyx_t_11;

          /* "vcstring.pyx":482
 *                         y_t = y[t]
 *                         x_tau = x[t + tau]
 *                         y_tau = y[t + tau]             # <<<<<<<<<<<<<<
 * 
 *                         # Find nearest Voronoi center from (x,y)
 */
          __pyx_t_32 = (__pyx_v_t + __pyx_v_tau);
          __pyx_t_8 = __Pyx_GetItemInt_List(__pyx_v_y, __pyx_t_32, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 482, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_8); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 482, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_v_y_tau = __pyx_t_11;

          /* "vcstring.pyx":485
 * 
 *                         # Find nearest Voronoi center from (x,y)
 *                         dist_t = sqrt((x_t - xcenters)**2 + (y_t - ycenters)**2)             # <<<<<<<<<<<<<<
 *                         dist_tau = sqrt((x_tau - xcenters)**2 + (y_tau - ycenters)**2)
 *                         nc_t = np.argmin(dist_t)
 */
          __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 485, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_1 = PyFloat_FromDouble(__pyx_v_x_t); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_2 = PyNumber_Subtract(__pyx_t_1, ((PyObject *)__pyx_v_xcenters)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 485, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = PyNumber_Power(__pyx_t_2, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = PyFloat_FromDouble(__pyx_v_y_t); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 485, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_4 = PyNumber_Subtract(__pyx_t_2, ((PyObject *)__pyx_v_ycenters)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = PyNumber_Power(__pyx_t_4, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 485, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = PyNumber_Add(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
            __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_5);
            if (likely(__pyx_t_2)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
              __Pyx_INCREF(__pyx_t_2);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_5, function);
            }
          }
          __pyx_t_8 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_4);
          __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 485, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          if (!(likely(((__pyx_t_8) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_8, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 485, __pyx_L1_error)
          __pyx_t_33 = ((PyArrayObject *)__pyx_t_8);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_t.rcbuffer->pybuffer);
            __pyx_t_32 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist_t.rcbuffer->pybuffer, (PyObject*)__pyx_t_33, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_32 < 0)) {
              PyErr_Fetch(&__pyx_t_15, &__pyx_t_14, &__pyx_t_13);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist_t.rcbuffer->pybuffer, (PyObject*)__pyx_v_dist_t, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_13);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_15, __pyx_t_14, __pyx_t_13);
              }
              __pyx_t_15 = __pyx_t_14 = __pyx_t_13 = 0;
            }
            __pyx_pybuffernd_dist_t.diminfo[0].strides = __pyx_pybuffernd_dist_t.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_dist_t.diminfo[0].shape = __pyx_pybuffernd_dist_t.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_32 < 0)) __PYX_ERR(0, 485, __pyx_L1_error)
          }
          __pyx_t_33 = 0;
          __Pyx_XDECREF_SET(__pyx_v_dist_t, ((PyArrayObject *)__pyx_t_8));
          __pyx_t_8 = 0;

          /* "vcstring.pyx":486
 *                         # Find nearest Voronoi center from (x,y)
 *                         dist_t = sqrt((x_t - xcenters)**2 + (y_t - ycenters)**2)
 *                         dist_tau = sqrt((x_tau - xcenters)**2 + (y_tau - ycenters)**2)             # <<<<<<<<<<<<<<
 *                         nc_t = np.argmin(dist_t)
 *                         nc_tau = np.argmin(dist_tau)
 */
          __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 486, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_4 = PyFloat_FromDouble(__pyx_v_x_tau); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 486, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_2 = PyNumber_Subtract(__pyx_t_4, ((PyObject *)__pyx_v_xcenters)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 486, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = PyNumber_Power(__pyx_t_2, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 486, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = PyFloat_FromDouble(__pyx_v_y_tau); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 486, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_1 = PyNumber_Subtract(__pyx_t_2, ((PyObject *)__pyx_v_ycenters)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 486, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = PyNumber_Power(__pyx_t_1, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 486, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = PyNumber_Add(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 486, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
            __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_5);
            if (likely(__pyx_t_2)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
              __Pyx_INCREF(__pyx_t_2);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_5, function);
            }
          }
          __pyx_t_8 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_2, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_1);
          __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 486, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          if (!(likely(((__pyx_t_8) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_8, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 486, __pyx_L1_error)
          __pyx_t_33 = ((PyArrayObject *)__pyx_t_8);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_tau.rcbuffer->pybuffer);
            __pyx_t_32 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_33, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_32 < 0)) {
              PyErr_Fetch(&__pyx_t_13, &__pyx_t_14, &__pyx_t_15);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_dist_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_13, __pyx_t_14, __pyx_t_15);
              }
              __pyx_t_13 = __pyx_t_14 = __pyx_t_15 = 0;
            }
            __pyx_pybuffernd_dist_tau.diminfo[0].strides = __pyx_pybuffernd_dist_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_dist_tau.diminfo[0].shape = __pyx_pybuffernd_dist_tau.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_32 < 0)) __PYX_ERR(0, 486, __pyx_L1_error)
          }
          __pyx_t_33 = 0;
          __Pyx_XDECREF_SET(__pyx_v_dist_tau, ((PyArrayObject *)__pyx_t_8));
          __pyx_t_8 = 0;

          /* "vcstring.pyx":487
 *                         dist_t = sqrt((x_t - xcenters)**2 + (y_t - ycenters)**2)
 *                         dist_tau = sqrt((x_tau - xcenters)**2 + (y_tau - ycenters)**2)
 *                         nc_t = np.argmin(dist_t)             # <<<<<<<<<<<<<<
 *                         nc_tau = np.argmin(dist_tau)
 * 
 */
          __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 487, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_argmin); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 487, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
            __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
            if (likely(__pyx_t_5)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
              __Pyx_INCREF(__pyx_t_5);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_1, function);
            }
          }
          __pyx_t_8 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_5, ((PyObject *)__pyx_v_dist_t)) : __Pyx_PyObject_CallOneArg(__pyx_t_1, ((PyObject *)__pyx_v_dist_t));
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 487, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_8); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 487, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_v_nc_t = __pyx_t_11;

          /* "vcstring.pyx":488
 *                         dist_tau = sqrt((x_tau - xcenters)**2 + (y_tau - ycenters)**2)
 *                         nc_t = np.argmin(dist_t)
 *                         nc_tau = np.argmin(dist_tau)             # <<<<<<<<<<<<<<
 * 
 *                         # Orthogonal projection of (x,y) -> (u,v) onto reaction coordinate
 */
          __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_argmin); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 488, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
            __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_5);
            if (likely(__pyx_t_1)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
              __Pyx_INCREF(__pyx_t_1);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_5, function);
            }
          }
          __pyx_t_8 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_1, ((PyObject *)__pyx_v_dist_tau)) : __Pyx_PyObject_CallOneArg(__pyx_t_5, ((PyObject *)__pyx_v_dist_tau));
          __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
          if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 488, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_8); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 488, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_v_nc_tau = __pyx_t_11;

          /* "vcstring.pyx":491
 * 
 *                         # Orthogonal projection of (x,y) -> (u,v) onto reaction coordinate
 *                         u_t = (y_t * tan(self.theta) + x_t) / (tan(self.theta)**2 + 1)             # <<<<<<<<<<<<<<
 *                         u_tau = (y_tau * tan(self.theta) + x_tau) / (tan(self.theta)**2 + 1)
 * 
 */
          __pyx_t_8 = PyFloat_FromDouble(__pyx_v_y_t); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 491, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_tan); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 491, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_2 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 491, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_4 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
            __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
            if (likely(__pyx_t_4)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
              __Pyx_INCREF(__pyx_t_4);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_1, function);
            }
          }
          __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_2);
          __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 491, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = PyNumber_Multiply(__pyx_t_8, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 491, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = PyFloat_FromDouble(__pyx_v_x_t); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 491, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_8 = PyNumber_Add(__pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 491, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_tan); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 491, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_2 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 491, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_4 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
            __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
            if (likely(__pyx_t_4)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
              __Pyx_INCREF(__pyx_t_4);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_1, function);
            }
          }
          __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_2);
          __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 491, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = PyNumber_Power(__pyx_t_5, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 491, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = __Pyx_PyInt_AddObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 491, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_t_8, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 491, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 491, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_v_u_t = __pyx_t_11;

          /* "vcstring.pyx":492
 *                         # Orthogonal projection of (x,y) -> (u,v) onto reaction coordinate
 *                         u_t = (y_t * tan(self.theta) + x_t) / (tan(self.theta)**2 + 1)
 *                         u_tau = (y_tau * tan(self.theta) + x_tau) / (tan(self.theta)**2 + 1)             # <<<<<<<<<<<<<<
 * 
 *                         # Check if (u,v) is inside/outside of the intermediate region
 */
          __pyx_t_1 = PyFloat_FromDouble(__pyx_v_y_tau); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 492, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_tan); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 492, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __pyx_t_2 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 492, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_4 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
            __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_8);
            if (likely(__pyx_t_4)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
              __Pyx_INCREF(__pyx_t_4);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_8, function);
            }
          }
          __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_2);
          __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 492, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_t_8 = PyNumber_Multiply(__pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 492, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = PyFloat_FromDouble(__pyx_v_x_tau); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 492, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_1 = PyNumber_Add(__pyx_t_8, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 492, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_tan); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 492, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __pyx_t_2 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 492, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_4 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
            __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_8);
            if (likely(__pyx_t_4)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
              __Pyx_INCREF(__pyx_t_4);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_8, function);
            }
          }
          __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_2);
          __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 492, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_t_8 = PyNumber_Power(__pyx_t_5, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 492, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = __Pyx_PyInt_AddObjC(__pyx_t_8, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 492, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_t_8 = __Pyx_PyNumber_Divide(__pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 492, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_8); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 492, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __pyx_v_u_tau = __pyx_t_11;

          /* "vcstring.pyx":495
 * 
 *                         # Check if (u,v) is inside/outside of the intermediate region
 *                         f_i0, f_itau, f_j = 0.0, 0.0, 0.0  # Voronoi basis functions             # <<<<<<<<<<<<<<
 *                         h_I0, h_B0, h_Itau, h_Btau = 0.0, 0.0, 0.0, 0.0  # Indicator functions of states
 * 
 */
          __pyx_t_11 = 0.0;
          __pyx_t_10 = 0.0;
          __pyx_t_34 = 0.0;
          __pyx_v_f_i0 = __pyx_t_11;
          __pyx_v_f_itau = __pyx_t_10;
          __pyx_v_f_j = __pyx_t_34;

          /* "vcstring.pyx":496
 *                         # Check if (u,v) is inside/outside of the intermediate region
 *                         f_i0, f_itau, f_j = 0.0, 0.0, 0.0  # Voronoi basis functions
 *                         h_I0, h_B0, h_Itau, h_Btau = 0.0, 0.0, 0.0, 0.0  # Indicator functions of states             # <<<<<<<<<<<<<<
 * 
 *                         if u_t >= xa and u_t <= xb:  # Intermediate region
 */
          __pyx_t_34 = 0.0;
          __pyx_t_10 = 0.0;
          __pyx_t_11 = 0.0;
          __pyx_t_35 = 0.0;
          __pyx_v_h_I0 = __pyx_t_34;
          __pyx_v_h_B0 = __pyx_t_10;
          __pyx_v_h_Itau = __pyx_t_11;
          __pyx_v_h_Btau = __pyx_t_35;

          /* "vcstring.pyx":498
 *                         h_I0, h_B0, h_Itau, h_Btau = 0.0, 0.0, 0.0, 0.0  # Indicator functions of states
 * 
 *                         if u_t >= xa and u_t <= xb:  # Intermediate region             # <<<<<<<<<<<<<<
 *                             h_I0 = 1.0
 *                             if i == nc_t:
 */
          __pyx_t_25 = ((__pyx_v_u_t >= __pyx_v_xa) != 0);
          if (__pyx_t_25) {
          } else {
            __pyx_t_17 = __pyx_t_25;
            goto __pyx_L30_bool_binop_done;
          }
          __pyx_t_25 = ((__pyx_v_u_t <= __pyx_v_xb) != 0);
          __pyx_t_17 = __pyx_t_25;
          __pyx_L30_bool_binop_done:;
          if (__pyx_t_17) {

            /* "vcstring.pyx":499
 * 
 *                         if u_t >= xa and u_t <= xb:  # Intermediate region
 *                             h_I0 = 1.0             # <<<<<<<<<<<<<<
 *                             if i == nc_t:
 *                                 f_i0 = 1.0
 */
            __pyx_v_h_I0 = 1.0;

            /* "vcstring.pyx":500
 *                         if u_t >= xa and u_t <= xb:  # Intermediate region
 *                             h_I0 = 1.0
 *                             if i == nc_t:             # <<<<<<<<<<<<<<
 *                                 f_i0 = 1.0
 *                             if j == nc_t:
 */
            __pyx_t_17 = ((__pyx_v_i == __pyx_v_nc_t) != 0);
            if (__pyx_t_17) {

              /* "vcstring.pyx":501
 *                             h_I0 = 1.0
 *                             if i == nc_t:
 *                                 f_i0 = 1.0             # <<<<<<<<<<<<<<
 *                             if j == nc_t:
 *                                 f_j = 1.0
 */
              __pyx_v_f_i0 = 1.0;

              /* "vcstring.pyx":500
 *                         if u_t >= xa and u_t <= xb:  # Intermediate region
 *                             h_I0 = 1.0
 *                             if i == nc_t:             # <<<<<<<<<<<<<<
 *                                 f_i0 = 1.0
 *                             if j == nc_t:
 */
            }

            /* "vcstring.pyx":502
 *                             if i == nc_t:
 *                                 f_i0 = 1.0
 *                             if j == nc_t:             # <<<<<<<<<<<<<<
 *                                 f_j = 1.0
 *                         elif u_t > xb:  # Ouside of intermediate region (state B)
 */
            __pyx_t_17 = ((__pyx_v_j == __pyx_v_nc_t) != 0);
            if (__pyx_t_17) {

              /* "vcstring.pyx":503
 *                                 f_i0 = 1.0
 *                             if j == nc_t:
 *                                 f_j = 1.0             # <<<<<<<<<<<<<<
 *                         elif u_t > xb:  # Ouside of intermediate region (state B)
 *                             h_B0 = 1.0
 */
              __pyx_v_f_j = 1.0;

              /* "vcstring.pyx":502
 *                             if i == nc_t:
 *                                 f_i0 = 1.0
 *                             if j == nc_t:             # <<<<<<<<<<<<<<
 *                                 f_j = 1.0
 *                         elif u_t > xb:  # Ouside of intermediate region (state B)
 */
            }

            /* "vcstring.pyx":498
 *                         h_I0, h_B0, h_Itau, h_Btau = 0.0, 0.0, 0.0, 0.0  # Indicator functions of states
 * 
 *                         if u_t >= xa and u_t <= xb:  # Intermediate region             # <<<<<<<<<<<<<<
 *                             h_I0 = 1.0
 *                             if i == nc_t:
 */
            goto __pyx_L29;
          }

          /* "vcstring.pyx":504
 *                             if j == nc_t:
 *                                 f_j = 1.0
 *                         elif u_t > xb:  # Ouside of intermediate region (state B)             # <<<<<<<<<<<<<<
 *                             h_B0 = 1.0
 * 
 */
          __pyx_t_17 = ((__pyx_v_u_t > __pyx_v_xb) != 0);
          if (__pyx_t_17) {

            /* "vcstring.pyx":505
 *                                 f_j = 1.0
 *                         elif u_t > xb:  # Ouside of intermediate region (state B)
 *                             h_B0 = 1.0             # <<<<<<<<<<<<<<
 * 
 *                         if u_tau >= xa and u_tau <= xb:  # Intermediate region
 */
            __pyx_v_h_B0 = 1.0;

            /* "vcstring.pyx":504
 *                             if j == nc_t:
 *                                 f_j = 1.0
 *                         elif u_t > xb:  # Ouside of intermediate region (state B)             # <<<<<<<<<<<<<<
 *                             h_B0 = 1.0
 * 
 */
          }
          __pyx_L29:;

          /* "vcstring.pyx":507
 *                             h_B0 = 1.0
 * 
 *                         if u_tau >= xa and u_tau <= xb:  # Intermediate region             # <<<<<<<<<<<<<<
 *                             h_Itau = 1.0
 *                             if i == nc_tau:
 */
          __pyx_t_25 = ((__pyx_v_u_tau >= __pyx_v_xa) != 0);
          if (__pyx_t_25) {
          } else {
            __pyx_t_17 = __pyx_t_25;
            goto __pyx_L35_bool_binop_done;
          }
          __pyx_t_25 = ((__pyx_v_u_tau <= __pyx_v_xb) != 0);
          __pyx_t_17 = __pyx_t_25;
          __pyx_L35_bool_binop_done:;
          if (__pyx_t_17) {

            /* "vcstring.pyx":508
 * 
 *                         if u_tau >= xa and u_tau <= xb:  # Intermediate region
 *                             h_Itau = 1.0             # <<<<<<<<<<<<<<
 *                             if i == nc_tau:
 *                                 f_itau = 1.0
 */
            __pyx_v_h_Itau = 1.0;

            /* "vcstring.pyx":509
 *                         if u_tau >= xa and u_tau <= xb:  # Intermediate region
 *                             h_Itau = 1.0
 *                             if i == nc_tau:             # <<<<<<<<<<<<<<
 *                                 f_itau = 1.0
 *                         elif u_tau > xb:  # Outside intermediate region (state B)
 */
            __pyx_t_17 = ((__pyx_v_i == __pyx_v_nc_tau) != 0);
            if (__pyx_t_17) {

              /* "vcstring.pyx":510
 *                             h_Itau = 1.0
 *                             if i == nc_tau:
 *                                 f_itau = 1.0             # <<<<<<<<<<<<<<
 *                         elif u_tau > xb:  # Outside intermediate region (state B)
 *                             h_Btau = 1.0
 */
              __pyx_v_f_itau = 1.0;

              /* "vcstring.pyx":509
 *                         if u_tau >= xa and u_tau <= xb:  # Intermediate region
 *                             h_Itau = 1.0
 *                             if i == nc_tau:             # <<<<<<<<<<<<<<
 *                                 f_itau = 1.0
 *                         elif u_tau > xb:  # Outside intermediate region (state B)
 */
            }

            /* "vcstring.pyx":507
 *                             h_B0 = 1.0
 * 
 *                         if u_tau >= xa and u_tau <= xb:  # Intermediate region             # <<<<<<<<<<<<<<
 *                             h_Itau = 1.0
 *                             if i == nc_tau:
 */
            goto __pyx_L34;
          }

          /* "vcstring.pyx":511
 *                             if i == nc_tau:
 *                                 f_itau = 1.0
 *                         elif u_tau > xb:  # Outside intermediate region (state B)             # <<<<<<<<<<<<<<
 *                             h_Btau = 1.0
 * 
 */
          __pyx_t_17 = ((__pyx_v_u_tau > __pyx_v_xb) != 0);
          if (__pyx_t_17) {

            /* "vcstring.pyx":512
 *                                 f_itau = 1.0
 *                         elif u_tau > xb:  # Outside intermediate region (state B)
 *                             h_Btau = 1.0             # <<<<<<<<<<<<<<
 * 
 *                         # Summation of terms
 */
            __pyx_v_h_Btau = 1.0;

            /* "vcstring.pyx":511
 *                             if i == nc_tau:
 *                                 f_itau = 1.0
 *                         elif u_tau > xb:  # Outside intermediate region (state B)             # <<<<<<<<<<<<<<
 *                             h_Btau = 1.0
 * 
 */
          }
          __pyx_L34:;

          /* "vcstring.pyx":515
 * 
 *                         # Summation of terms
 *                         D_0[i][j] += h_I0 * h_I0 * f_i0 * f_j             # <<<<<<<<<<<<<<
 *                         D_tau[i][j] += h_Itau * h_I0 * f_itau * f_j
 *                         if j == 0:
 */
          __pyx_t_8 = __Pyx_GetItemInt(((PyObject *)__pyx_v_D_0), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 515, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __pyx_t_32 = __pyx_v_j;
          __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_8, __pyx_t_32, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 515, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_1 = PyFloat_FromDouble((((__pyx_v_h_I0 * __pyx_v_h_I0) * __pyx_v_f_i0) * __pyx_v_f_j)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 515, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 515, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          if (unlikely(__Pyx_SetItemInt(__pyx_t_8, __pyx_t_32, __pyx_t_2, int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 515, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

          /* "vcstring.pyx":516
 *                         # Summation of terms
 *                         D_0[i][j] += h_I0 * h_I0 * f_i0 * f_j
 *                         D_tau[i][j] += h_Itau * h_I0 * f_itau * f_j             # <<<<<<<<<<<<<<
 *                         if j == 0:
 *                             g_0[i] += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) / (N - tau)
 */
          __pyx_t_8 = __Pyx_GetItemInt(((PyObject *)__pyx_v_D_tau), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 516, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          __pyx_t_32 = __pyx_v_j;
          __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_8, __pyx_t_32, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 516, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_1 = PyFloat_FromDouble((((__pyx_v_h_Itau * __pyx_v_h_I0) * __pyx_v_f_itau) * __pyx_v_f_j)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 516, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 516, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          if (unlikely(__Pyx_SetItemInt(__pyx_t_8, __pyx_t_32, __pyx_t_5, int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 516, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

          /* "vcstring.pyx":517
 *                         D_0[i][j] += h_I0 * h_I0 * f_i0 * f_j
 *                         D_tau[i][j] += h_Itau * h_I0 * f_itau * f_j
 *                         if j == 0:             # <<<<<<<<<<<<<<
 *                             g_0[i] += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) / (N - tau)
 *                             g_tau[i] += ((h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)) / (N - tau)
 */
          __pyx_t_17 = ((__pyx_v_j == 0) != 0);
          if (__pyx_t_17) {

            /* "vcstring.pyx":518
 *                         D_tau[i][j] += h_Itau * h_I0 * f_itau * f_j
 *                         if j == 0:
 *                             g_0[i] += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) / (N - tau)             # <<<<<<<<<<<<<<
 *                             g_tau[i] += ((h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)) / (N - tau)
 * 
 */
            __pyx_t_35 = (((__pyx_v_h_I0 * __pyx_v_f_i0) * __pyx_v_h_B0) + ((__pyx_v_h_B0 * __pyx_v_h_I0) * __pyx_v_f_i0));
            __pyx_t_32 = (__pyx_v_N - __pyx_v_tau);
            if (unlikely(__pyx_t_32 == 0)) {
              PyErr_SetString(PyExc_ZeroDivisionError, "float division");
              __PYX_ERR(0, 518, __pyx_L1_error)
            }
            __pyx_t_28 = __pyx_v_i;
            __pyx_t_36 = -1;
            if (__pyx_t_28 < 0) {
              __pyx_t_28 += __pyx_pybuffernd_g_0.diminfo[0].shape;
              if (unlikely(__pyx_t_28 < 0)) __pyx_t_36 = 0;
            } else if (unlikely(__pyx_t_28 >= __pyx_pybuffernd_g_0.diminfo[0].shape)) __pyx_t_36 = 0;
            if (unlikely(__pyx_t_36 != -1)) {
              __Pyx_RaiseBufferIndexError(__pyx_t_36);
              __PYX_ERR(0, 518, __pyx_L1_error)
            }
            *__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_g_0.rcbuffer->pybuffer.buf, __pyx_t_28, __pyx_pybuffernd_g_0.diminfo[0].strides) += (__pyx_t_35 / ((double)__pyx_t_32));

            /* "vcstring.pyx":519
 *                         if j == 0:
 *                             g_0[i] += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) / (N - tau)
 *                             g_tau[i] += ((h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)) / (N - tau)             # <<<<<<<<<<<<<<
 * 
 *                     # Divide by data size
 */
            __pyx_t_35 = (((__pyx_v_h_Itau * __pyx_v_f_itau) * __pyx_v_h_B0) + ((__pyx_v_h_Btau * __pyx_v_h_I0) * __pyx_v_f_i0));
            __pyx_t_32 = (__pyx_v_N - __pyx_v_tau);
            if (unlikely(__pyx_t_32 == 0)) {
              PyErr_SetString(PyExc_ZeroDivisionError, "float division");
              __PYX_ERR(0, 519, __pyx_L1_error)
            }
            __pyx_t_28 = __pyx_v_i;
            __pyx_t_36 = -1;
            if (__pyx_t_28 < 0) {
              __pyx_t_28 += __pyx_pybuffernd_g_tau.diminfo[0].shape;
              if (unlikely(__pyx_t_28 < 0)) __pyx_t_36 = 0;
            } else if (unlikely(__pyx_t_28 >= __pyx_pybuffernd_g_tau.diminfo[0].shape)) __pyx_t_36 = 0;
            if (unlikely(__pyx_t_36 != -1)) {
              __Pyx_RaiseBufferIndexError(__pyx_t_36);
              __PYX_ERR(0, 519, __pyx_L1_error)
            }
            *__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.buf, __pyx_t_28, __pyx_pybuffernd_g_tau.diminfo[0].strides) += (__pyx_t_35 / ((double)__pyx_t_32));

            /* "vcstring.pyx":517
 *                         D_0[i][j] += h_I0 * h_I0 * f_i0 * f_j
 *                         D_tau[i][j] += h_Itau * h_I0 * f_itau * f_j
 *                         if j == 0:             # <<<<<<<<<<<<<<
 *                             g_0[i] += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) / (N - tau)
 *                             g_tau[i] += ((h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)) / (N - tau)
 */
          }
        }

        /* "vcstring.pyx":522
 * 
 *                     # Divide by data size
 *                     D_0[i][j] = D_0[i][j] / (N - tau)             # <<<<<<<<<<<<<<
 *                     D_tau[i][j] = D_tau[i][j] / (N - tau)
 * 
 */
        __pyx_t_8 = __Pyx_GetItemInt(((PyObject *)__pyx_v_D_0), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 522, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_8, __pyx_v_j, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 522, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_t_8 = __Pyx_PyInt_From_int((__pyx_v_N - __pyx_v_tau)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 522, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_t_5, __pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 522, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_t_8 = __Pyx_GetItemInt(((PyObject *)__pyx_v_D_0), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 522, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        if (unlikely(__Pyx_SetItemInt(__pyx_t_8, __pyx_v_j, __pyx_t_1, int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 522, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

        /* "vcstring.pyx":523
 *                     # Divide by data size
 *                     D_0[i][j] = D_0[i][j] / (N - tau)
 *                     D_tau[i][j] = D_tau[i][j] / (N - tau)             # <<<<<<<<<<<<<<
 * 
 *         # Reshape into appropriate matrix size
 */
        __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_D_tau), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 523, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_8 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_j, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 523, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_PyInt_From_int((__pyx_v_N - __pyx_v_tau)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 523, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_5 = __Pyx_PyNumber_Divide(__pyx_t_8, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 523, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_D_tau), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 523, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        if (unlikely(__Pyx_SetItemInt(__pyx_t_1, __pyx_v_j, __pyx_t_5, int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 523, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

        /* "vcstring.pyx":468
 *             # val_g_0, val_g_tau = 0.0, 0.0
 *             for j in range(len(xcenters)):
 *                 if i in affected_images or j in affected_images: # Update specific elements             # <<<<<<<<<<<<<<
 *                     print("Matrix elements", i, j)
 *                     sys.stdout.flush()
 */
      }
    }
  }

  /* "vcstring.pyx":526
 * 
 *         # Reshape into appropriate matrix size
 *         D_0_arr = np.asarray(D_0).reshape(self.num_basis, self.num_basis)             # <<<<<<<<<<<<<<
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 526, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_asarray); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 526, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_8, ((PyObject *)__pyx_v_D_0)) : __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)__pyx_v_D_0));
  __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_reshape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 526, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 526, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_4 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_1, __pyx_t_8};
    __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 526, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_1, __pyx_t_8};
    __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 526, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  } else
  #endif
  {
    __pyx_t_3 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 526, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (__pyx_t_4) {
      __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4); __pyx_t_4 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_7, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_8);
    PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_7, __pyx_t_8);
    __pyx_t_1 = 0;
    __pyx_t_8 = 0;
    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 526, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 526, __pyx_L1_error)
  __pyx_t_37 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_37, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_15, &__pyx_t_14, &__pyx_t_13);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_13);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_15, __pyx_t_14, __pyx_t_13);
      }
      __pyx_t_15 = __pyx_t_14 = __pyx_t_13 = 0;
    }
    __pyx_pybuffernd_D_0_arr.diminfo[0].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0_arr.diminfo[0].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0_arr.diminfo[1].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0_arr.diminfo[1].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 526, __pyx_L1_error)
  }
  __pyx_t_37 = 0;
  __pyx_v_D_0_arr = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;

  /* "vcstring.pyx":527
 *         # Reshape into appropriate matrix size
 *         D_0_arr = np.asarray(D_0).reshape(self.num_basis, self.num_basis)
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)             # <<<<<<<<<<<<<<
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 527, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_asarray); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 527, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_3, ((PyObject *)__pyx_v_D_tau)) : __Pyx_PyObject_CallOneArg(__pyx_t_8, ((PyObject *)__pyx_v_D_tau));
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 527, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_reshape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 527, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 527, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 527, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_t_2, __pyx_t_3};
    __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 527, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_t_2, __pyx_t_3};
    __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 527, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  {
    __pyx_t_4 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 527, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    if (__pyx_t_1) {
      __Pyx_GIVEREF(__pyx_t_1); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1); __pyx_t_1 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_7, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_7, __pyx_t_3);
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 527, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 527, __pyx_L1_error)
  __pyx_t_37 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_37, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_13, &__pyx_t_14, &__pyx_t_15);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_13, __pyx_t_14, __pyx_t_15);
      }
      __pyx_t_13 = __pyx_t_14 = __pyx_t_15 = 0;
    }
    __pyx_pybuffernd_D_tau_arr.diminfo[0].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau_arr.diminfo[0].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau_arr.diminfo[1].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau_arr.diminfo[1].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 527, __pyx_L1_error)
  }
  __pyx_t_37 = 0;
  __pyx_v_D_tau_arr = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;

  /* "vcstring.pyx":528
 *         D_0_arr = np.asarray(D_0).reshape(self.num_basis, self.num_basis)
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)             # <<<<<<<<<<<<<<
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 528, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_asarray); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 528, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_5 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_8, ((PyObject *)__pyx_v_g_0)) : __Pyx_PyObject_CallOneArg(__pyx_t_4, ((PyObject *)__pyx_v_g_0));
  __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 528, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 528, __pyx_L1_error)
  __pyx_t_20 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_20, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_15, &__pyx_t_14, &__pyx_t_13);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_0_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_13);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_15, __pyx_t_14, __pyx_t_13);
      }
      __pyx_t_15 = __pyx_t_14 = __pyx_t_13 = 0;
    }
    __pyx_pybuffernd_g_0_arr.diminfo[0].strides = __pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_0_arr.diminfo[0].shape = __pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 528, __pyx_L1_error)
  }
  __pyx_t_20 = 0;
  __pyx_v_g_0_arr = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;

  /* "vcstring.pyx":529
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)             # <<<<<<<<<<<<<<
 * 
 *         # Symmetrize for reversible dynamics
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 529, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_asarray); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 529, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
    }
  }
  __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_4, ((PyObject *)__pyx_v_g_tau)) : __Pyx_PyObject_CallOneArg(__pyx_t_8, ((PyObject *)__pyx_v_g_tau));
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 529, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 529, __pyx_L1_error)
  __pyx_t_20 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_20, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_13, &__pyx_t_14, &__pyx_t_15);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_tau_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_13, __pyx_t_14, __pyx_t_15);
      }
      __pyx_t_13 = __pyx_t_14 = __pyx_t_15 = 0;
    }
    __pyx_pybuffernd_g_tau_arr.diminfo[0].strides = __pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_tau_arr.diminfo[0].shape = __pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 529, __pyx_L1_error)
  }
  __pyx_t_20 = 0;
  __pyx_v_g_tau_arr = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;

  /* "vcstring.pyx":537
 *         # Calculate committor coefficients
 *         # D = D_0_sym - D_tau_sym
 *         D = D_0_arr - D_tau_arr             # <<<<<<<<<<<<<<
 *         g = g_tau_arr - g_0_arr
 *         b = 0.5 * np.linalg.inv(D).dot(g)
 */
  __pyx_t_5 = PyNumber_Subtract(((PyObject *)__pyx_v_D_0_arr), ((PyObject *)__pyx_v_D_tau_arr)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 537, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 537, __pyx_L1_error)
  __pyx_t_37 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D.rcbuffer->pybuffer, (PyObject*)__pyx_t_37, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_15, &__pyx_t_14, &__pyx_t_13);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D.rcbuffer->pybuffer, (PyObject*)__pyx_v_D, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_13);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_15, __pyx_t_14, __pyx_t_13);
      }
      __pyx_t_15 = __pyx_t_14 = __pyx_t_13 = 0;
    }
    __pyx_pybuffernd_D.diminfo[0].strides = __pyx_pybuffernd_D.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D.diminfo[0].shape = __pyx_pybuffernd_D.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D.diminfo[1].strides = __pyx_pybuffernd_D.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D.diminfo[1].shape = __pyx_pybuffernd_D.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 537, __pyx_L1_error)
  }
  __pyx_t_37 = 0;
  __pyx_v_D = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;

  /* "vcstring.pyx":538
 *         # D = D_0_sym - D_tau_sym
 *         D = D_0_arr - D_tau_arr
 *         g = g_tau_arr - g_0_arr             # <<<<<<<<<<<<<<
 *         b = 0.5 * np.linalg.inv(D).dot(g)
 *         print('D_0 =', D_0_arr)
 */
  __pyx_t_5 = PyNumber_Subtract(((PyObject *)__pyx_v_g_tau_arr), ((PyObject *)__pyx_v_g_0_arr)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 538, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 538, __pyx_L1_error)
  __pyx_t_20 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g.rcbuffer->pybuffer, (PyObject*)__pyx_t_20, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_13, &__pyx_t_14, &__pyx_t_15);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g.rcbuffer->pybuffer, (PyObject*)__pyx_v_g, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_13); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_13, __pyx_t_14, __pyx_t_15);
      }
      __pyx_t_13 = __pyx_t_14 = __pyx_t_15 = 0;
    }
    __pyx_pybuffernd_g.diminfo[0].strides = __pyx_pybuffernd_g.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g.diminfo[0].shape = __pyx_pybuffernd_g.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 538, __pyx_L1_error)
  }
  __pyx_t_20 = 0;
  __pyx_v_g = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;

  /* "vcstring.pyx":539
 *         D = D_0_arr - D_tau_arr
 *         g = g_tau_arr - g_0_arr
 *         b = 0.5 * np.linalg.inv(D).dot(g)             # <<<<<<<<<<<<<<
 *         print('D_0 =', D_0_arr)
 *         print('D_tau =', D_tau_arr)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 539, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_linalg); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 539, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_inv); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 539, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_8 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, ((PyObject *)__pyx_v_D)) : __Pyx_PyObject_CallOneArg(__pyx_t_4, ((PyObject *)__pyx_v_D));
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 539, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_dot); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 539, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_5 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_8, ((PyObject *)__pyx_v_g)) : __Pyx_PyObject_CallOneArg(__pyx_t_4, ((PyObject *)__pyx_v_g));
  __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyNumber_Multiply(__pyx_float_0_5, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 539, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 539, __pyx_L1_error)
  __pyx_t_20 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_t_20, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_15, &__pyx_t_14, &__pyx_t_13);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_13);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_15, __pyx_t_14, __pyx_t_13);
      }
      __pyx_t_15 = __pyx_t_14 = __pyx_t_13 = 0;
    }
    __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 539, __pyx_L1_error)
  }
  __pyx_t_20 = 0;
  __Pyx_DECREF_SET(__pyx_v_b, ((PyArrayObject *)__pyx_t_4));
  __pyx_t_4 = 0;

  /* "vcstring.pyx":540
 *         g = g_tau_arr - g_0_arr
 *         b = 0.5 * np.linalg.inv(D).dot(g)
 *         print('D_0 =', D_0_arr)             # <<<<<<<<<<<<<<
 *         print('D_tau =', D_tau_arr)
 *         print('g_0 =', g_0_arr)
 */
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 540, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_kp_u_D_0);
  __Pyx_GIVEREF(__pyx_kp_u_D_0);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_D_0);
  __Pyx_INCREF(((PyObject *)__pyx_v_D_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_0_arr));
  PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_D_0_arr));
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 540, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "vcstring.pyx":541
 *         b = 0.5 * np.linalg.inv(D).dot(g)
 *         print('D_0 =', D_0_arr)
 *         print('D_tau =', D_tau_arr)             # <<<<<<<<<<<<<<
 *         print('g_0 =', g_0_arr)
 *         print('g_tau =', g_tau_arr)
 */
  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 541, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_INCREF(__pyx_kp_u_D_tau);
  __Pyx_GIVEREF(__pyx_kp_u_D_tau);
  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_kp_u_D_tau);
  __Pyx_INCREF(((PyObject *)__pyx_v_D_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_5, 1, ((PyObject *)__pyx_v_D_tau_arr));
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 541, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "vcstring.pyx":542
 *         print('D_0 =', D_0_arr)
 *         print('D_tau =', D_tau_arr)
 *         print('g_0 =', g_0_arr)             # <<<<<<<<<<<<<<
 *         print('g_tau =', g_tau_arr)
 *         print('b =', b)
 */
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 542, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_kp_u_g_0);
  __Pyx_GIVEREF(__pyx_kp_u_g_0);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_g_0);
  __Pyx_INCREF(((PyObject *)__pyx_v_g_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_0_arr));
  PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_g_0_arr));
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 542, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "vcstring.pyx":543
 *         print('D_tau =', D_tau_arr)
 *         print('g_0 =', g_0_arr)
 *         print('g_tau =', g_tau_arr)             # <<<<<<<<<<<<<<
 *         print('b =', b)
 * 
 */
  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 543, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_INCREF(__pyx_kp_u_g_tau);
  __Pyx_GIVEREF(__pyx_kp_u_g_tau);
  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_kp_u_g_tau);
  __Pyx_INCREF(((PyObject *)__pyx_v_g_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_5, 1, ((PyObject *)__pyx_v_g_tau_arr));
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 543, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "vcstring.pyx":544
 *         print('g_0 =', g_0_arr)
 *         print('g_tau =', g_tau_arr)
 *         print('b =', b)             # <<<<<<<<<<<<<<
 * 
 *         return b, D_0_arr, D_tau_arr, g_0_arr, g_tau_arr
 */
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 544, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_kp_u_b);
  __Pyx_GIVEREF(__pyx_kp_u_b);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_b);
  __Pyx_INCREF(((PyObject *)__pyx_v_b));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
  PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_b));
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 544, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "vcstring.pyx":546
 *         print('b =', b)
 * 
 *         return b, D_0_arr, D_tau_arr, g_0_arr, g_tau_arr             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_5 = PyTuple_New(5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 546, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_INCREF(((PyObject *)__pyx_v_b));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
  PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_v_b));
  __Pyx_INCREF(((PyObject *)__pyx_v_D_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_0_arr));
  PyTuple_SET_ITEM(__pyx_t_5, 1, ((PyObject *)__pyx_v_D_0_arr));
  __Pyx_INCREF(((PyObject *)__pyx_v_D_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_5, 2, ((PyObject *)__pyx_v_D_tau_arr));
  __Pyx_INCREF(((PyObject *)__pyx_v_g_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_0_arr));
  PyTuple_SET_ITEM(__pyx_t_5, 3, ((PyObject *)__pyx_v_g_0_arr));
  __Pyx_INCREF(((PyObject *)__pyx_v_g_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_5, 4, ((PyObject *)__pyx_v_g_tau_arr));
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;

  /* "vcstring.pyx":382
 *         return b, D_0_arr, D_tau_arr, g_0_arr, g_tau_arr
 * 
 *     cpdef calc_coeffs_accelerated(self, int image, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z):             # <<<<<<<<<<<<<<
 *         """
 *         Solve the linear equation from minimizing the forward steady-state flux.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_t.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_tau.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_coeffs_accelerated", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_t.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_tau.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_xcenters.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ycenters.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XDECREF((PyObject *)__pyx_v_xcenters);
  __Pyx_XDECREF((PyObject *)__pyx_v_ycenters);
  __Pyx_XDECREF(__pyx_v_x);
  __Pyx_XDECREF(__pyx_v_y);
  __Pyx_XDECREF(__pyx_v_affected_images);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_0);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_tau);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_0);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_tau);
  __Pyx_XDECREF((PyObject *)__pyx_v_dist_t);
  __Pyx_XDECREF((PyObject *)__pyx_v_dist_tau);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_0_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_tau_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_D);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_0_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_tau_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_g);
  __Pyx_XDECREF((PyObject *)__pyx_v_b);
  __Pyx_XDECREF(__pyx_v_dat);
  __Pyx_XDECREF(__pyx_8genexpr6__pyx_v_row);
  __Pyx_XDECREF(__pyx_8genexpr7__pyx_v_row);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_13calc_coeffs_accelerated(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8vcstring_8vcstring_12calc_coeffs_accelerated[] = "\n        Solve the linear equation from minimizing the forward steady-state flux.\n        Calculates D matrices, g vectors, and b coefficients.\n        Accelerated method only calculates the rows/column elements of the affected image and its\n        nearest neighboring images.\n\n        WARNING: THIS METHOD IS NOT RECOMMENDED FOR MOST CASES BECAUSE MOVING THE IMAGES \n        MORE THAN A CERTAIN AMOUNT CAN AFFECT THE VORONOI TESSELATION IN FARTHER OUT IMAGES \n        OTHER THAN THE NEAREST NEIGHBORS.\n\n        Parameters\n        ----------\n        image    :  index of image, starting from 0\n        traj :  trajectory with shape (T, d), where T is number of time steps and d is dimensions.\n        tau  :  lag time (units step)\n        z    :  input centroid positions\n\n        Returns:\n        --------\n        - Symmetric square Matrices D_0_sym and D_tau_sym\n        - Vectors g_0 and g_tau\n        - A vector of the coefficients b for the trial committor expressed as a basis set expansion\n        ";
static PyObject *__pyx_pw_8vcstring_8vcstring_13calc_coeffs_accelerated(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_image;
  PyObject *__pyx_v_traj = 0;
  int __pyx_v_tau;
  PyArrayObject *__pyx_v_z = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("calc_coeffs_accelerated (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_image,&__pyx_n_s_traj,&__pyx_n_s_tau,&__pyx_n_s_z,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_image)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_traj)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_coeffs_accelerated", 1, 4, 4, 1); __PYX_ERR(0, 382, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tau)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_coeffs_accelerated", 1, 4, 4, 2); __PYX_ERR(0, 382, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_coeffs_accelerated", 1, 4, 4, 3); __PYX_ERR(0, 382, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "calc_coeffs_accelerated") < 0)) __PYX_ERR(0, 382, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
    }
    __pyx_v_image = __Pyx_PyInt_As_int(values[0]); if (unlikely((__pyx_v_image == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 382, __pyx_L3_error)
    __pyx_v_traj = ((PyObject*)values[1]);
    __pyx_v_tau = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_tau == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 382, __pyx_L3_error)
    __pyx_v_z = ((PyArrayObject *)values[3]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("calc_coeffs_accelerated", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 382, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.vcstring.calc_coeffs_accelerated", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_traj), (&PyList_Type), 1, "traj", 1))) __PYX_ERR(0, 382, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_z), __pyx_ptype_5numpy_ndarray, 1, "z", 0))) __PYX_ERR(0, 382, __pyx_L1_error)
  __pyx_r = __pyx_pf_8vcstring_8vcstring_12calc_coeffs_accelerated(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self), __pyx_v_image, __pyx_v_traj, __pyx_v_tau, __pyx_v_z);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_12calc_coeffs_accelerated(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_v_image, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_coeffs_accelerated", 0);
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 382, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __pyx_f_8vcstring_8vcstring_calc_coeffs_accelerated(__pyx_v_self, __pyx_v_image, __pyx_v_traj, __pyx_v_tau, __pyx_v_z, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 382, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_coeffs_accelerated", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":549
 * 
 * 
 *     cpdef calc_coeffs_ensemble(self, int N, int tau, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=2] ids, symmetric=True):             # <<<<<<<<<<<<<<
 *         """
 *         Solve the linear equation from minimizing the forward steady-state flux.
 */

static PyObject *__pyx_pw_8vcstring_8vcstring_15calc_coeffs_ensemble(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_coeffs_ensemble(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_v_N, int __pyx_v_tau, CYTHON_UNUSED PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_ids, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble *__pyx_optional_args) {
  PyObject *__pyx_v_symmetric = ((PyObject *)Py_True);
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_t;
  PyObject *__pyx_v_D_0 = 0;
  PyObject *__pyx_v_D_tau = 0;
  PyObject *__pyx_v_g_0 = 0;
  PyObject *__pyx_v_g_tau = 0;
  double __pyx_v_val_g_0;
  double __pyx_v_val_g_tau;
  double __pyx_v_val_D_0;
  double __pyx_v_val_D_tau;
  double __pyx_v_f_i0;
  double __pyx_v_f_itau;
  double __pyx_v_f_j;
  double __pyx_v_h_I0;
  double __pyx_v_h_B0;
  double __pyx_v_h_Itau;
  double __pyx_v_h_Btau;
  double __pyx_v_weight;
  PyArrayObject *__pyx_v_D_0_arr = 0;
  PyArrayObject *__pyx_v_D_tau_arr = 0;
  PyArrayObject *__pyx_v_D = 0;
  PyArrayObject *__pyx_v_g_0_arr = 0;
  PyArrayObject *__pyx_v_g_tau_arr = 0;
  PyArrayObject *__pyx_v_g = 0;
  PyArrayObject *__pyx_v_b = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D;
  __Pyx_Buffer __pyx_pybuffer_D;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_0_arr;
  __Pyx_Buffer __pyx_pybuffer_D_0_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_tau_arr;
  __Pyx_Buffer __pyx_pybuffer_D_tau_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g;
  __Pyx_Buffer __pyx_pybuffer_g;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_0_arr;
  __Pyx_Buffer __pyx_pybuffer_g_0_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_tau_arr;
  __Pyx_Buffer __pyx_pybuffer_g_tau_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ids;
  __Pyx_Buffer __pyx_pybuffer_ids;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  int __pyx_t_10;
  double __pyx_t_11;
  double __pyx_t_12;
  int __pyx_t_13;
  int __pyx_t_14;
  int __pyx_t_15;
  int __pyx_t_16;
  int __pyx_t_17;
  int __pyx_t_18;
  double __pyx_t_19;
  int __pyx_t_20;
  int __pyx_t_21;
  int __pyx_t_22;
  PyArrayObject *__pyx_t_23 = NULL;
  PyObject *__pyx_t_24 = NULL;
  PyObject *__pyx_t_25 = NULL;
  PyObject *__pyx_t_26 = NULL;
  PyArrayObject *__pyx_t_27 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_coeffs_ensemble", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args->__pyx_n > 0) {
      __pyx_v_symmetric = __pyx_optional_args->symmetric;
    }
  }
  __pyx_pybuffer_D_0_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_D_0_arr.refcount = 0;
  __pyx_pybuffernd_D_0_arr.data = NULL;
  __pyx_pybuffernd_D_0_arr.rcbuffer = &__pyx_pybuffer_D_0_arr;
  __pyx_pybuffer_D_tau_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_D_tau_arr.refcount = 0;
  __pyx_pybuffernd_D_tau_arr.data = NULL;
  __pyx_pybuffernd_D_tau_arr.rcbuffer = &__pyx_pybuffer_D_tau_arr;
  __pyx_pybuffer_D.pybuffer.buf = NULL;
  __pyx_pybuffer_D.refcount = 0;
  __pyx_pybuffernd_D.data = NULL;
  __pyx_pybuffernd_D.rcbuffer = &__pyx_pybuffer_D;
  __pyx_pybuffer_g_0_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_g_0_arr.refcount = 0;
  __pyx_pybuffernd_g_0_arr.data = NULL;
  __pyx_pybuffernd_g_0_arr.rcbuffer = &__pyx_pybuffer_g_0_arr;
  __pyx_pybuffer_g_tau_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_g_tau_arr.refcount = 0;
  __pyx_pybuffernd_g_tau_arr.data = NULL;
  __pyx_pybuffernd_g_tau_arr.rcbuffer = &__pyx_pybuffer_g_tau_arr;
  __pyx_pybuffer_g.pybuffer.buf = NULL;
  __pyx_pybuffer_g.refcount = 0;
  __pyx_pybuffernd_g.data = NULL;
  __pyx_pybuffernd_g.rcbuffer = &__pyx_pybuffer_g;
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  __pyx_pybuffer_ids.pybuffer.buf = NULL;
  __pyx_pybuffer_ids.refcount = 0;
  __pyx_pybuffernd_ids.data = NULL;
  __pyx_pybuffernd_ids.rcbuffer = &__pyx_pybuffer_ids;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 549, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 549, __pyx_L1_error)
  }
  __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_calc_coeffs_ensemble); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 549, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_8vcstring_8vcstring_15calc_coeffs_ensemble)) {
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_N); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 549, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 549, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_5 = __pyx_t_1; __pyx_t_6 = NULL;
        __pyx_t_7 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
          __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
          if (likely(__pyx_t_6)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
            __Pyx_INCREF(__pyx_t_6);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_5, function);
            __pyx_t_7 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[6] = {__pyx_t_6, __pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_v_z), ((PyObject *)__pyx_v_ids), __pyx_v_symmetric};
          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 5+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 549, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[6] = {__pyx_t_6, __pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_v_z), ((PyObject *)__pyx_v_ids), __pyx_v_symmetric};
          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 5+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 549, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        } else
        #endif
        {
          __pyx_t_8 = PyTuple_New(5+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 549, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          if (__pyx_t_6) {
            __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
          }
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_4);
          PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_t_4);
          __Pyx_INCREF(((PyObject *)__pyx_v_z));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
          PyTuple_SET_ITEM(__pyx_t_8, 2+__pyx_t_7, ((PyObject *)__pyx_v_z));
          __Pyx_INCREF(((PyObject *)__pyx_v_ids));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_ids));
          PyTuple_SET_ITEM(__pyx_t_8, 3+__pyx_t_7, ((PyObject *)__pyx_v_ids));
          __Pyx_INCREF(__pyx_v_symmetric);
          __Pyx_GIVEREF(__pyx_v_symmetric);
          PyTuple_SET_ITEM(__pyx_t_8, 4+__pyx_t_7, __pyx_v_symmetric);
          __pyx_t_3 = 0;
          __pyx_t_4 = 0;
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 549, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        }
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }

  /* "vcstring.pyx":577
 *         cdef np.ndarray[DTYPE_t, ndim=1] g_0_arr, g_tau_arr, g, b
 * 
 *         print('\n======================================')             # <<<<<<<<<<<<<<
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')
 *         print('======================================')
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__21, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 577, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":578
 * 
 *         print('\n======================================')
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')             # <<<<<<<<<<<<<<
 *         print('======================================')
 *         print('lag time =', tau)
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__22, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 578, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":579
 *         print('\n======================================')
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')
 *         print('======================================')             # <<<<<<<<<<<<<<
 *         print('lag time =', tau)
 *         print('Number of trajs:', N)
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__24, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 579, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":580
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')
 *         print('======================================')
 *         print('lag time =', tau)             # <<<<<<<<<<<<<<
 *         print('Number of trajs:', N)
 *         print('Symmetrization of D matrices:', symmetric)
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 580, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 580, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_lag_time);
  __Pyx_GIVEREF(__pyx_kp_u_lag_time);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_lag_time);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 580, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":581
 *         print('======================================')
 *         print('lag time =', tau)
 *         print('Number of trajs:', N)             # <<<<<<<<<<<<<<
 *         print('Symmetrization of D matrices:', symmetric)
 * 
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_N); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 581, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 581, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_Number_of_trajs);
  __Pyx_GIVEREF(__pyx_kp_u_Number_of_trajs);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_Number_of_trajs);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 581, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":582
 *         print('lag time =', tau)
 *         print('Number of trajs:', N)
 *         print('Symmetrization of D matrices:', symmetric)             # <<<<<<<<<<<<<<
 * 
 *         D_0 = []
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 582, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_Symmetrization_of_D_matrices);
  __Pyx_GIVEREF(__pyx_kp_u_Symmetrization_of_D_matrices);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Symmetrization_of_D_matrices);
  __Pyx_INCREF(__pyx_v_symmetric);
  __Pyx_GIVEREF(__pyx_v_symmetric);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_symmetric);
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 582, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":584
 *         print('Symmetrization of D matrices:', symmetric)
 * 
 *         D_0 = []             # <<<<<<<<<<<<<<
 *         D_tau = []
 *         g_0 = []
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 584, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_D_0 = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":585
 * 
 *         D_0 = []
 *         D_tau = []             # <<<<<<<<<<<<<<
 *         g_0 = []
 *         g_tau = []
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 585, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_D_tau = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":586
 *         D_0 = []
 *         D_tau = []
 *         g_0 = []             # <<<<<<<<<<<<<<
 *         g_tau = []
 *         for i in range(self.num_basis):
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 586, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_g_0 = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":587
 *         D_tau = []
 *         g_0 = []
 *         g_tau = []             # <<<<<<<<<<<<<<
 *         for i in range(self.num_basis):
 *             val_g_0, val_g_tau = 0.0, 0.0
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 587, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_g_tau = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":588
 *         g_0 = []
 *         g_tau = []
 *         for i in range(self.num_basis):             # <<<<<<<<<<<<<<
 *             val_g_0, val_g_tau = 0.0, 0.0
 *             for j in range(self.num_basis):
 */
  __pyx_t_7 = __pyx_v_self->num_basis;
  __pyx_t_9 = __pyx_t_7;
  for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
    __pyx_v_i = __pyx_t_10;

    /* "vcstring.pyx":589
 *         g_tau = []
 *         for i in range(self.num_basis):
 *             val_g_0, val_g_tau = 0.0, 0.0             # <<<<<<<<<<<<<<
 *             for j in range(self.num_basis):
 *                 print("Matrix elements", i, j)
 */
    __pyx_t_11 = 0.0;
    __pyx_t_12 = 0.0;
    __pyx_v_val_g_0 = __pyx_t_11;
    __pyx_v_val_g_tau = __pyx_t_12;

    /* "vcstring.pyx":590
 *         for i in range(self.num_basis):
 *             val_g_0, val_g_tau = 0.0, 0.0
 *             for j in range(self.num_basis):             # <<<<<<<<<<<<<<
 *                 print("Matrix elements", i, j)
 *                 sys.stdout.flush()
 */
    __pyx_t_13 = __pyx_v_self->num_basis;
    __pyx_t_14 = __pyx_t_13;
    for (__pyx_t_15 = 0; __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
      __pyx_v_j = __pyx_t_15;

      /* "vcstring.pyx":591
 *             val_g_0, val_g_tau = 0.0, 0.0
 *             for j in range(self.num_basis):
 *                 print("Matrix elements", i, j)             # <<<<<<<<<<<<<<
 *                 sys.stdout.flush()
 *                 val_D_0, val_D_tau = 0.0, 0.0
 */
      __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 591, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_j); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 591, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 591, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_INCREF(__pyx_kp_u_Matrix_elements);
      __Pyx_GIVEREF(__pyx_kp_u_Matrix_elements);
      PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_kp_u_Matrix_elements);
      __Pyx_GIVEREF(__pyx_t_2);
      PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_t_1);
      __pyx_t_2 = 0;
      __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 591, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":592
 *             for j in range(self.num_basis):
 *                 print("Matrix elements", i, j)
 *                 sys.stdout.flush()             # <<<<<<<<<<<<<<
 *                 val_D_0, val_D_tau = 0.0, 0.0
 *                 for t in range(N):
 */
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sys); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 592, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_stdout); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 592, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_flush); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 592, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_2)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_2);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
        }
      }
      __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 592, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":593
 *                 print("Matrix elements", i, j)
 *                 sys.stdout.flush()
 *                 val_D_0, val_D_tau = 0.0, 0.0             # <<<<<<<<<<<<<<
 *                 for t in range(N):
 *                     f_i0, f_itau, f_j = 0.0, 0.0, 0.0
 */
      __pyx_t_12 = 0.0;
      __pyx_t_11 = 0.0;
      __pyx_v_val_D_0 = __pyx_t_12;
      __pyx_v_val_D_tau = __pyx_t_11;

      /* "vcstring.pyx":594
 *                 sys.stdout.flush()
 *                 val_D_0, val_D_tau = 0.0, 0.0
 *                 for t in range(N):             # <<<<<<<<<<<<<<
 *                     f_i0, f_itau, f_j = 0.0, 0.0, 0.0
 *                     h_I0 = ids[t][0]
 */
      __pyx_t_16 = __pyx_v_N;
      __pyx_t_17 = __pyx_t_16;
      for (__pyx_t_18 = 0; __pyx_t_18 < __pyx_t_17; __pyx_t_18+=1) {
        __pyx_v_t = __pyx_t_18;

        /* "vcstring.pyx":595
 *                 val_D_0, val_D_tau = 0.0, 0.0
 *                 for t in range(N):
 *                     f_i0, f_itau, f_j = 0.0, 0.0, 0.0             # <<<<<<<<<<<<<<
 *                     h_I0 = ids[t][0]
 *                     h_Itau = ids[t][2]
 */
        __pyx_t_11 = 0.0;
        __pyx_t_12 = 0.0;
        __pyx_t_19 = 0.0;
        __pyx_v_f_i0 = __pyx_t_11;
        __pyx_v_f_itau = __pyx_t_12;
        __pyx_v_f_j = __pyx_t_19;

        /* "vcstring.pyx":596
 *                 for t in range(N):
 *                     f_i0, f_itau, f_j = 0.0, 0.0, 0.0
 *                     h_I0 = ids[t][0]             # <<<<<<<<<<<<<<
 *                     h_Itau = ids[t][2]
 *                     h_B0 = ids[t][1]
 */
        __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 596, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 596, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_19 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely((__pyx_t_19 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 596, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_v_h_I0 = __pyx_t_19;

        /* "vcstring.pyx":597
 *                     f_i0, f_itau, f_j = 0.0, 0.0, 0.0
 *                     h_I0 = ids[t][0]
 *                     h_Itau = ids[t][2]             # <<<<<<<<<<<<<<
 *                     h_B0 = ids[t][1]
 *                     h_Btau = ids[t][3]
 */
        __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 597, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_5, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 597, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_19 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_19 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 597, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_v_h_Itau = __pyx_t_19;

        /* "vcstring.pyx":598
 *                     h_I0 = ids[t][0]
 *                     h_Itau = ids[t][2]
 *                     h_B0 = ids[t][1]             # <<<<<<<<<<<<<<
 *                     h_Btau = ids[t][3]
 *                     if ids[t][4] == i:  # Match Voronoi centroids
 */
        __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 598, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 598, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_19 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely((__pyx_t_19 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 598, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_v_h_B0 = __pyx_t_19;

        /* "vcstring.pyx":599
 *                     h_Itau = ids[t][2]
 *                     h_B0 = ids[t][1]
 *                     h_Btau = ids[t][3]             # <<<<<<<<<<<<<<
 *                     if ids[t][4] == i:  # Match Voronoi centroids
 *                         f_i0 = 1.0
 */
        __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 599, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_5, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 599, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_19 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_19 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 599, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_v_h_Btau = __pyx_t_19;

        /* "vcstring.pyx":600
 *                     h_B0 = ids[t][1]
 *                     h_Btau = ids[t][3]
 *                     if ids[t][4] == i:  # Match Voronoi centroids             # <<<<<<<<<<<<<<
 *                         f_i0 = 1.0
 *                     if ids[t][5] == i:
 */
        __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 600, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_1, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 600, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 600, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_2 = PyObject_RichCompare(__pyx_t_5, __pyx_t_1, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 600, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_20 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_20 < 0)) __PYX_ERR(0, 600, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        if (__pyx_t_20) {

          /* "vcstring.pyx":601
 *                     h_Btau = ids[t][3]
 *                     if ids[t][4] == i:  # Match Voronoi centroids
 *                         f_i0 = 1.0             # <<<<<<<<<<<<<<
 *                     if ids[t][5] == i:
 *                         f_itau = 1.0
 */
          __pyx_v_f_i0 = 1.0;

          /* "vcstring.pyx":600
 *                     h_B0 = ids[t][1]
 *                     h_Btau = ids[t][3]
 *                     if ids[t][4] == i:  # Match Voronoi centroids             # <<<<<<<<<<<<<<
 *                         f_i0 = 1.0
 *                     if ids[t][5] == i:
 */
        }

        /* "vcstring.pyx":602
 *                     if ids[t][4] == i:  # Match Voronoi centroids
 *                         f_i0 = 1.0
 *                     if ids[t][5] == i:             # <<<<<<<<<<<<<<
 *                         f_itau = 1.0
 *                     if ids[t][4] == j:
 */
        __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 602, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 602, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 602, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_5 = PyObject_RichCompare(__pyx_t_1, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 602, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_20 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_20 < 0)) __PYX_ERR(0, 602, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        if (__pyx_t_20) {

          /* "vcstring.pyx":603
 *                         f_i0 = 1.0
 *                     if ids[t][5] == i:
 *                         f_itau = 1.0             # <<<<<<<<<<<<<<
 *                     if ids[t][4] == j:
 *                         f_j = 1.0
 */
          __pyx_v_f_itau = 1.0;

          /* "vcstring.pyx":602
 *                     if ids[t][4] == i:  # Match Voronoi centroids
 *                         f_i0 = 1.0
 *                     if ids[t][5] == i:             # <<<<<<<<<<<<<<
 *                         f_itau = 1.0
 *                     if ids[t][4] == j:
 */
        }

        /* "vcstring.pyx":604
 *                     if ids[t][5] == i:
 *                         f_itau = 1.0
 *                     if ids[t][4] == j:             # <<<<<<<<<<<<<<
 *                         f_j = 1.0
 * 
 */
        __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 604, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_5, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 604, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_j); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 604, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_1 = PyObject_RichCompare(__pyx_t_2, __pyx_t_5, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 604, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_20 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_20 < 0)) __PYX_ERR(0, 604, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        if (__pyx_t_20) {

          /* "vcstring.pyx":605
 *                         f_itau = 1.0
 *                     if ids[t][4] == j:
 *                         f_j = 1.0             # <<<<<<<<<<<<<<
 * 
 *                     # Summation of terms
 */
          __pyx_v_f_j = 1.0;

          /* "vcstring.pyx":604
 *                     if ids[t][5] == i:
 *                         f_itau = 1.0
 *                     if ids[t][4] == j:             # <<<<<<<<<<<<<<
 *                         f_j = 1.0
 * 
 */
        }

        /* "vcstring.pyx":608
 * 
 *                     # Summation of terms
 *                     if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                         weight = ids[t][8]
 *                     else:
 */
        __pyx_t_20 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_kp_u_1d, Py_EQ)); if (unlikely(__pyx_t_20 < 0)) __PYX_ERR(0, 608, __pyx_L1_error)
        __pyx_t_21 = (__pyx_t_20 != 0);
        if (__pyx_t_21) {

          /* "vcstring.pyx":609
 *                     # Summation of terms
 *                     if self.state_assignment == '1d':
 *                         weight = ids[t][8]             # <<<<<<<<<<<<<<
 *                     else:
 *                         weight = ids[t][10]
 */
          __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 609, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_1, 8, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 609, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_19 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely((__pyx_t_19 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 609, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_v_weight = __pyx_t_19;

          /* "vcstring.pyx":608
 * 
 *                     # Summation of terms
 *                     if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                         weight = ids[t][8]
 *                     else:
 */
          goto __pyx_L12;
        }

        /* "vcstring.pyx":611
 *                         weight = ids[t][8]
 *                     else:
 *                         weight = ids[t][10]             # <<<<<<<<<<<<<<
 *                     val_D_0 += h_I0 * h_I0 * f_i0 * f_j * weight
 *                     val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight
 */
        /*else*/ {
          __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 611, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_5, 10, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 611, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_19 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_19 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 611, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_v_weight = __pyx_t_19;
        }
        __pyx_L12:;

        /* "vcstring.pyx":612
 *                     else:
 *                         weight = ids[t][10]
 *                     val_D_0 += h_I0 * h_I0 * f_i0 * f_j * weight             # <<<<<<<<<<<<<<
 *                     val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight
 *                     if j == 0:
 */
        __pyx_v_val_D_0 = (__pyx_v_val_D_0 + ((((__pyx_v_h_I0 * __pyx_v_h_I0) * __pyx_v_f_i0) * __pyx_v_f_j) * __pyx_v_weight));

        /* "vcstring.pyx":613
 *                         weight = ids[t][10]
 *                     val_D_0 += h_I0 * h_I0 * f_i0 * f_j * weight
 *                     val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight             # <<<<<<<<<<<<<<
 *                     if j == 0:
 *                         val_g_0 += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) * weight
 */
        __pyx_v_val_D_tau = (__pyx_v_val_D_tau + ((((__pyx_v_h_Itau * __pyx_v_h_I0) * __pyx_v_f_itau) * __pyx_v_f_j) * __pyx_v_weight));

        /* "vcstring.pyx":614
 *                     val_D_0 += h_I0 * h_I0 * f_i0 * f_j * weight
 *                     val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight
 *                     if j == 0:             # <<<<<<<<<<<<<<
 *                         val_g_0 += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) * weight
 *                         val_g_tau += ((h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)) * weight
 */
        __pyx_t_21 = ((__pyx_v_j == 0) != 0);
        if (__pyx_t_21) {

          /* "vcstring.pyx":615
 *                     val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight
 *                     if j == 0:
 *                         val_g_0 += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) * weight             # <<<<<<<<<<<<<<
 *                         val_g_tau += ((h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)) * weight
 * 
 */
          __pyx_v_val_g_0 = (__pyx_v_val_g_0 + ((((__pyx_v_h_I0 * __pyx_v_f_i0) * __pyx_v_h_B0) + ((__pyx_v_h_B0 * __pyx_v_h_I0) * __pyx_v_f_i0)) * __pyx_v_weight));

          /* "vcstring.pyx":616
 *                     if j == 0:
 *                         val_g_0 += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) * weight
 *                         val_g_tau += ((h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)) * weight             # <<<<<<<<<<<<<<
 * 
 *                 # Divide by data size
 */
          __pyx_v_val_g_tau = (__pyx_v_val_g_tau + ((((__pyx_v_h_Itau * __pyx_v_f_itau) * __pyx_v_h_B0) + ((__pyx_v_h_Btau * __pyx_v_h_I0) * __pyx_v_f_i0)) * __pyx_v_weight));

          /* "vcstring.pyx":614
 *                     val_D_0 += h_I0 * h_I0 * f_i0 * f_j * weight
 *                     val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight
 *                     if j == 0:             # <<<<<<<<<<<<<<
 *                         val_g_0 += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) * weight
 *                         val_g_tau += ((h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)) * weight
 */
        }
      }

      /* "vcstring.pyx":619
 * 
 *                 # Divide by data size
 *                 D_0.append(val_D_0 / N)             # <<<<<<<<<<<<<<
 *                 D_tau.append(val_D_tau / N)
 *             g_0.append(val_g_0 / N)
 */
      if (unlikely(__pyx_v_N == 0)) {
        PyErr_SetString(PyExc_ZeroDivisionError, "float division");
        __PYX_ERR(0, 619, __pyx_L1_error)
      }
      __pyx_t_1 = PyFloat_FromDouble((__pyx_v_val_D_0 / ((double)__pyx_v_N))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 619, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_22 = __Pyx_PyList_Append(__pyx_v_D_0, __pyx_t_1); if (unlikely(__pyx_t_22 == ((int)-1))) __PYX_ERR(0, 619, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":620
 *                 # Divide by data size
 *                 D_0.append(val_D_0 / N)
 *                 D_tau.append(val_D_tau / N)             # <<<<<<<<<<<<<<
 *             g_0.append(val_g_0 / N)
 *             g_tau.append(val_g_tau / N)
 */
      if (unlikely(__pyx_v_N == 0)) {
        PyErr_SetString(PyExc_ZeroDivisionError, "float division");
        __PYX_ERR(0, 620, __pyx_L1_error)
      }
      __pyx_t_1 = PyFloat_FromDouble((__pyx_v_val_D_tau / ((double)__pyx_v_N))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 620, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_22 = __Pyx_PyList_Append(__pyx_v_D_tau, __pyx_t_1); if (unlikely(__pyx_t_22 == ((int)-1))) __PYX_ERR(0, 620, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }

    /* "vcstring.pyx":621
 *                 D_0.append(val_D_0 / N)
 *                 D_tau.append(val_D_tau / N)
 *             g_0.append(val_g_0 / N)             # <<<<<<<<<<<<<<
 *             g_tau.append(val_g_tau / N)
 * 
 */
    if (unlikely(__pyx_v_N == 0)) {
      PyErr_SetString(PyExc_ZeroDivisionError, "float division");
      __PYX_ERR(0, 621, __pyx_L1_error)
    }
    __pyx_t_1 = PyFloat_FromDouble((__pyx_v_val_g_0 / ((double)__pyx_v_N))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_22 = __Pyx_PyList_Append(__pyx_v_g_0, __pyx_t_1); if (unlikely(__pyx_t_22 == ((int)-1))) __PYX_ERR(0, 621, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "vcstring.pyx":622
 *                 D_tau.append(val_D_tau / N)
 *             g_0.append(val_g_0 / N)
 *             g_tau.append(val_g_tau / N)             # <<<<<<<<<<<<<<
 * 
 *         # Reshape into appropriate matrix size
 */
    if (unlikely(__pyx_v_N == 0)) {
      PyErr_SetString(PyExc_ZeroDivisionError, "float division");
      __PYX_ERR(0, 622, __pyx_L1_error)
    }
    __pyx_t_1 = PyFloat_FromDouble((__pyx_v_val_g_tau / ((double)__pyx_v_N))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 622, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_22 = __Pyx_PyList_Append(__pyx_v_g_tau, __pyx_t_1); if (unlikely(__pyx_t_22 == ((int)-1))) __PYX_ERR(0, 622, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }

  /* "vcstring.pyx":625
 * 
 *         # Reshape into appropriate matrix size
 *         D_0_arr = np.asarray(D_0).reshape(self.num_basis, self.num_basis)             # <<<<<<<<<<<<<<
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 625, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 625, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
    }
  }
  __pyx_t_5 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_2, __pyx_v_D_0) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_v_D_0);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 625, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_reshape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 625, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 625, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 625, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_5, __pyx_t_2};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 625, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_5, __pyx_t_2};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 625, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else
  #endif
  {
    __pyx_t_3 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 625, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (__pyx_t_4) {
      __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4); __pyx_t_4 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_7, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_7, __pyx_t_2);
    __pyx_t_5 = 0;
    __pyx_t_2 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 625, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 625, __pyx_L1_error)
  __pyx_t_23 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_23, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_24, &__pyx_t_25, &__pyx_t_26);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_26);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_24, __pyx_t_25, __pyx_t_26);
      }
      __pyx_t_24 = __pyx_t_25 = __pyx_t_26 = 0;
    }
    __pyx_pybuffernd_D_0_arr.diminfo[0].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0_arr.diminfo[0].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0_arr.diminfo[1].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0_arr.diminfo[1].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 625, __pyx_L1_error)
  }
  __pyx_t_23 = 0;
  __pyx_v_D_0_arr = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":626
 *         # Reshape into appropriate matrix size
 *         D_0_arr = np.asarray(D_0).reshape(self.num_basis, self.num_basis)
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)             # <<<<<<<<<<<<<<
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 626, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_asarray); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 626, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_8 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_D_tau) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_D_tau);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 626, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_reshape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 626, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 626, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 626, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_8, __pyx_t_3};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 626, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_8, __pyx_t_3};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 626, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  {
    __pyx_t_4 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 626, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    if (__pyx_t_5) {
      __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_8);
    PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_7, __pyx_t_8);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_7, __pyx_t_3);
    __pyx_t_8 = 0;
    __pyx_t_3 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 626, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 626, __pyx_L1_error)
  __pyx_t_23 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_23, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_26, &__pyx_t_25, &__pyx_t_24);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_24);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_26, __pyx_t_25, __pyx_t_24);
      }
      __pyx_t_26 = __pyx_t_25 = __pyx_t_24 = 0;
    }
    __pyx_pybuffernd_D_tau_arr.diminfo[0].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau_arr.diminfo[0].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau_arr.diminfo[1].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau_arr.diminfo[1].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 626, __pyx_L1_error)
  }
  __pyx_t_23 = 0;
  __pyx_v_D_tau_arr = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":627
 *         D_0_arr = np.asarray(D_0).reshape(self.num_basis, self.num_basis)
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)             # <<<<<<<<<<<<<<
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 *         print('D_0 =', D_0_arr)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 627, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 627, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_v_g_0) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_g_0);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 627, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 627, __pyx_L1_error)
  __pyx_t_27 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_27, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_24, &__pyx_t_25, &__pyx_t_26);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_0_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_26);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_24, __pyx_t_25, __pyx_t_26);
      }
      __pyx_t_24 = __pyx_t_25 = __pyx_t_26 = 0;
    }
    __pyx_pybuffernd_g_0_arr.diminfo[0].strides = __pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_0_arr.diminfo[0].shape = __pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 627, __pyx_L1_error)
  }
  __pyx_t_27 = 0;
  __pyx_v_g_0_arr = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":628
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)             # <<<<<<<<<<<<<<
 *         print('D_0 =', D_0_arr)
 *         print('D_tau =', D_tau_arr)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 628, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_asarray); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 628, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_v_g_tau) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_g_tau);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 628, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 628, __pyx_L1_error)
  __pyx_t_27 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_27, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_26, &__pyx_t_25, &__pyx_t_24);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_tau_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_24);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_26, __pyx_t_25, __pyx_t_24);
      }
      __pyx_t_26 = __pyx_t_25 = __pyx_t_24 = 0;
    }
    __pyx_pybuffernd_g_tau_arr.diminfo[0].strides = __pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_tau_arr.diminfo[0].shape = __pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 628, __pyx_L1_error)
  }
  __pyx_t_27 = 0;
  __pyx_v_g_tau_arr = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":629
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 *         print('D_0 =', D_0_arr)             # <<<<<<<<<<<<<<
 *         print('D_tau =', D_tau_arr)
 *         print('g_0 =', g_0_arr)
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 629, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_D_0);
  __Pyx_GIVEREF(__pyx_kp_u_D_0);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_D_0);
  __Pyx_INCREF(((PyObject *)__pyx_v_D_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_0_arr));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_D_0_arr));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 629, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":630
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 *         print('D_0 =', D_0_arr)
 *         print('D_tau =', D_tau_arr)             # <<<<<<<<<<<<<<
 *         print('g_0 =', g_0_arr)
 *         print('g_tau =', g_tau_arr)
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 630, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_D_tau);
  __Pyx_GIVEREF(__pyx_kp_u_D_tau);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_D_tau);
  __Pyx_INCREF(((PyObject *)__pyx_v_D_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_D_tau_arr));
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 630, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":631
 *         print('D_0 =', D_0_arr)
 *         print('D_tau =', D_tau_arr)
 *         print('g_0 =', g_0_arr)             # <<<<<<<<<<<<<<
 *         print('g_tau =', g_tau_arr)
 * 
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 631, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_g_0);
  __Pyx_GIVEREF(__pyx_kp_u_g_0);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_g_0);
  __Pyx_INCREF(((PyObject *)__pyx_v_g_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_0_arr));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_g_0_arr));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 631, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":632
 *         print('D_tau =', D_tau_arr)
 *         print('g_0 =', g_0_arr)
 *         print('g_tau =', g_tau_arr)             # <<<<<<<<<<<<<<
 * 
 *         # Symmetrize for reversible dynamics
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 632, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_g_tau);
  __Pyx_GIVEREF(__pyx_kp_u_g_tau);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_g_tau);
  __Pyx_INCREF(((PyObject *)__pyx_v_g_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_g_tau_arr));
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 632, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":635
 * 
 *         # Symmetrize for reversible dynamics
 *         if symmetric == True:             # <<<<<<<<<<<<<<
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 */
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_symmetric, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 635, __pyx_L1_error)
  __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 635, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_21) {

    /* "vcstring.pyx":636
 *         # Symmetrize for reversible dynamics
 *         if symmetric == True:
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)             # <<<<<<<<<<<<<<
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 *             print('Symmetric D_0 =', D_0_arr)
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_D_0_arr), __pyx_n_s_T); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 636, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_Add(((PyObject *)__pyx_v_D_0_arr), __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 636, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyNumber_Multiply(__pyx_float_0_5, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 636, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 636, __pyx_L1_error)
    __pyx_t_23 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
      __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_23, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
      if (unlikely(__pyx_t_7 < 0)) {
        PyErr_Fetch(&__pyx_t_24, &__pyx_t_25, &__pyx_t_26);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_26);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_24, __pyx_t_25, __pyx_t_26);
        }
        __pyx_t_24 = __pyx_t_25 = __pyx_t_26 = 0;
      }
      __pyx_pybuffernd_D_0_arr.diminfo[0].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0_arr.diminfo[0].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0_arr.diminfo[1].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0_arr.diminfo[1].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[1];
      if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 636, __pyx_L1_error)
    }
    __pyx_t_23 = 0;
    __Pyx_DECREF_SET(__pyx_v_D_0_arr, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "vcstring.pyx":637
 *         if symmetric == True:
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)             # <<<<<<<<<<<<<<
 *             print('Symmetric D_0 =', D_0_arr)
 *             print('Symmetric D_tau =', D_tau_arr)
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_D_tau_arr), __pyx_n_s_T); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 637, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_Add(((PyObject *)__pyx_v_D_tau_arr), __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 637, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyNumber_Multiply(__pyx_float_0_5, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 637, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 637, __pyx_L1_error)
    __pyx_t_23 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
      __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_23, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
      if (unlikely(__pyx_t_7 < 0)) {
        PyErr_Fetch(&__pyx_t_26, &__pyx_t_25, &__pyx_t_24);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_24);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_26, __pyx_t_25, __pyx_t_24);
        }
        __pyx_t_26 = __pyx_t_25 = __pyx_t_24 = 0;
      }
      __pyx_pybuffernd_D_tau_arr.diminfo[0].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau_arr.diminfo[0].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau_arr.diminfo[1].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau_arr.diminfo[1].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[1];
      if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 637, __pyx_L1_error)
    }
    __pyx_t_23 = 0;
    __Pyx_DECREF_SET(__pyx_v_D_tau_arr, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "vcstring.pyx":638
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 *             print('Symmetric D_0 =', D_0_arr)             # <<<<<<<<<<<<<<
 *             print('Symmetric D_tau =', D_tau_arr)
 * 
 */
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 638, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_kp_u_Symmetric_D_0);
    __Pyx_GIVEREF(__pyx_kp_u_Symmetric_D_0);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Symmetric_D_0);
    __Pyx_INCREF(((PyObject *)__pyx_v_D_0_arr));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_D_0_arr));
    PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_D_0_arr));
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 638, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "vcstring.pyx":639
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 *             print('Symmetric D_0 =', D_0_arr)
 *             print('Symmetric D_tau =', D_tau_arr)             # <<<<<<<<<<<<<<
 * 
 *         # Calculate committor coefficients, b
 */
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 639, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_kp_u_Symmetric_D_tau);
    __Pyx_GIVEREF(__pyx_kp_u_Symmetric_D_tau);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_Symmetric_D_tau);
    __Pyx_INCREF(((PyObject *)__pyx_v_D_tau_arr));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_D_tau_arr));
    PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_D_tau_arr));
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 639, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "vcstring.pyx":635
 * 
 *         # Symmetrize for reversible dynamics
 *         if symmetric == True:             # <<<<<<<<<<<<<<
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 */
  }

  /* "vcstring.pyx":642
 * 
 *         # Calculate committor coefficients, b
 *         D = D_0_arr - D_tau_arr             # <<<<<<<<<<<<<<
 *         g = g_tau_arr - g_0_arr
 *         b = 0.5 * np.linalg.inv(D).dot(g)
 */
  __pyx_t_1 = PyNumber_Subtract(((PyObject *)__pyx_v_D_0_arr), ((PyObject *)__pyx_v_D_tau_arr)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 642, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 642, __pyx_L1_error)
  __pyx_t_23 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D.rcbuffer->pybuffer, (PyObject*)__pyx_t_23, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_24, &__pyx_t_25, &__pyx_t_26);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D.rcbuffer->pybuffer, (PyObject*)__pyx_v_D, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_26);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_24, __pyx_t_25, __pyx_t_26);
      }
      __pyx_t_24 = __pyx_t_25 = __pyx_t_26 = 0;
    }
    __pyx_pybuffernd_D.diminfo[0].strides = __pyx_pybuffernd_D.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D.diminfo[0].shape = __pyx_pybuffernd_D.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D.diminfo[1].strides = __pyx_pybuffernd_D.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D.diminfo[1].shape = __pyx_pybuffernd_D.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 642, __pyx_L1_error)
  }
  __pyx_t_23 = 0;
  __pyx_v_D = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":643
 *         # Calculate committor coefficients, b
 *         D = D_0_arr - D_tau_arr
 *         g = g_tau_arr - g_0_arr             # <<<<<<<<<<<<<<
 *         b = 0.5 * np.linalg.inv(D).dot(g)
 *         print('b =', b)
 */
  __pyx_t_1 = PyNumber_Subtract(((PyObject *)__pyx_v_g_tau_arr), ((PyObject *)__pyx_v_g_0_arr)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 643, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 643, __pyx_L1_error)
  __pyx_t_27 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g.rcbuffer->pybuffer, (PyObject*)__pyx_t_27, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_26, &__pyx_t_25, &__pyx_t_24);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g.rcbuffer->pybuffer, (PyObject*)__pyx_v_g, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_24);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_26, __pyx_t_25, __pyx_t_24);
      }
      __pyx_t_26 = __pyx_t_25 = __pyx_t_24 = 0;
    }
    __pyx_pybuffernd_g.diminfo[0].strides = __pyx_pybuffernd_g.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g.diminfo[0].shape = __pyx_pybuffernd_g.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 643, __pyx_L1_error)
  }
  __pyx_t_27 = 0;
  __pyx_v_g = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":644
 *         D = D_0_arr - D_tau_arr
 *         g = g_tau_arr - g_0_arr
 *         b = 0.5 * np.linalg.inv(D).dot(g)             # <<<<<<<<<<<<<<
 *         print('b =', b)
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 644, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_linalg); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 644, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_inv); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 644, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, ((PyObject *)__pyx_v_D)) : __Pyx_PyObject_CallOneArg(__pyx_t_4, ((PyObject *)__pyx_v_D));
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 644, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_dot); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 644, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, ((PyObject *)__pyx_v_g)) : __Pyx_PyObject_CallOneArg(__pyx_t_4, ((PyObject *)__pyx_v_g));
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 644, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyNumber_Multiply(__pyx_float_0_5, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 644, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 644, __pyx_L1_error)
  __pyx_t_27 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_t_27, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_24, &__pyx_t_25, &__pyx_t_26);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_26);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_24, __pyx_t_25, __pyx_t_26);
      }
      __pyx_t_24 = __pyx_t_25 = __pyx_t_26 = 0;
    }
    __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 644, __pyx_L1_error)
  }
  __pyx_t_27 = 0;
  __pyx_v_b = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "vcstring.pyx":645
 *         g = g_tau_arr - g_0_arr
 *         b = 0.5 * np.linalg.inv(D).dot(g)
 *         print('b =', b)             # <<<<<<<<<<<<<<
 * 
 *         return b, D_0_arr, D_tau_arr, g_0_arr, g_tau_arr
 */
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 645, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_kp_u_b);
  __Pyx_GIVEREF(__pyx_kp_u_b);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_b);
  __Pyx_INCREF(((PyObject *)__pyx_v_b));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
  PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_b));
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 645, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":647
 *         print('b =', b)
 * 
 *         return b, D_0_arr, D_tau_arr, g_0_arr, g_tau_arr             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 647, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_v_b));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_b));
  __Pyx_INCREF(((PyObject *)__pyx_v_D_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_0_arr));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_D_0_arr));
  __Pyx_INCREF(((PyObject *)__pyx_v_D_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_1, 2, ((PyObject *)__pyx_v_D_tau_arr));
  __Pyx_INCREF(((PyObject *)__pyx_v_g_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_0_arr));
  PyTuple_SET_ITEM(__pyx_t_1, 3, ((PyObject *)__pyx_v_g_0_arr));
  __Pyx_INCREF(((PyObject *)__pyx_v_g_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_1, 4, ((PyObject *)__pyx_v_g_tau_arr));
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "vcstring.pyx":549
 * 
 * 
 *     cpdef calc_coeffs_ensemble(self, int N, int tau, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=2] ids, symmetric=True):             # <<<<<<<<<<<<<<
 *         """
 *         Solve the linear equation from minimizing the forward steady-state flux.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_coeffs_ensemble", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XDECREF(__pyx_v_D_0);
  __Pyx_XDECREF(__pyx_v_D_tau);
  __Pyx_XDECREF(__pyx_v_g_0);
  __Pyx_XDECREF(__pyx_v_g_tau);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_0_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_tau_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_D);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_0_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_tau_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_g);
  __Pyx_XDECREF((PyObject *)__pyx_v_b);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_15calc_coeffs_ensemble(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8vcstring_8vcstring_14calc_coeffs_ensemble[] = "\n        Solve the linear equation from minimizing the forward steady-state flux.\n        Calculates D matrices, g vectors, and b coefficients.\n\n        Parameters\n        ----------\n        traj :  trajectory with shape (T, d), where T is number of time steps and d is dimensions.\n        tau  :  lag time (units step)\n\n        Returns:\n        --------\n        - Symmetric square Matrices D_0_sym and D_tau_sym\n        - Vectors g_0 and g_tau\n        - A vector of the coefficients b for the trial committor expressed as a basis set expansion\n        ";
static PyObject *__pyx_pw_8vcstring_8vcstring_15calc_coeffs_ensemble(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_N;
  int __pyx_v_tau;
  PyArrayObject *__pyx_v_z = 0;
  PyArrayObject *__pyx_v_ids = 0;
  PyObject *__pyx_v_symmetric = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("calc_coeffs_ensemble (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_N,&__pyx_n_s_tau,&__pyx_n_s_z,&__pyx_n_s_ids,&__pyx_n_s_symmetric,0};
    PyObject* values[5] = {0,0,0,0,0};
    values[4] = ((PyObject *)Py_True);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_N)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tau)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_coeffs_ensemble", 0, 4, 5, 1); __PYX_ERR(0, 549, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_coeffs_ensemble", 0, 4, 5, 2); __PYX_ERR(0, 549, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ids)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_coeffs_ensemble", 0, 4, 5, 3); __PYX_ERR(0, 549, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_symmetric);
          if (value) { values[4] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "calc_coeffs_ensemble") < 0)) __PYX_ERR(0, 549, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_N = __Pyx_PyInt_As_int(values[0]); if (unlikely((__pyx_v_N == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 549, __pyx_L3_error)
    __pyx_v_tau = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_tau == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 549, __pyx_L3_error)
    __pyx_v_z = ((PyArrayObject *)values[2]);
    __pyx_v_ids = ((PyArrayObject *)values[3]);
    __pyx_v_symmetric = values[4];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("calc_coeffs_ensemble", 0, 4, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 549, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.vcstring.calc_coeffs_ensemble", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_z), __pyx_ptype_5numpy_ndarray, 1, "z", 0))) __PYX_ERR(0, 549, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ids), __pyx_ptype_5numpy_ndarray, 1, "ids", 0))) __PYX_ERR(0, 549, __pyx_L1_error)
  __pyx_r = __pyx_pf_8vcstring_8vcstring_14calc_coeffs_ensemble(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self), __pyx_v_N, __pyx_v_tau, __pyx_v_z, __pyx_v_ids, __pyx_v_symmetric);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_14calc_coeffs_ensemble(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_v_N, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_ids, PyObject *__pyx_v_symmetric) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ids;
  __Pyx_Buffer __pyx_pybuffer_ids;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble __pyx_t_2;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_coeffs_ensemble", 0);
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  __pyx_pybuffer_ids.pybuffer.buf = NULL;
  __pyx_pybuffer_ids.refcount = 0;
  __pyx_pybuffernd_ids.data = NULL;
  __pyx_pybuffernd_ids.rcbuffer = &__pyx_pybuffer_ids;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 549, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 549, __pyx_L1_error)
  }
  __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2.__pyx_n = 1;
  __pyx_t_2.symmetric = __pyx_v_symmetric;
  __pyx_t_1 = __pyx_vtabptr_8vcstring_vcstring->calc_coeffs_ensemble(__pyx_v_self, __pyx_v_N, __pyx_v_tau, __pyx_v_z, __pyx_v_ids, 1, &__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 549, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_coeffs_ensemble", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":650
 * 
 * 
 *     cpdef calc_coeffs_ensemble_timeavg(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, list weights=None, t_final=None, symmetric=True):             # <<<<<<<<<<<<<<
 *         """
 *         Solve the linear equation from minimizing the forward steady-state flux.
 */

static PyObject *__pyx_pw_8vcstring_8vcstring_17calc_coeffs_ensemble_timeavg(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg *__pyx_optional_args) {
  PyObject *__pyx_v_weights = ((PyObject*)Py_None);
  PyObject *__pyx_v_t_final = ((PyObject *)Py_None);
  PyObject *__pyx_v_symmetric = ((PyObject *)Py_True);
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_count;
  int __pyx_v_t0;
  int __pyx_v_t;
  PyObject *__pyx_v_D_0 = 0;
  PyObject *__pyx_v_D_tau = 0;
  PyObject *__pyx_v_g_0 = 0;
  PyObject *__pyx_v_g_tau = 0;
  double __pyx_v_val_g_0;
  double __pyx_v_val_g_tau;
  double __pyx_v_val_D_0;
  double __pyx_v_val_D_tau;
  double __pyx_v_f_i0;
  double __pyx_v_f_itau;
  double __pyx_v_f_j;
  double __pyx_v_h_I0;
  double __pyx_v_h_B0;
  double __pyx_v_h_Itau;
  double __pyx_v_h_Btau;
  double __pyx_v_weight;
  PyArrayObject *__pyx_v_ids = 0;
  PyArrayObject *__pyx_v_D_0_arr = 0;
  PyArrayObject *__pyx_v_D_tau_arr = 0;
  PyArrayObject *__pyx_v_D = 0;
  PyArrayObject *__pyx_v_g_0_arr = 0;
  PyArrayObject *__pyx_v_g_tau_arr = 0;
  PyArrayObject *__pyx_v_g = 0;
  PyArrayObject *__pyx_v_b = 0;
  Py_ssize_t __pyx_v_N;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D;
  __Pyx_Buffer __pyx_pybuffer_D;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_0_arr;
  __Pyx_Buffer __pyx_pybuffer_D_0_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_tau_arr;
  __Pyx_Buffer __pyx_pybuffer_D_tau_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g;
  __Pyx_Buffer __pyx_pybuffer_g;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_0_arr;
  __Pyx_Buffer __pyx_pybuffer_g_0_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_tau_arr;
  __Pyx_Buffer __pyx_pybuffer_g_tau_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ids;
  __Pyx_Buffer __pyx_pybuffer_ids;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  int __pyx_t_9;
  int __pyx_t_10;
  double __pyx_t_11;
  double __pyx_t_12;
  int __pyx_t_13;
  int __pyx_t_14;
  int __pyx_t_15;
  Py_ssize_t __pyx_t_16;
  int __pyx_t_17;
  int __pyx_t_18;
  Py_ssize_t __pyx_t_19;
  struct __pyx_opt_args_8vcstring_8vcstring_assign_states_ensemble __pyx_t_20;
  PyArrayObject *__pyx_t_21 = NULL;
  int __pyx_t_22;
  PyObject *__pyx_t_23 = NULL;
  PyObject *__pyx_t_24 = NULL;
  PyObject *__pyx_t_25 = NULL;
  Py_ssize_t __pyx_t_26;
  double __pyx_t_27;
  int __pyx_t_28;
  int __pyx_t_29;
  PyArrayObject *__pyx_t_30 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_coeffs_ensemble_timeavg", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args->__pyx_n > 0) {
      __pyx_v_weights = __pyx_optional_args->weights;
      if (__pyx_optional_args->__pyx_n > 1) {
        __pyx_v_t_final = __pyx_optional_args->t_final;
        if (__pyx_optional_args->__pyx_n > 2) {
          __pyx_v_symmetric = __pyx_optional_args->symmetric;
        }
      }
    }
  }
  __pyx_pybuffer_ids.pybuffer.buf = NULL;
  __pyx_pybuffer_ids.refcount = 0;
  __pyx_pybuffernd_ids.data = NULL;
  __pyx_pybuffernd_ids.rcbuffer = &__pyx_pybuffer_ids;
  __pyx_pybuffer_D_0_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_D_0_arr.refcount = 0;
  __pyx_pybuffernd_D_0_arr.data = NULL;
  __pyx_pybuffernd_D_0_arr.rcbuffer = &__pyx_pybuffer_D_0_arr;
  __pyx_pybuffer_D_tau_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_D_tau_arr.refcount = 0;
  __pyx_pybuffernd_D_tau_arr.data = NULL;
  __pyx_pybuffernd_D_tau_arr.rcbuffer = &__pyx_pybuffer_D_tau_arr;
  __pyx_pybuffer_D.pybuffer.buf = NULL;
  __pyx_pybuffer_D.refcount = 0;
  __pyx_pybuffernd_D.data = NULL;
  __pyx_pybuffernd_D.rcbuffer = &__pyx_pybuffer_D;
  __pyx_pybuffer_g_0_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_g_0_arr.refcount = 0;
  __pyx_pybuffernd_g_0_arr.data = NULL;
  __pyx_pybuffernd_g_0_arr.rcbuffer = &__pyx_pybuffer_g_0_arr;
  __pyx_pybuffer_g_tau_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_g_tau_arr.refcount = 0;
  __pyx_pybuffernd_g_tau_arr.data = NULL;
  __pyx_pybuffernd_g_tau_arr.rcbuffer = &__pyx_pybuffer_g_tau_arr;
  __pyx_pybuffer_g.pybuffer.buf = NULL;
  __pyx_pybuffer_g.refcount = 0;
  __pyx_pybuffernd_g.data = NULL;
  __pyx_pybuffernd_g.rcbuffer = &__pyx_pybuffer_g;
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 650, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_calc_coeffs_ensemble_timeavg); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 650, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_8vcstring_8vcstring_17calc_coeffs_ensemble_timeavg)) {
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 650, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
        __pyx_t_6 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
          __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
          if (likely(__pyx_t_5)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
            __Pyx_INCREF(__pyx_t_5);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_4, function);
            __pyx_t_6 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[7] = {__pyx_t_5, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_z), __pyx_v_weights, __pyx_v_t_final, __pyx_v_symmetric};
          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 6+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 650, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[7] = {__pyx_t_5, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_z), __pyx_v_weights, __pyx_v_t_final, __pyx_v_symmetric};
          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 6+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 650, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        } else
        #endif
        {
          __pyx_t_7 = PyTuple_New(6+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 650, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          if (__pyx_t_5) {
            __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
          }
          __Pyx_INCREF(__pyx_v_traj);
          __Pyx_GIVEREF(__pyx_v_traj);
          PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_traj);
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_t_3);
          __Pyx_INCREF(((PyObject *)__pyx_v_z));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
          PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_6, ((PyObject *)__pyx_v_z));
          __Pyx_INCREF(__pyx_v_weights);
          __Pyx_GIVEREF(__pyx_v_weights);
          PyTuple_SET_ITEM(__pyx_t_7, 3+__pyx_t_6, __pyx_v_weights);
          __Pyx_INCREF(__pyx_v_t_final);
          __Pyx_GIVEREF(__pyx_v_t_final);
          PyTuple_SET_ITEM(__pyx_t_7, 4+__pyx_t_6, __pyx_v_t_final);
          __Pyx_INCREF(__pyx_v_symmetric);
          __Pyx_GIVEREF(__pyx_v_symmetric);
          PyTuple_SET_ITEM(__pyx_t_7, 5+__pyx_t_6, __pyx_v_symmetric);
          __pyx_t_3 = 0;
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 650, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        }
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }

  /* "vcstring.pyx":675
 *         cdef np.ndarray[DTYPE_t, ndim=1] g_0_arr, g_tau_arr, g, b
 * 
 *         print('\n======================================')             # <<<<<<<<<<<<<<
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')
 *         print('======================================')
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__21, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 675, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":676
 * 
 *         print('\n======================================')
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')             # <<<<<<<<<<<<<<
 *         print('======================================')
 *         print('lag time =', tau)
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__22, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 676, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":677
 *         print('\n======================================')
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')
 *         print('======================================')             # <<<<<<<<<<<<<<
 *         print('lag time =', tau)
 *         # print('Number of trajs:', N)
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__24, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 677, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":678
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')
 *         print('======================================')
 *         print('lag time =', tau)             # <<<<<<<<<<<<<<
 *         # print('Number of trajs:', N)
 *         print('Symmetrization of D matrices:', symmetric)
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 678, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 678, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_lag_time);
  __Pyx_GIVEREF(__pyx_kp_u_lag_time);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_lag_time);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 678, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":680
 *         print('lag time =', tau)
 *         # print('Number of trajs:', N)
 *         print('Symmetrization of D matrices:', symmetric)             # <<<<<<<<<<<<<<
 * 
 *         N = len(traj)
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 680, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_Symmetrization_of_D_matrices);
  __Pyx_GIVEREF(__pyx_kp_u_Symmetrization_of_D_matrices);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Symmetrization_of_D_matrices);
  __Pyx_INCREF(__pyx_v_symmetric);
  __Pyx_GIVEREF(__pyx_v_symmetric);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_symmetric);
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 680, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":682
 *         print('Symmetrization of D matrices:', symmetric)
 * 
 *         N = len(traj)             # <<<<<<<<<<<<<<
 *         D_0 = []
 *         D_tau = []
 */
  if (unlikely(__pyx_v_traj == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
    __PYX_ERR(0, 682, __pyx_L1_error)
  }
  __pyx_t_8 = PyList_GET_SIZE(__pyx_v_traj); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 682, __pyx_L1_error)
  __pyx_v_N = __pyx_t_8;

  /* "vcstring.pyx":683
 * 
 *         N = len(traj)
 *         D_0 = []             # <<<<<<<<<<<<<<
 *         D_tau = []
 *         g_0 = []
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 683, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_D_0 = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":684
 *         N = len(traj)
 *         D_0 = []
 *         D_tau = []             # <<<<<<<<<<<<<<
 *         g_0 = []
 *         g_tau = []
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 684, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_D_tau = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":685
 *         D_0 = []
 *         D_tau = []
 *         g_0 = []             # <<<<<<<<<<<<<<
 *         g_tau = []
 *         for i in range(self.num_basis):
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 685, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_g_0 = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":686
 *         D_tau = []
 *         g_0 = []
 *         g_tau = []             # <<<<<<<<<<<<<<
 *         for i in range(self.num_basis):
 *             val_g_0, val_g_tau = 0.0, 0.0
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 686, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_g_tau = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":687
 *         g_0 = []
 *         g_tau = []
 *         for i in range(self.num_basis):             # <<<<<<<<<<<<<<
 *             val_g_0, val_g_tau = 0.0, 0.0
 *             for j in range(self.num_basis):
 */
  __pyx_t_6 = __pyx_v_self->num_basis;
  __pyx_t_9 = __pyx_t_6;
  for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
    __pyx_v_i = __pyx_t_10;

    /* "vcstring.pyx":688
 *         g_tau = []
 *         for i in range(self.num_basis):
 *             val_g_0, val_g_tau = 0.0, 0.0             # <<<<<<<<<<<<<<
 *             for j in range(self.num_basis):
 *                 print("Matrix elements", i, j)
 */
    __pyx_t_11 = 0.0;
    __pyx_t_12 = 0.0;
    __pyx_v_val_g_0 = __pyx_t_11;
    __pyx_v_val_g_tau = __pyx_t_12;

    /* "vcstring.pyx":689
 *         for i in range(self.num_basis):
 *             val_g_0, val_g_tau = 0.0, 0.0
 *             for j in range(self.num_basis):             # <<<<<<<<<<<<<<
 *                 print("Matrix elements", i, j)
 *                 sys.stdout.flush()
 */
    __pyx_t_13 = __pyx_v_self->num_basis;
    __pyx_t_14 = __pyx_t_13;
    for (__pyx_t_15 = 0; __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
      __pyx_v_j = __pyx_t_15;

      /* "vcstring.pyx":690
 *             val_g_0, val_g_tau = 0.0, 0.0
 *             for j in range(self.num_basis):
 *                 print("Matrix elements", i, j)             # <<<<<<<<<<<<<<
 *                 sys.stdout.flush()
 *                 val_D_0, val_D_tau = 0.0, 0.0
 */
      __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 690, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_j); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 690, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 690, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_INCREF(__pyx_kp_u_Matrix_elements);
      __Pyx_GIVEREF(__pyx_kp_u_Matrix_elements);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_Matrix_elements);
      __Pyx_GIVEREF(__pyx_t_2);
      PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_t_1);
      __pyx_t_2 = 0;
      __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 690, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":691
 *             for j in range(self.num_basis):
 *                 print("Matrix elements", i, j)
 *                 sys.stdout.flush()             # <<<<<<<<<<<<<<
 *                 val_D_0, val_D_tau = 0.0, 0.0
 *                 count = 0
 */
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sys); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 691, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_stdout); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 691, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_flush); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 691, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_2)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_2);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
        }
      }
      __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 691, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":692
 *                 print("Matrix elements", i, j)
 *                 sys.stdout.flush()
 *                 val_D_0, val_D_tau = 0.0, 0.0             # <<<<<<<<<<<<<<
 *                 count = 0
 *                 for t0 in range(len(traj[0])):
 */
      __pyx_t_12 = 0.0;
      __pyx_t_11 = 0.0;
      __pyx_v_val_D_0 = __pyx_t_12;
      __pyx_v_val_D_tau = __pyx_t_11;

      /* "vcstring.pyx":693
 *                 sys.stdout.flush()
 *                 val_D_0, val_D_tau = 0.0, 0.0
 *                 count = 0             # <<<<<<<<<<<<<<
 *                 for t0 in range(len(traj[0])):
 *                     print('\nt0:', t0)
 */
      __pyx_v_count = 0;

      /* "vcstring.pyx":694
 *                 val_D_0, val_D_tau = 0.0, 0.0
 *                 count = 0
 *                 for t0 in range(len(traj[0])):             # <<<<<<<<<<<<<<
 *                     print('\nt0:', t0)
 *                     if t_final == None:
 */
      if (unlikely(__pyx_v_traj == Py_None)) {
        PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
        __PYX_ERR(0, 694, __pyx_L1_error)
      }
      __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_v_traj, 0, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 694, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_8 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 694, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_16 = __pyx_t_8;
      for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
        __pyx_v_t0 = __pyx_t_17;

        /* "vcstring.pyx":695
 *                 count = 0
 *                 for t0 in range(len(traj[0])):
 *                     print('\nt0:', t0)             # <<<<<<<<<<<<<<
 *                     if t_final == None:
 *                         if t0 + tau >= len(traj[0]):
 */
        __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_t0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 695, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 695, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_kp_u_t0_2);
        __Pyx_GIVEREF(__pyx_kp_u_t0_2);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_t0_2);
        __Pyx_GIVEREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_1);
        __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 695, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

        /* "vcstring.pyx":696
 *                 for t0 in range(len(traj[0])):
 *                     print('\nt0:', t0)
 *                     if t_final == None:             # <<<<<<<<<<<<<<
 *                         if t0 + tau >= len(traj[0]):
 *                             print('out of index')
 */
        __pyx_t_1 = PyObject_RichCompare(__pyx_v_t_final, Py_None, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 696, __pyx_L1_error)
        __pyx_t_18 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_18 < 0)) __PYX_ERR(0, 696, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        if (__pyx_t_18) {

          /* "vcstring.pyx":697
 *                     print('\nt0:', t0)
 *                     if t_final == None:
 *                         if t0 + tau >= len(traj[0]):             # <<<<<<<<<<<<<<
 *                             print('out of index')
 *                             break
 */
          if (unlikely(__pyx_v_traj == Py_None)) {
            PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
            __PYX_ERR(0, 697, __pyx_L1_error)
          }
          __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_v_traj, 0, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 697, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_19 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_19 == ((Py_ssize_t)-1))) __PYX_ERR(0, 697, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_18 = (((__pyx_v_t0 + __pyx_v_tau) >= __pyx_t_19) != 0);
          if (__pyx_t_18) {

            /* "vcstring.pyx":698
 *                     if t_final == None:
 *                         if t0 + tau >= len(traj[0]):
 *                             print('out of index')             # <<<<<<<<<<<<<<
 *                             break
 *                     else:
 */
            __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__31, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 698, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_1);
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

            /* "vcstring.pyx":699
 *                         if t0 + tau >= len(traj[0]):
 *                             print('out of index')
 *                             break             # <<<<<<<<<<<<<<
 *                     else:
 *                         if t0 + tau >= t_final:
 */
            goto __pyx_L8_break;

            /* "vcstring.pyx":697
 *                     print('\nt0:', t0)
 *                     if t_final == None:
 *                         if t0 + tau >= len(traj[0]):             # <<<<<<<<<<<<<<
 *                             print('out of index')
 *                             break
 */
          }

          /* "vcstring.pyx":696
 *                 for t0 in range(len(traj[0])):
 *                     print('\nt0:', t0)
 *                     if t_final == None:             # <<<<<<<<<<<<<<
 *                         if t0 + tau >= len(traj[0]):
 *                             print('out of index')
 */
          goto __pyx_L9;
        }

        /* "vcstring.pyx":701
 *                             break
 *                     else:
 *                         if t0 + tau >= t_final:             # <<<<<<<<<<<<<<
 *                             print('out of index')
 *                             break
 */
        /*else*/ {
          __pyx_t_1 = __Pyx_PyInt_From_int((__pyx_v_t0 + __pyx_v_tau)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 701, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_4 = PyObject_RichCompare(__pyx_t_1, __pyx_v_t_final, Py_GE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 701, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_18 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_18 < 0)) __PYX_ERR(0, 701, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          if (__pyx_t_18) {

            /* "vcstring.pyx":702
 *                     else:
 *                         if t0 + tau >= t_final:
 *                             print('out of index')             # <<<<<<<<<<<<<<
 *                             break
 * 
 */
            __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__31, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 702, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_4);
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

            /* "vcstring.pyx":703
 *                         if t0 + tau >= t_final:
 *                             print('out of index')
 *                             break             # <<<<<<<<<<<<<<
 * 
 *                     ids = self.assign_states_ensemble(traj, tau, z, t0=t0, weights=weights)
 */
            goto __pyx_L8_break;

            /* "vcstring.pyx":701
 *                             break
 *                     else:
 *                         if t0 + tau >= t_final:             # <<<<<<<<<<<<<<
 *                             print('out of index')
 *                             break
 */
          }
        }
        __pyx_L9:;

        /* "vcstring.pyx":705
 *                             break
 * 
 *                     ids = self.assign_states_ensemble(traj, tau, z, t0=t0, weights=weights)             # <<<<<<<<<<<<<<
 *                     for t in range(N):
 *                         f_i0, f_itau, f_j = 0.0, 0.0, 0.0
 */
        __pyx_t_20.__pyx_n = 2;
        __pyx_t_20.t0 = __pyx_v_t0;
        __pyx_t_20.weights = __pyx_v_weights;
        __pyx_t_4 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->assign_states_ensemble(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, ((PyArrayObject *)__pyx_v_z), 0, &__pyx_t_20); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 705, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 705, __pyx_L1_error)
        __pyx_t_21 = ((PyArrayObject *)__pyx_t_4);
        {
          __Pyx_BufFmt_StackElem __pyx_stack[1];
          __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
          __pyx_t_22 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_t_21, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
          if (unlikely(__pyx_t_22 < 0)) {
            PyErr_Fetch(&__pyx_t_23, &__pyx_t_24, &__pyx_t_25);
            if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
              Py_XDECREF(__pyx_t_23); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25);
              __Pyx_RaiseBufferFallbackError();
            } else {
              PyErr_Restore(__pyx_t_23, __pyx_t_24, __pyx_t_25);
            }
            __pyx_t_23 = __pyx_t_24 = __pyx_t_25 = 0;
          }
          __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
          if (unlikely(__pyx_t_22 < 0)) __PYX_ERR(0, 705, __pyx_L1_error)
        }
        __pyx_t_21 = 0;
        __Pyx_XDECREF_SET(__pyx_v_ids, ((PyArrayObject *)__pyx_t_4));
        __pyx_t_4 = 0;

        /* "vcstring.pyx":706
 * 
 *                     ids = self.assign_states_ensemble(traj, tau, z, t0=t0, weights=weights)
 *                     for t in range(N):             # <<<<<<<<<<<<<<
 *                         f_i0, f_itau, f_j = 0.0, 0.0, 0.0
 *                         h_I0 = ids[t][0]
 */
        __pyx_t_19 = __pyx_v_N;
        __pyx_t_26 = __pyx_t_19;
        for (__pyx_t_22 = 0; __pyx_t_22 < __pyx_t_26; __pyx_t_22+=1) {
          __pyx_v_t = __pyx_t_22;

          /* "vcstring.pyx":707
 *                     ids = self.assign_states_ensemble(traj, tau, z, t0=t0, weights=weights)
 *                     for t in range(N):
 *                         f_i0, f_itau, f_j = 0.0, 0.0, 0.0             # <<<<<<<<<<<<<<
 *                         h_I0 = ids[t][0]
 *                         h_Itau = ids[t][2]
 */
          __pyx_t_11 = 0.0;
          __pyx_t_12 = 0.0;
          __pyx_t_27 = 0.0;
          __pyx_v_f_i0 = __pyx_t_11;
          __pyx_v_f_itau = __pyx_t_12;
          __pyx_v_f_j = __pyx_t_27;

          /* "vcstring.pyx":708
 *                     for t in range(N):
 *                         f_i0, f_itau, f_j = 0.0, 0.0, 0.0
 *                         h_I0 = ids[t][0]             # <<<<<<<<<<<<<<
 *                         h_Itau = ids[t][2]
 *                         h_B0 = ids[t][1]
 */
          __pyx_t_4 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 708, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_4, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 708, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_27 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_27 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 708, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_v_h_I0 = __pyx_t_27;

          /* "vcstring.pyx":709
 *                         f_i0, f_itau, f_j = 0.0, 0.0, 0.0
 *                         h_I0 = ids[t][0]
 *                         h_Itau = ids[t][2]             # <<<<<<<<<<<<<<
 *                         h_B0 = ids[t][1]
 *                         h_Btau = ids[t][3]
 */
          __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 709, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 709, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_27 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_27 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 709, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_v_h_Itau = __pyx_t_27;

          /* "vcstring.pyx":710
 *                         h_I0 = ids[t][0]
 *                         h_Itau = ids[t][2]
 *                         h_B0 = ids[t][1]             # <<<<<<<<<<<<<<
 *                         h_Btau = ids[t][3]
 *                         if ids[t][4] == i:  # Match Voronoi centroids
 */
          __pyx_t_4 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 710, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_4, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 710, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_27 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_27 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 710, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_v_h_B0 = __pyx_t_27;

          /* "vcstring.pyx":711
 *                         h_Itau = ids[t][2]
 *                         h_B0 = ids[t][1]
 *                         h_Btau = ids[t][3]             # <<<<<<<<<<<<<<
 *                         if ids[t][4] == i:  # Match Voronoi centroids
 *                             f_i0 = 1.0
 */
          __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 711, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 711, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_27 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_27 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 711, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_v_h_Btau = __pyx_t_27;

          /* "vcstring.pyx":712
 *                         h_B0 = ids[t][1]
 *                         h_Btau = ids[t][3]
 *                         if ids[t][4] == i:  # Match Voronoi centroids             # <<<<<<<<<<<<<<
 *                             f_i0 = 1.0
 *                         if ids[t][5] == i:
 */
          __pyx_t_4 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 712, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_4, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 712, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 712, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_2 = PyObject_RichCompare(__pyx_t_1, __pyx_t_4, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 712, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_18 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_18 < 0)) __PYX_ERR(0, 712, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          if (__pyx_t_18) {

            /* "vcstring.pyx":713
 *                         h_Btau = ids[t][3]
 *                         if ids[t][4] == i:  # Match Voronoi centroids
 *                             f_i0 = 1.0             # <<<<<<<<<<<<<<
 *                         if ids[t][5] == i:
 *                             f_itau = 1.0
 */
            __pyx_v_f_i0 = 1.0;

            /* "vcstring.pyx":712
 *                         h_B0 = ids[t][1]
 *                         h_Btau = ids[t][3]
 *                         if ids[t][4] == i:  # Match Voronoi centroids             # <<<<<<<<<<<<<<
 *                             f_i0 = 1.0
 *                         if ids[t][5] == i:
 */
          }

          /* "vcstring.pyx":714
 *                         if ids[t][4] == i:  # Match Voronoi centroids
 *                             f_i0 = 1.0
 *                         if ids[t][5] == i:             # <<<<<<<<<<<<<<
 *                             f_itau = 1.0
 *                         if ids[t][4] == j:
 */
          __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 714, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_2, 5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 714, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 714, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_1 = PyObject_RichCompare(__pyx_t_4, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 714, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_18 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_18 < 0)) __PYX_ERR(0, 714, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          if (__pyx_t_18) {

            /* "vcstring.pyx":715
 *                             f_i0 = 1.0
 *                         if ids[t][5] == i:
 *                             f_itau = 1.0             # <<<<<<<<<<<<<<
 *                         if ids[t][4] == j:
 *                             f_j = 1.0
 */
            __pyx_v_f_itau = 1.0;

            /* "vcstring.pyx":714
 *                         if ids[t][4] == i:  # Match Voronoi centroids
 *                             f_i0 = 1.0
 *                         if ids[t][5] == i:             # <<<<<<<<<<<<<<
 *                             f_itau = 1.0
 *                         if ids[t][4] == j:
 */
          }

          /* "vcstring.pyx":716
 *                         if ids[t][5] == i:
 *                             f_itau = 1.0
 *                         if ids[t][4] == j:             # <<<<<<<<<<<<<<
 *                             f_j = 1.0
 * 
 */
          __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 716, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 716, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_j); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 716, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_4 = PyObject_RichCompare(__pyx_t_2, __pyx_t_1, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 716, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_18 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_18 < 0)) __PYX_ERR(0, 716, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          if (__pyx_t_18) {

            /* "vcstring.pyx":717
 *                             f_itau = 1.0
 *                         if ids[t][4] == j:
 *                             f_j = 1.0             # <<<<<<<<<<<<<<
 * 
 *                         # Summation of terms
 */
            __pyx_v_f_j = 1.0;

            /* "vcstring.pyx":716
 *                         if ids[t][5] == i:
 *                             f_itau = 1.0
 *                         if ids[t][4] == j:             # <<<<<<<<<<<<<<
 *                             f_j = 1.0
 * 
 */
          }

          /* "vcstring.pyx":720
 * 
 *                         # Summation of terms
 *                         if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                             weight = ids[t][8]
 *                         else:
 */
          __pyx_t_18 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_kp_u_1d, Py_EQ)); if (unlikely(__pyx_t_18 < 0)) __PYX_ERR(0, 720, __pyx_L1_error)
          __pyx_t_28 = (__pyx_t_18 != 0);
          if (__pyx_t_28) {

            /* "vcstring.pyx":721
 *                         # Summation of terms
 *                         if self.state_assignment == '1d':
 *                             weight = ids[t][8]             # <<<<<<<<<<<<<<
 *                         else:
 *                             weight = ids[t][10]
 */
            __pyx_t_4 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 721, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_4);
            __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_4, 8, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 721, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_1);
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_t_27 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_27 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 721, __pyx_L1_error)
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
            __pyx_v_weight = __pyx_t_27;

            /* "vcstring.pyx":720
 * 
 *                         # Summation of terms
 *                         if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                             weight = ids[t][8]
 *                         else:
 */
            goto __pyx_L17;
          }

          /* "vcstring.pyx":723
 *                             weight = ids[t][8]
 *                         else:
 *                             weight = ids[t][10]             # <<<<<<<<<<<<<<
 *                         val_D_0 += h_I0 * h_I0 * f_i0 * f_j * weight
 *                         val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight
 */
          /*else*/ {
            __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 723, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_1);
            __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 10, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 723, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_4);
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
            __pyx_t_27 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_27 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 723, __pyx_L1_error)
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_v_weight = __pyx_t_27;
          }
          __pyx_L17:;

          /* "vcstring.pyx":724
 *                         else:
 *                             weight = ids[t][10]
 *                         val_D_0 += h_I0 * h_I0 * f_i0 * f_j * weight             # <<<<<<<<<<<<<<
 *                         val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight
 *                         if j == 0:
 */
          __pyx_v_val_D_0 = (__pyx_v_val_D_0 + ((((__pyx_v_h_I0 * __pyx_v_h_I0) * __pyx_v_f_i0) * __pyx_v_f_j) * __pyx_v_weight));

          /* "vcstring.pyx":725
 *                             weight = ids[t][10]
 *                         val_D_0 += h_I0 * h_I0 * f_i0 * f_j * weight
 *                         val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight             # <<<<<<<<<<<<<<
 *                         if j == 0:
 *                             val_g_0 += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) * weight
 */
          __pyx_v_val_D_tau = (__pyx_v_val_D_tau + ((((__pyx_v_h_Itau * __pyx_v_h_I0) * __pyx_v_f_itau) * __pyx_v_f_j) * __pyx_v_weight));

          /* "vcstring.pyx":726
 *                         val_D_0 += h_I0 * h_I0 * f_i0 * f_j * weight
 *                         val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight
 *                         if j == 0:             # <<<<<<<<<<<<<<
 *                             val_g_0 += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) * weight
 *                             val_g_tau += ((h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)) * weight
 */
          __pyx_t_28 = ((__pyx_v_j == 0) != 0);
          if (__pyx_t_28) {

            /* "vcstring.pyx":727
 *                         val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight
 *                         if j == 0:
 *                             val_g_0 += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) * weight             # <<<<<<<<<<<<<<
 *                             val_g_tau += ((h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)) * weight
 *                         count += 1
 */
            __pyx_v_val_g_0 = (__pyx_v_val_g_0 + ((((__pyx_v_h_I0 * __pyx_v_f_i0) * __pyx_v_h_B0) + ((__pyx_v_h_B0 * __pyx_v_h_I0) * __pyx_v_f_i0)) * __pyx_v_weight));

            /* "vcstring.pyx":728
 *                         if j == 0:
 *                             val_g_0 += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) * weight
 *                             val_g_tau += ((h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)) * weight             # <<<<<<<<<<<<<<
 *                         count += 1
 * 
 */
            __pyx_v_val_g_tau = (__pyx_v_val_g_tau + ((((__pyx_v_h_Itau * __pyx_v_f_itau) * __pyx_v_h_B0) + ((__pyx_v_h_Btau * __pyx_v_h_I0) * __pyx_v_f_i0)) * __pyx_v_weight));

            /* "vcstring.pyx":726
 *                         val_D_0 += h_I0 * h_I0 * f_i0 * f_j * weight
 *                         val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight
 *                         if j == 0:             # <<<<<<<<<<<<<<
 *                             val_g_0 += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) * weight
 *                             val_g_tau += ((h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)) * weight
 */
          }

          /* "vcstring.pyx":729
 *                             val_g_0 += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) * weight
 *                             val_g_tau += ((h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)) * weight
 *                         count += 1             # <<<<<<<<<<<<<<
 * 
 *                 # Divide by data size
 */
          __pyx_v_count = (__pyx_v_count + 1);
        }
      }
      __pyx_L8_break:;

      /* "vcstring.pyx":732
 * 
 *                 # Divide by data size
 *                 print('Dividing D by data size\n')             # <<<<<<<<<<<<<<
 *                 D_0.append(val_D_0 / count)
 *                 D_tau.append(val_D_tau / count)
 */
      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__32, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 732, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "vcstring.pyx":733
 *                 # Divide by data size
 *                 print('Dividing D by data size\n')
 *                 D_0.append(val_D_0 / count)             # <<<<<<<<<<<<<<
 *                 D_tau.append(val_D_tau / count)
 *             g_0.append(val_g_0 / count)
 */
      if (unlikely(__pyx_v_count == 0)) {
        PyErr_SetString(PyExc_ZeroDivisionError, "float division");
        __PYX_ERR(0, 733, __pyx_L1_error)
      }
      __pyx_t_4 = PyFloat_FromDouble((__pyx_v_val_D_0 / ((double)__pyx_v_count))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 733, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_29 = __Pyx_PyList_Append(__pyx_v_D_0, __pyx_t_4); if (unlikely(__pyx_t_29 == ((int)-1))) __PYX_ERR(0, 733, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "vcstring.pyx":734
 *                 print('Dividing D by data size\n')
 *                 D_0.append(val_D_0 / count)
 *                 D_tau.append(val_D_tau / count)             # <<<<<<<<<<<<<<
 *             g_0.append(val_g_0 / count)
 *             g_tau.append(val_g_tau / count)
 */
      if (unlikely(__pyx_v_count == 0)) {
        PyErr_SetString(PyExc_ZeroDivisionError, "float division");
        __PYX_ERR(0, 734, __pyx_L1_error)
      }
      __pyx_t_4 = PyFloat_FromDouble((__pyx_v_val_D_tau / ((double)__pyx_v_count))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 734, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_29 = __Pyx_PyList_Append(__pyx_v_D_tau, __pyx_t_4); if (unlikely(__pyx_t_29 == ((int)-1))) __PYX_ERR(0, 734, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }

    /* "vcstring.pyx":735
 *                 D_0.append(val_D_0 / count)
 *                 D_tau.append(val_D_tau / count)
 *             g_0.append(val_g_0 / count)             # <<<<<<<<<<<<<<
 *             g_tau.append(val_g_tau / count)
 * 
 */
    if (unlikely(__pyx_v_count == 0)) {
      PyErr_SetString(PyExc_ZeroDivisionError, "float division");
      __PYX_ERR(0, 735, __pyx_L1_error)
    }
    __pyx_t_4 = PyFloat_FromDouble((__pyx_v_val_g_0 / ((double)__pyx_v_count))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 735, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_29 = __Pyx_PyList_Append(__pyx_v_g_0, __pyx_t_4); if (unlikely(__pyx_t_29 == ((int)-1))) __PYX_ERR(0, 735, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "vcstring.pyx":736
 *                 D_tau.append(val_D_tau / count)
 *             g_0.append(val_g_0 / count)
 *             g_tau.append(val_g_tau / count)             # <<<<<<<<<<<<<<
 * 
 *         # Reshape into appropriate matrix size
 */
    if (unlikely(__pyx_v_count == 0)) {
      PyErr_SetString(PyExc_ZeroDivisionError, "float division");
      __PYX_ERR(0, 736, __pyx_L1_error)
    }
    __pyx_t_4 = PyFloat_FromDouble((__pyx_v_val_g_tau / ((double)__pyx_v_count))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 736, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_29 = __Pyx_PyList_Append(__pyx_v_g_tau, __pyx_t_4); if (unlikely(__pyx_t_29 == ((int)-1))) __PYX_ERR(0, 736, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }

  /* "vcstring.pyx":739
 * 
 *         # Reshape into appropriate matrix size
 *         D_0_arr = np.asarray(D_0).reshape(self.num_basis, self.num_basis)             # <<<<<<<<<<<<<<
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 739, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 739, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_2, __pyx_v_D_0) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_D_0);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 739, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_reshape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 739, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 739, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 739, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
      __pyx_t_6 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_7)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_1, __pyx_t_2};
    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 739, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_1, __pyx_t_2};
    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 739, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else
  #endif
  {
    __pyx_t_5 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 739, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    if (__pyx_t_3) {
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_6, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_6, __pyx_t_2);
    __pyx_t_1 = 0;
    __pyx_t_2 = 0;
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 739, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 739, __pyx_L1_error)
  __pyx_t_21 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
    __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_21, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 < 0)) {
      PyErr_Fetch(&__pyx_t_25, &__pyx_t_24, &__pyx_t_23);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_23);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_25, __pyx_t_24, __pyx_t_23);
      }
      __pyx_t_25 = __pyx_t_24 = __pyx_t_23 = 0;
    }
    __pyx_pybuffernd_D_0_arr.diminfo[0].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0_arr.diminfo[0].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0_arr.diminfo[1].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0_arr.diminfo[1].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 739, __pyx_L1_error)
  }
  __pyx_t_21 = 0;
  __pyx_v_D_0_arr = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "vcstring.pyx":740
 *         # Reshape into appropriate matrix size
 *         D_0_arr = np.asarray(D_0).reshape(self.num_basis, self.num_basis)
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)             # <<<<<<<<<<<<<<
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 740, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_asarray); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 740, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_7 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_v_D_tau) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_D_tau);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 740, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_reshape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 740, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 740, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 740, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_1 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_t_7, __pyx_t_5};
    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 740, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_t_7, __pyx_t_5};
    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 740, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  {
    __pyx_t_3 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 740, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (__pyx_t_1) {
      __Pyx_GIVEREF(__pyx_t_1); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1); __pyx_t_1 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_7);
    PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_6, __pyx_t_7);
    __Pyx_GIVEREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_6, __pyx_t_5);
    __pyx_t_7 = 0;
    __pyx_t_5 = 0;
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 740, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 740, __pyx_L1_error)
  __pyx_t_21 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
    __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_21, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 < 0)) {
      PyErr_Fetch(&__pyx_t_23, &__pyx_t_24, &__pyx_t_25);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_23); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_23, __pyx_t_24, __pyx_t_25);
      }
      __pyx_t_23 = __pyx_t_24 = __pyx_t_25 = 0;
    }
    __pyx_pybuffernd_D_tau_arr.diminfo[0].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau_arr.diminfo[0].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau_arr.diminfo[1].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau_arr.diminfo[1].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 740, __pyx_L1_error)
  }
  __pyx_t_21 = 0;
  __pyx_v_D_tau_arr = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "vcstring.pyx":741
 *         D_0_arr = np.asarray(D_0).reshape(self.num_basis, self.num_basis)
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)             # <<<<<<<<<<<<<<
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 *         print('D_0 =', D_0_arr)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 741, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 741, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_g_0) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_g_0);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 741, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 741, __pyx_L1_error)
  __pyx_t_30 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer);
    __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_30, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 < 0)) {
      PyErr_Fetch(&__pyx_t_25, &__pyx_t_24, &__pyx_t_23);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_0_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_23);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_25, __pyx_t_24, __pyx_t_23);
      }
      __pyx_t_25 = __pyx_t_24 = __pyx_t_23 = 0;
    }
    __pyx_pybuffernd_g_0_arr.diminfo[0].strides = __pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_0_arr.diminfo[0].shape = __pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 741, __pyx_L1_error)
  }
  __pyx_t_30 = 0;
  __pyx_v_g_0_arr = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "vcstring.pyx":742
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)             # <<<<<<<<<<<<<<
 *         print('D_0 =', D_0_arr)
 *         print('D_tau =', D_tau_arr)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 742, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_asarray); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 742, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_4 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_g_tau) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_g_tau);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 742, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 742, __pyx_L1_error)
  __pyx_t_30 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer);
    __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_30, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 < 0)) {
      PyErr_Fetch(&__pyx_t_23, &__pyx_t_24, &__pyx_t_25);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_tau_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_23); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_23, __pyx_t_24, __pyx_t_25);
      }
      __pyx_t_23 = __pyx_t_24 = __pyx_t_25 = 0;
    }
    __pyx_pybuffernd_g_tau_arr.diminfo[0].strides = __pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_tau_arr.diminfo[0].shape = __pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 742, __pyx_L1_error)
  }
  __pyx_t_30 = 0;
  __pyx_v_g_tau_arr = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "vcstring.pyx":743
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 *         print('D_0 =', D_0_arr)             # <<<<<<<<<<<<<<
 *         print('D_tau =', D_tau_arr)
 *         print('g_0 =', g_0_arr)
 */
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 743, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_kp_u_D_0);
  __Pyx_GIVEREF(__pyx_kp_u_D_0);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_D_0);
  __Pyx_INCREF(((PyObject *)__pyx_v_D_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_0_arr));
  PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_D_0_arr));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 743, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":744
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 *         print('D_0 =', D_0_arr)
 *         print('D_tau =', D_tau_arr)             # <<<<<<<<<<<<<<
 *         print('g_0 =', g_0_arr)
 *         print('g_tau =', g_tau_arr)
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 744, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_D_tau);
  __Pyx_GIVEREF(__pyx_kp_u_D_tau);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_D_tau);
  __Pyx_INCREF(((PyObject *)__pyx_v_D_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_D_tau_arr));
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 744, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "vcstring.pyx":745
 *         print('D_0 =', D_0_arr)
 *         print('D_tau =', D_tau_arr)
 *         print('g_0 =', g_0_arr)             # <<<<<<<<<<<<<<
 *         print('g_tau =', g_tau_arr)
 * 
 */
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 745, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_kp_u_g_0);
  __Pyx_GIVEREF(__pyx_kp_u_g_0);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_g_0);
  __Pyx_INCREF(((PyObject *)__pyx_v_g_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_0_arr));
  PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_g_0_arr));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 745, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":746
 *         print('D_tau =', D_tau_arr)
 *         print('g_0 =', g_0_arr)
 *         print('g_tau =', g_tau_arr)             # <<<<<<<<<<<<<<
 * 
 *         # Symmetrize for reversible dynamics
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 746, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_g_tau);
  __Pyx_GIVEREF(__pyx_kp_u_g_tau);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_g_tau);
  __Pyx_INCREF(((PyObject *)__pyx_v_g_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_g_tau_arr));
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 746, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "vcstring.pyx":749
 * 
 *         # Symmetrize for reversible dynamics
 *         if symmetric == True:             # <<<<<<<<<<<<<<
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 */
  __pyx_t_4 = PyObject_RichCompare(__pyx_v_symmetric, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 749, __pyx_L1_error)
  __pyx_t_28 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_28 < 0)) __PYX_ERR(0, 749, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_28) {

    /* "vcstring.pyx":750
 *         # Symmetrize for reversible dynamics
 *         if symmetric == True:
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)             # <<<<<<<<<<<<<<
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 *             print('Symmetric D_0 =', D_0_arr)
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_D_0_arr), __pyx_n_s_T); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 750, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = PyNumber_Add(((PyObject *)__pyx_v_D_0_arr), __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 750, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyNumber_Multiply(__pyx_float_0_5, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 750, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 750, __pyx_L1_error)
    __pyx_t_21 = ((PyArrayObject *)__pyx_t_4);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
      __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_21, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
      if (unlikely(__pyx_t_6 < 0)) {
        PyErr_Fetch(&__pyx_t_25, &__pyx_t_24, &__pyx_t_23);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_23);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_25, __pyx_t_24, __pyx_t_23);
        }
        __pyx_t_25 = __pyx_t_24 = __pyx_t_23 = 0;
      }
      __pyx_pybuffernd_D_0_arr.diminfo[0].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0_arr.diminfo[0].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0_arr.diminfo[1].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0_arr.diminfo[1].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[1];
      if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 750, __pyx_L1_error)
    }
    __pyx_t_21 = 0;
    __Pyx_DECREF_SET(__pyx_v_D_0_arr, ((PyArrayObject *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "vcstring.pyx":751
 *         if symmetric == True:
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)             # <<<<<<<<<<<<<<
 *             print('Symmetric D_0 =', D_0_arr)
 *             print('Symmetric D_tau =', D_tau_arr)
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_D_tau_arr), __pyx_n_s_T); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 751, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = PyNumber_Add(((PyObject *)__pyx_v_D_tau_arr), __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 751, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyNumber_Multiply(__pyx_float_0_5, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 751, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 751, __pyx_L1_error)
    __pyx_t_21 = ((PyArrayObject *)__pyx_t_4);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
      __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_21, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
      if (unlikely(__pyx_t_6 < 0)) {
        PyErr_Fetch(&__pyx_t_23, &__pyx_t_24, &__pyx_t_25);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_23); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_23, __pyx_t_24, __pyx_t_25);
        }
        __pyx_t_23 = __pyx_t_24 = __pyx_t_25 = 0;
      }
      __pyx_pybuffernd_D_tau_arr.diminfo[0].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau_arr.diminfo[0].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau_arr.diminfo[1].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau_arr.diminfo[1].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[1];
      if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 751, __pyx_L1_error)
    }
    __pyx_t_21 = 0;
    __Pyx_DECREF_SET(__pyx_v_D_tau_arr, ((PyArrayObject *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "vcstring.pyx":752
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 *             print('Symmetric D_0 =', D_0_arr)             # <<<<<<<<<<<<<<
 *             print('Symmetric D_tau =', D_tau_arr)
 * 
 */
    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 752, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_INCREF(__pyx_kp_u_Symmetric_D_0);
    __Pyx_GIVEREF(__pyx_kp_u_Symmetric_D_0);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_Symmetric_D_0);
    __Pyx_INCREF(((PyObject *)__pyx_v_D_0_arr));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_D_0_arr));
    PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_D_0_arr));
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 752, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "vcstring.pyx":753
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 *             print('Symmetric D_0 =', D_0_arr)
 *             print('Symmetric D_tau =', D_tau_arr)             # <<<<<<<<<<<<<<
 * 
 *         # Calculate committor coefficients, b
 */
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 753, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_kp_u_Symmetric_D_tau);
    __Pyx_GIVEREF(__pyx_kp_u_Symmetric_D_tau);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_Symmetric_D_tau);
    __Pyx_INCREF(((PyObject *)__pyx_v_D_tau_arr));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_D_tau_arr));
    PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_D_tau_arr));
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 753, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "vcstring.pyx":749
 * 
 *         # Symmetrize for reversible dynamics
 *         if symmetric == True:             # <<<<<<<<<<<<<<
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 */
  }

  /* "vcstring.pyx":756
 * 
 *         # Calculate committor coefficients, b
 *         D = D_0_arr - D_tau_arr             # <<<<<<<<<<<<<<
 *         g = g_tau_arr - g_0_arr
 *         b = 0.5 * np.linalg.inv(D).dot(g)
 */
  __pyx_t_4 = PyNumber_Subtract(((PyObject *)__pyx_v_D_0_arr), ((PyObject *)__pyx_v_D_tau_arr)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 756, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 756, __pyx_L1_error)
  __pyx_t_21 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D.rcbuffer->pybuffer);
    __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D.rcbuffer->pybuffer, (PyObject*)__pyx_t_21, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 < 0)) {
      PyErr_Fetch(&__pyx_t_25, &__pyx_t_24, &__pyx_t_23);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D.rcbuffer->pybuffer, (PyObject*)__pyx_v_D, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_23);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_25, __pyx_t_24, __pyx_t_23);
      }
      __pyx_t_25 = __pyx_t_24 = __pyx_t_23 = 0;
    }
    __pyx_pybuffernd_D.diminfo[0].strides = __pyx_pybuffernd_D.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D.diminfo[0].shape = __pyx_pybuffernd_D.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D.diminfo[1].strides = __pyx_pybuffernd_D.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D.diminfo[1].shape = __pyx_pybuffernd_D.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 756, __pyx_L1_error)
  }
  __pyx_t_21 = 0;
  __pyx_v_D = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "vcstring.pyx":757
 *         # Calculate committor coefficients, b
 *         D = D_0_arr - D_tau_arr
 *         g = g_tau_arr - g_0_arr             # <<<<<<<<<<<<<<
 *         b = 0.5 * np.linalg.inv(D).dot(g)
 *         print('b =', b)
 */
  __pyx_t_4 = PyNumber_Subtract(((PyObject *)__pyx_v_g_tau_arr), ((PyObject *)__pyx_v_g_0_arr)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 757, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 757, __pyx_L1_error)
  __pyx_t_30 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g.rcbuffer->pybuffer);
    __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g.rcbuffer->pybuffer, (PyObject*)__pyx_t_30, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 < 0)) {
      PyErr_Fetch(&__pyx_t_23, &__pyx_t_24, &__pyx_t_25);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g.rcbuffer->pybuffer, (PyObject*)__pyx_v_g, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_23); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_25);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_23, __pyx_t_24, __pyx_t_25);
      }
      __pyx_t_23 = __pyx_t_24 = __pyx_t_25 = 0;
    }
    __pyx_pybuffernd_g.diminfo[0].strides = __pyx_pybuffernd_g.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g.diminfo[0].shape = __pyx_pybuffernd_g.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 757, __pyx_L1_error)
  }
  __pyx_t_30 = 0;
  __pyx_v_g = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "vcstring.pyx":758
 *         D = D_0_arr - D_tau_arr
 *         g = g_tau_arr - g_0_arr
 *         b = 0.5 * np.linalg.inv(D).dot(g)             # <<<<<<<<<<<<<<
 *         print('b =', b)
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 758, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_linalg); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 758, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_inv); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 758, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, ((PyObject *)__pyx_v_D)) : __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_D));
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 758, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_dot); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 758, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, ((PyObject *)__pyx_v_g)) : __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_g));
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 758, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_Multiply(__pyx_float_0_5, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 758, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 758, __pyx_L1_error)
  __pyx_t_30 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_t_30, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 < 0)) {
      PyErr_Fetch(&__pyx_t_25, &__pyx_t_24, &__pyx_t_23);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_24); Py_XDECREF(__pyx_t_23);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_25, __pyx_t_24, __pyx_t_23);
      }
      __pyx_t_25 = __pyx_t_24 = __pyx_t_23 = 0;
    }
    __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 758, __pyx_L1_error)
  }
  __pyx_t_30 = 0;
  __pyx_v_b = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "vcstring.pyx":759
 *         g = g_tau_arr - g_0_arr
 *         b = 0.5 * np.linalg.inv(D).dot(g)
 *         print('b =', b)             # <<<<<<<<<<<<<<
 * 
 *         return b, D_0_arr, D_tau_arr, g_0_arr, g_tau_arr
 */
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 759, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_kp_u_b);
  __Pyx_GIVEREF(__pyx_kp_u_b);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_u_b);
  __Pyx_INCREF(((PyObject *)__pyx_v_b));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
  PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)__pyx_v_b));
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 759, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "vcstring.pyx":761
 *         print('b =', b)
 * 
 *         return b, D_0_arr, D_tau_arr, g_0_arr, g_tau_arr             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = PyTuple_New(5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 761, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(((PyObject *)__pyx_v_b));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
  PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_v_b));
  __Pyx_INCREF(((PyObject *)__pyx_v_D_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_0_arr));
  PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_D_0_arr));
  __Pyx_INCREF(((PyObject *)__pyx_v_D_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_4, 2, ((PyObject *)__pyx_v_D_tau_arr));
  __Pyx_INCREF(((PyObject *)__pyx_v_g_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_0_arr));
  PyTuple_SET_ITEM(__pyx_t_4, 3, ((PyObject *)__pyx_v_g_0_arr));
  __Pyx_INCREF(((PyObject *)__pyx_v_g_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_4, 4, ((PyObject *)__pyx_v_g_tau_arr));
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  /* "vcstring.pyx":650
 * 
 * 
 *     cpdef calc_coeffs_ensemble_timeavg(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, list weights=None, t_final=None, symmetric=True):             # <<<<<<<<<<<<<<
 *         """
 *         Solve the linear equation from minimizing the forward steady-state flux.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_coeffs_ensemble_timeavg", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XDECREF(__pyx_v_D_0);
  __Pyx_XDECREF(__pyx_v_D_tau);
  __Pyx_XDECREF(__pyx_v_g_0);
  __Pyx_XDECREF(__pyx_v_g_tau);
  __Pyx_XDECREF((PyObject *)__pyx_v_ids);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_0_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_tau_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_D);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_0_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_tau_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_g);
  __Pyx_XDECREF((PyObject *)__pyx_v_b);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_17calc_coeffs_ensemble_timeavg(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8vcstring_8vcstring_16calc_coeffs_ensemble_timeavg[] = "\n        Solve the linear equation from minimizing the forward steady-state flux.\n        Calculates D matrices, g vectors, and b coefficients.\n\n        Parameters\n        ----------\n        traj :  trajectory with shape (T, d), where T is number of time steps and d is dimensions.\n        tau  :  lag time (units step)\n\n        Returns:\n        --------\n        - Symmetric square Matrices D_0_sym and D_tau_sym\n        - Vectors g_0 and g_tau\n        - A vector of the coefficients b for the trial committor expressed as a basis set expansion\n        ";
static PyObject *__pyx_pw_8vcstring_8vcstring_17calc_coeffs_ensemble_timeavg(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_traj = 0;
  int __pyx_v_tau;
  PyArrayObject *__pyx_v_z = 0;
  PyObject *__pyx_v_weights = 0;
  PyObject *__pyx_v_t_final = 0;
  PyObject *__pyx_v_symmetric = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("calc_coeffs_ensemble_timeavg (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_traj,&__pyx_n_s_tau,&__pyx_n_s_z,&__pyx_n_s_weights,&__pyx_n_s_t_final,&__pyx_n_s_symmetric,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    values[3] = ((PyObject*)Py_None);
    values[4] = ((PyObject *)Py_None);
    values[5] = ((PyObject *)Py_True);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_traj)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tau)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_coeffs_ensemble_timeavg", 0, 3, 6, 1); __PYX_ERR(0, 650, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_coeffs_ensemble_timeavg", 0, 3, 6, 2); __PYX_ERR(0, 650, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weights);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_t_final);
          if (value) { values[4] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_symmetric);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "calc_coeffs_ensemble_timeavg") < 0)) __PYX_ERR(0, 650, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_traj = ((PyObject*)values[0]);
    __pyx_v_tau = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_tau == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 650, __pyx_L3_error)
    __pyx_v_z = ((PyArrayObject *)values[2]);
    __pyx_v_weights = ((PyObject*)values[3]);
    __pyx_v_t_final = values[4];
    __pyx_v_symmetric = values[5];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("calc_coeffs_ensemble_timeavg", 0, 3, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 650, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.vcstring.calc_coeffs_ensemble_timeavg", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_traj), (&PyList_Type), 1, "traj", 1))) __PYX_ERR(0, 650, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_z), __pyx_ptype_5numpy_ndarray, 1, "z", 0))) __PYX_ERR(0, 650, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_weights), (&PyList_Type), 1, "weights", 1))) __PYX_ERR(0, 650, __pyx_L1_error)
  __pyx_r = __pyx_pf_8vcstring_8vcstring_16calc_coeffs_ensemble_timeavg(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self), __pyx_v_traj, __pyx_v_tau, __pyx_v_z, __pyx_v_weights, __pyx_v_t_final, __pyx_v_symmetric);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_16calc_coeffs_ensemble_timeavg(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyObject *__pyx_v_weights, PyObject *__pyx_v_t_final, PyObject *__pyx_v_symmetric) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg __pyx_t_2;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_coeffs_ensemble_timeavg", 0);
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 650, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2.__pyx_n = 3;
  __pyx_t_2.weights = __pyx_v_weights;
  __pyx_t_2.t_final = __pyx_v_t_final;
  __pyx_t_2.symmetric = __pyx_v_symmetric;
  __pyx_t_1 = __pyx_vtabptr_8vcstring_vcstring->calc_coeffs_ensemble_timeavg(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, __pyx_v_z, 1, &__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 650, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_coeffs_ensemble_timeavg", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":764
 * 
 * 
 *     cpdef calc_coeffs_ensemble_timeavg_fast(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, list weights=None, symmetric=True):             # <<<<<<<<<<<<<<
 *         """
 *         Solve the linear equation from minimizing the forward steady-state flux.
 */

static PyObject *__pyx_pw_8vcstring_8vcstring_19calc_coeffs_ensemble_timeavg_fast(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast *__pyx_optional_args) {
  PyObject *__pyx_v_weights = ((PyObject*)Py_None);
  PyObject *__pyx_v_symmetric = ((PyObject *)Py_True);
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_count;
  int __pyx_v_t;
  PyObject *__pyx_v_D_0 = 0;
  PyObject *__pyx_v_D_tau = 0;
  PyObject *__pyx_v_g_0 = 0;
  PyObject *__pyx_v_g_tau = 0;
  double __pyx_v_val_g_0;
  double __pyx_v_val_g_tau;
  double __pyx_v_val_D_0;
  double __pyx_v_val_D_tau;
  double __pyx_v_f_i0;
  double __pyx_v_f_itau;
  double __pyx_v_f_j;
  double __pyx_v_h_I0;
  double __pyx_v_h_B0;
  double __pyx_v_h_Itau;
  double __pyx_v_h_Btau;
  double __pyx_v_weight;
  PyArrayObject *__pyx_v_ids = 0;
  PyArrayObject *__pyx_v_D_0_arr = 0;
  PyArrayObject *__pyx_v_D_tau_arr = 0;
  PyArrayObject *__pyx_v_D = 0;
  PyArrayObject *__pyx_v_g_0_arr = 0;
  PyArrayObject *__pyx_v_g_tau_arr = 0;
  PyArrayObject *__pyx_v_g = 0;
  PyArrayObject *__pyx_v_b = 0;
  Py_ssize_t __pyx_v_N;
  Py_ssize_t __pyx_v_k;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D;
  __Pyx_Buffer __pyx_pybuffer_D;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_0_arr;
  __Pyx_Buffer __pyx_pybuffer_D_0_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_tau_arr;
  __Pyx_Buffer __pyx_pybuffer_D_tau_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g;
  __Pyx_Buffer __pyx_pybuffer_g;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_0_arr;
  __Pyx_Buffer __pyx_pybuffer_g_0_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_tau_arr;
  __Pyx_Buffer __pyx_pybuffer_g_tau_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ids;
  __Pyx_Buffer __pyx_pybuffer_ids;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  int __pyx_t_9;
  int __pyx_t_10;
  int __pyx_t_11;
  double __pyx_t_12;
  double __pyx_t_13;
  int __pyx_t_14;
  int __pyx_t_15;
  int __pyx_t_16;
  Py_ssize_t __pyx_t_17;
  Py_ssize_t __pyx_t_18;
  PyArrayObject *__pyx_t_19 = NULL;
  int __pyx_t_20;
  PyObject *__pyx_t_21 = NULL;
  PyObject *__pyx_t_22 = NULL;
  PyObject *__pyx_t_23 = NULL;
  Py_ssize_t __pyx_t_24;
  Py_ssize_t __pyx_t_25;
  double __pyx_t_26;
  int __pyx_t_27;
  Py_UCS4 __pyx_t_28;
  int __pyx_t_29;
  PyArrayObject *__pyx_t_30 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_coeffs_ensemble_timeavg_fast", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args->__pyx_n > 0) {
      __pyx_v_weights = __pyx_optional_args->weights;
      if (__pyx_optional_args->__pyx_n > 1) {
        __pyx_v_symmetric = __pyx_optional_args->symmetric;
      }
    }
  }
  __Pyx_INCREF(__pyx_v_weights);
  __pyx_pybuffer_ids.pybuffer.buf = NULL;
  __pyx_pybuffer_ids.refcount = 0;
  __pyx_pybuffernd_ids.data = NULL;
  __pyx_pybuffernd_ids.rcbuffer = &__pyx_pybuffer_ids;
  __pyx_pybuffer_D_0_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_D_0_arr.refcount = 0;
  __pyx_pybuffernd_D_0_arr.data = NULL;
  __pyx_pybuffernd_D_0_arr.rcbuffer = &__pyx_pybuffer_D_0_arr;
  __pyx_pybuffer_D_tau_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_D_tau_arr.refcount = 0;
  __pyx_pybuffernd_D_tau_arr.data = NULL;
  __pyx_pybuffernd_D_tau_arr.rcbuffer = &__pyx_pybuffer_D_tau_arr;
  __pyx_pybuffer_D.pybuffer.buf = NULL;
  __pyx_pybuffer_D.refcount = 0;
  __pyx_pybuffernd_D.data = NULL;
  __pyx_pybuffernd_D.rcbuffer = &__pyx_pybuffer_D;
  __pyx_pybuffer_g_0_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_g_0_arr.refcount = 0;
  __pyx_pybuffernd_g_0_arr.data = NULL;
  __pyx_pybuffernd_g_0_arr.rcbuffer = &__pyx_pybuffer_g_0_arr;
  __pyx_pybuffer_g_tau_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_g_tau_arr.refcount = 0;
  __pyx_pybuffernd_g_tau_arr.data = NULL;
  __pyx_pybuffernd_g_tau_arr.rcbuffer = &__pyx_pybuffer_g_tau_arr;
  __pyx_pybuffer_g.pybuffer.buf = NULL;
  __pyx_pybuffer_g.refcount = 0;
  __pyx_pybuffernd_g.data = NULL;
  __pyx_pybuffernd_g.rcbuffer = &__pyx_pybuffer_g;
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 764, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_calc_coeffs_ensemble_timeavg_fas); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 764, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_8vcstring_8vcstring_19calc_coeffs_ensemble_timeavg_fast)) {
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 764, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
        __pyx_t_6 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
          __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
          if (likely(__pyx_t_5)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
            __Pyx_INCREF(__pyx_t_5);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_4, function);
            __pyx_t_6 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[6] = {__pyx_t_5, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_z), __pyx_v_weights, __pyx_v_symmetric};
          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 5+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 764, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[6] = {__pyx_t_5, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_z), __pyx_v_weights, __pyx_v_symmetric};
          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 5+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 764, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        } else
        #endif
        {
          __pyx_t_7 = PyTuple_New(5+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 764, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          if (__pyx_t_5) {
            __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
          }
          __Pyx_INCREF(__pyx_v_traj);
          __Pyx_GIVEREF(__pyx_v_traj);
          PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_traj);
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_t_3);
          __Pyx_INCREF(((PyObject *)__pyx_v_z));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
          PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_6, ((PyObject *)__pyx_v_z));
          __Pyx_INCREF(__pyx_v_weights);
          __Pyx_GIVEREF(__pyx_v_weights);
          PyTuple_SET_ITEM(__pyx_t_7, 3+__pyx_t_6, __pyx_v_weights);
          __Pyx_INCREF(__pyx_v_symmetric);
          __Pyx_GIVEREF(__pyx_v_symmetric);
          PyTuple_SET_ITEM(__pyx_t_7, 4+__pyx_t_6, __pyx_v_symmetric);
          __pyx_t_3 = 0;
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 764, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        }
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }

  /* "vcstring.pyx":789
 *         cdef np.ndarray[DTYPE_t, ndim=1] g_0_arr, g_tau_arr, g, b
 * 
 *         print('\n======================================')             # <<<<<<<<<<<<<<
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')
 *         print('======================================')
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__21, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 789, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":790
 * 
 *         print('\n======================================')
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')             # <<<<<<<<<<<<<<
 *         print('======================================')
 *         print('lag time =', tau)
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__22, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 790, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":791
 *         print('\n======================================')
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')
 *         print('======================================')             # <<<<<<<<<<<<<<
 *         print('lag time =', tau)
 *         # print('Number of trajs:', N)
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__24, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 791, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":792
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')
 *         print('======================================')
 *         print('lag time =', tau)             # <<<<<<<<<<<<<<
 *         # print('Number of trajs:', N)
 *         print('Symmetrization of D matrices:', symmetric)
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 792, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 792, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_lag_time);
  __Pyx_GIVEREF(__pyx_kp_u_lag_time);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_lag_time);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 792, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":794
 *         print('lag time =', tau)
 *         # print('Number of trajs:', N)
 *         print('Symmetrization of D matrices:', symmetric)             # <<<<<<<<<<<<<<
 * 
 *         N = len(traj)
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_Symmetrization_of_D_matrices);
  __Pyx_GIVEREF(__pyx_kp_u_Symmetrization_of_D_matrices);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Symmetrization_of_D_matrices);
  __Pyx_INCREF(__pyx_v_symmetric);
  __Pyx_GIVEREF(__pyx_v_symmetric);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_symmetric);
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":796
 *         print('Symmetrization of D matrices:', symmetric)
 * 
 *         N = len(traj)             # <<<<<<<<<<<<<<
 *         if weights == None:
 *             print('Using uniform weights')
 */
  if (unlikely(__pyx_v_traj == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
    __PYX_ERR(0, 796, __pyx_L1_error)
  }
  __pyx_t_8 = PyList_GET_SIZE(__pyx_v_traj); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 796, __pyx_L1_error)
  __pyx_v_N = __pyx_t_8;

  /* "vcstring.pyx":797
 * 
 *         N = len(traj)
 *         if weights == None:             # <<<<<<<<<<<<<<
 *             print('Using uniform weights')
 *             weights = [1.] * N
 */
  __pyx_t_2 = PyObject_RichCompare(__pyx_v_weights, Py_None, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 797, __pyx_L1_error)
  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 797, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_9) {

    /* "vcstring.pyx":798
 *         N = len(traj)
 *         if weights == None:
 *             print('Using uniform weights')             # <<<<<<<<<<<<<<
 *             weights = [1.] * N
 * 
 */
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__33, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 798, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "vcstring.pyx":799
 *         if weights == None:
 *             print('Using uniform weights')
 *             weights = [1.] * N             # <<<<<<<<<<<<<<
 * 
 *         D_0 = []
 */
    __pyx_t_2 = PyList_New(1 * ((__pyx_v_N<0) ? 0:__pyx_v_N)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 799, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    { Py_ssize_t __pyx_temp;
      for (__pyx_temp=0; __pyx_temp < __pyx_v_N; __pyx_temp++) {
        __Pyx_INCREF(__pyx_float_1_);
        __Pyx_GIVEREF(__pyx_float_1_);
        PyList_SET_ITEM(__pyx_t_2, __pyx_temp, __pyx_float_1_);
      }
    }
    __Pyx_DECREF_SET(__pyx_v_weights, ((PyObject*)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "vcstring.pyx":797
 * 
 *         N = len(traj)
 *         if weights == None:             # <<<<<<<<<<<<<<
 *             print('Using uniform weights')
 *             weights = [1.] * N
 */
  }

  /* "vcstring.pyx":801
 *             weights = [1.] * N
 * 
 *         D_0 = []             # <<<<<<<<<<<<<<
 *         D_tau = []
 *         g_0 = []
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 801, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_D_0 = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":802
 * 
 *         D_0 = []
 *         D_tau = []             # <<<<<<<<<<<<<<
 *         g_0 = []
 *         g_tau = []
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 802, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_D_tau = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":803
 *         D_0 = []
 *         D_tau = []
 *         g_0 = []             # <<<<<<<<<<<<<<
 *         g_tau = []
 *         for i in range(self.num_basis):
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 803, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_g_0 = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":804
 *         D_tau = []
 *         g_0 = []
 *         g_tau = []             # <<<<<<<<<<<<<<
 *         for i in range(self.num_basis):
 *             val_g_0, val_g_tau = 0.0, 0.0
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 804, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_g_tau = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":805
 *         g_0 = []
 *         g_tau = []
 *         for i in range(self.num_basis):             # <<<<<<<<<<<<<<
 *             val_g_0, val_g_tau = 0.0, 0.0
 *             for j in range(self.num_basis):
 */
  __pyx_t_6 = __pyx_v_self->num_basis;
  __pyx_t_10 = __pyx_t_6;
  for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
    __pyx_v_i = __pyx_t_11;

    /* "vcstring.pyx":806
 *         g_tau = []
 *         for i in range(self.num_basis):
 *             val_g_0, val_g_tau = 0.0, 0.0             # <<<<<<<<<<<<<<
 *             for j in range(self.num_basis):
 *                 print("\nMatrix elements", i, j)
 */
    __pyx_t_12 = 0.0;
    __pyx_t_13 = 0.0;
    __pyx_v_val_g_0 = __pyx_t_12;
    __pyx_v_val_g_tau = __pyx_t_13;

    /* "vcstring.pyx":807
 *         for i in range(self.num_basis):
 *             val_g_0, val_g_tau = 0.0, 0.0
 *             for j in range(self.num_basis):             # <<<<<<<<<<<<<<
 *                 print("\nMatrix elements", i, j)
 *                 sys.stdout.flush()
 */
    __pyx_t_14 = __pyx_v_self->num_basis;
    __pyx_t_15 = __pyx_t_14;
    for (__pyx_t_16 = 0; __pyx_t_16 < __pyx_t_15; __pyx_t_16+=1) {
      __pyx_v_j = __pyx_t_16;

      /* "vcstring.pyx":808
 *             val_g_0, val_g_tau = 0.0, 0.0
 *             for j in range(self.num_basis):
 *                 print("\nMatrix elements", i, j)             # <<<<<<<<<<<<<<
 *                 sys.stdout.flush()
 *                 val_D_0, val_D_tau = 0.0, 0.0
 */
      __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 808, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_j); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 808, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 808, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_INCREF(__pyx_kp_u_Matrix_elements_2);
      __Pyx_GIVEREF(__pyx_kp_u_Matrix_elements_2);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_Matrix_elements_2);
      __Pyx_GIVEREF(__pyx_t_2);
      PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_t_1);
      __pyx_t_2 = 0;
      __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 808, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":809
 *             for j in range(self.num_basis):
 *                 print("\nMatrix elements", i, j)
 *                 sys.stdout.flush()             # <<<<<<<<<<<<<<
 *                 val_D_0, val_D_tau = 0.0, 0.0
 *                 count = 0
 */
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sys); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 809, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_stdout); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 809, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_flush); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 809, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_2)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_2);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
        }
      }
      __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 809, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":810
 *                 print("\nMatrix elements", i, j)
 *                 sys.stdout.flush()
 *                 val_D_0, val_D_tau = 0.0, 0.0             # <<<<<<<<<<<<<<
 *                 count = 0
 * 
 */
      __pyx_t_13 = 0.0;
      __pyx_t_12 = 0.0;
      __pyx_v_val_D_0 = __pyx_t_13;
      __pyx_v_val_D_tau = __pyx_t_12;

      /* "vcstring.pyx":811
 *                 sys.stdout.flush()
 *                 val_D_0, val_D_tau = 0.0, 0.0
 *                 count = 0             # <<<<<<<<<<<<<<
 * 
 *                 for k in range(N):  # Iterate over number of aggregate trajectories
 */
      __pyx_v_count = 0;

      /* "vcstring.pyx":813
 *                 count = 0
 * 
 *                 for k in range(N):  # Iterate over number of aggregate trajectories             # <<<<<<<<<<<<<<
 *                     # print('Traj', k)
 *                     ids = self.assign_states(traj[k], tau, z)
 */
      __pyx_t_8 = __pyx_v_N;
      __pyx_t_17 = __pyx_t_8;
      for (__pyx_t_18 = 0; __pyx_t_18 < __pyx_t_17; __pyx_t_18+=1) {
        __pyx_v_k = __pyx_t_18;

        /* "vcstring.pyx":815
 *                 for k in range(N):  # Iterate over number of aggregate trajectories
 *                     # print('Traj', k)
 *                     ids = self.assign_states(traj[k], tau, z)             # <<<<<<<<<<<<<<
 *                     weight = weights[k]
 *                     for t in range(len(traj[k])-tau):  # Iterate over trajectory steps
 */
        if (unlikely(__pyx_v_traj == Py_None)) {
          PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
          __PYX_ERR(0, 815, __pyx_L1_error)
        }
        __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_v_traj, __pyx_v_k, Py_ssize_t, 1, PyInt_FromSsize_t, 1, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 815, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 815, __pyx_L1_error)
        __pyx_t_4 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->assign_states(__pyx_v_self, ((PyObject*)__pyx_t_1), __pyx_v_tau, ((PyArrayObject *)__pyx_v_z), 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 815, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 815, __pyx_L1_error)
        __pyx_t_19 = ((PyArrayObject *)__pyx_t_4);
        {
          __Pyx_BufFmt_StackElem __pyx_stack[1];
          __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
          __pyx_t_20 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_t_19, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
          if (unlikely(__pyx_t_20 < 0)) {
            PyErr_Fetch(&__pyx_t_21, &__pyx_t_22, &__pyx_t_23);
            if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
              Py_XDECREF(__pyx_t_21); Py_XDECREF(__pyx_t_22); Py_XDECREF(__pyx_t_23);
              __Pyx_RaiseBufferFallbackError();
            } else {
              PyErr_Restore(__pyx_t_21, __pyx_t_22, __pyx_t_23);
            }
            __pyx_t_21 = __pyx_t_22 = __pyx_t_23 = 0;
          }
          __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
          if (unlikely(__pyx_t_20 < 0)) __PYX_ERR(0, 815, __pyx_L1_error)
        }
        __pyx_t_19 = 0;
        __Pyx_XDECREF_SET(__pyx_v_ids, ((PyArrayObject *)__pyx_t_4));
        __pyx_t_4 = 0;

        /* "vcstring.pyx":816
 *                     # print('Traj', k)
 *                     ids = self.assign_states(traj[k], tau, z)
 *                     weight = weights[k]             # <<<<<<<<<<<<<<
 *                     for t in range(len(traj[k])-tau):  # Iterate over trajectory steps
 *                         f_i0, f_itau, f_j = 0.0, 0.0, 0.0
 */
        if (unlikely(__pyx_v_weights == Py_None)) {
          PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
          __PYX_ERR(0, 816, __pyx_L1_error)
        }
        __pyx_t_4 = __Pyx_GetItemInt_List(__pyx_v_weights, __pyx_v_k, Py_ssize_t, 1, PyInt_FromSsize_t, 1, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 816, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 816, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_v_weight = __pyx_t_12;

        /* "vcstring.pyx":817
 *                     ids = self.assign_states(traj[k], tau, z)
 *                     weight = weights[k]
 *                     for t in range(len(traj[k])-tau):  # Iterate over trajectory steps             # <<<<<<<<<<<<<<
 *                         f_i0, f_itau, f_j = 0.0, 0.0, 0.0
 *                         h_I0 = ids[t][0]
 */
        if (unlikely(__pyx_v_traj == Py_None)) {
          PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
          __PYX_ERR(0, 817, __pyx_L1_error)
        }
        __pyx_t_4 = __Pyx_GetItemInt_List(__pyx_v_traj, __pyx_v_k, Py_ssize_t, 1, PyInt_FromSsize_t, 1, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 817, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_24 = PyObject_Length(__pyx_t_4); if (unlikely(__pyx_t_24 == ((Py_ssize_t)-1))) __PYX_ERR(0, 817, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_25 = (__pyx_t_24 - __pyx_v_tau);
        __pyx_t_24 = __pyx_t_25;
        for (__pyx_t_20 = 0; __pyx_t_20 < __pyx_t_24; __pyx_t_20+=1) {
          __pyx_v_t = __pyx_t_20;

          /* "vcstring.pyx":818
 *                     weight = weights[k]
 *                     for t in range(len(traj[k])-tau):  # Iterate over trajectory steps
 *                         f_i0, f_itau, f_j = 0.0, 0.0, 0.0             # <<<<<<<<<<<<<<
 *                         h_I0 = ids[t][0]
 *                         h_Itau = ids[t + tau][0]
 */
          __pyx_t_12 = 0.0;
          __pyx_t_13 = 0.0;
          __pyx_t_26 = 0.0;
          __pyx_v_f_i0 = __pyx_t_12;
          __pyx_v_f_itau = __pyx_t_13;
          __pyx_v_f_j = __pyx_t_26;

          /* "vcstring.pyx":819
 *                     for t in range(len(traj[k])-tau):  # Iterate over trajectory steps
 *                         f_i0, f_itau, f_j = 0.0, 0.0, 0.0
 *                         h_I0 = ids[t][0]             # <<<<<<<<<<<<<<
 *                         h_Itau = ids[t + tau][0]
 *                         h_B0 = ids[t][1]
 */
          __pyx_t_4 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 819, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_4, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 819, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_26 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_26 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 819, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_v_h_I0 = __pyx_t_26;

          /* "vcstring.pyx":820
 *                         f_i0, f_itau, f_j = 0.0, 0.0, 0.0
 *                         h_I0 = ids[t][0]
 *                         h_Itau = ids[t + tau][0]             # <<<<<<<<<<<<<<
 *                         h_B0 = ids[t][1]
 *                         h_Btau = ids[t + tau][1]
 */
          __pyx_t_27 = (__pyx_v_t + __pyx_v_tau);
          __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_t_27, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 820, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 820, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_26 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_26 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 820, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_v_h_Itau = __pyx_t_26;

          /* "vcstring.pyx":821
 *                         h_I0 = ids[t][0]
 *                         h_Itau = ids[t + tau][0]
 *                         h_B0 = ids[t][1]             # <<<<<<<<<<<<<<
 *                         h_Btau = ids[t + tau][1]
 *                         if ids[t][2] == i:  # Match Voronoi centroids
 */
          __pyx_t_4 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 821, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_4, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 821, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_26 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_26 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 821, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_v_h_B0 = __pyx_t_26;

          /* "vcstring.pyx":822
 *                         h_Itau = ids[t + tau][0]
 *                         h_B0 = ids[t][1]
 *                         h_Btau = ids[t + tau][1]             # <<<<<<<<<<<<<<
 *                         if ids[t][2] == i:  # Match Voronoi centroids
 *                             f_i0 = 1.0
 */
          __pyx_t_27 = (__pyx_v_t + __pyx_v_tau);
          __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_t_27, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 822, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 822, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_26 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_26 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 822, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_v_h_Btau = __pyx_t_26;

          /* "vcstring.pyx":823
 *                         h_B0 = ids[t][1]
 *                         h_Btau = ids[t + tau][1]
 *                         if ids[t][2] == i:  # Match Voronoi centroids             # <<<<<<<<<<<<<<
 *                             f_i0 = 1.0
 *                         if ids[t + tau][2] == i:
 */
          __pyx_t_4 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 823, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_4, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 823, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 823, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_2 = PyObject_RichCompare(__pyx_t_1, __pyx_t_4, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 823, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 823, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          if (__pyx_t_9) {

            /* "vcstring.pyx":824
 *                         h_Btau = ids[t + tau][1]
 *                         if ids[t][2] == i:  # Match Voronoi centroids
 *                             f_i0 = 1.0             # <<<<<<<<<<<<<<
 *                         if ids[t + tau][2] == i:
 *                             f_itau = 1.0
 */
            __pyx_v_f_i0 = 1.0;

            /* "vcstring.pyx":823
 *                         h_B0 = ids[t][1]
 *                         h_Btau = ids[t + tau][1]
 *                         if ids[t][2] == i:  # Match Voronoi centroids             # <<<<<<<<<<<<<<
 *                             f_i0 = 1.0
 *                         if ids[t + tau][2] == i:
 */
          }

          /* "vcstring.pyx":825
 *                         if ids[t][2] == i:  # Match Voronoi centroids
 *                             f_i0 = 1.0
 *                         if ids[t + tau][2] == i:             # <<<<<<<<<<<<<<
 *                             f_itau = 1.0
 *                         if ids[t][2] == j:
 */
          __pyx_t_27 = (__pyx_v_t + __pyx_v_tau);
          __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_t_27, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 825, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_2, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 825, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 825, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_1 = PyObject_RichCompare(__pyx_t_4, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 825, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 825, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          if (__pyx_t_9) {

            /* "vcstring.pyx":826
 *                             f_i0 = 1.0
 *                         if ids[t + tau][2] == i:
 *                             f_itau = 1.0             # <<<<<<<<<<<<<<
 *                         if ids[t][2] == j:
 *                             f_j = 1.0
 */
            __pyx_v_f_itau = 1.0;

            /* "vcstring.pyx":825
 *                         if ids[t][2] == i:  # Match Voronoi centroids
 *                             f_i0 = 1.0
 *                         if ids[t + tau][2] == i:             # <<<<<<<<<<<<<<
 *                             f_itau = 1.0
 *                         if ids[t][2] == j:
 */
          }

          /* "vcstring.pyx":827
 *                         if ids[t + tau][2] == i:
 *                             f_itau = 1.0
 *                         if ids[t][2] == j:             # <<<<<<<<<<<<<<
 *                             f_j = 1.0
 * 
 */
          __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 827, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 827, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_j); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 827, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_4 = PyObject_RichCompare(__pyx_t_2, __pyx_t_1, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 827, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 827, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          if (__pyx_t_9) {

            /* "vcstring.pyx":828
 *                             f_itau = 1.0
 *                         if ids[t][2] == j:
 *                             f_j = 1.0             # <<<<<<<<<<<<<<
 * 
 *                         # Summation of terms
 */
            __pyx_v_f_j = 1.0;

            /* "vcstring.pyx":827
 *                         if ids[t + tau][2] == i:
 *                             f_itau = 1.0
 *                         if ids[t][2] == j:             # <<<<<<<<<<<<<<
 *                             f_j = 1.0
 * 
 */
          }

          /* "vcstring.pyx":831
 * 
 *                         # Summation of terms
 *                         val_D_0 += h_I0 * h_I0 * f_i0 * f_j * weight             # <<<<<<<<<<<<<<
 *                         val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight
 *                         if j == 0:
 */
          __pyx_v_val_D_0 = (__pyx_v_val_D_0 + ((((__pyx_v_h_I0 * __pyx_v_h_I0) * __pyx_v_f_i0) * __pyx_v_f_j) * __pyx_v_weight));

          /* "vcstring.pyx":832
 *                         # Summation of terms
 *                         val_D_0 += h_I0 * h_I0 * f_i0 * f_j * weight
 *                         val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight             # <<<<<<<<<<<<<<
 *                         if j == 0:
 *                             val_g_0 += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) * weight
 */
          __pyx_v_val_D_tau = (__pyx_v_val_D_tau + ((((__pyx_v_h_Itau * __pyx_v_h_I0) * __pyx_v_f_itau) * __pyx_v_f_j) * __pyx_v_weight));

          /* "vcstring.pyx":833
 *                         val_D_0 += h_I0 * h_I0 * f_i0 * f_j * weight
 *                         val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight
 *                         if j == 0:             # <<<<<<<<<<<<<<
 *                             val_g_0 += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) * weight
 *                             val_g_tau += ((h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)) * weight
 */
          __pyx_t_9 = ((__pyx_v_j == 0) != 0);
          if (__pyx_t_9) {

            /* "vcstring.pyx":834
 *                         val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight
 *                         if j == 0:
 *                             val_g_0 += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) * weight             # <<<<<<<<<<<<<<
 *                             val_g_tau += ((h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)) * weight
 *                         count += 1
 */
            __pyx_v_val_g_0 = (__pyx_v_val_g_0 + ((((__pyx_v_h_I0 * __pyx_v_f_i0) * __pyx_v_h_B0) + ((__pyx_v_h_B0 * __pyx_v_h_I0) * __pyx_v_f_i0)) * __pyx_v_weight));

            /* "vcstring.pyx":835
 *                         if j == 0:
 *                             val_g_0 += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) * weight
 *                             val_g_tau += ((h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)) * weight             # <<<<<<<<<<<<<<
 *                         count += 1
 * 
 */
            __pyx_v_val_g_tau = (__pyx_v_val_g_tau + ((((__pyx_v_h_Itau * __pyx_v_f_itau) * __pyx_v_h_B0) + ((__pyx_v_h_Btau * __pyx_v_h_I0) * __pyx_v_f_i0)) * __pyx_v_weight));

            /* "vcstring.pyx":833
 *                         val_D_0 += h_I0 * h_I0 * f_i0 * f_j * weight
 *                         val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight
 *                         if j == 0:             # <<<<<<<<<<<<<<
 *                             val_g_0 += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) * weight
 *                             val_g_tau += ((h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)) * weight
 */
          }

          /* "vcstring.pyx":836
 *                             val_g_0 += ((h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0)) * weight
 *                             val_g_tau += ((h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0)) * weight
 *                         count += 1             # <<<<<<<<<<<<<<
 * 
 *                 # Divide by data size
 */
          __pyx_v_count = (__pyx_v_count + 1);
        }
      }

      /* "vcstring.pyx":839
 * 
 *                 # Divide by data size
 *                 print(f'Dividing D by data size: {count}\n')             # <<<<<<<<<<<<<<
 *                 D_0.append(val_D_0 / count)
 *                 D_tau.append(val_D_tau / count)
 */
      __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 839, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_8 = 0;
      __pyx_t_28 = 127;
      __Pyx_INCREF(__pyx_kp_u_Dividing_D_by_data_size_2);
      __pyx_t_8 += 25;
      __Pyx_GIVEREF(__pyx_kp_u_Dividing_D_by_data_size_2);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_Dividing_D_by_data_size_2);
      __pyx_t_1 = __Pyx_PyUnicode_From_int(__pyx_v_count, 0, ' ', 'd'); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 839, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_8 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_1);
      __pyx_t_1 = 0;
      __Pyx_INCREF(__pyx_kp_u__34);
      __pyx_t_8 += 1;
      __Pyx_GIVEREF(__pyx_kp_u__34);
      PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_kp_u__34);
      __pyx_t_1 = __Pyx_PyUnicode_Join(__pyx_t_4, 3, __pyx_t_8, __pyx_t_28); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 839, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 839, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "vcstring.pyx":840
 *                 # Divide by data size
 *                 print(f'Dividing D by data size: {count}\n')
 *                 D_0.append(val_D_0 / count)             # <<<<<<<<<<<<<<
 *                 D_tau.append(val_D_tau / count)
 *             g_0.append(val_g_0 / count)
 */
      if (unlikely(__pyx_v_count == 0)) {
        PyErr_SetString(PyExc_ZeroDivisionError, "float division");
        __PYX_ERR(0, 840, __pyx_L1_error)
      }
      __pyx_t_4 = PyFloat_FromDouble((__pyx_v_val_D_0 / ((double)__pyx_v_count))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 840, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_29 = __Pyx_PyList_Append(__pyx_v_D_0, __pyx_t_4); if (unlikely(__pyx_t_29 == ((int)-1))) __PYX_ERR(0, 840, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "vcstring.pyx":841
 *                 print(f'Dividing D by data size: {count}\n')
 *                 D_0.append(val_D_0 / count)
 *                 D_tau.append(val_D_tau / count)             # <<<<<<<<<<<<<<
 *             g_0.append(val_g_0 / count)
 *             g_tau.append(val_g_tau / count)
 */
      if (unlikely(__pyx_v_count == 0)) {
        PyErr_SetString(PyExc_ZeroDivisionError, "float division");
        __PYX_ERR(0, 841, __pyx_L1_error)
      }
      __pyx_t_4 = PyFloat_FromDouble((__pyx_v_val_D_tau / ((double)__pyx_v_count))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 841, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_29 = __Pyx_PyList_Append(__pyx_v_D_tau, __pyx_t_4); if (unlikely(__pyx_t_29 == ((int)-1))) __PYX_ERR(0, 841, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }

    /* "vcstring.pyx":842
 *                 D_0.append(val_D_0 / count)
 *                 D_tau.append(val_D_tau / count)
 *             g_0.append(val_g_0 / count)             # <<<<<<<<<<<<<<
 *             g_tau.append(val_g_tau / count)
 * 
 */
    if (unlikely(__pyx_v_count == 0)) {
      PyErr_SetString(PyExc_ZeroDivisionError, "float division");
      __PYX_ERR(0, 842, __pyx_L1_error)
    }
    __pyx_t_4 = PyFloat_FromDouble((__pyx_v_val_g_0 / ((double)__pyx_v_count))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 842, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_29 = __Pyx_PyList_Append(__pyx_v_g_0, __pyx_t_4); if (unlikely(__pyx_t_29 == ((int)-1))) __PYX_ERR(0, 842, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "vcstring.pyx":843
 *                 D_tau.append(val_D_tau / count)
 *             g_0.append(val_g_0 / count)
 *             g_tau.append(val_g_tau / count)             # <<<<<<<<<<<<<<
 * 
 *         # Reshape into appropriate matrix size
 */
    if (unlikely(__pyx_v_count == 0)) {
      PyErr_SetString(PyExc_ZeroDivisionError, "float division");
      __PYX_ERR(0, 843, __pyx_L1_error)
    }
    __pyx_t_4 = PyFloat_FromDouble((__pyx_v_val_g_tau / ((double)__pyx_v_count))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 843, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_29 = __Pyx_PyList_Append(__pyx_v_g_tau, __pyx_t_4); if (unlikely(__pyx_t_29 == ((int)-1))) __PYX_ERR(0, 843, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }

  /* "vcstring.pyx":846
 * 
 *         # Reshape into appropriate matrix size
 *         D_0_arr = np.asarray(D_0).reshape(self.num_basis, self.num_basis)             # <<<<<<<<<<<<<<
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 846, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 846, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_2, __pyx_v_D_0) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_D_0);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 846, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_reshape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 846, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 846, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 846, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
      __pyx_t_6 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_7)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_1, __pyx_t_2};
    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 846, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_1, __pyx_t_2};
    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 846, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else
  #endif
  {
    __pyx_t_5 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 846, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    if (__pyx_t_3) {
      __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_6, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_6, __pyx_t_2);
    __pyx_t_1 = 0;
    __pyx_t_2 = 0;
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 846, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 846, __pyx_L1_error)
  __pyx_t_19 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
    __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_19, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 < 0)) {
      PyErr_Fetch(&__pyx_t_23, &__pyx_t_22, &__pyx_t_21);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_23); Py_XDECREF(__pyx_t_22); Py_XDECREF(__pyx_t_21);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_23, __pyx_t_22, __pyx_t_21);
      }
      __pyx_t_23 = __pyx_t_22 = __pyx_t_21 = 0;
    }
    __pyx_pybuffernd_D_0_arr.diminfo[0].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0_arr.diminfo[0].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0_arr.diminfo[1].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0_arr.diminfo[1].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 846, __pyx_L1_error)
  }
  __pyx_t_19 = 0;
  __pyx_v_D_0_arr = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "vcstring.pyx":847
 *         # Reshape into appropriate matrix size
 *         D_0_arr = np.asarray(D_0).reshape(self.num_basis, self.num_basis)
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)             # <<<<<<<<<<<<<<
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 847, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_asarray); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 847, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_7 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_v_D_tau) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_D_tau);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 847, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_reshape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 847, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 847, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 847, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_1 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_t_7, __pyx_t_5};
    __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 847, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_t_7, __pyx_t_5};
    __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 847, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  {
    __pyx_t_3 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 847, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (__pyx_t_1) {
      __Pyx_GIVEREF(__pyx_t_1); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1); __pyx_t_1 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_7);
    PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_6, __pyx_t_7);
    __Pyx_GIVEREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_6, __pyx_t_5);
    __pyx_t_7 = 0;
    __pyx_t_5 = 0;
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 847, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 847, __pyx_L1_error)
  __pyx_t_19 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
    __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_19, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 < 0)) {
      PyErr_Fetch(&__pyx_t_21, &__pyx_t_22, &__pyx_t_23);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_21); Py_XDECREF(__pyx_t_22); Py_XDECREF(__pyx_t_23);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_21, __pyx_t_22, __pyx_t_23);
      }
      __pyx_t_21 = __pyx_t_22 = __pyx_t_23 = 0;
    }
    __pyx_pybuffernd_D_tau_arr.diminfo[0].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau_arr.diminfo[0].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau_arr.diminfo[1].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau_arr.diminfo[1].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 847, __pyx_L1_error)
  }
  __pyx_t_19 = 0;
  __pyx_v_D_tau_arr = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "vcstring.pyx":848
 *         D_0_arr = np.asarray(D_0).reshape(self.num_basis, self.num_basis)
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)             # <<<<<<<<<<<<<<
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 *         print('D_0 =', D_0_arr)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 848, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 848, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_g_0) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_g_0);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 848, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 848, __pyx_L1_error)
  __pyx_t_30 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer);
    __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_30, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 < 0)) {
      PyErr_Fetch(&__pyx_t_23, &__pyx_t_22, &__pyx_t_21);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_0_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_23); Py_XDECREF(__pyx_t_22); Py_XDECREF(__pyx_t_21);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_23, __pyx_t_22, __pyx_t_21);
      }
      __pyx_t_23 = __pyx_t_22 = __pyx_t_21 = 0;
    }
    __pyx_pybuffernd_g_0_arr.diminfo[0].strides = __pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_0_arr.diminfo[0].shape = __pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 848, __pyx_L1_error)
  }
  __pyx_t_30 = 0;
  __pyx_v_g_0_arr = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "vcstring.pyx":849
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)             # <<<<<<<<<<<<<<
 *         print('D_0 =', D_0_arr)
 *         print('D_tau =', D_tau_arr)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 849, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_asarray); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 849, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_4 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_g_tau) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_g_tau);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 849, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 849, __pyx_L1_error)
  __pyx_t_30 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer);
    __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_30, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 < 0)) {
      PyErr_Fetch(&__pyx_t_21, &__pyx_t_22, &__pyx_t_23);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_tau_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_21); Py_XDECREF(__pyx_t_22); Py_XDECREF(__pyx_t_23);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_21, __pyx_t_22, __pyx_t_23);
      }
      __pyx_t_21 = __pyx_t_22 = __pyx_t_23 = 0;
    }
    __pyx_pybuffernd_g_tau_arr.diminfo[0].strides = __pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_tau_arr.diminfo[0].shape = __pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 849, __pyx_L1_error)
  }
  __pyx_t_30 = 0;
  __pyx_v_g_tau_arr = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "vcstring.pyx":850
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 *         print('D_0 =', D_0_arr)             # <<<<<<<<<<<<<<
 *         print('D_tau =', D_tau_arr)
 *         print('g_0 =', g_0_arr)
 */
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 850, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_kp_u_D_0);
  __Pyx_GIVEREF(__pyx_kp_u_D_0);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_D_0);
  __Pyx_INCREF(((PyObject *)__pyx_v_D_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_0_arr));
  PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_D_0_arr));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 850, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":851
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 *         print('D_0 =', D_0_arr)
 *         print('D_tau =', D_tau_arr)             # <<<<<<<<<<<<<<
 *         print('g_0 =', g_0_arr)
 *         print('g_tau =', g_tau_arr)
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 851, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_D_tau);
  __Pyx_GIVEREF(__pyx_kp_u_D_tau);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_D_tau);
  __Pyx_INCREF(((PyObject *)__pyx_v_D_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_D_tau_arr));
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 851, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "vcstring.pyx":852
 *         print('D_0 =', D_0_arr)
 *         print('D_tau =', D_tau_arr)
 *         print('g_0 =', g_0_arr)             # <<<<<<<<<<<<<<
 *         print('g_tau =', g_tau_arr)
 * 
 */
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 852, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_kp_u_g_0);
  __Pyx_GIVEREF(__pyx_kp_u_g_0);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_g_0);
  __Pyx_INCREF(((PyObject *)__pyx_v_g_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_0_arr));
  PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_g_0_arr));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 852, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":853
 *         print('D_tau =', D_tau_arr)
 *         print('g_0 =', g_0_arr)
 *         print('g_tau =', g_tau_arr)             # <<<<<<<<<<<<<<
 * 
 *         # Symmetrize for reversible dynamics
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 853, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_g_tau);
  __Pyx_GIVEREF(__pyx_kp_u_g_tau);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_g_tau);
  __Pyx_INCREF(((PyObject *)__pyx_v_g_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_g_tau_arr));
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 853, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "vcstring.pyx":856
 * 
 *         # Symmetrize for reversible dynamics
 *         if symmetric == True:             # <<<<<<<<<<<<<<
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 */
  __pyx_t_4 = PyObject_RichCompare(__pyx_v_symmetric, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 856, __pyx_L1_error)
  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 856, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_9) {

    /* "vcstring.pyx":857
 *         # Symmetrize for reversible dynamics
 *         if symmetric == True:
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)             # <<<<<<<<<<<<<<
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 *             print('Symmetric D_0 =', D_0_arr)
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_D_0_arr), __pyx_n_s_T); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 857, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = PyNumber_Add(((PyObject *)__pyx_v_D_0_arr), __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 857, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyNumber_Multiply(__pyx_float_0_5, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 857, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 857, __pyx_L1_error)
    __pyx_t_19 = ((PyArrayObject *)__pyx_t_4);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
      __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_19, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
      if (unlikely(__pyx_t_6 < 0)) {
        PyErr_Fetch(&__pyx_t_23, &__pyx_t_22, &__pyx_t_21);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_23); Py_XDECREF(__pyx_t_22); Py_XDECREF(__pyx_t_21);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_23, __pyx_t_22, __pyx_t_21);
        }
        __pyx_t_23 = __pyx_t_22 = __pyx_t_21 = 0;
      }
      __pyx_pybuffernd_D_0_arr.diminfo[0].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0_arr.diminfo[0].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0_arr.diminfo[1].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0_arr.diminfo[1].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[1];
      if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 857, __pyx_L1_error)
    }
    __pyx_t_19 = 0;
    __Pyx_DECREF_SET(__pyx_v_D_0_arr, ((PyArrayObject *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "vcstring.pyx":858
 *         if symmetric == True:
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)             # <<<<<<<<<<<<<<
 *             print('Symmetric D_0 =', D_0_arr)
 *             print('Symmetric D_tau =', D_tau_arr)
 */
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_D_tau_arr), __pyx_n_s_T); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 858, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = PyNumber_Add(((PyObject *)__pyx_v_D_tau_arr), __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 858, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyNumber_Multiply(__pyx_float_0_5, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 858, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 858, __pyx_L1_error)
    __pyx_t_19 = ((PyArrayObject *)__pyx_t_4);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
      __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_19, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
      if (unlikely(__pyx_t_6 < 0)) {
        PyErr_Fetch(&__pyx_t_21, &__pyx_t_22, &__pyx_t_23);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_21); Py_XDECREF(__pyx_t_22); Py_XDECREF(__pyx_t_23);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_21, __pyx_t_22, __pyx_t_23);
        }
        __pyx_t_21 = __pyx_t_22 = __pyx_t_23 = 0;
      }
      __pyx_pybuffernd_D_tau_arr.diminfo[0].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau_arr.diminfo[0].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau_arr.diminfo[1].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau_arr.diminfo[1].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[1];
      if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 858, __pyx_L1_error)
    }
    __pyx_t_19 = 0;
    __Pyx_DECREF_SET(__pyx_v_D_tau_arr, ((PyArrayObject *)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "vcstring.pyx":859
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 *             print('Symmetric D_0 =', D_0_arr)             # <<<<<<<<<<<<<<
 *             print('Symmetric D_tau =', D_tau_arr)
 * 
 */
    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 859, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_INCREF(__pyx_kp_u_Symmetric_D_0);
    __Pyx_GIVEREF(__pyx_kp_u_Symmetric_D_0);
    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_Symmetric_D_0);
    __Pyx_INCREF(((PyObject *)__pyx_v_D_0_arr));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_D_0_arr));
    PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_D_0_arr));
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 859, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "vcstring.pyx":860
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 *             print('Symmetric D_0 =', D_0_arr)
 *             print('Symmetric D_tau =', D_tau_arr)             # <<<<<<<<<<<<<<
 * 
 *         # Calculate committor coefficients, b
 */
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 860, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_kp_u_Symmetric_D_tau);
    __Pyx_GIVEREF(__pyx_kp_u_Symmetric_D_tau);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_Symmetric_D_tau);
    __Pyx_INCREF(((PyObject *)__pyx_v_D_tau_arr));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_D_tau_arr));
    PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_D_tau_arr));
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 860, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "vcstring.pyx":856
 * 
 *         # Symmetrize for reversible dynamics
 *         if symmetric == True:             # <<<<<<<<<<<<<<
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 */
  }

  /* "vcstring.pyx":863
 * 
 *         # Calculate committor coefficients, b
 *         D = D_0_arr - D_tau_arr             # <<<<<<<<<<<<<<
 *         g = g_tau_arr - g_0_arr
 *         b = 0.5 * np.linalg.inv(D).dot(g)
 */
  __pyx_t_4 = PyNumber_Subtract(((PyObject *)__pyx_v_D_0_arr), ((PyObject *)__pyx_v_D_tau_arr)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 863, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 863, __pyx_L1_error)
  __pyx_t_19 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D.rcbuffer->pybuffer);
    __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D.rcbuffer->pybuffer, (PyObject*)__pyx_t_19, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 < 0)) {
      PyErr_Fetch(&__pyx_t_23, &__pyx_t_22, &__pyx_t_21);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D.rcbuffer->pybuffer, (PyObject*)__pyx_v_D, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_23); Py_XDECREF(__pyx_t_22); Py_XDECREF(__pyx_t_21);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_23, __pyx_t_22, __pyx_t_21);
      }
      __pyx_t_23 = __pyx_t_22 = __pyx_t_21 = 0;
    }
    __pyx_pybuffernd_D.diminfo[0].strides = __pyx_pybuffernd_D.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D.diminfo[0].shape = __pyx_pybuffernd_D.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D.diminfo[1].strides = __pyx_pybuffernd_D.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D.diminfo[1].shape = __pyx_pybuffernd_D.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 863, __pyx_L1_error)
  }
  __pyx_t_19 = 0;
  __pyx_v_D = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "vcstring.pyx":864
 *         # Calculate committor coefficients, b
 *         D = D_0_arr - D_tau_arr
 *         g = g_tau_arr - g_0_arr             # <<<<<<<<<<<<<<
 *         b = 0.5 * np.linalg.inv(D).dot(g)
 *         print('b =', b)
 */
  __pyx_t_4 = PyNumber_Subtract(((PyObject *)__pyx_v_g_tau_arr), ((PyObject *)__pyx_v_g_0_arr)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 864, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 864, __pyx_L1_error)
  __pyx_t_30 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g.rcbuffer->pybuffer);
    __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g.rcbuffer->pybuffer, (PyObject*)__pyx_t_30, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 < 0)) {
      PyErr_Fetch(&__pyx_t_21, &__pyx_t_22, &__pyx_t_23);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g.rcbuffer->pybuffer, (PyObject*)__pyx_v_g, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_21); Py_XDECREF(__pyx_t_22); Py_XDECREF(__pyx_t_23);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_21, __pyx_t_22, __pyx_t_23);
      }
      __pyx_t_21 = __pyx_t_22 = __pyx_t_23 = 0;
    }
    __pyx_pybuffernd_g.diminfo[0].strides = __pyx_pybuffernd_g.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g.diminfo[0].shape = __pyx_pybuffernd_g.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 864, __pyx_L1_error)
  }
  __pyx_t_30 = 0;
  __pyx_v_g = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "vcstring.pyx":865
 *         D = D_0_arr - D_tau_arr
 *         g = g_tau_arr - g_0_arr
 *         b = 0.5 * np.linalg.inv(D).dot(g)             # <<<<<<<<<<<<<<
 *         print('b =', b)
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 865, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_linalg); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 865, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_inv); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 865, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, ((PyObject *)__pyx_v_D)) : __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_D));
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 865, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_dot); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 865, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, ((PyObject *)__pyx_v_g)) : __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_g));
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 865, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_Multiply(__pyx_float_0_5, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 865, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 865, __pyx_L1_error)
  __pyx_t_30 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_t_30, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 < 0)) {
      PyErr_Fetch(&__pyx_t_23, &__pyx_t_22, &__pyx_t_21);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_23); Py_XDECREF(__pyx_t_22); Py_XDECREF(__pyx_t_21);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_23, __pyx_t_22, __pyx_t_21);
      }
      __pyx_t_23 = __pyx_t_22 = __pyx_t_21 = 0;
    }
    __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 865, __pyx_L1_error)
  }
  __pyx_t_30 = 0;
  __pyx_v_b = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "vcstring.pyx":866
 *         g = g_tau_arr - g_0_arr
 *         b = 0.5 * np.linalg.inv(D).dot(g)
 *         print('b =', b)             # <<<<<<<<<<<<<<
 * 
 *         return b, D_0_arr, D_tau_arr, g_0_arr, g_tau_arr
 */
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 866, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_kp_u_b);
  __Pyx_GIVEREF(__pyx_kp_u_b);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_u_b);
  __Pyx_INCREF(((PyObject *)__pyx_v_b));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
  PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)__pyx_v_b));
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 866, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "vcstring.pyx":868
 *         print('b =', b)
 * 
 *         return b, D_0_arr, D_tau_arr, g_0_arr, g_tau_arr             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = PyTuple_New(5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 868, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(((PyObject *)__pyx_v_b));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
  PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_v_b));
  __Pyx_INCREF(((PyObject *)__pyx_v_D_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_0_arr));
  PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_D_0_arr));
  __Pyx_INCREF(((PyObject *)__pyx_v_D_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_4, 2, ((PyObject *)__pyx_v_D_tau_arr));
  __Pyx_INCREF(((PyObject *)__pyx_v_g_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_0_arr));
  PyTuple_SET_ITEM(__pyx_t_4, 3, ((PyObject *)__pyx_v_g_0_arr));
  __Pyx_INCREF(((PyObject *)__pyx_v_g_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_4, 4, ((PyObject *)__pyx_v_g_tau_arr));
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  /* "vcstring.pyx":764
 * 
 * 
 *     cpdef calc_coeffs_ensemble_timeavg_fast(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, list weights=None, symmetric=True):             # <<<<<<<<<<<<<<
 *         """
 *         Solve the linear equation from minimizing the forward steady-state flux.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_coeffs_ensemble_timeavg_fast", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XDECREF(__pyx_v_D_0);
  __Pyx_XDECREF(__pyx_v_D_tau);
  __Pyx_XDECREF(__pyx_v_g_0);
  __Pyx_XDECREF(__pyx_v_g_tau);
  __Pyx_XDECREF((PyObject *)__pyx_v_ids);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_0_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_tau_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_D);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_0_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_tau_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_g);
  __Pyx_XDECREF((PyObject *)__pyx_v_b);
  __Pyx_XDECREF(__pyx_v_weights);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_19calc_coeffs_ensemble_timeavg_fast(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8vcstring_8vcstring_18calc_coeffs_ensemble_timeavg_fast[] = "\n        Solve the linear equation from minimizing the forward steady-state flux.\n        Calculates D matrices, g vectors, and b coefficients.\n\n        Parameters\n        ----------\n        traj :  trajectory with shape (T, d), where T is number of time steps and d is dimensions.\n        tau  :  lag time (units step)\n\n        Returns:\n        --------\n        - Symmetric square Matrices D_0_sym and D_tau_sym\n        - Vectors g_0 and g_tau\n        - A vector of the coefficients b for the trial committor expressed as a basis set expansion\n        ";
static PyObject *__pyx_pw_8vcstring_8vcstring_19calc_coeffs_ensemble_timeavg_fast(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_traj = 0;
  int __pyx_v_tau;
  PyArrayObject *__pyx_v_z = 0;
  PyObject *__pyx_v_weights = 0;
  PyObject *__pyx_v_symmetric = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("calc_coeffs_ensemble_timeavg_fast (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_traj,&__pyx_n_s_tau,&__pyx_n_s_z,&__pyx_n_s_weights,&__pyx_n_s_symmetric,0};
    PyObject* values[5] = {0,0,0,0,0};
    values[3] = ((PyObject*)Py_None);
    values[4] = ((PyObject *)Py_True);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_traj)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tau)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_coeffs_ensemble_timeavg_fast", 0, 3, 5, 1); __PYX_ERR(0, 764, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_coeffs_ensemble_timeavg_fast", 0, 3, 5, 2); __PYX_ERR(0, 764, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weights);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_symmetric);
          if (value) { values[4] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "calc_coeffs_ensemble_timeavg_fast") < 0)) __PYX_ERR(0, 764, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_traj = ((PyObject*)values[0]);
    __pyx_v_tau = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_tau == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 764, __pyx_L3_error)
    __pyx_v_z = ((PyArrayObject *)values[2]);
    __pyx_v_weights = ((PyObject*)values[3]);
    __pyx_v_symmetric = values[4];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("calc_coeffs_ensemble_timeavg_fast", 0, 3, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 764, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.vcstring.calc_coeffs_ensemble_timeavg_fast", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_traj), (&PyList_Type), 1, "traj", 1))) __PYX_ERR(0, 764, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_z), __pyx_ptype_5numpy_ndarray, 1, "z", 0))) __PYX_ERR(0, 764, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_weights), (&PyList_Type), 1, "weights", 1))) __PYX_ERR(0, 764, __pyx_L1_error)
  __pyx_r = __pyx_pf_8vcstring_8vcstring_18calc_coeffs_ensemble_timeavg_fast(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self), __pyx_v_traj, __pyx_v_tau, __pyx_v_z, __pyx_v_weights, __pyx_v_symmetric);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_18calc_coeffs_ensemble_timeavg_fast(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyObject *__pyx_v_weights, PyObject *__pyx_v_symmetric) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast __pyx_t_2;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_coeffs_ensemble_timeavg_fast", 0);
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 764, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2.__pyx_n = 2;
  __pyx_t_2.weights = __pyx_v_weights;
  __pyx_t_2.symmetric = __pyx_v_symmetric;
  __pyx_t_1 = __pyx_vtabptr_8vcstring_vcstring->calc_coeffs_ensemble_timeavg_fast(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, __pyx_v_z, 1, &__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 764, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_coeffs_ensemble_timeavg_fast", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":871
 * 
 * 
 *     cpdef calc_coeffs_ensemble_timeavg_fast_v2(self, int N, list last_frames, int tau, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=2] ids, list weights=None, symmetric=True):             # <<<<<<<<<<<<<<
 *         cdef int i, j, count, t
 *         cdef list x, y, D_0, D_tau, g_0, g_tau
 */

static PyObject *__pyx_pw_8vcstring_8vcstring_21calc_coeffs_ensemble_timeavg_fast_v2(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast_v2(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, CYTHON_UNUSED int __pyx_v_N, PyObject *__pyx_v_last_frames, int __pyx_v_tau, CYTHON_UNUSED PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_ids, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast_v2 *__pyx_optional_args) {
  PyObject *__pyx_v_weights = ((PyObject*)Py_None);
  PyObject *__pyx_v_symmetric = ((PyObject *)Py_True);
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_count;
  int __pyx_v_t;
  PyObject *__pyx_v_D_0 = 0;
  PyObject *__pyx_v_D_tau = 0;
  PyObject *__pyx_v_g_0 = 0;
  PyObject *__pyx_v_g_tau = 0;
  double __pyx_v_val_g_0;
  double __pyx_v_val_g_tau;
  double __pyx_v_val_D_0;
  double __pyx_v_val_D_tau;
  double __pyx_v_weight;
  double __pyx_v_f_i0;
  double __pyx_v_f_itau;
  double __pyx_v_f_j;
  double __pyx_v_h_I0;
  double __pyx_v_h_B0;
  double __pyx_v_h_Itau;
  double __pyx_v_h_Btau;
  PyArrayObject *__pyx_v_D_0_arr = 0;
  PyArrayObject *__pyx_v_D_tau_arr = 0;
  PyArrayObject *__pyx_v_D = 0;
  PyArrayObject *__pyx_v_g_0_arr = 0;
  PyArrayObject *__pyx_v_g_tau_arr = 0;
  PyArrayObject *__pyx_v_g = 0;
  PyArrayObject *__pyx_v_b = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D;
  __Pyx_Buffer __pyx_pybuffer_D;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_0_arr;
  __Pyx_Buffer __pyx_pybuffer_D_0_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_tau_arr;
  __Pyx_Buffer __pyx_pybuffer_D_tau_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g;
  __Pyx_Buffer __pyx_pybuffer_g;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_0_arr;
  __Pyx_Buffer __pyx_pybuffer_g_0_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_tau_arr;
  __Pyx_Buffer __pyx_pybuffer_g_tau_arr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ids;
  __Pyx_Buffer __pyx_pybuffer_ids;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  Py_ssize_t __pyx_t_10;
  int __pyx_t_11;
  int __pyx_t_12;
  double __pyx_t_13;
  double __pyx_t_14;
  int __pyx_t_15;
  int __pyx_t_16;
  int __pyx_t_17;
  Py_ssize_t __pyx_t_18;
  int __pyx_t_19;
  int __pyx_t_20;
  double __pyx_t_21;
  int __pyx_t_22;
  int __pyx_t_23;
  PyArrayObject *__pyx_t_24 = NULL;
  PyObject *__pyx_t_25 = NULL;
  PyObject *__pyx_t_26 = NULL;
  PyObject *__pyx_t_27 = NULL;
  PyArrayObject *__pyx_t_28 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_coeffs_ensemble_timeavg_fast_v2", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args->__pyx_n > 0) {
      __pyx_v_weights = __pyx_optional_args->weights;
      if (__pyx_optional_args->__pyx_n > 1) {
        __pyx_v_symmetric = __pyx_optional_args->symmetric;
      }
    }
  }
  __Pyx_INCREF(__pyx_v_weights);
  __pyx_pybuffer_D_0_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_D_0_arr.refcount = 0;
  __pyx_pybuffernd_D_0_arr.data = NULL;
  __pyx_pybuffernd_D_0_arr.rcbuffer = &__pyx_pybuffer_D_0_arr;
  __pyx_pybuffer_D_tau_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_D_tau_arr.refcount = 0;
  __pyx_pybuffernd_D_tau_arr.data = NULL;
  __pyx_pybuffernd_D_tau_arr.rcbuffer = &__pyx_pybuffer_D_tau_arr;
  __pyx_pybuffer_D.pybuffer.buf = NULL;
  __pyx_pybuffer_D.refcount = 0;
  __pyx_pybuffernd_D.data = NULL;
  __pyx_pybuffernd_D.rcbuffer = &__pyx_pybuffer_D;
  __pyx_pybuffer_g_0_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_g_0_arr.refcount = 0;
  __pyx_pybuffernd_g_0_arr.data = NULL;
  __pyx_pybuffernd_g_0_arr.rcbuffer = &__pyx_pybuffer_g_0_arr;
  __pyx_pybuffer_g_tau_arr.pybuffer.buf = NULL;
  __pyx_pybuffer_g_tau_arr.refcount = 0;
  __pyx_pybuffernd_g_tau_arr.data = NULL;
  __pyx_pybuffernd_g_tau_arr.rcbuffer = &__pyx_pybuffer_g_tau_arr;
  __pyx_pybuffer_g.pybuffer.buf = NULL;
  __pyx_pybuffer_g.refcount = 0;
  __pyx_pybuffernd_g.data = NULL;
  __pyx_pybuffernd_g.rcbuffer = &__pyx_pybuffer_g;
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  __pyx_pybuffer_ids.pybuffer.buf = NULL;
  __pyx_pybuffer_ids.refcount = 0;
  __pyx_pybuffernd_ids.data = NULL;
  __pyx_pybuffernd_ids.rcbuffer = &__pyx_pybuffer_ids;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 871, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 871, __pyx_L1_error)
  }
  __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_calc_coeffs_ensemble_timeavg_fas_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 871, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_8vcstring_8vcstring_21calc_coeffs_ensemble_timeavg_fast_v2)) {
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_N); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 871, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 871, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_5 = __pyx_t_1; __pyx_t_6 = NULL;
        __pyx_t_7 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
          __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
          if (likely(__pyx_t_6)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
            __Pyx_INCREF(__pyx_t_6);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_5, function);
            __pyx_t_7 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[8] = {__pyx_t_6, __pyx_t_3, __pyx_v_last_frames, __pyx_t_4, ((PyObject *)__pyx_v_z), ((PyObject *)__pyx_v_ids), __pyx_v_weights, __pyx_v_symmetric};
          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 7+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 871, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[8] = {__pyx_t_6, __pyx_t_3, __pyx_v_last_frames, __pyx_t_4, ((PyObject *)__pyx_v_z), ((PyObject *)__pyx_v_ids), __pyx_v_weights, __pyx_v_symmetric};
          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 7+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 871, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        } else
        #endif
        {
          __pyx_t_8 = PyTuple_New(7+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 871, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          if (__pyx_t_6) {
            __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
          }
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_t_3);
          __Pyx_INCREF(__pyx_v_last_frames);
          __Pyx_GIVEREF(__pyx_v_last_frames);
          PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_v_last_frames);
          __Pyx_GIVEREF(__pyx_t_4);
          PyTuple_SET_ITEM(__pyx_t_8, 2+__pyx_t_7, __pyx_t_4);
          __Pyx_INCREF(((PyObject *)__pyx_v_z));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
          PyTuple_SET_ITEM(__pyx_t_8, 3+__pyx_t_7, ((PyObject *)__pyx_v_z));
          __Pyx_INCREF(((PyObject *)__pyx_v_ids));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_ids));
          PyTuple_SET_ITEM(__pyx_t_8, 4+__pyx_t_7, ((PyObject *)__pyx_v_ids));
          __Pyx_INCREF(__pyx_v_weights);
          __Pyx_GIVEREF(__pyx_v_weights);
          PyTuple_SET_ITEM(__pyx_t_8, 5+__pyx_t_7, __pyx_v_weights);
          __Pyx_INCREF(__pyx_v_symmetric);
          __Pyx_GIVEREF(__pyx_v_symmetric);
          PyTuple_SET_ITEM(__pyx_t_8, 6+__pyx_t_7, __pyx_v_symmetric);
          __pyx_t_3 = 0;
          __pyx_t_4 = 0;
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 871, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        }
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }

  /* "vcstring.pyx":879
 *         cdef np.ndarray[DTYPE_t, ndim=1] g_0_arr, g_tau_arr, g, b
 * 
 *         print('\n======================================')             # <<<<<<<<<<<<<<
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')
 *         print('======================================')
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__21, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 879, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":880
 * 
 *         print('\n======================================')
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')             # <<<<<<<<<<<<<<
 *         print('======================================')
 *         print('lag time =', tau)
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__22, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 880, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":881
 *         print('\n======================================')
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')
 *         print('======================================')             # <<<<<<<<<<<<<<
 *         print('lag time =', tau)
 *         print('Symmetrization of D matrices:', symmetric)
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__24, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 881, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":882
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')
 *         print('======================================')
 *         print('lag time =', tau)             # <<<<<<<<<<<<<<
 *         print('Symmetrization of D matrices:', symmetric)
 * 
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 882, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 882, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_lag_time);
  __Pyx_GIVEREF(__pyx_kp_u_lag_time);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_lag_time);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 882, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":883
 *         print('======================================')
 *         print('lag time =', tau)
 *         print('Symmetrization of D matrices:', symmetric)             # <<<<<<<<<<<<<<
 * 
 *         if weights == None:
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 883, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_Symmetrization_of_D_matrices);
  __Pyx_GIVEREF(__pyx_kp_u_Symmetrization_of_D_matrices);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Symmetrization_of_D_matrices);
  __Pyx_INCREF(__pyx_v_symmetric);
  __Pyx_GIVEREF(__pyx_v_symmetric);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_symmetric);
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 883, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":885
 *         print('Symmetrization of D matrices:', symmetric)
 * 
 *         if weights == None:             # <<<<<<<<<<<<<<
 *             print('Using uniform weights')
 *             weights = [1.] * len(ids)
 */
  __pyx_t_2 = PyObject_RichCompare(__pyx_v_weights, Py_None, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 885, __pyx_L1_error)
  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 885, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_9) {

    /* "vcstring.pyx":886
 * 
 *         if weights == None:
 *             print('Using uniform weights')             # <<<<<<<<<<<<<<
 *             weights = [1.] * len(ids)
 * 
 */
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__33, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 886, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "vcstring.pyx":887
 *         if weights == None:
 *             print('Using uniform weights')
 *             weights = [1.] * len(ids)             # <<<<<<<<<<<<<<
 * 
 *         D_0 = []
 */
    __pyx_t_10 = PyObject_Length(((PyObject *)__pyx_v_ids)); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 887, __pyx_L1_error)
    __pyx_t_2 = PyList_New(1 * ((__pyx_t_10<0) ? 0:__pyx_t_10)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 887, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    { Py_ssize_t __pyx_temp;
      for (__pyx_temp=0; __pyx_temp < __pyx_t_10; __pyx_temp++) {
        __Pyx_INCREF(__pyx_float_1_);
        __Pyx_GIVEREF(__pyx_float_1_);
        PyList_SET_ITEM(__pyx_t_2, __pyx_temp, __pyx_float_1_);
      }
    }
    __Pyx_DECREF_SET(__pyx_v_weights, ((PyObject*)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "vcstring.pyx":885
 *         print('Symmetrization of D matrices:', symmetric)
 * 
 *         if weights == None:             # <<<<<<<<<<<<<<
 *             print('Using uniform weights')
 *             weights = [1.] * len(ids)
 */
  }

  /* "vcstring.pyx":889
 *             weights = [1.] * len(ids)
 * 
 *         D_0 = []             # <<<<<<<<<<<<<<
 *         D_tau = []
 *         g_0 = []
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 889, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_D_0 = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":890
 * 
 *         D_0 = []
 *         D_tau = []             # <<<<<<<<<<<<<<
 *         g_0 = []
 *         g_tau = []
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 890, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_D_tau = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":891
 *         D_0 = []
 *         D_tau = []
 *         g_0 = []             # <<<<<<<<<<<<<<
 *         g_tau = []
 *         for i in range(self.num_basis):
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 891, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_g_0 = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":892
 *         D_tau = []
 *         g_0 = []
 *         g_tau = []             # <<<<<<<<<<<<<<
 *         for i in range(self.num_basis):
 *             val_g_0, val_g_tau = 0.0, 0.0
 */
  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 892, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_g_tau = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "vcstring.pyx":893
 *         g_0 = []
 *         g_tau = []
 *         for i in range(self.num_basis):             # <<<<<<<<<<<<<<
 *             val_g_0, val_g_tau = 0.0, 0.0
 *             for j in range(self.num_basis):
 */
  __pyx_t_7 = __pyx_v_self->num_basis;
  __pyx_t_11 = __pyx_t_7;
  for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
    __pyx_v_i = __pyx_t_12;

    /* "vcstring.pyx":894
 *         g_tau = []
 *         for i in range(self.num_basis):
 *             val_g_0, val_g_tau = 0.0, 0.0             # <<<<<<<<<<<<<<
 *             for j in range(self.num_basis):
 *                 print("Matrix elements", i, j)
 */
    __pyx_t_13 = 0.0;
    __pyx_t_14 = 0.0;
    __pyx_v_val_g_0 = __pyx_t_13;
    __pyx_v_val_g_tau = __pyx_t_14;

    /* "vcstring.pyx":895
 *         for i in range(self.num_basis):
 *             val_g_0, val_g_tau = 0.0, 0.0
 *             for j in range(self.num_basis):             # <<<<<<<<<<<<<<
 *                 print("Matrix elements", i, j)
 *                 sys.stdout.flush()
 */
    __pyx_t_15 = __pyx_v_self->num_basis;
    __pyx_t_16 = __pyx_t_15;
    for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
      __pyx_v_j = __pyx_t_17;

      /* "vcstring.pyx":896
 *             val_g_0, val_g_tau = 0.0, 0.0
 *             for j in range(self.num_basis):
 *                 print("Matrix elements", i, j)             # <<<<<<<<<<<<<<
 *                 sys.stdout.flush()
 *                 val_D_0, val_D_tau = 0.0, 0.0
 */
      __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 896, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_j); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 896, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 896, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_INCREF(__pyx_kp_u_Matrix_elements);
      __Pyx_GIVEREF(__pyx_kp_u_Matrix_elements);
      PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_kp_u_Matrix_elements);
      __Pyx_GIVEREF(__pyx_t_2);
      PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_t_1);
      __pyx_t_2 = 0;
      __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 896, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":897
 *             for j in range(self.num_basis):
 *                 print("Matrix elements", i, j)
 *                 sys.stdout.flush()             # <<<<<<<<<<<<<<
 *                 val_D_0, val_D_tau = 0.0, 0.0
 *                 count = 0
 */
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sys); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 897, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_stdout); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 897, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_flush); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 897, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_2)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_2);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
        }
      }
      __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 897, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":898
 *                 print("Matrix elements", i, j)
 *                 sys.stdout.flush()
 *                 val_D_0, val_D_tau = 0.0, 0.0             # <<<<<<<<<<<<<<
 *                 count = 0
 * 
 */
      __pyx_t_14 = 0.0;
      __pyx_t_13 = 0.0;
      __pyx_v_val_D_0 = __pyx_t_14;
      __pyx_v_val_D_tau = __pyx_t_13;

      /* "vcstring.pyx":899
 *                 sys.stdout.flush()
 *                 val_D_0, val_D_tau = 0.0, 0.0
 *                 count = 0             # <<<<<<<<<<<<<<
 * 
 *                 for t in range(len(ids)):
 */
      __pyx_v_count = 0;

      /* "vcstring.pyx":901
 *                 count = 0
 * 
 *                 for t in range(len(ids)):             # <<<<<<<<<<<<<<
 *                     weight = weights[t]
 *                     if t in last_frames:
 */
      __pyx_t_10 = PyObject_Length(((PyObject *)__pyx_v_ids)); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 901, __pyx_L1_error)
      __pyx_t_18 = __pyx_t_10;
      for (__pyx_t_19 = 0; __pyx_t_19 < __pyx_t_18; __pyx_t_19+=1) {
        __pyx_v_t = __pyx_t_19;

        /* "vcstring.pyx":902
 * 
 *                 for t in range(len(ids)):
 *                     weight = weights[t]             # <<<<<<<<<<<<<<
 *                     if t in last_frames:
 *                         # print('Skipping last frame:', t, '\n')
 */
        if (unlikely(__pyx_v_weights == Py_None)) {
          PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
          __PYX_ERR(0, 902, __pyx_L1_error)
        }
        __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_v_weights, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 902, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_13 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_13 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 902, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_v_weight = __pyx_t_13;

        /* "vcstring.pyx":903
 *                 for t in range(len(ids)):
 *                     weight = weights[t]
 *                     if t in last_frames:             # <<<<<<<<<<<<<<
 *                         # print('Skipping last frame:', t, '\n')
 *                         continue
 */
        __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_t); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 903, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_9 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_v_last_frames, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 903, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_20 = (__pyx_t_9 != 0);
        if (__pyx_t_20) {

          /* "vcstring.pyx":905
 *                     if t in last_frames:
 *                         # print('Skipping last frame:', t, '\n')
 *                         continue             # <<<<<<<<<<<<<<
 *                     # print('frame:', t)
 *                     f_i0, f_itau, f_j = 0.0, 0.0, 0.0
 */
          goto __pyx_L8_continue;

          /* "vcstring.pyx":903
 *                 for t in range(len(ids)):
 *                     weight = weights[t]
 *                     if t in last_frames:             # <<<<<<<<<<<<<<
 *                         # print('Skipping last frame:', t, '\n')
 *                         continue
 */
        }

        /* "vcstring.pyx":907
 *                         continue
 *                     # print('frame:', t)
 *                     f_i0, f_itau, f_j = 0.0, 0.0, 0.0             # <<<<<<<<<<<<<<
 *                     h_I0 = ids[t][0]
 *                     h_Itau = ids[t + tau][0]
 */
        __pyx_t_13 = 0.0;
        __pyx_t_14 = 0.0;
        __pyx_t_21 = 0.0;
        __pyx_v_f_i0 = __pyx_t_13;
        __pyx_v_f_itau = __pyx_t_14;
        __pyx_v_f_j = __pyx_t_21;

        /* "vcstring.pyx":908
 *                     # print('frame:', t)
 *                     f_i0, f_itau, f_j = 0.0, 0.0, 0.0
 *                     h_I0 = ids[t][0]             # <<<<<<<<<<<<<<
 *                     h_Itau = ids[t + tau][0]
 *                     h_B0 = ids[t][1]
 */
        __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 908, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 908, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_21 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely((__pyx_t_21 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 908, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_v_h_I0 = __pyx_t_21;

        /* "vcstring.pyx":909
 *                     f_i0, f_itau, f_j = 0.0, 0.0, 0.0
 *                     h_I0 = ids[t][0]
 *                     h_Itau = ids[t + tau][0]             # <<<<<<<<<<<<<<
 *                     h_B0 = ids[t][1]
 *                     h_Btau = ids[t + tau][1]
 */
        __pyx_t_22 = (__pyx_v_t + __pyx_v_tau);
        __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_t_22, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 909, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_5, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 909, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_21 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_21 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 909, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_v_h_Itau = __pyx_t_21;

        /* "vcstring.pyx":910
 *                     h_I0 = ids[t][0]
 *                     h_Itau = ids[t + tau][0]
 *                     h_B0 = ids[t][1]             # <<<<<<<<<<<<<<
 *                     h_Btau = ids[t + tau][1]
 *                     if ids[t][2] == i:
 */
        __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 910, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 910, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_21 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely((__pyx_t_21 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 910, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_v_h_B0 = __pyx_t_21;

        /* "vcstring.pyx":911
 *                     h_Itau = ids[t + tau][0]
 *                     h_B0 = ids[t][1]
 *                     h_Btau = ids[t + tau][1]             # <<<<<<<<<<<<<<
 *                     if ids[t][2] == i:
 *                         f_i0 = 1.0
 */
        __pyx_t_22 = (__pyx_v_t + __pyx_v_tau);
        __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_t_22, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 911, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_5, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 911, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_21 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_21 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 911, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_v_h_Btau = __pyx_t_21;

        /* "vcstring.pyx":912
 *                     h_B0 = ids[t][1]
 *                     h_Btau = ids[t + tau][1]
 *                     if ids[t][2] == i:             # <<<<<<<<<<<<<<
 *                         f_i0 = 1.0
 *                     if ids[t + tau][2] == i:
 */
        __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 912, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_1, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 912, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 912, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_2 = PyObject_RichCompare(__pyx_t_5, __pyx_t_1, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 912, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_20 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_20 < 0)) __PYX_ERR(0, 912, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        if (__pyx_t_20) {

          /* "vcstring.pyx":913
 *                     h_Btau = ids[t + tau][1]
 *                     if ids[t][2] == i:
 *                         f_i0 = 1.0             # <<<<<<<<<<<<<<
 *                     if ids[t + tau][2] == i:
 *                         f_itau = 1.0
 */
          __pyx_v_f_i0 = 1.0;

          /* "vcstring.pyx":912
 *                     h_B0 = ids[t][1]
 *                     h_Btau = ids[t + tau][1]
 *                     if ids[t][2] == i:             # <<<<<<<<<<<<<<
 *                         f_i0 = 1.0
 *                     if ids[t + tau][2] == i:
 */
        }

        /* "vcstring.pyx":914
 *                     if ids[t][2] == i:
 *                         f_i0 = 1.0
 *                     if ids[t + tau][2] == i:             # <<<<<<<<<<<<<<
 *                         f_itau = 1.0
 *                     if ids[t][2] == j:
 */
        __pyx_t_22 = (__pyx_v_t + __pyx_v_tau);
        __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_t_22, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 914, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 914, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 914, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_5 = PyObject_RichCompare(__pyx_t_1, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 914, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_20 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_20 < 0)) __PYX_ERR(0, 914, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        if (__pyx_t_20) {

          /* "vcstring.pyx":915
 *                         f_i0 = 1.0
 *                     if ids[t + tau][2] == i:
 *                         f_itau = 1.0             # <<<<<<<<<<<<<<
 *                     if ids[t][2] == j:
 *                         f_j = 1.0
 */
          __pyx_v_f_itau = 1.0;

          /* "vcstring.pyx":914
 *                     if ids[t][2] == i:
 *                         f_i0 = 1.0
 *                     if ids[t + tau][2] == i:             # <<<<<<<<<<<<<<
 *                         f_itau = 1.0
 *                     if ids[t][2] == j:
 */
        }

        /* "vcstring.pyx":916
 *                     if ids[t + tau][2] == i:
 *                         f_itau = 1.0
 *                     if ids[t][2] == j:             # <<<<<<<<<<<<<<
 *                         f_j = 1.0
 * 
 */
        __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 916, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_5, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 916, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_j); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 916, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_1 = PyObject_RichCompare(__pyx_t_2, __pyx_t_5, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 916, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_20 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_20 < 0)) __PYX_ERR(0, 916, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        if (__pyx_t_20) {

          /* "vcstring.pyx":917
 *                         f_itau = 1.0
 *                     if ids[t][2] == j:
 *                         f_j = 1.0             # <<<<<<<<<<<<<<
 * 
 *                     # Summation of terms
 */
          __pyx_v_f_j = 1.0;

          /* "vcstring.pyx":916
 *                     if ids[t + tau][2] == i:
 *                         f_itau = 1.0
 *                     if ids[t][2] == j:             # <<<<<<<<<<<<<<
 *                         f_j = 1.0
 * 
 */
        }

        /* "vcstring.pyx":920
 * 
 *                     # Summation of terms
 *                     val_D_0 += h_I0 * h_I0 * f_i0 * f_j * weight             # <<<<<<<<<<<<<<
 *                     val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight
 *                     if j == 0:
 */
        __pyx_v_val_D_0 = (__pyx_v_val_D_0 + ((((__pyx_v_h_I0 * __pyx_v_h_I0) * __pyx_v_f_i0) * __pyx_v_f_j) * __pyx_v_weight));

        /* "vcstring.pyx":921
 *                     # Summation of terms
 *                     val_D_0 += h_I0 * h_I0 * f_i0 * f_j * weight
 *                     val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight             # <<<<<<<<<<<<<<
 *                     if j == 0:
 *                         val_g_0 += (h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0) * weight
 */
        __pyx_v_val_D_tau = (__pyx_v_val_D_tau + ((((__pyx_v_h_Itau * __pyx_v_h_I0) * __pyx_v_f_itau) * __pyx_v_f_j) * __pyx_v_weight));

        /* "vcstring.pyx":922
 *                     val_D_0 += h_I0 * h_I0 * f_i0 * f_j * weight
 *                     val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight
 *                     if j == 0:             # <<<<<<<<<<<<<<
 *                         val_g_0 += (h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0) * weight
 *                         val_g_tau += (h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0) * weight
 */
        __pyx_t_20 = ((__pyx_v_j == 0) != 0);
        if (__pyx_t_20) {

          /* "vcstring.pyx":923
 *                     val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight
 *                     if j == 0:
 *                         val_g_0 += (h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0) * weight             # <<<<<<<<<<<<<<
 *                         val_g_tau += (h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0) * weight
 *                     count += 1
 */
          __pyx_v_val_g_0 = (__pyx_v_val_g_0 + (((__pyx_v_h_I0 * __pyx_v_f_i0) * __pyx_v_h_B0) + (((__pyx_v_h_B0 * __pyx_v_h_I0) * __pyx_v_f_i0) * __pyx_v_weight)));

          /* "vcstring.pyx":924
 *                     if j == 0:
 *                         val_g_0 += (h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0) * weight
 *                         val_g_tau += (h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0) * weight             # <<<<<<<<<<<<<<
 *                     count += 1
 * 
 */
          __pyx_v_val_g_tau = (__pyx_v_val_g_tau + (((__pyx_v_h_Itau * __pyx_v_f_itau) * __pyx_v_h_B0) + (((__pyx_v_h_Btau * __pyx_v_h_I0) * __pyx_v_f_i0) * __pyx_v_weight)));

          /* "vcstring.pyx":922
 *                     val_D_0 += h_I0 * h_I0 * f_i0 * f_j * weight
 *                     val_D_tau += h_Itau * h_I0 * f_itau * f_j * weight
 *                     if j == 0:             # <<<<<<<<<<<<<<
 *                         val_g_0 += (h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0) * weight
 *                         val_g_tau += (h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0) * weight
 */
        }

        /* "vcstring.pyx":925
 *                         val_g_0 += (h_I0 * f_i0 * h_B0) + (h_B0 * h_I0 * f_i0) * weight
 *                         val_g_tau += (h_Itau * f_itau * h_B0) + (h_Btau * h_I0 * f_i0) * weight
 *                     count += 1             # <<<<<<<<<<<<<<
 * 
 *                 # Divide by data size
 */
        __pyx_v_count = (__pyx_v_count + 1);
        __pyx_L8_continue:;
      }

      /* "vcstring.pyx":928
 * 
 *                 # Divide by data size
 *                 D_0.append(val_D_0 / count)             # <<<<<<<<<<<<<<
 *                 D_tau.append(val_D_tau / count)
 *             g_0.append(val_g_0 / count)
 */
      if (unlikely(__pyx_v_count == 0)) {
        PyErr_SetString(PyExc_ZeroDivisionError, "float division");
        __PYX_ERR(0, 928, __pyx_L1_error)
      }
      __pyx_t_1 = PyFloat_FromDouble((__pyx_v_val_D_0 / ((double)__pyx_v_count))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 928, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_23 = __Pyx_PyList_Append(__pyx_v_D_0, __pyx_t_1); if (unlikely(__pyx_t_23 == ((int)-1))) __PYX_ERR(0, 928, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":929
 *                 # Divide by data size
 *                 D_0.append(val_D_0 / count)
 *                 D_tau.append(val_D_tau / count)             # <<<<<<<<<<<<<<
 *             g_0.append(val_g_0 / count)
 *             g_tau.append(val_g_tau / count)
 */
      if (unlikely(__pyx_v_count == 0)) {
        PyErr_SetString(PyExc_ZeroDivisionError, "float division");
        __PYX_ERR(0, 929, __pyx_L1_error)
      }
      __pyx_t_1 = PyFloat_FromDouble((__pyx_v_val_D_tau / ((double)__pyx_v_count))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 929, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_23 = __Pyx_PyList_Append(__pyx_v_D_tau, __pyx_t_1); if (unlikely(__pyx_t_23 == ((int)-1))) __PYX_ERR(0, 929, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }

    /* "vcstring.pyx":930
 *                 D_0.append(val_D_0 / count)
 *                 D_tau.append(val_D_tau / count)
 *             g_0.append(val_g_0 / count)             # <<<<<<<<<<<<<<
 *             g_tau.append(val_g_tau / count)
 * 
 */
    if (unlikely(__pyx_v_count == 0)) {
      PyErr_SetString(PyExc_ZeroDivisionError, "float division");
      __PYX_ERR(0, 930, __pyx_L1_error)
    }
    __pyx_t_1 = PyFloat_FromDouble((__pyx_v_val_g_0 / ((double)__pyx_v_count))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 930, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_23 = __Pyx_PyList_Append(__pyx_v_g_0, __pyx_t_1); if (unlikely(__pyx_t_23 == ((int)-1))) __PYX_ERR(0, 930, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "vcstring.pyx":931
 *                 D_tau.append(val_D_tau / count)
 *             g_0.append(val_g_0 / count)
 *             g_tau.append(val_g_tau / count)             # <<<<<<<<<<<<<<
 * 
 *         # Reshape into appropriate matrix size
 */
    if (unlikely(__pyx_v_count == 0)) {
      PyErr_SetString(PyExc_ZeroDivisionError, "float division");
      __PYX_ERR(0, 931, __pyx_L1_error)
    }
    __pyx_t_1 = PyFloat_FromDouble((__pyx_v_val_g_tau / ((double)__pyx_v_count))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 931, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_23 = __Pyx_PyList_Append(__pyx_v_g_tau, __pyx_t_1); if (unlikely(__pyx_t_23 == ((int)-1))) __PYX_ERR(0, 931, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }

  /* "vcstring.pyx":934
 * 
 *         # Reshape into appropriate matrix size
 *         D_0_arr = np.asarray(D_0).reshape(self.num_basis, self.num_basis)             # <<<<<<<<<<<<<<
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 934, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 934, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
    }
  }
  __pyx_t_5 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_2, __pyx_v_D_0) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_v_D_0);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 934, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_reshape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 934, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 934, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 934, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_5, __pyx_t_2};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 934, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_8)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_5, __pyx_t_2};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 934, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else
  #endif
  {
    __pyx_t_3 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 934, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (__pyx_t_4) {
      __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4); __pyx_t_4 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_5);
    PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_7, __pyx_t_5);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_7, __pyx_t_2);
    __pyx_t_5 = 0;
    __pyx_t_2 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 934, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 934, __pyx_L1_error)
  __pyx_t_24 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_24, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_25, &__pyx_t_26, &__pyx_t_27);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_27);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_25, __pyx_t_26, __pyx_t_27);
      }
      __pyx_t_25 = __pyx_t_26 = __pyx_t_27 = 0;
    }
    __pyx_pybuffernd_D_0_arr.diminfo[0].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0_arr.diminfo[0].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0_arr.diminfo[1].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0_arr.diminfo[1].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 934, __pyx_L1_error)
  }
  __pyx_t_24 = 0;
  __pyx_v_D_0_arr = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":935
 *         # Reshape into appropriate matrix size
 *         D_0_arr = np.asarray(D_0).reshape(self.num_basis, self.num_basis)
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)             # <<<<<<<<<<<<<<
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 935, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_asarray); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 935, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_8 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_D_tau) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_D_tau);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 935, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_reshape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 935, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 935, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 935, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (PyFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_8, __pyx_t_3};
    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 935, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_8, __pyx_t_3};
    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 935, __pyx_L1_error)
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  {
    __pyx_t_4 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 935, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    if (__pyx_t_5) {
      __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    __Pyx_GIVEREF(__pyx_t_8);
    PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_7, __pyx_t_8);
    __Pyx_GIVEREF(__pyx_t_3);
    PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_7, __pyx_t_3);
    __pyx_t_8 = 0;
    __pyx_t_3 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 935, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 935, __pyx_L1_error)
  __pyx_t_24 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_24, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_27, &__pyx_t_26, &__pyx_t_25);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_27); Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_25);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_27, __pyx_t_26, __pyx_t_25);
      }
      __pyx_t_27 = __pyx_t_26 = __pyx_t_25 = 0;
    }
    __pyx_pybuffernd_D_tau_arr.diminfo[0].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau_arr.diminfo[0].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau_arr.diminfo[1].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau_arr.diminfo[1].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 935, __pyx_L1_error)
  }
  __pyx_t_24 = 0;
  __pyx_v_D_tau_arr = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":936
 *         D_0_arr = np.asarray(D_0).reshape(self.num_basis, self.num_basis)
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)             # <<<<<<<<<<<<<<
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 *         print('D_0 =', D_0_arr)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 936, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 936, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_v_g_0) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_g_0);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 936, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 936, __pyx_L1_error)
  __pyx_t_28 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_28, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_25, &__pyx_t_26, &__pyx_t_27);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_0_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_27);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_25, __pyx_t_26, __pyx_t_27);
      }
      __pyx_t_25 = __pyx_t_26 = __pyx_t_27 = 0;
    }
    __pyx_pybuffernd_g_0_arr.diminfo[0].strides = __pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_0_arr.diminfo[0].shape = __pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 936, __pyx_L1_error)
  }
  __pyx_t_28 = 0;
  __pyx_v_g_0_arr = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":937
 *         D_tau_arr = np.asarray(D_tau).reshape(self.num_basis, self.num_basis)
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)             # <<<<<<<<<<<<<<
 *         print('D_0 =', D_0_arr)
 *         print('D_tau =', D_tau_arr)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 937, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_asarray); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 937, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_v_g_tau) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_g_tau);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 937, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 937, __pyx_L1_error)
  __pyx_t_28 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_28, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_27, &__pyx_t_26, &__pyx_t_25);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_tau_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_27); Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_25);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_27, __pyx_t_26, __pyx_t_25);
      }
      __pyx_t_27 = __pyx_t_26 = __pyx_t_25 = 0;
    }
    __pyx_pybuffernd_g_tau_arr.diminfo[0].strides = __pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_tau_arr.diminfo[0].shape = __pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 937, __pyx_L1_error)
  }
  __pyx_t_28 = 0;
  __pyx_v_g_tau_arr = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":938
 *         g_0_arr = np.asarray(g_0) # .reshape(self.num_basis)
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 *         print('D_0 =', D_0_arr)             # <<<<<<<<<<<<<<
 *         print('D_tau =', D_tau_arr)
 *         print('g_0 =', g_0_arr)
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 938, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_D_0);
  __Pyx_GIVEREF(__pyx_kp_u_D_0);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_D_0);
  __Pyx_INCREF(((PyObject *)__pyx_v_D_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_0_arr));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_D_0_arr));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 938, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":939
 *         g_tau_arr = np.asarray(g_tau)# .reshape(self.num_basis)
 *         print('D_0 =', D_0_arr)
 *         print('D_tau =', D_tau_arr)             # <<<<<<<<<<<<<<
 *         print('g_0 =', g_0_arr)
 *         print('g_tau =', g_tau_arr)
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 939, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_D_tau);
  __Pyx_GIVEREF(__pyx_kp_u_D_tau);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_D_tau);
  __Pyx_INCREF(((PyObject *)__pyx_v_D_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_D_tau_arr));
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 939, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":940
 *         print('D_0 =', D_0_arr)
 *         print('D_tau =', D_tau_arr)
 *         print('g_0 =', g_0_arr)             # <<<<<<<<<<<<<<
 *         print('g_tau =', g_tau_arr)
 * 
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 940, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_g_0);
  __Pyx_GIVEREF(__pyx_kp_u_g_0);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_g_0);
  __Pyx_INCREF(((PyObject *)__pyx_v_g_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_0_arr));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_g_0_arr));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 940, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":941
 *         print('D_tau =', D_tau_arr)
 *         print('g_0 =', g_0_arr)
 *         print('g_tau =', g_tau_arr)             # <<<<<<<<<<<<<<
 * 
 *         # Symmetrize for reversible dynamics
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 941, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_g_tau);
  __Pyx_GIVEREF(__pyx_kp_u_g_tau);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_g_tau);
  __Pyx_INCREF(((PyObject *)__pyx_v_g_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_g_tau_arr));
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 941, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":944
 * 
 *         # Symmetrize for reversible dynamics
 *         if symmetric == True:             # <<<<<<<<<<<<<<
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 */
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_symmetric, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 944, __pyx_L1_error)
  __pyx_t_20 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_20 < 0)) __PYX_ERR(0, 944, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_20) {

    /* "vcstring.pyx":945
 *         # Symmetrize for reversible dynamics
 *         if symmetric == True:
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)             # <<<<<<<<<<<<<<
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 *             print('Symmetric D_0 =', D_0_arr)
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_D_0_arr), __pyx_n_s_T); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 945, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_Add(((PyObject *)__pyx_v_D_0_arr), __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 945, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyNumber_Multiply(__pyx_float_0_5, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 945, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 945, __pyx_L1_error)
    __pyx_t_24 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
      __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_24, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
      if (unlikely(__pyx_t_7 < 0)) {
        PyErr_Fetch(&__pyx_t_25, &__pyx_t_26, &__pyx_t_27);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_27);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_25, __pyx_t_26, __pyx_t_27);
        }
        __pyx_t_25 = __pyx_t_26 = __pyx_t_27 = 0;
      }
      __pyx_pybuffernd_D_0_arr.diminfo[0].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0_arr.diminfo[0].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0_arr.diminfo[1].strides = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0_arr.diminfo[1].shape = __pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer.shape[1];
      if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 945, __pyx_L1_error)
    }
    __pyx_t_24 = 0;
    __Pyx_DECREF_SET(__pyx_v_D_0_arr, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "vcstring.pyx":946
 *         if symmetric == True:
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)             # <<<<<<<<<<<<<<
 *             print('Symmetric D_0 =', D_0_arr)
 *             print('Symmetric D_tau =', D_tau_arr)
 */
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_D_tau_arr), __pyx_n_s_T); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 946, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_Add(((PyObject *)__pyx_v_D_tau_arr), __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 946, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyNumber_Multiply(__pyx_float_0_5, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 946, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 946, __pyx_L1_error)
    __pyx_t_24 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
      __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_t_24, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
      if (unlikely(__pyx_t_7 < 0)) {
        PyErr_Fetch(&__pyx_t_27, &__pyx_t_26, &__pyx_t_25);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau_arr, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_27); Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_25);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_27, __pyx_t_26, __pyx_t_25);
        }
        __pyx_t_27 = __pyx_t_26 = __pyx_t_25 = 0;
      }
      __pyx_pybuffernd_D_tau_arr.diminfo[0].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau_arr.diminfo[0].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau_arr.diminfo[1].strides = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau_arr.diminfo[1].shape = __pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer.shape[1];
      if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 946, __pyx_L1_error)
    }
    __pyx_t_24 = 0;
    __Pyx_DECREF_SET(__pyx_v_D_tau_arr, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "vcstring.pyx":947
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 *             print('Symmetric D_0 =', D_0_arr)             # <<<<<<<<<<<<<<
 *             print('Symmetric D_tau =', D_tau_arr)
 * 
 */
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 947, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_kp_u_Symmetric_D_0);
    __Pyx_GIVEREF(__pyx_kp_u_Symmetric_D_0);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Symmetric_D_0);
    __Pyx_INCREF(((PyObject *)__pyx_v_D_0_arr));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_D_0_arr));
    PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_D_0_arr));
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 947, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "vcstring.pyx":948
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 *             print('Symmetric D_0 =', D_0_arr)
 *             print('Symmetric D_tau =', D_tau_arr)             # <<<<<<<<<<<<<<
 * 
 *         # Calculate committor coefficients, b
 */
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 948, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_kp_u_Symmetric_D_tau);
    __Pyx_GIVEREF(__pyx_kp_u_Symmetric_D_tau);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_Symmetric_D_tau);
    __Pyx_INCREF(((PyObject *)__pyx_v_D_tau_arr));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_D_tau_arr));
    PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_D_tau_arr));
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 948, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "vcstring.pyx":944
 * 
 *         # Symmetrize for reversible dynamics
 *         if symmetric == True:             # <<<<<<<<<<<<<<
 *             D_0_arr = 0.5 * (D_0_arr + D_0_arr.T)
 *             D_tau_arr = 0.5 * (D_tau_arr + D_tau_arr.T)
 */
  }

  /* "vcstring.pyx":951
 * 
 *         # Calculate committor coefficients, b
 *         D = D_0_arr - D_tau_arr             # <<<<<<<<<<<<<<
 *         g = g_tau_arr - g_0_arr
 *         b = 0.5 * np.linalg.inv(D).dot(g)
 */
  __pyx_t_1 = PyNumber_Subtract(((PyObject *)__pyx_v_D_0_arr), ((PyObject *)__pyx_v_D_tau_arr)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 951, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 951, __pyx_L1_error)
  __pyx_t_24 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D.rcbuffer->pybuffer, (PyObject*)__pyx_t_24, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_25, &__pyx_t_26, &__pyx_t_27);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D.rcbuffer->pybuffer, (PyObject*)__pyx_v_D, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_27);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_25, __pyx_t_26, __pyx_t_27);
      }
      __pyx_t_25 = __pyx_t_26 = __pyx_t_27 = 0;
    }
    __pyx_pybuffernd_D.diminfo[0].strides = __pyx_pybuffernd_D.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D.diminfo[0].shape = __pyx_pybuffernd_D.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D.diminfo[1].strides = __pyx_pybuffernd_D.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D.diminfo[1].shape = __pyx_pybuffernd_D.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 951, __pyx_L1_error)
  }
  __pyx_t_24 = 0;
  __pyx_v_D = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":952
 *         # Calculate committor coefficients, b
 *         D = D_0_arr - D_tau_arr
 *         g = g_tau_arr - g_0_arr             # <<<<<<<<<<<<<<
 *         b = 0.5 * np.linalg.inv(D).dot(g)
 *         print('b =', b)
 */
  __pyx_t_1 = PyNumber_Subtract(((PyObject *)__pyx_v_g_tau_arr), ((PyObject *)__pyx_v_g_0_arr)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 952, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 952, __pyx_L1_error)
  __pyx_t_28 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g.rcbuffer->pybuffer, (PyObject*)__pyx_t_28, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_27, &__pyx_t_26, &__pyx_t_25);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g.rcbuffer->pybuffer, (PyObject*)__pyx_v_g, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_27); Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_25);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_27, __pyx_t_26, __pyx_t_25);
      }
      __pyx_t_27 = __pyx_t_26 = __pyx_t_25 = 0;
    }
    __pyx_pybuffernd_g.diminfo[0].strides = __pyx_pybuffernd_g.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g.diminfo[0].shape = __pyx_pybuffernd_g.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 952, __pyx_L1_error)
  }
  __pyx_t_28 = 0;
  __pyx_v_g = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":953
 *         D = D_0_arr - D_tau_arr
 *         g = g_tau_arr - g_0_arr
 *         b = 0.5 * np.linalg.inv(D).dot(g)             # <<<<<<<<<<<<<<
 *         print('b =', b)
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 953, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_linalg); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 953, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_inv); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 953, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, ((PyObject *)__pyx_v_D)) : __Pyx_PyObject_CallOneArg(__pyx_t_4, ((PyObject *)__pyx_v_D));
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 953, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_dot); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 953, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, ((PyObject *)__pyx_v_g)) : __Pyx_PyObject_CallOneArg(__pyx_t_4, ((PyObject *)__pyx_v_g));
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 953, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyNumber_Multiply(__pyx_float_0_5, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 953, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 953, __pyx_L1_error)
  __pyx_t_28 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_t_28, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_25, &__pyx_t_26, &__pyx_t_27);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_25); Py_XDECREF(__pyx_t_26); Py_XDECREF(__pyx_t_27);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_25, __pyx_t_26, __pyx_t_27);
      }
      __pyx_t_25 = __pyx_t_26 = __pyx_t_27 = 0;
    }
    __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 953, __pyx_L1_error)
  }
  __pyx_t_28 = 0;
  __pyx_v_b = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "vcstring.pyx":954
 *         g = g_tau_arr - g_0_arr
 *         b = 0.5 * np.linalg.inv(D).dot(g)
 *         print('b =', b)             # <<<<<<<<<<<<<<
 * 
 *         return b, D_0_arr, D_tau_arr, g_0_arr, g_tau_arr
 */
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 954, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_kp_u_b);
  __Pyx_GIVEREF(__pyx_kp_u_b);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_b);
  __Pyx_INCREF(((PyObject *)__pyx_v_b));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
  PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_b));
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 954, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":956
 *         print('b =', b)
 * 
 *         return b, D_0_arr, D_tau_arr, g_0_arr, g_tau_arr             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 956, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(((PyObject *)__pyx_v_b));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_b));
  __Pyx_INCREF(((PyObject *)__pyx_v_D_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_0_arr));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_D_0_arr));
  __Pyx_INCREF(((PyObject *)__pyx_v_D_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_D_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_1, 2, ((PyObject *)__pyx_v_D_tau_arr));
  __Pyx_INCREF(((PyObject *)__pyx_v_g_0_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_0_arr));
  PyTuple_SET_ITEM(__pyx_t_1, 3, ((PyObject *)__pyx_v_g_0_arr));
  __Pyx_INCREF(((PyObject *)__pyx_v_g_tau_arr));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_g_tau_arr));
  PyTuple_SET_ITEM(__pyx_t_1, 4, ((PyObject *)__pyx_v_g_tau_arr));
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "vcstring.pyx":871
 * 
 * 
 *     cpdef calc_coeffs_ensemble_timeavg_fast_v2(self, int N, list last_frames, int tau, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=2] ids, list weights=None, symmetric=True):             # <<<<<<<<<<<<<<
 *         cdef int i, j, count, t
 *         cdef list x, y, D_0, D_tau, g_0, g_tau
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_coeffs_ensemble_timeavg_fast_v2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_arr.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XDECREF(__pyx_v_D_0);
  __Pyx_XDECREF(__pyx_v_D_tau);
  __Pyx_XDECREF(__pyx_v_g_0);
  __Pyx_XDECREF(__pyx_v_g_tau);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_0_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_tau_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_D);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_0_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_tau_arr);
  __Pyx_XDECREF((PyObject *)__pyx_v_g);
  __Pyx_XDECREF((PyObject *)__pyx_v_b);
  __Pyx_XDECREF(__pyx_v_weights);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_21calc_coeffs_ensemble_timeavg_fast_v2(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_8vcstring_8vcstring_21calc_coeffs_ensemble_timeavg_fast_v2(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_N;
  PyObject *__pyx_v_last_frames = 0;
  int __pyx_v_tau;
  PyArrayObject *__pyx_v_z = 0;
  PyArrayObject *__pyx_v_ids = 0;
  PyObject *__pyx_v_weights = 0;
  PyObject *__pyx_v_symmetric = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("calc_coeffs_ensemble_timeavg_fast_v2 (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_N,&__pyx_n_s_last_frames,&__pyx_n_s_tau,&__pyx_n_s_z,&__pyx_n_s_ids,&__pyx_n_s_weights,&__pyx_n_s_symmetric,0};
    PyObject* values[7] = {0,0,0,0,0,0,0};
    values[5] = ((PyObject*)Py_None);
    values[6] = ((PyObject *)Py_True);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_N)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_last_frames)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_coeffs_ensemble_timeavg_fast_v2", 0, 5, 7, 1); __PYX_ERR(0, 871, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tau)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_coeffs_ensemble_timeavg_fast_v2", 0, 5, 7, 2); __PYX_ERR(0, 871, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_coeffs_ensemble_timeavg_fast_v2", 0, 5, 7, 3); __PYX_ERR(0, 871, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ids)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_coeffs_ensemble_timeavg_fast_v2", 0, 5, 7, 4); __PYX_ERR(0, 871, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weights);
          if (value) { values[5] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_symmetric);
          if (value) { values[6] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "calc_coeffs_ensemble_timeavg_fast_v2") < 0)) __PYX_ERR(0, 871, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_N = __Pyx_PyInt_As_int(values[0]); if (unlikely((__pyx_v_N == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 871, __pyx_L3_error)
    __pyx_v_last_frames = ((PyObject*)values[1]);
    __pyx_v_tau = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_tau == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 871, __pyx_L3_error)
    __pyx_v_z = ((PyArrayObject *)values[3]);
    __pyx_v_ids = ((PyArrayObject *)values[4]);
    __pyx_v_weights = ((PyObject*)values[5]);
    __pyx_v_symmetric = values[6];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("calc_coeffs_ensemble_timeavg_fast_v2", 0, 5, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 871, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.vcstring.calc_coeffs_ensemble_timeavg_fast_v2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_last_frames), (&PyList_Type), 1, "last_frames", 1))) __PYX_ERR(0, 871, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_z), __pyx_ptype_5numpy_ndarray, 1, "z", 0))) __PYX_ERR(0, 871, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ids), __pyx_ptype_5numpy_ndarray, 1, "ids", 0))) __PYX_ERR(0, 871, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_weights), (&PyList_Type), 1, "weights", 1))) __PYX_ERR(0, 871, __pyx_L1_error)
  __pyx_r = __pyx_pf_8vcstring_8vcstring_20calc_coeffs_ensemble_timeavg_fast_v2(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self), __pyx_v_N, __pyx_v_last_frames, __pyx_v_tau, __pyx_v_z, __pyx_v_ids, __pyx_v_weights, __pyx_v_symmetric);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_20calc_coeffs_ensemble_timeavg_fast_v2(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_v_N, PyObject *__pyx_v_last_frames, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_ids, PyObject *__pyx_v_weights, PyObject *__pyx_v_symmetric) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ids;
  __Pyx_Buffer __pyx_pybuffer_ids;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast_v2 __pyx_t_2;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_coeffs_ensemble_timeavg_fast_v2", 0);
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  __pyx_pybuffer_ids.pybuffer.buf = NULL;
  __pyx_pybuffer_ids.refcount = 0;
  __pyx_pybuffernd_ids.data = NULL;
  __pyx_pybuffernd_ids.rcbuffer = &__pyx_pybuffer_ids;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 871, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 871, __pyx_L1_error)
  }
  __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2.__pyx_n = 2;
  __pyx_t_2.weights = __pyx_v_weights;
  __pyx_t_2.symmetric = __pyx_v_symmetric;
  __pyx_t_1 = __pyx_vtabptr_8vcstring_vcstring->calc_coeffs_ensemble_timeavg_fast_v2(__pyx_v_self, __pyx_v_N, __pyx_v_last_frames, __pyx_v_tau, __pyx_v_z, __pyx_v_ids, 1, &__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 871, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_coeffs_ensemble_timeavg_fast_v2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":959
 * 
 * 
 *     cpdef calc_corr(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=1] b, np.ndarray[DTYPE_t, ndim=2] D_0, np.ndarray[DTYPE_t, ndim=2] D_tau, np.ndarray[DTYPE_t, ndim=1] g_0, np.ndarray[DTYPE_t, ndim=1] g_tau):             # <<<<<<<<<<<<<<
 *         """Get correlation function as a function of sigma.
 *         <r(0)r(0) - r(0)r(t)> = b.T[D(0)-D(tau)]b + [g(0)-g(tau)]b + <hB(0)hB(0)> - <hB(tau)hB(0)>,
 */

static PyObject *__pyx_pw_8vcstring_8vcstring_23calc_corr(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_corr(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_b, PyArrayObject *__pyx_v_D_0, PyArrayObject *__pyx_v_D_tau, PyArrayObject *__pyx_v_g_0, PyArrayObject *__pyx_v_g_tau, int __pyx_skip_dispatch) {
  CYTHON_UNUSED double __pyx_v_xa;
  double __pyx_v_xb;
  double __pyx_v_ell_tB;
  double __pyx_v_ell_tauB;
  PyObject *__pyx_v_x = 0;
  PyObject *__pyx_v_y = 0;
  int __pyx_v_N;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_t;
  double __pyx_v_C_00;
  double __pyx_v_C_tau0;
  double __pyx_v_bD_0j;
  double __pyx_v_bD_tj;
  double __pyx_v_Bval_0;
  double __pyx_v_Bval_tau;
  double __pyx_v_hB_0;
  double __pyx_v_hB_tau;
  double __pyx_v_u_t;
  double __pyx_v_u_tau;
  double __pyx_v_C;
  PyObject *__pyx_v_x_t = NULL;
  PyObject *__pyx_v_x_tau = NULL;
  PyObject *__pyx_v_y_t = NULL;
  PyObject *__pyx_v_y_tau = NULL;
  double __pyx_v_Bval;
  PyObject *__pyx_8genexpr8__pyx_v_row = NULL;
  PyObject *__pyx_8genexpr9__pyx_v_row = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_0;
  __Pyx_Buffer __pyx_pybuffer_D_0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_tau;
  __Pyx_Buffer __pyx_pybuffer_D_tau;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_0;
  __Pyx_Buffer __pyx_pybuffer_g_0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_tau;
  __Pyx_Buffer __pyx_pybuffer_g_tau;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  int __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  double __pyx_t_11;
  double __pyx_t_12;
  Py_ssize_t __pyx_t_13;
  int __pyx_t_14;
  int __pyx_t_15;
  int __pyx_t_16;
  int __pyx_t_17;
  int __pyx_t_18;
  Py_ssize_t __pyx_t_19;
  int __pyx_t_20;
  Py_ssize_t __pyx_t_21;
  Py_ssize_t __pyx_t_22;
  PyObject *__pyx_t_23 = NULL;
  PyObject *__pyx_t_24 = NULL;
  PyObject *__pyx_t_25 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_corr", 0);
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  __pyx_pybuffer_D_0.pybuffer.buf = NULL;
  __pyx_pybuffer_D_0.refcount = 0;
  __pyx_pybuffernd_D_0.data = NULL;
  __pyx_pybuffernd_D_0.rcbuffer = &__pyx_pybuffer_D_0;
  __pyx_pybuffer_D_tau.pybuffer.buf = NULL;
  __pyx_pybuffer_D_tau.refcount = 0;
  __pyx_pybuffernd_D_tau.data = NULL;
  __pyx_pybuffernd_D_tau.rcbuffer = &__pyx_pybuffer_D_tau;
  __pyx_pybuffer_g_0.pybuffer.buf = NULL;
  __pyx_pybuffer_g_0.refcount = 0;
  __pyx_pybuffernd_g_0.data = NULL;
  __pyx_pybuffernd_g_0.rcbuffer = &__pyx_pybuffer_g_0;
  __pyx_pybuffer_g_tau.pybuffer.buf = NULL;
  __pyx_pybuffer_g_tau.refcount = 0;
  __pyx_pybuffernd_g_tau.data = NULL;
  __pyx_pybuffernd_g_tau.rcbuffer = &__pyx_pybuffer_g_tau;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 959, __pyx_L1_error)
  }
  __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 959, __pyx_L1_error)
  }
  __pyx_pybuffernd_D_0.diminfo[0].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0.diminfo[0].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0.diminfo[1].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0.diminfo[1].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 959, __pyx_L1_error)
  }
  __pyx_pybuffernd_D_tau.diminfo[0].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau.diminfo[0].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau.diminfo[1].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau.diminfo[1].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 959, __pyx_L1_error)
  }
  __pyx_pybuffernd_g_0.diminfo[0].strides = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_0.diminfo[0].shape = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 959, __pyx_L1_error)
  }
  __pyx_pybuffernd_g_tau.diminfo[0].strides = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_tau.diminfo[0].shape = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.shape[0];
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_calc_corr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 959, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_8vcstring_8vcstring_23calc_corr)) {
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 959, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
        __pyx_t_6 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
          __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
          if (likely(__pyx_t_5)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
            __Pyx_INCREF(__pyx_t_5);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_4, function);
            __pyx_t_6 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[8] = {__pyx_t_5, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_b), ((PyObject *)__pyx_v_D_0), ((PyObject *)__pyx_v_D_tau), ((PyObject *)__pyx_v_g_0), ((PyObject *)__pyx_v_g_tau)};
          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 7+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 959, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[8] = {__pyx_t_5, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_b), ((PyObject *)__pyx_v_D_0), ((PyObject *)__pyx_v_D_tau), ((PyObject *)__pyx_v_g_0), ((PyObject *)__pyx_v_g_tau)};
          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 7+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 959, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        } else
        #endif
        {
          __pyx_t_7 = PyTuple_New(7+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 959, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          if (__pyx_t_5) {
            __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
          }
          __Pyx_INCREF(__pyx_v_traj);
          __Pyx_GIVEREF(__pyx_v_traj);
          PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_traj);
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_t_3);
          __Pyx_INCREF(((PyObject *)__pyx_v_b));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
          PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_6, ((PyObject *)__pyx_v_b));
          __Pyx_INCREF(((PyObject *)__pyx_v_D_0));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_D_0));
          PyTuple_SET_ITEM(__pyx_t_7, 3+__pyx_t_6, ((PyObject *)__pyx_v_D_0));
          __Pyx_INCREF(((PyObject *)__pyx_v_D_tau));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_D_tau));
          PyTuple_SET_ITEM(__pyx_t_7, 4+__pyx_t_6, ((PyObject *)__pyx_v_D_tau));
          __Pyx_INCREF(((PyObject *)__pyx_v_g_0));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_g_0));
          PyTuple_SET_ITEM(__pyx_t_7, 5+__pyx_t_6, ((PyObject *)__pyx_v_g_0));
          __Pyx_INCREF(((PyObject *)__pyx_v_g_tau));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_g_tau));
          PyTuple_SET_ITEM(__pyx_t_7, 6+__pyx_t_6, ((PyObject *)__pyx_v_g_tau));
          __pyx_t_3 = 0;
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 959, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        }
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }

  /* "vcstring.pyx":969
 *         cdef double C_00, C_tau0, bD_0j, bD_tj, Bval_0, Bval_tau, hB_0, hB_tau, u_t, u_tau, C
 * 
 *         if self.state_assignment == 'orthogonal_projection':             # <<<<<<<<<<<<<<
 *             xa, xb = self.intermediate_region()
 * 
 */
  __pyx_t_8 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_n_u_orthogonal_projection, Py_EQ)); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 969, __pyx_L1_error)
  __pyx_t_9 = (__pyx_t_8 != 0);
  if (__pyx_t_9) {

    /* "vcstring.pyx":970
 * 
 *         if self.state_assignment == 'orthogonal_projection':
 *             xa, xb = self.intermediate_region()             # <<<<<<<<<<<<<<
 * 
 *         x = [row[1] for row in traj]
 */
    __pyx_t_1 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->intermediate_region(__pyx_v_self, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 970, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
      PyObject* sequence = __pyx_t_1;
      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        __PYX_ERR(0, 970, __pyx_L1_error)
      }
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
      } else {
        __pyx_t_2 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
      }
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      #else
      __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 970, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 970, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_7 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 970, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_10 = Py_TYPE(__pyx_t_7)->tp_iternext;
      index = 0; __pyx_t_2 = __pyx_t_10(__pyx_t_7); if (unlikely(!__pyx_t_2)) goto __pyx_L4_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_2);
      index = 1; __pyx_t_4 = __pyx_t_10(__pyx_t_7); if (unlikely(!__pyx_t_4)) goto __pyx_L4_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_4);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_10(__pyx_t_7), 2) < 0) __PYX_ERR(0, 970, __pyx_L1_error)
      __pyx_t_10 = NULL;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      goto __pyx_L5_unpacking_done;
      __pyx_L4_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_10 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      __PYX_ERR(0, 970, __pyx_L1_error)
      __pyx_L5_unpacking_done:;
    }
    __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 970, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 970, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_xa = __pyx_t_11;
    __pyx_v_xb = __pyx_t_12;

    /* "vcstring.pyx":969
 *         cdef double C_00, C_tau0, bD_0j, bD_tj, Bval_0, Bval_tau, hB_0, hB_tau, u_t, u_tau, C
 * 
 *         if self.state_assignment == 'orthogonal_projection':             # <<<<<<<<<<<<<<
 *             xa, xb = self.intermediate_region()
 * 
 */
  }

  /* "vcstring.pyx":972
 *             xa, xb = self.intermediate_region()
 * 
 *         x = [row[1] for row in traj]             # <<<<<<<<<<<<<<
 *         if self.state_assignment != '1d':
 *             y = [row[2] for row in traj]
 */
  { /* enter inner scope */
    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 972, __pyx_L8_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (unlikely(__pyx_v_traj == Py_None)) {
      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
      __PYX_ERR(0, 972, __pyx_L8_error)
    }
    __pyx_t_4 = __pyx_v_traj; __Pyx_INCREF(__pyx_t_4); __pyx_t_13 = 0;
    for (;;) {
      if (__pyx_t_13 >= PyList_GET_SIZE(__pyx_t_4)) break;
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      __pyx_t_2 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_13); __Pyx_INCREF(__pyx_t_2); __pyx_t_13++; if (unlikely(0 < 0)) __PYX_ERR(0, 972, __pyx_L8_error)
      #else
      __pyx_t_2 = PySequence_ITEM(__pyx_t_4, __pyx_t_13); __pyx_t_13++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 972, __pyx_L8_error)
      __Pyx_GOTREF(__pyx_t_2);
      #endif
      __Pyx_XDECREF_SET(__pyx_8genexpr8__pyx_v_row, __pyx_t_2);
      __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_GetItemInt(__pyx_8genexpr8__pyx_v_row, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 972, __pyx_L8_error)
      __Pyx_GOTREF(__pyx_t_2);
      if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_2))) __PYX_ERR(0, 972, __pyx_L8_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_8genexpr8__pyx_v_row); __pyx_8genexpr8__pyx_v_row = 0;
    goto __pyx_L11_exit_scope;
    __pyx_L8_error:;
    __Pyx_XDECREF(__pyx_8genexpr8__pyx_v_row); __pyx_8genexpr8__pyx_v_row = 0;
    goto __pyx_L1_error;
    __pyx_L11_exit_scope:;
  } /* exit inner scope */
  __pyx_v_x = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":973
 * 
 *         x = [row[1] for row in traj]
 *         if self.state_assignment != '1d':             # <<<<<<<<<<<<<<
 *             y = [row[2] for row in traj]
 *         N = len(x)
 */
  __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_kp_u_1d, Py_NE)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 973, __pyx_L1_error)
  __pyx_t_8 = (__pyx_t_9 != 0);
  if (__pyx_t_8) {

    /* "vcstring.pyx":974
 *         x = [row[1] for row in traj]
 *         if self.state_assignment != '1d':
 *             y = [row[2] for row in traj]             # <<<<<<<<<<<<<<
 *         N = len(x)
 * 
 */
    { /* enter inner scope */
      __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 974, __pyx_L15_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (unlikely(__pyx_v_traj == Py_None)) {
        PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
        __PYX_ERR(0, 974, __pyx_L15_error)
      }
      __pyx_t_4 = __pyx_v_traj; __Pyx_INCREF(__pyx_t_4); __pyx_t_13 = 0;
      for (;;) {
        if (__pyx_t_13 >= PyList_GET_SIZE(__pyx_t_4)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_13); __Pyx_INCREF(__pyx_t_2); __pyx_t_13++; if (unlikely(0 < 0)) __PYX_ERR(0, 974, __pyx_L15_error)
        #else
        __pyx_t_2 = PySequence_ITEM(__pyx_t_4, __pyx_t_13); __pyx_t_13++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 974, __pyx_L15_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
        __Pyx_XDECREF_SET(__pyx_8genexpr9__pyx_v_row, __pyx_t_2);
        __pyx_t_2 = 0;
        __pyx_t_2 = __Pyx_GetItemInt(__pyx_8genexpr9__pyx_v_row, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 974, __pyx_L15_error)
        __Pyx_GOTREF(__pyx_t_2);
        if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_2))) __PYX_ERR(0, 974, __pyx_L15_error)
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      }
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_XDECREF(__pyx_8genexpr9__pyx_v_row); __pyx_8genexpr9__pyx_v_row = 0;
      goto __pyx_L18_exit_scope;
      __pyx_L15_error:;
      __Pyx_XDECREF(__pyx_8genexpr9__pyx_v_row); __pyx_8genexpr9__pyx_v_row = 0;
      goto __pyx_L1_error;
      __pyx_L18_exit_scope:;
    } /* exit inner scope */
    __pyx_v_y = ((PyObject*)__pyx_t_1);
    __pyx_t_1 = 0;

    /* "vcstring.pyx":973
 * 
 *         x = [row[1] for row in traj]
 *         if self.state_assignment != '1d':             # <<<<<<<<<<<<<<
 *             y = [row[2] for row in traj]
 *         N = len(x)
 */
  }

  /* "vcstring.pyx":975
 *         if self.state_assignment != '1d':
 *             y = [row[2] for row in traj]
 *         N = len(x)             # <<<<<<<<<<<<<<
 * 
 *         # Calculate correlation function
 */
  __pyx_t_13 = PyList_GET_SIZE(__pyx_v_x); if (unlikely(__pyx_t_13 == ((Py_ssize_t)-1))) __PYX_ERR(0, 975, __pyx_L1_error)
  __pyx_v_N = __pyx_t_13;

  /* "vcstring.pyx":978
 * 
 *         # Calculate correlation function
 *         print('\n=================================')             # <<<<<<<<<<<<<<
 *         print('CALCULATING CORRELATION FUNCTION')
 *         print('=================================')
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__36, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 978, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":979
 *         # Calculate correlation function
 *         print('\n=================================')
 *         print('CALCULATING CORRELATION FUNCTION')             # <<<<<<<<<<<<<<
 *         print('=================================')
 *         sys.stdout.flush()
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__37, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 979, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":980
 *         print('\n=================================')
 *         print('CALCULATING CORRELATION FUNCTION')
 *         print('=================================')             # <<<<<<<<<<<<<<
 *         sys.stdout.flush()
 *         C_00, C_tau0 = 0.0, 0.0
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__39, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 980, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":981
 *         print('CALCULATING CORRELATION FUNCTION')
 *         print('=================================')
 *         sys.stdout.flush()             # <<<<<<<<<<<<<<
 *         C_00, C_tau0 = 0.0, 0.0
 *         for i in range(self.num_basis):
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sys); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 981, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_stdout); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 981, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_flush); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 981, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 981, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":982
 *         print('=================================')
 *         sys.stdout.flush()
 *         C_00, C_tau0 = 0.0, 0.0             # <<<<<<<<<<<<<<
 *         for i in range(self.num_basis):
 *             bD_0j, bD_tj = 0.0, 0.0
 */
  __pyx_t_12 = 0.0;
  __pyx_t_11 = 0.0;
  __pyx_v_C_00 = __pyx_t_12;
  __pyx_v_C_tau0 = __pyx_t_11;

  /* "vcstring.pyx":983
 *         sys.stdout.flush()
 *         C_00, C_tau0 = 0.0, 0.0
 *         for i in range(self.num_basis):             # <<<<<<<<<<<<<<
 *             bD_0j, bD_tj = 0.0, 0.0
 *             for j in range(self.num_basis):
 */
  __pyx_t_6 = __pyx_v_self->num_basis;
  __pyx_t_14 = __pyx_t_6;
  for (__pyx_t_15 = 0; __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
    __pyx_v_i = __pyx_t_15;

    /* "vcstring.pyx":984
 *         C_00, C_tau0 = 0.0, 0.0
 *         for i in range(self.num_basis):
 *             bD_0j, bD_tj = 0.0, 0.0             # <<<<<<<<<<<<<<
 *             for j in range(self.num_basis):
 *                 bD_0j += b[j] * D_0[i][j]
 */
    __pyx_t_11 = 0.0;
    __pyx_t_12 = 0.0;
    __pyx_v_bD_0j = __pyx_t_11;
    __pyx_v_bD_tj = __pyx_t_12;

    /* "vcstring.pyx":985
 *         for i in range(self.num_basis):
 *             bD_0j, bD_tj = 0.0, 0.0
 *             for j in range(self.num_basis):             # <<<<<<<<<<<<<<
 *                 bD_0j += b[j] * D_0[i][j]
 *                 bD_tj += b[j] * D_tau[i][j]
 */
    __pyx_t_16 = __pyx_v_self->num_basis;
    __pyx_t_17 = __pyx_t_16;
    for (__pyx_t_18 = 0; __pyx_t_18 < __pyx_t_17; __pyx_t_18+=1) {
      __pyx_v_j = __pyx_t_18;

      /* "vcstring.pyx":986
 *             bD_0j, bD_tj = 0.0, 0.0
 *             for j in range(self.num_basis):
 *                 bD_0j += b[j] * D_0[i][j]             # <<<<<<<<<<<<<<
 *                 bD_tj += b[j] * D_tau[i][j]
 *             C_00 += b[i] * bD_0j + b[i] * g_0[i]
 */
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_bD_0j); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 986, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_19 = __pyx_v_j;
      __pyx_t_20 = -1;
      if (__pyx_t_19 < 0) {
        __pyx_t_19 += __pyx_pybuffernd_b.diminfo[0].shape;
        if (unlikely(__pyx_t_19 < 0)) __pyx_t_20 = 0;
      } else if (unlikely(__pyx_t_19 >= __pyx_pybuffernd_b.diminfo[0].shape)) __pyx_t_20 = 0;
      if (unlikely(__pyx_t_20 != -1)) {
        __Pyx_RaiseBufferIndexError(__pyx_t_20);
        __PYX_ERR(0, 986, __pyx_L1_error)
      }
      __pyx_t_4 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_b.rcbuffer->pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_b.diminfo[0].strides))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 986, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_D_0), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 986, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_j, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 986, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = PyNumber_Multiply(__pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 986, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = PyNumber_InPlaceAdd(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 986, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_7); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 986, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_v_bD_0j = __pyx_t_12;

      /* "vcstring.pyx":987
 *             for j in range(self.num_basis):
 *                 bD_0j += b[j] * D_0[i][j]
 *                 bD_tj += b[j] * D_tau[i][j]             # <<<<<<<<<<<<<<
 *             C_00 += b[i] * bD_0j + b[i] * g_0[i]
 *             C_tau0 += b[i] * bD_tj + b[i] * g_tau[i]
 */
      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_bD_tj); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 987, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_19 = __pyx_v_j;
      __pyx_t_20 = -1;
      if (__pyx_t_19 < 0) {
        __pyx_t_19 += __pyx_pybuffernd_b.diminfo[0].shape;
        if (unlikely(__pyx_t_19 < 0)) __pyx_t_20 = 0;
      } else if (unlikely(__pyx_t_19 >= __pyx_pybuffernd_b.diminfo[0].shape)) __pyx_t_20 = 0;
      if (unlikely(__pyx_t_20 != -1)) {
        __Pyx_RaiseBufferIndexError(__pyx_t_20);
        __PYX_ERR(0, 987, __pyx_L1_error)
      }
      __pyx_t_2 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_b.rcbuffer->pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_b.diminfo[0].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 987, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_D_tau), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 987, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_j, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 987, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = PyNumber_Multiply(__pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 987, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_t_7, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 987, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 987, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_v_bD_tj = __pyx_t_12;
    }

    /* "vcstring.pyx":988
 *                 bD_0j += b[j] * D_0[i][j]
 *                 bD_tj += b[j] * D_tau[i][j]
 *             C_00 += b[i] * bD_0j + b[i] * g_0[i]             # <<<<<<<<<<<<<<
 *             C_tau0 += b[i] * bD_tj + b[i] * g_tau[i]
 * 
 */
    __pyx_t_19 = __pyx_v_i;
    __pyx_t_16 = -1;
    if (__pyx_t_19 < 0) {
      __pyx_t_19 += __pyx_pybuffernd_b.diminfo[0].shape;
      if (unlikely(__pyx_t_19 < 0)) __pyx_t_16 = 0;
    } else if (unlikely(__pyx_t_19 >= __pyx_pybuffernd_b.diminfo[0].shape)) __pyx_t_16 = 0;
    if (unlikely(__pyx_t_16 != -1)) {
      __Pyx_RaiseBufferIndexError(__pyx_t_16);
      __PYX_ERR(0, 988, __pyx_L1_error)
    }
    __pyx_t_21 = __pyx_v_i;
    __pyx_t_16 = -1;
    if (__pyx_t_21 < 0) {
      __pyx_t_21 += __pyx_pybuffernd_b.diminfo[0].shape;
      if (unlikely(__pyx_t_21 < 0)) __pyx_t_16 = 0;
    } else if (unlikely(__pyx_t_21 >= __pyx_pybuffernd_b.diminfo[0].shape)) __pyx_t_16 = 0;
    if (unlikely(__pyx_t_16 != -1)) {
      __Pyx_RaiseBufferIndexError(__pyx_t_16);
      __PYX_ERR(0, 988, __pyx_L1_error)
    }
    __pyx_t_22 = __pyx_v_i;
    __pyx_t_16 = -1;
    if (__pyx_t_22 < 0) {
      __pyx_t_22 += __pyx_pybuffernd_g_0.diminfo[0].shape;
      if (unlikely(__pyx_t_22 < 0)) __pyx_t_16 = 0;
    } else if (unlikely(__pyx_t_22 >= __pyx_pybuffernd_g_0.diminfo[0].shape)) __pyx_t_16 = 0;
    if (unlikely(__pyx_t_16 != -1)) {
      __Pyx_RaiseBufferIndexError(__pyx_t_16);
      __PYX_ERR(0, 988, __pyx_L1_error)
    }
    __pyx_v_C_00 = (__pyx_v_C_00 + (((*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_b.rcbuffer->pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_b.diminfo[0].strides)) * __pyx_v_bD_0j) + ((*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_b.rcbuffer->pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_b.diminfo[0].strides)) * (*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_g_0.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_g_0.diminfo[0].strides)))));

    /* "vcstring.pyx":989
 *                 bD_tj += b[j] * D_tau[i][j]
 *             C_00 += b[i] * bD_0j + b[i] * g_0[i]
 *             C_tau0 += b[i] * bD_tj + b[i] * g_tau[i]             # <<<<<<<<<<<<<<
 * 
 *         # Calculate <hB(0) hB(0)> - <hB(tau) hB(0)>
 */
    __pyx_t_22 = __pyx_v_i;
    __pyx_t_16 = -1;
    if (__pyx_t_22 < 0) {
      __pyx_t_22 += __pyx_pybuffernd_b.diminfo[0].shape;
      if (unlikely(__pyx_t_22 < 0)) __pyx_t_16 = 0;
    } else if (unlikely(__pyx_t_22 >= __pyx_pybuffernd_b.diminfo[0].shape)) __pyx_t_16 = 0;
    if (unlikely(__pyx_t_16 != -1)) {
      __Pyx_RaiseBufferIndexError(__pyx_t_16);
      __PYX_ERR(0, 989, __pyx_L1_error)
    }
    __pyx_t_21 = __pyx_v_i;
    __pyx_t_16 = -1;
    if (__pyx_t_21 < 0) {
      __pyx_t_21 += __pyx_pybuffernd_b.diminfo[0].shape;
      if (unlikely(__pyx_t_21 < 0)) __pyx_t_16 = 0;
    } else if (unlikely(__pyx_t_21 >= __pyx_pybuffernd_b.diminfo[0].shape)) __pyx_t_16 = 0;
    if (unlikely(__pyx_t_16 != -1)) {
      __Pyx_RaiseBufferIndexError(__pyx_t_16);
      __PYX_ERR(0, 989, __pyx_L1_error)
    }
    __pyx_t_19 = __pyx_v_i;
    __pyx_t_16 = -1;
    if (__pyx_t_19 < 0) {
      __pyx_t_19 += __pyx_pybuffernd_g_tau.diminfo[0].shape;
      if (unlikely(__pyx_t_19 < 0)) __pyx_t_16 = 0;
    } else if (unlikely(__pyx_t_19 >= __pyx_pybuffernd_g_tau.diminfo[0].shape)) __pyx_t_16 = 0;
    if (unlikely(__pyx_t_16 != -1)) {
      __Pyx_RaiseBufferIndexError(__pyx_t_16);
      __PYX_ERR(0, 989, __pyx_L1_error)
    }
    __pyx_v_C_tau0 = (__pyx_v_C_tau0 + (((*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_b.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_b.diminfo[0].strides)) * __pyx_v_bD_tj) + ((*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_b.rcbuffer->pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_b.diminfo[0].strides)) * (*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_g_tau.diminfo[0].strides)))));
  }

  /* "vcstring.pyx":992
 * 
 *         # Calculate <hB(0) hB(0)> - <hB(tau) hB(0)>
 *         Bval_0, Bval_tau = 0.0, 0.0             # <<<<<<<<<<<<<<
 *         for t in range(N-tau):
 *             hB_0, hB_tau = 0.0, 0.0
 */
  __pyx_t_12 = 0.0;
  __pyx_t_11 = 0.0;
  __pyx_v_Bval_0 = __pyx_t_12;
  __pyx_v_Bval_tau = __pyx_t_11;

  /* "vcstring.pyx":993
 *         # Calculate <hB(0) hB(0)> - <hB(tau) hB(0)>
 *         Bval_0, Bval_tau = 0.0, 0.0
 *         for t in range(N-tau):             # <<<<<<<<<<<<<<
 *             hB_0, hB_tau = 0.0, 0.0
 *             x_t = x[t]
 */
  __pyx_t_6 = (__pyx_v_N - __pyx_v_tau);
  __pyx_t_14 = __pyx_t_6;
  for (__pyx_t_15 = 0; __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
    __pyx_v_t = __pyx_t_15;

    /* "vcstring.pyx":994
 *         Bval_0, Bval_tau = 0.0, 0.0
 *         for t in range(N-tau):
 *             hB_0, hB_tau = 0.0, 0.0             # <<<<<<<<<<<<<<
 *             x_t = x[t]
 *             x_tau = x[t + tau]
 */
    __pyx_t_11 = 0.0;
    __pyx_t_12 = 0.0;
    __pyx_v_hB_0 = __pyx_t_11;
    __pyx_v_hB_tau = __pyx_t_12;

    /* "vcstring.pyx":995
 *         for t in range(N-tau):
 *             hB_0, hB_tau = 0.0, 0.0
 *             x_t = x[t]             # <<<<<<<<<<<<<<
 *             x_tau = x[t + tau]
 *             if self.state_assignment != '1d':  # If system is 2-dimensional or higher
 */
    __pyx_t_4 = __Pyx_GetItemInt_List(__pyx_v_x, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 995, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_XDECREF_SET(__pyx_v_x_t, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "vcstring.pyx":996
 *             hB_0, hB_tau = 0.0, 0.0
 *             x_t = x[t]
 *             x_tau = x[t + tau]             # <<<<<<<<<<<<<<
 *             if self.state_assignment != '1d':  # If system is 2-dimensional or higher
 *                 y_t = y[t]
 */
    __pyx_t_16 = (__pyx_v_t + __pyx_v_tau);
    __pyx_t_4 = __Pyx_GetItemInt_List(__pyx_v_x, __pyx_t_16, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 996, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_XDECREF_SET(__pyx_v_x_tau, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "vcstring.pyx":997
 *             x_t = x[t]
 *             x_tau = x[t + tau]
 *             if self.state_assignment != '1d':  # If system is 2-dimensional or higher             # <<<<<<<<<<<<<<
 *                 y_t = y[t]
 *                 y_tau = y[t + tau]
 */
    __pyx_t_8 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_kp_u_1d, Py_NE)); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 997, __pyx_L1_error)
    __pyx_t_9 = (__pyx_t_8 != 0);
    if (__pyx_t_9) {

      /* "vcstring.pyx":998
 *             x_tau = x[t + tau]
 *             if self.state_assignment != '1d':  # If system is 2-dimensional or higher
 *                 y_t = y[t]             # <<<<<<<<<<<<<<
 *                 y_tau = y[t + tau]
 * 
 */
      if (unlikely(!__pyx_v_y)) { __Pyx_RaiseUnboundLocalError("y"); __PYX_ERR(0, 998, __pyx_L1_error) }
      __pyx_t_4 = __Pyx_GetItemInt_List(__pyx_v_y, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 998, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_XDECREF_SET(__pyx_v_y_t, __pyx_t_4);
      __pyx_t_4 = 0;

      /* "vcstring.pyx":999
 *             if self.state_assignment != '1d':  # If system is 2-dimensional or higher
 *                 y_t = y[t]
 *                 y_tau = y[t + tau]             # <<<<<<<<<<<<<<
 * 
 *             if self.state_assignment == '1d':
 */
      if (unlikely(!__pyx_v_y)) { __Pyx_RaiseUnboundLocalError("y"); __PYX_ERR(0, 999, __pyx_L1_error) }
      __pyx_t_16 = (__pyx_v_t + __pyx_v_tau);
      __pyx_t_4 = __Pyx_GetItemInt_List(__pyx_v_y, __pyx_t_16, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 999, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_XDECREF_SET(__pyx_v_y_tau, __pyx_t_4);
      __pyx_t_4 = 0;

      /* "vcstring.pyx":997
 *             x_t = x[t]
 *             x_tau = x[t + tau]
 *             if self.state_assignment != '1d':  # If system is 2-dimensional or higher             # <<<<<<<<<<<<<<
 *                 y_t = y[t]
 *                 y_tau = y[t + tau]
 */
    }

    /* "vcstring.pyx":1001
 *                 y_tau = y[t + tau]
 * 
 *             if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                 if x_t > self.cut_B:
 *                     hB_0 = 1.0
 */
    __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_kp_u_1d, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 1001, __pyx_L1_error)
    __pyx_t_8 = (__pyx_t_9 != 0);
    if (__pyx_t_8) {

      /* "vcstring.pyx":1002
 * 
 *             if self.state_assignment == '1d':
 *                 if x_t > self.cut_B:             # <<<<<<<<<<<<<<
 *                     hB_0 = 1.0
 *                 if x_tau > self.cut_B:
 */
      __pyx_t_4 = PyFloat_FromDouble(__pyx_v_self->cut_B); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1002, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_1 = PyObject_RichCompare(__pyx_v_x_t, __pyx_t_4, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1002, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 1002, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_8) {

        /* "vcstring.pyx":1003
 *             if self.state_assignment == '1d':
 *                 if x_t > self.cut_B:
 *                     hB_0 = 1.0             # <<<<<<<<<<<<<<
 *                 if x_tau > self.cut_B:
 *                     hB_tau = 1.0
 */
        __pyx_v_hB_0 = 1.0;

        /* "vcstring.pyx":1002
 * 
 *             if self.state_assignment == '1d':
 *                 if x_t > self.cut_B:             # <<<<<<<<<<<<<<
 *                     hB_0 = 1.0
 *                 if x_tau > self.cut_B:
 */
      }

      /* "vcstring.pyx":1004
 *                 if x_t > self.cut_B:
 *                     hB_0 = 1.0
 *                 if x_tau > self.cut_B:             # <<<<<<<<<<<<<<
 *                     hB_tau = 1.0
 * 
 */
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_self->cut_B); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1004, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_x_tau, __pyx_t_1, Py_GT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1004, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 1004, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_8) {

        /* "vcstring.pyx":1005
 *                     hB_0 = 1.0
 *                 if x_tau > self.cut_B:
 *                     hB_tau = 1.0             # <<<<<<<<<<<<<<
 * 
 *             elif self.state_assignment == 'orthogonal_projection':
 */
        __pyx_v_hB_tau = 1.0;

        /* "vcstring.pyx":1004
 *                 if x_t > self.cut_B:
 *                     hB_0 = 1.0
 *                 if x_tau > self.cut_B:             # <<<<<<<<<<<<<<
 *                     hB_tau = 1.0
 * 
 */
      }

      /* "vcstring.pyx":1001
 *                 y_tau = y[t + tau]
 * 
 *             if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                 if x_t > self.cut_B:
 *                     hB_0 = 1.0
 */
      goto __pyx_L26;
    }

    /* "vcstring.pyx":1007
 *                     hB_tau = 1.0
 * 
 *             elif self.state_assignment == 'orthogonal_projection':             # <<<<<<<<<<<<<<
 *                 u_t = (y_t * tan(self.theta) + x_t) / (tan(self.theta)**2 + 1)
 *                 u_tau = (y_tau * tan(self.theta) + x_tau) / (tan(self.theta)**2 + 1)
 */
    __pyx_t_8 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_n_u_orthogonal_projection, Py_EQ)); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 1007, __pyx_L1_error)
    __pyx_t_9 = (__pyx_t_8 != 0);
    if (__pyx_t_9) {

      /* "vcstring.pyx":1008
 * 
 *             elif self.state_assignment == 'orthogonal_projection':
 *                 u_t = (y_t * tan(self.theta) + x_t) / (tan(self.theta)**2 + 1)             # <<<<<<<<<<<<<<
 *                 u_tau = (y_tau * tan(self.theta) + x_tau) / (tan(self.theta)**2 + 1)
 *                 if u_t > xb:
 */
      if (unlikely(!__pyx_v_y_t)) { __Pyx_RaiseUnboundLocalError("y_t"); __PYX_ERR(0, 1008, __pyx_L1_error) }
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_tan); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1008, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1008, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_2 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_2)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_2);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
        }
      }
      __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_2, __pyx_t_7) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_7);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1008, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = PyNumber_Multiply(__pyx_v_y_t, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1008, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyNumber_Add(__pyx_t_1, __pyx_v_x_t); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1008, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_tan); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1008, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1008, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_3 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
        __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_7);
        if (likely(__pyx_t_3)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_7, function);
        }
      }
      __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_2);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1008, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = PyNumber_Power(__pyx_t_1, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1008, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyInt_AddObjC(__pyx_t_7, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1008, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = __Pyx_PyNumber_Divide(__pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1008, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_7); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1008, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_v_u_t = __pyx_t_12;

      /* "vcstring.pyx":1009
 *             elif self.state_assignment == 'orthogonal_projection':
 *                 u_t = (y_t * tan(self.theta) + x_t) / (tan(self.theta)**2 + 1)
 *                 u_tau = (y_tau * tan(self.theta) + x_tau) / (tan(self.theta)**2 + 1)             # <<<<<<<<<<<<<<
 *                 if u_t > xb:
 *                     hB_0 = 1.0
 */
      if (unlikely(!__pyx_v_y_tau)) { __Pyx_RaiseUnboundLocalError("y_tau"); __PYX_ERR(0, 1009, __pyx_L1_error) }
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_tan); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1009, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1009, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_2 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_2)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_2);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
        }
      }
      __pyx_t_7 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_4);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1009, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = PyNumber_Multiply(__pyx_v_y_tau, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1009, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = PyNumber_Add(__pyx_t_1, __pyx_v_x_tau); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1009, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_tan); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1009, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1009, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_3 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_3)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
        }
      }
      __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_2);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1009, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyNumber_Power(__pyx_t_1, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1009, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyInt_AddObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1009, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyNumber_Divide(__pyx_t_7, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1009, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1009, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_v_u_tau = __pyx_t_12;

      /* "vcstring.pyx":1010
 *                 u_t = (y_t * tan(self.theta) + x_t) / (tan(self.theta)**2 + 1)
 *                 u_tau = (y_tau * tan(self.theta) + x_tau) / (tan(self.theta)**2 + 1)
 *                 if u_t > xb:             # <<<<<<<<<<<<<<
 *                     hB_0 = 1.0
 *                 if u_tau > xb:
 */
      __pyx_t_9 = ((__pyx_v_u_t > __pyx_v_xb) != 0);
      if (__pyx_t_9) {

        /* "vcstring.pyx":1011
 *                 u_tau = (y_tau * tan(self.theta) + x_tau) / (tan(self.theta)**2 + 1)
 *                 if u_t > xb:
 *                     hB_0 = 1.0             # <<<<<<<<<<<<<<
 *                 if u_tau > xb:
 *                     hB_tau = 1.0
 */
        __pyx_v_hB_0 = 1.0;

        /* "vcstring.pyx":1010
 *                 u_t = (y_t * tan(self.theta) + x_t) / (tan(self.theta)**2 + 1)
 *                 u_tau = (y_tau * tan(self.theta) + x_tau) / (tan(self.theta)**2 + 1)
 *                 if u_t > xb:             # <<<<<<<<<<<<<<
 *                     hB_0 = 1.0
 *                 if u_tau > xb:
 */
      }

      /* "vcstring.pyx":1012
 *                 if u_t > xb:
 *                     hB_0 = 1.0
 *                 if u_tau > xb:             # <<<<<<<<<<<<<<
 *                     hB_tau = 1.0
 *             elif self.state_assignment == 'ellipse':
 */
      __pyx_t_9 = ((__pyx_v_u_tau > __pyx_v_xb) != 0);
      if (__pyx_t_9) {

        /* "vcstring.pyx":1013
 *                     hB_0 = 1.0
 *                 if u_tau > xb:
 *                     hB_tau = 1.0             # <<<<<<<<<<<<<<
 *             elif self.state_assignment == 'ellipse':
 *                 ell_tB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_t, y_t)
 */
        __pyx_v_hB_tau = 1.0;

        /* "vcstring.pyx":1012
 *                 if u_t > xb:
 *                     hB_0 = 1.0
 *                 if u_tau > xb:             # <<<<<<<<<<<<<<
 *                     hB_tau = 1.0
 *             elif self.state_assignment == 'ellipse':
 */
      }

      /* "vcstring.pyx":1007
 *                     hB_tau = 1.0
 * 
 *             elif self.state_assignment == 'orthogonal_projection':             # <<<<<<<<<<<<<<
 *                 u_t = (y_t * tan(self.theta) + x_t) / (tan(self.theta)**2 + 1)
 *                 u_tau = (y_tau * tan(self.theta) + x_tau) / (tan(self.theta)**2 + 1)
 */
      goto __pyx_L26;
    }

    /* "vcstring.pyx":1014
 *                 if u_tau > xb:
 *                     hB_tau = 1.0
 *             elif self.state_assignment == 'ellipse':             # <<<<<<<<<<<<<<
 *                 ell_tB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_t, y_t)
 *                 ell_tauB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_tau, y_tau)
 */
    __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_n_u_ellipse, Py_EQ)); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 1014, __pyx_L1_error)
    __pyx_t_8 = (__pyx_t_9 != 0);
    if (__pyx_t_8) {

      /* "vcstring.pyx":1015
 *                     hB_tau = 1.0
 *             elif self.state_assignment == 'ellipse':
 *                 ell_tB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_t, y_t)             # <<<<<<<<<<<<<<
 *                 ell_tauB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_tau, y_tau)
 *                 if ell_tB <= 1.0:
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_elliptical); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1015, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_self->ra_B); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1015, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_self->rb_B); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1015, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_self->alpha_B); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1015, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_self->x0_B); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1015, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_23 = PyFloat_FromDouble(__pyx_v_self->y0_B); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 1015, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_23);
      if (unlikely(!__pyx_v_y_t)) { __Pyx_RaiseUnboundLocalError("y_t"); __PYX_ERR(0, 1015, __pyx_L1_error) }
      __pyx_t_24 = NULL;
      __pyx_t_16 = 0;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_24 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_24)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_24);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_16 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[8] = {__pyx_t_24, __pyx_t_7, __pyx_t_2, __pyx_t_3, __pyx_t_5, __pyx_t_23, __pyx_v_x_t, __pyx_v_y_t};
        __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_16, 7+__pyx_t_16); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1015, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_24); __pyx_t_24 = 0;
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[8] = {__pyx_t_24, __pyx_t_7, __pyx_t_2, __pyx_t_3, __pyx_t_5, __pyx_t_23, __pyx_v_x_t, __pyx_v_y_t};
        __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_16, 7+__pyx_t_16); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1015, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_24); __pyx_t_24 = 0;
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
      } else
      #endif
      {
        __pyx_t_25 = PyTuple_New(7+__pyx_t_16); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 1015, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_25);
        if (__pyx_t_24) {
          __Pyx_GIVEREF(__pyx_t_24); PyTuple_SET_ITEM(__pyx_t_25, 0, __pyx_t_24); __pyx_t_24 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_7);
        PyTuple_SET_ITEM(__pyx_t_25, 0+__pyx_t_16, __pyx_t_7);
        __Pyx_GIVEREF(__pyx_t_2);
        PyTuple_SET_ITEM(__pyx_t_25, 1+__pyx_t_16, __pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_3);
        PyTuple_SET_ITEM(__pyx_t_25, 2+__pyx_t_16, __pyx_t_3);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_25, 3+__pyx_t_16, __pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_23);
        PyTuple_SET_ITEM(__pyx_t_25, 4+__pyx_t_16, __pyx_t_23);
        __Pyx_INCREF(__pyx_v_x_t);
        __Pyx_GIVEREF(__pyx_v_x_t);
        PyTuple_SET_ITEM(__pyx_t_25, 5+__pyx_t_16, __pyx_v_x_t);
        __Pyx_INCREF(__pyx_v_y_t);
        __Pyx_GIVEREF(__pyx_v_y_t);
        PyTuple_SET_ITEM(__pyx_t_25, 6+__pyx_t_16, __pyx_v_y_t);
        __pyx_t_7 = 0;
        __pyx_t_2 = 0;
        __pyx_t_3 = 0;
        __pyx_t_5 = 0;
        __pyx_t_23 = 0;
        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_25, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1015, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_25); __pyx_t_25 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1015, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_v_ell_tB = __pyx_t_12;

      /* "vcstring.pyx":1016
 *             elif self.state_assignment == 'ellipse':
 *                 ell_tB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_t, y_t)
 *                 ell_tauB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_tau, y_tau)             # <<<<<<<<<<<<<<
 *                 if ell_tB <= 1.0:
 *                     hB_0 = 1.0
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_elliptical); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1016, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_25 = PyFloat_FromDouble(__pyx_v_self->ra_B); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 1016, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_25);
      __pyx_t_23 = PyFloat_FromDouble(__pyx_v_self->rb_B); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 1016, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_23);
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_self->alpha_B); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1016, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_self->x0_B); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1016, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_self->y0_B); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1016, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      if (unlikely(!__pyx_v_y_tau)) { __Pyx_RaiseUnboundLocalError("y_tau"); __PYX_ERR(0, 1016, __pyx_L1_error) }
      __pyx_t_7 = NULL;
      __pyx_t_16 = 0;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_16 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[8] = {__pyx_t_7, __pyx_t_25, __pyx_t_23, __pyx_t_5, __pyx_t_3, __pyx_t_2, __pyx_v_x_tau, __pyx_v_y_tau};
        __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_16, 7+__pyx_t_16); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1016, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_25); __pyx_t_25 = 0;
        __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[8] = {__pyx_t_7, __pyx_t_25, __pyx_t_23, __pyx_t_5, __pyx_t_3, __pyx_t_2, __pyx_v_x_tau, __pyx_v_y_tau};
        __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_16, 7+__pyx_t_16); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1016, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_25); __pyx_t_25 = 0;
        __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      } else
      #endif
      {
        __pyx_t_24 = PyTuple_New(7+__pyx_t_16); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 1016, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_24);
        if (__pyx_t_7) {
          __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_24, 0, __pyx_t_7); __pyx_t_7 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_25);
        PyTuple_SET_ITEM(__pyx_t_24, 0+__pyx_t_16, __pyx_t_25);
        __Pyx_GIVEREF(__pyx_t_23);
        PyTuple_SET_ITEM(__pyx_t_24, 1+__pyx_t_16, __pyx_t_23);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_24, 2+__pyx_t_16, __pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_3);
        PyTuple_SET_ITEM(__pyx_t_24, 3+__pyx_t_16, __pyx_t_3);
        __Pyx_GIVEREF(__pyx_t_2);
        PyTuple_SET_ITEM(__pyx_t_24, 4+__pyx_t_16, __pyx_t_2);
        __Pyx_INCREF(__pyx_v_x_tau);
        __Pyx_GIVEREF(__pyx_v_x_tau);
        PyTuple_SET_ITEM(__pyx_t_24, 5+__pyx_t_16, __pyx_v_x_tau);
        __Pyx_INCREF(__pyx_v_y_tau);
        __Pyx_GIVEREF(__pyx_v_y_tau);
        PyTuple_SET_ITEM(__pyx_t_24, 6+__pyx_t_16, __pyx_v_y_tau);
        __pyx_t_25 = 0;
        __pyx_t_23 = 0;
        __pyx_t_5 = 0;
        __pyx_t_3 = 0;
        __pyx_t_2 = 0;
        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_24, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1016, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1016, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_v_ell_tauB = __pyx_t_12;

      /* "vcstring.pyx":1017
 *                 ell_tB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_t, y_t)
 *                 ell_tauB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_tau, y_tau)
 *                 if ell_tB <= 1.0:             # <<<<<<<<<<<<<<
 *                     hB_0 = 1.0
 *                 if ell_tauB <= 1.0:
 */
      __pyx_t_8 = ((__pyx_v_ell_tB <= 1.0) != 0);
      if (__pyx_t_8) {

        /* "vcstring.pyx":1018
 *                 ell_tauB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_tau, y_tau)
 *                 if ell_tB <= 1.0:
 *                     hB_0 = 1.0             # <<<<<<<<<<<<<<
 *                 if ell_tauB <= 1.0:
 *                     hB_tau = 1.0
 */
        __pyx_v_hB_0 = 1.0;

        /* "vcstring.pyx":1017
 *                 ell_tB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_t, y_t)
 *                 ell_tauB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_tau, y_tau)
 *                 if ell_tB <= 1.0:             # <<<<<<<<<<<<<<
 *                     hB_0 = 1.0
 *                 if ell_tauB <= 1.0:
 */
      }

      /* "vcstring.pyx":1019
 *                 if ell_tB <= 1.0:
 *                     hB_0 = 1.0
 *                 if ell_tauB <= 1.0:             # <<<<<<<<<<<<<<
 *                     hB_tau = 1.0
 *             Bval_0 += hB_0 * hB_0
 */
      __pyx_t_8 = ((__pyx_v_ell_tauB <= 1.0) != 0);
      if (__pyx_t_8) {

        /* "vcstring.pyx":1020
 *                     hB_0 = 1.0
 *                 if ell_tauB <= 1.0:
 *                     hB_tau = 1.0             # <<<<<<<<<<<<<<
 *             Bval_0 += hB_0 * hB_0
 *             Bval_tau += hB_tau * hB_0
 */
        __pyx_v_hB_tau = 1.0;

        /* "vcstring.pyx":1019
 *                 if ell_tB <= 1.0:
 *                     hB_0 = 1.0
 *                 if ell_tauB <= 1.0:             # <<<<<<<<<<<<<<
 *                     hB_tau = 1.0
 *             Bval_0 += hB_0 * hB_0
 */
      }

      /* "vcstring.pyx":1014
 *                 if u_tau > xb:
 *                     hB_tau = 1.0
 *             elif self.state_assignment == 'ellipse':             # <<<<<<<<<<<<<<
 *                 ell_tB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_t, y_t)
 *                 ell_tauB = elliptical(self.ra_B, self.rb_B, self.alpha_B, self.x0_B, self.y0_B, x_tau, y_tau)
 */
    }
    __pyx_L26:;

    /* "vcstring.pyx":1021
 *                 if ell_tauB <= 1.0:
 *                     hB_tau = 1.0
 *             Bval_0 += hB_0 * hB_0             # <<<<<<<<<<<<<<
 *             Bval_tau += hB_tau * hB_0
 *         Bval_0 = Bval_0 / (N - tau)
 */
    __pyx_v_Bval_0 = (__pyx_v_Bval_0 + (__pyx_v_hB_0 * __pyx_v_hB_0));

    /* "vcstring.pyx":1022
 *                     hB_tau = 1.0
 *             Bval_0 += hB_0 * hB_0
 *             Bval_tau += hB_tau * hB_0             # <<<<<<<<<<<<<<
 *         Bval_0 = Bval_0 / (N - tau)
 *         Bval_tau = Bval_tau / (N - tau)
 */
    __pyx_v_Bval_tau = (__pyx_v_Bval_tau + (__pyx_v_hB_tau * __pyx_v_hB_0));
  }

  /* "vcstring.pyx":1023
 *             Bval_0 += hB_0 * hB_0
 *             Bval_tau += hB_tau * hB_0
 *         Bval_0 = Bval_0 / (N - tau)             # <<<<<<<<<<<<<<
 *         Bval_tau = Bval_tau / (N - tau)
 *         Bval = (Bval_0 - Bval_tau)
 */
  __pyx_t_6 = (__pyx_v_N - __pyx_v_tau);
  if (unlikely(__pyx_t_6 == 0)) {
    PyErr_SetString(PyExc_ZeroDivisionError, "float division");
    __PYX_ERR(0, 1023, __pyx_L1_error)
  }
  __pyx_v_Bval_0 = (__pyx_v_Bval_0 / ((double)__pyx_t_6));

  /* "vcstring.pyx":1024
 *             Bval_tau += hB_tau * hB_0
 *         Bval_0 = Bval_0 / (N - tau)
 *         Bval_tau = Bval_tau / (N - tau)             # <<<<<<<<<<<<<<
 *         Bval = (Bval_0 - Bval_tau)
 *         C = C_00 - C_tau0 + Bval
 */
  __pyx_t_6 = (__pyx_v_N - __pyx_v_tau);
  if (unlikely(__pyx_t_6 == 0)) {
    PyErr_SetString(PyExc_ZeroDivisionError, "float division");
    __PYX_ERR(0, 1024, __pyx_L1_error)
  }
  __pyx_v_Bval_tau = (__pyx_v_Bval_tau / ((double)__pyx_t_6));

  /* "vcstring.pyx":1025
 *         Bval_0 = Bval_0 / (N - tau)
 *         Bval_tau = Bval_tau / (N - tau)
 *         Bval = (Bval_0 - Bval_tau)             # <<<<<<<<<<<<<<
 *         C = C_00 - C_tau0 + Bval
 * 
 */
  __pyx_v_Bval = (__pyx_v_Bval_0 - __pyx_v_Bval_tau);

  /* "vcstring.pyx":1026
 *         Bval_tau = Bval_tau / (N - tau)
 *         Bval = (Bval_0 - Bval_tau)
 *         C = C_00 - C_tau0 + Bval             # <<<<<<<<<<<<<<
 * 
 *         print('Corr =', C)
 */
  __pyx_v_C = ((__pyx_v_C_00 - __pyx_v_C_tau0) + __pyx_v_Bval);

  /* "vcstring.pyx":1028
 *         C = C_00 - C_tau0 + Bval
 * 
 *         print('Corr =', C)             # <<<<<<<<<<<<<<
 *         sys.stdout.flush()
 * 
 */
  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_C); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1028, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1028, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_Corr);
  __Pyx_GIVEREF(__pyx_kp_u_Corr);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Corr);
  __Pyx_GIVEREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1028, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "vcstring.pyx":1029
 * 
 *         print('Corr =', C)
 *         sys.stdout.flush()             # <<<<<<<<<<<<<<
 * 
 *         return C
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sys); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1029, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_24 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_stdout); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 1029, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_24);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_24, __pyx_n_s_flush); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1029, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
  __pyx_t_24 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_24 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_24)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_24);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_4 = (__pyx_t_24) ? __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_24) : __Pyx_PyObject_CallNoArg(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_24); __pyx_t_24 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1029, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "vcstring.pyx":1031
 *         sys.stdout.flush()
 * 
 *         return C             # <<<<<<<<<<<<<<
 * 
 *     cpdef calc_corr_q2(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=1] b, np.ndarray[DTYPE_t, ndim=2] ids):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_C); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1031, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  /* "vcstring.pyx":959
 * 
 * 
 *     cpdef calc_corr(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=1] b, np.ndarray[DTYPE_t, ndim=2] D_0, np.ndarray[DTYPE_t, ndim=2] D_tau, np.ndarray[DTYPE_t, ndim=1] g_0, np.ndarray[DTYPE_t, ndim=1] g_tau):             # <<<<<<<<<<<<<<
 *         """Get correlation function as a function of sigma.
 *         <r(0)r(0) - r(0)r(t)> = b.T[D(0)-D(tau)]b + [g(0)-g(tau)]b + <hB(0)hB(0)> - <hB(tau)hB(0)>,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_23);
  __Pyx_XDECREF(__pyx_t_24);
  __Pyx_XDECREF(__pyx_t_25);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_corr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XDECREF(__pyx_v_x);
  __Pyx_XDECREF(__pyx_v_y);
  __Pyx_XDECREF(__pyx_v_x_t);
  __Pyx_XDECREF(__pyx_v_x_tau);
  __Pyx_XDECREF(__pyx_v_y_t);
  __Pyx_XDECREF(__pyx_v_y_tau);
  __Pyx_XDECREF(__pyx_8genexpr8__pyx_v_row);
  __Pyx_XDECREF(__pyx_8genexpr9__pyx_v_row);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_23calc_corr(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8vcstring_8vcstring_22calc_corr[] = "Get correlation function as a function of sigma.\n        <r(0)r(0) - r(0)r(t)> = b.T[D(0)-D(tau)]b + [g(0)-g(tau)]b + <hB(0)hB(0)> - <hB(tau)hB(0)>,\n        where D is an NxN matrix, b is a column vector, and b.T and g are row vectors.\n        ";
static PyObject *__pyx_pw_8vcstring_8vcstring_23calc_corr(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_traj = 0;
  int __pyx_v_tau;
  PyArrayObject *__pyx_v_b = 0;
  PyArrayObject *__pyx_v_D_0 = 0;
  PyArrayObject *__pyx_v_D_tau = 0;
  PyArrayObject *__pyx_v_g_0 = 0;
  PyArrayObject *__pyx_v_g_tau = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("calc_corr (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_traj,&__pyx_n_s_tau,&__pyx_n_s_b_2,&__pyx_n_s_D_0_2,&__pyx_n_s_D_tau_2,&__pyx_n_s_g_0_2,&__pyx_n_s_g_tau_2,0};
    PyObject* values[7] = {0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_traj)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tau)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_corr", 1, 7, 7, 1); __PYX_ERR(0, 959, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_b_2)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_corr", 1, 7, 7, 2); __PYX_ERR(0, 959, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_D_0_2)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_corr", 1, 7, 7, 3); __PYX_ERR(0, 959, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_D_tau_2)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_corr", 1, 7, 7, 4); __PYX_ERR(0, 959, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_g_0_2)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_corr", 1, 7, 7, 5); __PYX_ERR(0, 959, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_g_tau_2)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_corr", 1, 7, 7, 6); __PYX_ERR(0, 959, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "calc_corr") < 0)) __PYX_ERR(0, 959, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 7) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
      values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
      values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
      values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
    }
    __pyx_v_traj = ((PyObject*)values[0]);
    __pyx_v_tau = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_tau == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 959, __pyx_L3_error)
    __pyx_v_b = ((PyArrayObject *)values[2]);
    __pyx_v_D_0 = ((PyArrayObject *)values[3]);
    __pyx_v_D_tau = ((PyArrayObject *)values[4]);
    __pyx_v_g_0 = ((PyArrayObject *)values[5]);
    __pyx_v_g_tau = ((PyArrayObject *)values[6]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("calc_corr", 1, 7, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 959, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.vcstring.calc_corr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_traj), (&PyList_Type), 1, "traj", 1))) __PYX_ERR(0, 959, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_b), __pyx_ptype_5numpy_ndarray, 1, "b", 0))) __PYX_ERR(0, 959, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_D_0), __pyx_ptype_5numpy_ndarray, 1, "D_0", 0))) __PYX_ERR(0, 959, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_D_tau), __pyx_ptype_5numpy_ndarray, 1, "D_tau", 0))) __PYX_ERR(0, 959, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_g_0), __pyx_ptype_5numpy_ndarray, 1, "g_0", 0))) __PYX_ERR(0, 959, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_g_tau), __pyx_ptype_5numpy_ndarray, 1, "g_tau", 0))) __PYX_ERR(0, 959, __pyx_L1_error)
  __pyx_r = __pyx_pf_8vcstring_8vcstring_22calc_corr(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self), __pyx_v_traj, __pyx_v_tau, __pyx_v_b, __pyx_v_D_0, __pyx_v_D_tau, __pyx_v_g_0, __pyx_v_g_tau);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_22calc_corr(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_b, PyArrayObject *__pyx_v_D_0, PyArrayObject *__pyx_v_D_tau, PyArrayObject *__pyx_v_g_0, PyArrayObject *__pyx_v_g_tau) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_0;
  __Pyx_Buffer __pyx_pybuffer_D_0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_tau;
  __Pyx_Buffer __pyx_pybuffer_D_tau;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_0;
  __Pyx_Buffer __pyx_pybuffer_g_0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_tau;
  __Pyx_Buffer __pyx_pybuffer_g_tau;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_corr", 0);
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  __pyx_pybuffer_D_0.pybuffer.buf = NULL;
  __pyx_pybuffer_D_0.refcount = 0;
  __pyx_pybuffernd_D_0.data = NULL;
  __pyx_pybuffernd_D_0.rcbuffer = &__pyx_pybuffer_D_0;
  __pyx_pybuffer_D_tau.pybuffer.buf = NULL;
  __pyx_pybuffer_D_tau.refcount = 0;
  __pyx_pybuffernd_D_tau.data = NULL;
  __pyx_pybuffernd_D_tau.rcbuffer = &__pyx_pybuffer_D_tau;
  __pyx_pybuffer_g_0.pybuffer.buf = NULL;
  __pyx_pybuffer_g_0.refcount = 0;
  __pyx_pybuffernd_g_0.data = NULL;
  __pyx_pybuffernd_g_0.rcbuffer = &__pyx_pybuffer_g_0;
  __pyx_pybuffer_g_tau.pybuffer.buf = NULL;
  __pyx_pybuffer_g_tau.refcount = 0;
  __pyx_pybuffernd_g_tau.data = NULL;
  __pyx_pybuffernd_g_tau.rcbuffer = &__pyx_pybuffer_g_tau;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 959, __pyx_L1_error)
  }
  __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 959, __pyx_L1_error)
  }
  __pyx_pybuffernd_D_0.diminfo[0].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0.diminfo[0].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0.diminfo[1].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0.diminfo[1].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 959, __pyx_L1_error)
  }
  __pyx_pybuffernd_D_tau.diminfo[0].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau.diminfo[0].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau.diminfo[1].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau.diminfo[1].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 959, __pyx_L1_error)
  }
  __pyx_pybuffernd_g_0.diminfo[0].strides = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_0.diminfo[0].shape = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 959, __pyx_L1_error)
  }
  __pyx_pybuffernd_g_tau.diminfo[0].strides = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_tau.diminfo[0].shape = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.shape[0];
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __pyx_f_8vcstring_8vcstring_calc_corr(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, __pyx_v_b, __pyx_v_D_0, __pyx_v_D_tau, __pyx_v_g_0, __pyx_v_g_tau, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 959, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_corr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":1033
 *         return C
 * 
 *     cpdef calc_corr_q2(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=1] b, np.ndarray[DTYPE_t, ndim=2] ids):             # <<<<<<<<<<<<<<
 *         """
 *         Compute correlation function using committor at time t and t+tau, <[q(tau)-q(0)] ** 2>.
 */

static PyObject *__pyx_pw_8vcstring_8vcstring_25calc_corr_q2(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_corr_q2(CYTHON_UNUSED struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_b, PyArrayObject *__pyx_v_ids, int __pyx_skip_dispatch) {
  PyObject *__pyx_v_x = 0;
  int __pyx_v_N;
  int __pyx_v_t;
  int __pyx_v_id_vor_t;
  int __pyx_v_id_vor_tau;
  double __pyx_v_q_t;
  double __pyx_v_q_tau;
  double __pyx_v_C;
  PyObject *__pyx_9genexpr10__pyx_v_row = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ids;
  __Pyx_Buffer __pyx_pybuffer_ids;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  int __pyx_t_9;
  int __pyx_t_10;
  int __pyx_t_11;
  int __pyx_t_12;
  int __pyx_t_13;
  Py_ssize_t __pyx_t_14;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_corr_q2", 0);
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  __pyx_pybuffer_ids.pybuffer.buf = NULL;
  __pyx_pybuffer_ids.refcount = 0;
  __pyx_pybuffernd_ids.data = NULL;
  __pyx_pybuffernd_ids.rcbuffer = &__pyx_pybuffer_ids;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1033, __pyx_L1_error)
  }
  __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1033, __pyx_L1_error)
  }
  __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_calc_corr_q2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1033, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_8vcstring_8vcstring_25calc_corr_q2)) {
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1033, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
        __pyx_t_6 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
          __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
          if (likely(__pyx_t_5)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
            __Pyx_INCREF(__pyx_t_5);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_4, function);
            __pyx_t_6 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[5] = {__pyx_t_5, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_b), ((PyObject *)__pyx_v_ids)};
          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1033, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[5] = {__pyx_t_5, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_b), ((PyObject *)__pyx_v_ids)};
          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1033, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        } else
        #endif
        {
          __pyx_t_7 = PyTuple_New(4+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1033, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          if (__pyx_t_5) {
            __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
          }
          __Pyx_INCREF(__pyx_v_traj);
          __Pyx_GIVEREF(__pyx_v_traj);
          PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_traj);
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_t_3);
          __Pyx_INCREF(((PyObject *)__pyx_v_b));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
          PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_6, ((PyObject *)__pyx_v_b));
          __Pyx_INCREF(((PyObject *)__pyx_v_ids));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_ids));
          PyTuple_SET_ITEM(__pyx_t_7, 3+__pyx_t_6, ((PyObject *)__pyx_v_ids));
          __pyx_t_3 = 0;
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1033, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        }
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }

  /* "vcstring.pyx":1041
 *         cdef double x_t, y_t, x_tau, y_tau, q_t, q_tau, dq, C
 * 
 *         x = [row[1] for row in traj]             # <<<<<<<<<<<<<<
 *         # if self.state_assignment != '1d':
 *         #     y = [row[2] for row in traj]
 */
  { /* enter inner scope */
    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1041, __pyx_L5_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (unlikely(__pyx_v_traj == Py_None)) {
      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
      __PYX_ERR(0, 1041, __pyx_L5_error)
    }
    __pyx_t_2 = __pyx_v_traj; __Pyx_INCREF(__pyx_t_2); __pyx_t_8 = 0;
    for (;;) {
      if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_2)) break;
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      __pyx_t_4 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 1041, __pyx_L5_error)
      #else
      __pyx_t_4 = PySequence_ITEM(__pyx_t_2, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1041, __pyx_L5_error)
      __Pyx_GOTREF(__pyx_t_4);
      #endif
      __Pyx_XDECREF_SET(__pyx_9genexpr10__pyx_v_row, __pyx_t_4);
      __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_GetItemInt(__pyx_9genexpr10__pyx_v_row, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1041, __pyx_L5_error)
      __Pyx_GOTREF(__pyx_t_4);
      if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_4))) __PYX_ERR(0, 1041, __pyx_L5_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_9genexpr10__pyx_v_row); __pyx_9genexpr10__pyx_v_row = 0;
    goto __pyx_L8_exit_scope;
    __pyx_L5_error:;
    __Pyx_XDECREF(__pyx_9genexpr10__pyx_v_row); __pyx_9genexpr10__pyx_v_row = 0;
    goto __pyx_L1_error;
    __pyx_L8_exit_scope:;
  } /* exit inner scope */
  __pyx_v_x = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":1044
 *         # if self.state_assignment != '1d':
 *         #     y = [row[2] for row in traj]
 *         N = len(x)             # <<<<<<<<<<<<<<
 * 
 *         # Calculate correlation function
 */
  __pyx_t_8 = PyList_GET_SIZE(__pyx_v_x); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1044, __pyx_L1_error)
  __pyx_v_N = __pyx_t_8;

  /* "vcstring.pyx":1047
 * 
 *         # Calculate correlation function
 *         print('\n=================================')             # <<<<<<<<<<<<<<
 *         print('CALCULATING CORRELATION FUNCTION')
 *         print('=================================')
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__36, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1047, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1048
 *         # Calculate correlation function
 *         print('\n=================================')
 *         print('CALCULATING CORRELATION FUNCTION')             # <<<<<<<<<<<<<<
 *         print('=================================')
 *         sys.stdout.flush()
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__37, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1048, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1049
 *         print('\n=================================')
 *         print('CALCULATING CORRELATION FUNCTION')
 *         print('=================================')             # <<<<<<<<<<<<<<
 *         sys.stdout.flush()
 *         C = 0.0
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__39, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1049, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1050
 *         print('CALCULATING CORRELATION FUNCTION')
 *         print('=================================')
 *         sys.stdout.flush()             # <<<<<<<<<<<<<<
 *         C = 0.0
 *         for t in range(N-tau):
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_sys); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1050, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_stdout); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1050, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_flush); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1050, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1050, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1051
 *         print('=================================')
 *         sys.stdout.flush()
 *         C = 0.0             # <<<<<<<<<<<<<<
 *         for t in range(N-tau):
 *             if ids[t][0] == 0.0 and ids[t][1] == 0.0:  # State A at time t
 */
  __pyx_v_C = 0.0;

  /* "vcstring.pyx":1052
 *         sys.stdout.flush()
 *         C = 0.0
 *         for t in range(N-tau):             # <<<<<<<<<<<<<<
 *             if ids[t][0] == 0.0 and ids[t][1] == 0.0:  # State A at time t
 *                 q_t = 0.0
 */
  __pyx_t_6 = (__pyx_v_N - __pyx_v_tau);
  __pyx_t_9 = __pyx_t_6;
  for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
    __pyx_v_t = __pyx_t_10;

    /* "vcstring.pyx":1053
 *         C = 0.0
 *         for t in range(N-tau):
 *             if ids[t][0] == 0.0 and ids[t][1] == 0.0:  # State A at time t             # <<<<<<<<<<<<<<
 *                 q_t = 0.0
 *             elif ids[t][1] == 1.0: # State B at time t
 */
    __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1053, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1053, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1053, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 1053, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_12) {
    } else {
      __pyx_t_11 = __pyx_t_12;
      goto __pyx_L12_bool_binop_done;
    }
    __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1053, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1053, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1053, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 1053, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_11 = __pyx_t_12;
    __pyx_L12_bool_binop_done:;
    if (__pyx_t_11) {

      /* "vcstring.pyx":1054
 *         for t in range(N-tau):
 *             if ids[t][0] == 0.0 and ids[t][1] == 0.0:  # State A at time t
 *                 q_t = 0.0             # <<<<<<<<<<<<<<
 *             elif ids[t][1] == 1.0: # State B at time t
 *                 q_t = 1.0
 */
      __pyx_v_q_t = 0.0;

      /* "vcstring.pyx":1053
 *         C = 0.0
 *         for t in range(N-tau):
 *             if ids[t][0] == 0.0 and ids[t][1] == 0.0:  # State A at time t             # <<<<<<<<<<<<<<
 *                 q_t = 0.0
 *             elif ids[t][1] == 1.0: # State B at time t
 */
      goto __pyx_L11;
    }

    /* "vcstring.pyx":1055
 *             if ids[t][0] == 0.0 and ids[t][1] == 0.0:  # State A at time t
 *                 q_t = 0.0
 *             elif ids[t][1] == 1.0: # State B at time t             # <<<<<<<<<<<<<<
 *                 q_t = 1.0
 *             else:                                      # State I at time t
 */
    __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1055, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1055, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_1_0, 1.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1055, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 1055, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_11) {

      /* "vcstring.pyx":1056
 *                 q_t = 0.0
 *             elif ids[t][1] == 1.0: # State B at time t
 *                 q_t = 1.0             # <<<<<<<<<<<<<<
 *             else:                                      # State I at time t
 *                 id_vor_t = int(ids[t][2])              # Check voronoi index at time t
 */
      __pyx_v_q_t = 1.0;

      /* "vcstring.pyx":1055
 *             if ids[t][0] == 0.0 and ids[t][1] == 0.0:  # State A at time t
 *                 q_t = 0.0
 *             elif ids[t][1] == 1.0: # State B at time t             # <<<<<<<<<<<<<<
 *                 q_t = 1.0
 *             else:                                      # State I at time t
 */
      goto __pyx_L11;
    }

    /* "vcstring.pyx":1058
 *                 q_t = 1.0
 *             else:                                      # State I at time t
 *                 id_vor_t = int(ids[t][2])              # Check voronoi index at time t             # <<<<<<<<<<<<<<
 *                 q_t = b[id_vor_t]
 * 
 */
    /*else*/ {
      __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1058, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1058, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyNumber_Int(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1058, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_13 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_13 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1058, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_id_vor_t = __pyx_t_13;

      /* "vcstring.pyx":1059
 *             else:                                      # State I at time t
 *                 id_vor_t = int(ids[t][2])              # Check voronoi index at time t
 *                 q_t = b[id_vor_t]             # <<<<<<<<<<<<<<
 * 
 *             if ids[t+tau][0] == 0.0 and ids[t+tau][1] == 0.0:  # State A at time t + tau
 */
      __pyx_t_14 = __pyx_v_id_vor_t;
      __pyx_t_13 = -1;
      if (__pyx_t_14 < 0) {
        __pyx_t_14 += __pyx_pybuffernd_b.diminfo[0].shape;
        if (unlikely(__pyx_t_14 < 0)) __pyx_t_13 = 0;
      } else if (unlikely(__pyx_t_14 >= __pyx_pybuffernd_b.diminfo[0].shape)) __pyx_t_13 = 0;
      if (unlikely(__pyx_t_13 != -1)) {
        __Pyx_RaiseBufferIndexError(__pyx_t_13);
        __PYX_ERR(0, 1059, __pyx_L1_error)
      }
      __pyx_v_q_t = (*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_b.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_b.diminfo[0].strides));
    }
    __pyx_L11:;

    /* "vcstring.pyx":1061
 *                 q_t = b[id_vor_t]
 * 
 *             if ids[t+tau][0] == 0.0 and ids[t+tau][1] == 0.0:  # State A at time t + tau             # <<<<<<<<<<<<<<
 *                 q_tau = 0.0
 *             elif ids[t+tau][1] == 1.0:                         # State B at time t + tau
 */
    __pyx_t_13 = (__pyx_v_t + __pyx_v_tau);
    __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_t_13, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1061, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1061, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1061, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 1061, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_12) {
    } else {
      __pyx_t_11 = __pyx_t_12;
      goto __pyx_L15_bool_binop_done;
    }
    __pyx_t_13 = (__pyx_v_t + __pyx_v_tau);
    __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_t_13, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1061, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1061, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1061, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 1061, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_11 = __pyx_t_12;
    __pyx_L15_bool_binop_done:;
    if (__pyx_t_11) {

      /* "vcstring.pyx":1062
 * 
 *             if ids[t+tau][0] == 0.0 and ids[t+tau][1] == 0.0:  # State A at time t + tau
 *                 q_tau = 0.0             # <<<<<<<<<<<<<<
 *             elif ids[t+tau][1] == 1.0:                         # State B at time t + tau
 *                 q_tau = 1.0
 */
      __pyx_v_q_tau = 0.0;

      /* "vcstring.pyx":1061
 *                 q_t = b[id_vor_t]
 * 
 *             if ids[t+tau][0] == 0.0 and ids[t+tau][1] == 0.0:  # State A at time t + tau             # <<<<<<<<<<<<<<
 *                 q_tau = 0.0
 *             elif ids[t+tau][1] == 1.0:                         # State B at time t + tau
 */
      goto __pyx_L14;
    }

    /* "vcstring.pyx":1063
 *             if ids[t+tau][0] == 0.0 and ids[t+tau][1] == 0.0:  # State A at time t + tau
 *                 q_tau = 0.0
 *             elif ids[t+tau][1] == 1.0:                         # State B at time t + tau             # <<<<<<<<<<<<<<
 *                 q_tau = 1.0
 *             else:                                              # State I at time t + tau
 */
    __pyx_t_13 = (__pyx_v_t + __pyx_v_tau);
    __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_t_13, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1063, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1063, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_1_0, 1.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1063, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 1063, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_11) {

      /* "vcstring.pyx":1064
 *                 q_tau = 0.0
 *             elif ids[t+tau][1] == 1.0:                         # State B at time t + tau
 *                 q_tau = 1.0             # <<<<<<<<<<<<<<
 *             else:                                              # State I at time t + tau
 *                 id_vor_tau = int(ids[t+tau][2])                # Check voronoi index at time t + tau
 */
      __pyx_v_q_tau = 1.0;

      /* "vcstring.pyx":1063
 *             if ids[t+tau][0] == 0.0 and ids[t+tau][1] == 0.0:  # State A at time t + tau
 *                 q_tau = 0.0
 *             elif ids[t+tau][1] == 1.0:                         # State B at time t + tau             # <<<<<<<<<<<<<<
 *                 q_tau = 1.0
 *             else:                                              # State I at time t + tau
 */
      goto __pyx_L14;
    }

    /* "vcstring.pyx":1066
 *                 q_tau = 1.0
 *             else:                                              # State I at time t + tau
 *                 id_vor_tau = int(ids[t+tau][2])                # Check voronoi index at time t + tau             # <<<<<<<<<<<<<<
 *                 q_tau = b[id_vor_tau]
 *             C += (q_tau - q_t) ** 2
 */
    /*else*/ {
      __pyx_t_13 = (__pyx_v_t + __pyx_v_tau);
      __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_t_13, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1066, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1066, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyNumber_Int(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1066, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_13 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_13 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1066, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_id_vor_tau = __pyx_t_13;

      /* "vcstring.pyx":1067
 *             else:                                              # State I at time t + tau
 *                 id_vor_tau = int(ids[t+tau][2])                # Check voronoi index at time t + tau
 *                 q_tau = b[id_vor_tau]             # <<<<<<<<<<<<<<
 *             C += (q_tau - q_t) ** 2
 *         C = C / (N - tau)
 */
      __pyx_t_14 = __pyx_v_id_vor_tau;
      __pyx_t_13 = -1;
      if (__pyx_t_14 < 0) {
        __pyx_t_14 += __pyx_pybuffernd_b.diminfo[0].shape;
        if (unlikely(__pyx_t_14 < 0)) __pyx_t_13 = 0;
      } else if (unlikely(__pyx_t_14 >= __pyx_pybuffernd_b.diminfo[0].shape)) __pyx_t_13 = 0;
      if (unlikely(__pyx_t_13 != -1)) {
        __Pyx_RaiseBufferIndexError(__pyx_t_13);
        __PYX_ERR(0, 1067, __pyx_L1_error)
      }
      __pyx_v_q_tau = (*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_b.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_b.diminfo[0].strides));
    }
    __pyx_L14:;

    /* "vcstring.pyx":1068
 *                 id_vor_tau = int(ids[t+tau][2])                # Check voronoi index at time t + tau
 *                 q_tau = b[id_vor_tau]
 *             C += (q_tau - q_t) ** 2             # <<<<<<<<<<<<<<
 *         C = C / (N - tau)
 *         print('Corr =', C)
 */
    __pyx_v_C = (__pyx_v_C + pow((__pyx_v_q_tau - __pyx_v_q_t), 2.0));
  }

  /* "vcstring.pyx":1069
 *                 q_tau = b[id_vor_tau]
 *             C += (q_tau - q_t) ** 2
 *         C = C / (N - tau)             # <<<<<<<<<<<<<<
 *         print('Corr =', C)
 *         sys.stdout.flush()
 */
  __pyx_t_6 = (__pyx_v_N - __pyx_v_tau);
  if (unlikely(__pyx_t_6 == 0)) {
    PyErr_SetString(PyExc_ZeroDivisionError, "float division");
    __PYX_ERR(0, 1069, __pyx_L1_error)
  }
  __pyx_v_C = (__pyx_v_C / ((double)__pyx_t_6));

  /* "vcstring.pyx":1070
 *             C += (q_tau - q_t) ** 2
 *         C = C / (N - tau)
 *         print('Corr =', C)             # <<<<<<<<<<<<<<
 *         sys.stdout.flush()
 * 
 */
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_C); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1070, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1070, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_Corr);
  __Pyx_GIVEREF(__pyx_kp_u_Corr);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_Corr);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1070, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1071
 *         C = C / (N - tau)
 *         print('Corr =', C)
 *         sys.stdout.flush()             # <<<<<<<<<<<<<<
 * 
 *         return C
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_sys); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1071, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_stdout); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1071, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_flush); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1071, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1071, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1073
 *         sys.stdout.flush()
 * 
 *         return C             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_C); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1073, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "vcstring.pyx":1033
 *         return C
 * 
 *     cpdef calc_corr_q2(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=1] b, np.ndarray[DTYPE_t, ndim=2] ids):             # <<<<<<<<<<<<<<
 *         """
 *         Compute correlation function using committor at time t and t+tau, <[q(tau)-q(0)] ** 2>.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_corr_q2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XDECREF(__pyx_v_x);
  __Pyx_XDECREF(__pyx_9genexpr10__pyx_v_row);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_25calc_corr_q2(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8vcstring_8vcstring_24calc_corr_q2[] = "\n        Compute correlation function using committor at time t and t+tau, <[q(tau)-q(0)] ** 2>.\n        ";
static PyObject *__pyx_pw_8vcstring_8vcstring_25calc_corr_q2(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_traj = 0;
  int __pyx_v_tau;
  PyArrayObject *__pyx_v_b = 0;
  PyArrayObject *__pyx_v_ids = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("calc_corr_q2 (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_traj,&__pyx_n_s_tau,&__pyx_n_s_b_2,&__pyx_n_s_ids,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_traj)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tau)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_corr_q2", 1, 4, 4, 1); __PYX_ERR(0, 1033, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_b_2)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_corr_q2", 1, 4, 4, 2); __PYX_ERR(0, 1033, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ids)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_corr_q2", 1, 4, 4, 3); __PYX_ERR(0, 1033, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "calc_corr_q2") < 0)) __PYX_ERR(0, 1033, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
    }
    __pyx_v_traj = ((PyObject*)values[0]);
    __pyx_v_tau = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_tau == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1033, __pyx_L3_error)
    __pyx_v_b = ((PyArrayObject *)values[2]);
    __pyx_v_ids = ((PyArrayObject *)values[3]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("calc_corr_q2", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1033, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.vcstring.calc_corr_q2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_traj), (&PyList_Type), 1, "traj", 1))) __PYX_ERR(0, 1033, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_b), __pyx_ptype_5numpy_ndarray, 1, "b", 0))) __PYX_ERR(0, 1033, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ids), __pyx_ptype_5numpy_ndarray, 1, "ids", 0))) __PYX_ERR(0, 1033, __pyx_L1_error)
  __pyx_r = __pyx_pf_8vcstring_8vcstring_24calc_corr_q2(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self), __pyx_v_traj, __pyx_v_tau, __pyx_v_b, __pyx_v_ids);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_24calc_corr_q2(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_b, PyArrayObject *__pyx_v_ids) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ids;
  __Pyx_Buffer __pyx_pybuffer_ids;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_corr_q2", 0);
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  __pyx_pybuffer_ids.pybuffer.buf = NULL;
  __pyx_pybuffer_ids.refcount = 0;
  __pyx_pybuffernd_ids.data = NULL;
  __pyx_pybuffernd_ids.rcbuffer = &__pyx_pybuffer_ids;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1033, __pyx_L1_error)
  }
  __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1033, __pyx_L1_error)
  }
  __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __pyx_f_8vcstring_8vcstring_calc_corr_q2(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, __pyx_v_b, __pyx_v_ids, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1033, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_corr_q2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":1076
 * 
 * 
 *     cpdef calc_corr_q2_ensemble(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=1] b, np.ndarray[DTYPE_t, ndim=2] ids):             # <<<<<<<<<<<<<<
 *         """
 *         Compute correlation function using committor at time t and t+tau, <[q(tau)-q(0)] ** 2>.
 */

static PyObject *__pyx_pw_8vcstring_8vcstring_27calc_corr_q2_ensemble(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_corr_q2_ensemble(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, CYTHON_UNUSED int __pyx_v_tau, PyArrayObject *__pyx_v_b, PyArrayObject *__pyx_v_ids, int __pyx_skip_dispatch) {
  int __pyx_v_N;
  int __pyx_v_id_vor_t;
  int __pyx_v_id_vor_tau;
  double __pyx_v_q_t;
  double __pyx_v_q_tau;
  double __pyx_v_dq;
  double __pyx_v_weight;
  double __pyx_v_C;
  int __pyx_v_i;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ids;
  __Pyx_Buffer __pyx_pybuffer_ids;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  int __pyx_t_9;
  int __pyx_t_10;
  double __pyx_t_11;
  double __pyx_t_12;
  int __pyx_t_13;
  int __pyx_t_14;
  int __pyx_t_15;
  Py_ssize_t __pyx_t_16;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_corr_q2_ensemble", 0);
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  __pyx_pybuffer_ids.pybuffer.buf = NULL;
  __pyx_pybuffer_ids.refcount = 0;
  __pyx_pybuffernd_ids.data = NULL;
  __pyx_pybuffernd_ids.rcbuffer = &__pyx_pybuffer_ids;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1076, __pyx_L1_error)
  }
  __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1076, __pyx_L1_error)
  }
  __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_calc_corr_q2_ensemble); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1076, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_8vcstring_8vcstring_27calc_corr_q2_ensemble)) {
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1076, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
        __pyx_t_6 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
          __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
          if (likely(__pyx_t_5)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
            __Pyx_INCREF(__pyx_t_5);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_4, function);
            __pyx_t_6 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[5] = {__pyx_t_5, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_b), ((PyObject *)__pyx_v_ids)};
          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1076, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[5] = {__pyx_t_5, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_b), ((PyObject *)__pyx_v_ids)};
          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1076, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        } else
        #endif
        {
          __pyx_t_7 = PyTuple_New(4+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1076, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          if (__pyx_t_5) {
            __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
          }
          __Pyx_INCREF(__pyx_v_traj);
          __Pyx_GIVEREF(__pyx_v_traj);
          PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_traj);
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_t_3);
          __Pyx_INCREF(((PyObject *)__pyx_v_b));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
          PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_6, ((PyObject *)__pyx_v_b));
          __Pyx_INCREF(((PyObject *)__pyx_v_ids));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_ids));
          PyTuple_SET_ITEM(__pyx_t_7, 3+__pyx_t_6, ((PyObject *)__pyx_v_ids));
          __pyx_t_3 = 0;
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1076, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        }
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }

  /* "vcstring.pyx":1084
 *         cdef double x_t, y_t, x_tau, y_tau, q_t, q_tau, dq, weight, C
 * 
 *         print('\n=================================')             # <<<<<<<<<<<<<<
 *         print('CALCULATING CORRELATION FUNCTION')
 *         print('=================================')
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__36, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1084, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1085
 * 
 *         print('\n=================================')
 *         print('CALCULATING CORRELATION FUNCTION')             # <<<<<<<<<<<<<<
 *         print('=================================')
 *         sys.stdout.flush()
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__37, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1085, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1086
 *         print('\n=================================')
 *         print('CALCULATING CORRELATION FUNCTION')
 *         print('=================================')             # <<<<<<<<<<<<<<
 *         sys.stdout.flush()
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__39, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1086, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1087
 *         print('CALCULATING CORRELATION FUNCTION')
 *         print('=================================')
 *         sys.stdout.flush()             # <<<<<<<<<<<<<<
 * 
 *         N = len(traj)  # Number of aggregate trajectories
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_sys); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1087, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_stdout); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1087, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_flush); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1087, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1087, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1089
 *         sys.stdout.flush()
 * 
 *         N = len(traj)  # Number of aggregate trajectories             # <<<<<<<<<<<<<<
 *         dq = 0.0
 *         for i in range(N):
 */
  if (unlikely(__pyx_v_traj == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
    __PYX_ERR(0, 1089, __pyx_L1_error)
  }
  __pyx_t_8 = PyList_GET_SIZE(__pyx_v_traj); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1089, __pyx_L1_error)
  __pyx_v_N = __pyx_t_8;

  /* "vcstring.pyx":1090
 * 
 *         N = len(traj)  # Number of aggregate trajectories
 *         dq = 0.0             # <<<<<<<<<<<<<<
 *         for i in range(N):
 *             q_t, q_tau = 0., 0.
 */
  __pyx_v_dq = 0.0;

  /* "vcstring.pyx":1091
 *         N = len(traj)  # Number of aggregate trajectories
 *         dq = 0.0
 *         for i in range(N):             # <<<<<<<<<<<<<<
 *             q_t, q_tau = 0., 0.
 * 
 */
  __pyx_t_6 = __pyx_v_N;
  __pyx_t_9 = __pyx_t_6;
  for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
    __pyx_v_i = __pyx_t_10;

    /* "vcstring.pyx":1092
 *         dq = 0.0
 *         for i in range(N):
 *             q_t, q_tau = 0., 0.             # <<<<<<<<<<<<<<
 * 
 *             # Calculate q(0) for i-th Trajectory
 */
    __pyx_t_11 = 0.;
    __pyx_t_12 = 0.;
    __pyx_v_q_t = __pyx_t_11;
    __pyx_v_q_tau = __pyx_t_12;

    /* "vcstring.pyx":1095
 * 
 *             # Calculate q(0) for i-th Trajectory
 *             if ids[i][0] == 0.0 and ids[i][1] == 0.0:  # State A             # <<<<<<<<<<<<<<
 *                 q_t = 0.0
 *             elif ids[i][0] == 0.0 and ids[i][1] == 1.0:  # State B
 */
    __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1095, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1095, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1095, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1095, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_14) {
    } else {
      __pyx_t_13 = __pyx_t_14;
      goto __pyx_L6_bool_binop_done;
    }
    __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1095, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1095, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1095, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1095, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_13 = __pyx_t_14;
    __pyx_L6_bool_binop_done:;
    if (__pyx_t_13) {

      /* "vcstring.pyx":1096
 *             # Calculate q(0) for i-th Trajectory
 *             if ids[i][0] == 0.0 and ids[i][1] == 0.0:  # State A
 *                 q_t = 0.0             # <<<<<<<<<<<<<<
 *             elif ids[i][0] == 0.0 and ids[i][1] == 1.0:  # State B
 *                 q_t = 1.0
 */
      __pyx_v_q_t = 0.0;

      /* "vcstring.pyx":1095
 * 
 *             # Calculate q(0) for i-th Trajectory
 *             if ids[i][0] == 0.0 and ids[i][1] == 0.0:  # State A             # <<<<<<<<<<<<<<
 *                 q_t = 0.0
 *             elif ids[i][0] == 0.0 and ids[i][1] == 1.0:  # State B
 */
      goto __pyx_L5;
    }

    /* "vcstring.pyx":1097
 *             if ids[i][0] == 0.0 and ids[i][1] == 0.0:  # State A
 *                 q_t = 0.0
 *             elif ids[i][0] == 0.0 and ids[i][1] == 1.0:  # State B             # <<<<<<<<<<<<<<
 *                 q_t = 1.0
 *             else:                                      # State I
 */
    __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1097, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1097, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1097, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1097, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_14) {
    } else {
      __pyx_t_13 = __pyx_t_14;
      goto __pyx_L8_bool_binop_done;
    }
    __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1097, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1097, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_1_0, 1.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1097, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1097, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_13 = __pyx_t_14;
    __pyx_L8_bool_binop_done:;
    if (__pyx_t_13) {

      /* "vcstring.pyx":1098
 *                 q_t = 0.0
 *             elif ids[i][0] == 0.0 and ids[i][1] == 1.0:  # State B
 *                 q_t = 1.0             # <<<<<<<<<<<<<<
 *             else:                                      # State I
 *                 id_vor_t = int(ids[i][4])              # Check Voronoi index for Traj i
 */
      __pyx_v_q_t = 1.0;

      /* "vcstring.pyx":1097
 *             if ids[i][0] == 0.0 and ids[i][1] == 0.0:  # State A
 *                 q_t = 0.0
 *             elif ids[i][0] == 0.0 and ids[i][1] == 1.0:  # State B             # <<<<<<<<<<<<<<
 *                 q_t = 1.0
 *             else:                                      # State I
 */
      goto __pyx_L5;
    }

    /* "vcstring.pyx":1100
 *                 q_t = 1.0
 *             else:                                      # State I
 *                 id_vor_t = int(ids[i][4])              # Check Voronoi index for Traj i             # <<<<<<<<<<<<<<
 *                 q_t = b[id_vor_t]
 * 
 */
    /*else*/ {
      __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1100, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1100, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyNumber_Int(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1100, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_15 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_15 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1100, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_id_vor_t = __pyx_t_15;

      /* "vcstring.pyx":1101
 *             else:                                      # State I
 *                 id_vor_t = int(ids[i][4])              # Check Voronoi index for Traj i
 *                 q_t = b[id_vor_t]             # <<<<<<<<<<<<<<
 * 
 *             # Calculate q(tau) for i-th Trajectory
 */
      __pyx_t_16 = __pyx_v_id_vor_t;
      __pyx_t_15 = -1;
      if (__pyx_t_16 < 0) {
        __pyx_t_16 += __pyx_pybuffernd_b.diminfo[0].shape;
        if (unlikely(__pyx_t_16 < 0)) __pyx_t_15 = 0;
      } else if (unlikely(__pyx_t_16 >= __pyx_pybuffernd_b.diminfo[0].shape)) __pyx_t_15 = 0;
      if (unlikely(__pyx_t_15 != -1)) {
        __Pyx_RaiseBufferIndexError(__pyx_t_15);
        __PYX_ERR(0, 1101, __pyx_L1_error)
      }
      __pyx_v_q_t = (*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_b.rcbuffer->pybuffer.buf, __pyx_t_16, __pyx_pybuffernd_b.diminfo[0].strides));
    }
    __pyx_L5:;

    /* "vcstring.pyx":1104
 * 
 *             # Calculate q(tau) for i-th Trajectory
 *             if ids[i][2] == 0.0 and ids[i][3] == 0.0:  # State A             # <<<<<<<<<<<<<<
 *                 q_tau = 0.0
 *             elif ids[i][2] == 0.0 and ids[i][3] == 1.0: # State B
 */
    __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1104, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1104, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1104, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1104, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_14) {
    } else {
      __pyx_t_13 = __pyx_t_14;
      goto __pyx_L11_bool_binop_done;
    }
    __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1104, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1104, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1104, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1104, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_13 = __pyx_t_14;
    __pyx_L11_bool_binop_done:;
    if (__pyx_t_13) {

      /* "vcstring.pyx":1105
 *             # Calculate q(tau) for i-th Trajectory
 *             if ids[i][2] == 0.0 and ids[i][3] == 0.0:  # State A
 *                 q_tau = 0.0             # <<<<<<<<<<<<<<
 *             elif ids[i][2] == 0.0 and ids[i][3] == 1.0: # State B
 *                 q_tau = 1.0
 */
      __pyx_v_q_tau = 0.0;

      /* "vcstring.pyx":1104
 * 
 *             # Calculate q(tau) for i-th Trajectory
 *             if ids[i][2] == 0.0 and ids[i][3] == 0.0:  # State A             # <<<<<<<<<<<<<<
 *                 q_tau = 0.0
 *             elif ids[i][2] == 0.0 and ids[i][3] == 1.0: # State B
 */
      goto __pyx_L10;
    }

    /* "vcstring.pyx":1106
 *             if ids[i][2] == 0.0 and ids[i][3] == 0.0:  # State A
 *                 q_tau = 0.0
 *             elif ids[i][2] == 0.0 and ids[i][3] == 1.0: # State B             # <<<<<<<<<<<<<<
 *                 q_tau = 1.0
 *             else:                                      # State I
 */
    __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1106, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1106, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1106, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1106, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (__pyx_t_14) {
    } else {
      __pyx_t_13 = __pyx_t_14;
      goto __pyx_L13_bool_binop_done;
    }
    __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1106, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1106, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_1_0, 1.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1106, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1106, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_13 = __pyx_t_14;
    __pyx_L13_bool_binop_done:;
    if (__pyx_t_13) {

      /* "vcstring.pyx":1107
 *                 q_tau = 0.0
 *             elif ids[i][2] == 0.0 and ids[i][3] == 1.0: # State B
 *                 q_tau = 1.0             # <<<<<<<<<<<<<<
 *             else:                                      # State I
 *                 id_vor_tau = int(ids[i][5])            # Check Voronoi index for Traj i
 */
      __pyx_v_q_tau = 1.0;

      /* "vcstring.pyx":1106
 *             if ids[i][2] == 0.0 and ids[i][3] == 0.0:  # State A
 *                 q_tau = 0.0
 *             elif ids[i][2] == 0.0 and ids[i][3] == 1.0: # State B             # <<<<<<<<<<<<<<
 *                 q_tau = 1.0
 *             else:                                      # State I
 */
      goto __pyx_L10;
    }

    /* "vcstring.pyx":1109
 *                 q_tau = 1.0
 *             else:                                      # State I
 *                 id_vor_tau = int(ids[i][5])            # Check Voronoi index for Traj i             # <<<<<<<<<<<<<<
 *                 q_tau = b[id_vor_tau]
 * 
 */
    /*else*/ {
      __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1109, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1109, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyNumber_Int(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1109, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_15 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_15 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1109, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_id_vor_tau = __pyx_t_15;

      /* "vcstring.pyx":1110
 *             else:                                      # State I
 *                 id_vor_tau = int(ids[i][5])            # Check Voronoi index for Traj i
 *                 q_tau = b[id_vor_tau]             # <<<<<<<<<<<<<<
 * 
 *             if self.state_assignment == '1d':
 */
      __pyx_t_16 = __pyx_v_id_vor_tau;
      __pyx_t_15 = -1;
      if (__pyx_t_16 < 0) {
        __pyx_t_16 += __pyx_pybuffernd_b.diminfo[0].shape;
        if (unlikely(__pyx_t_16 < 0)) __pyx_t_15 = 0;
      } else if (unlikely(__pyx_t_16 >= __pyx_pybuffernd_b.diminfo[0].shape)) __pyx_t_15 = 0;
      if (unlikely(__pyx_t_15 != -1)) {
        __Pyx_RaiseBufferIndexError(__pyx_t_15);
        __PYX_ERR(0, 1110, __pyx_L1_error)
      }
      __pyx_v_q_tau = (*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_b.rcbuffer->pybuffer.buf, __pyx_t_16, __pyx_pybuffernd_b.diminfo[0].strides));
    }
    __pyx_L10:;

    /* "vcstring.pyx":1112
 *                 q_tau = b[id_vor_tau]
 * 
 *             if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                 weight = ids[i][8]
 *             else:
 */
    __pyx_t_13 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_kp_u_1d, Py_EQ)); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 1112, __pyx_L1_error)
    __pyx_t_14 = (__pyx_t_13 != 0);
    if (__pyx_t_14) {

      /* "vcstring.pyx":1113
 * 
 *             if self.state_assignment == '1d':
 *                 weight = ids[i][8]             # <<<<<<<<<<<<<<
 *             else:
 *                 weight = ids[i][10]
 */
      __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1113, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 8, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1113, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1113, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_v_weight = __pyx_t_12;

      /* "vcstring.pyx":1112
 *                 q_tau = b[id_vor_tau]
 * 
 *             if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                 weight = ids[i][8]
 *             else:
 */
      goto __pyx_L15;
    }

    /* "vcstring.pyx":1115
 *                 weight = ids[i][8]
 *             else:
 *                 weight = ids[i][10]             # <<<<<<<<<<<<<<
 * 
 *             dq += weight * (q_tau - q_t) ** 2
 */
    /*else*/ {
      __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1115, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 10, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1115, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1115, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_weight = __pyx_t_12;
    }
    __pyx_L15:;

    /* "vcstring.pyx":1117
 *                 weight = ids[i][10]
 * 
 *             dq += weight * (q_tau - q_t) ** 2             # <<<<<<<<<<<<<<
 *             # dq += (q_tau - q_t) ** 2
 *         C = dq / N
 */
    __pyx_v_dq = (__pyx_v_dq + (__pyx_v_weight * pow((__pyx_v_q_tau - __pyx_v_q_t), 2.0)));
  }

  /* "vcstring.pyx":1119
 *             dq += weight * (q_tau - q_t) ** 2
 *             # dq += (q_tau - q_t) ** 2
 *         C = dq / N             # <<<<<<<<<<<<<<
 *         # C = dq
 *         print('N =', N)
 */
  if (unlikely(__pyx_v_N == 0)) {
    PyErr_SetString(PyExc_ZeroDivisionError, "float division");
    __PYX_ERR(0, 1119, __pyx_L1_error)
  }
  __pyx_v_C = (__pyx_v_dq / ((double)__pyx_v_N));

  /* "vcstring.pyx":1121
 *         C = dq / N
 *         # C = dq
 *         print('N =', N)             # <<<<<<<<<<<<<<
 *         print('traj shape:', np.shape(traj))
 *         print('Corr =', C)
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_N); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1121, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1121, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_N_2);
  __Pyx_GIVEREF(__pyx_kp_u_N_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_N_2);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1121, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1122
 *         # C = dq
 *         print('N =', N)
 *         print('traj shape:', np.shape(traj))             # <<<<<<<<<<<<<<
 *         print('Corr =', C)
 *         sys.stdout.flush()
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1122, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_shape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1122, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_v_traj) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_traj);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1122, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1122, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_kp_u_traj_shape);
  __Pyx_GIVEREF(__pyx_kp_u_traj_shape);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_traj_shape);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1122, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1123
 *         print('N =', N)
 *         print('traj shape:', np.shape(traj))
 *         print('Corr =', C)             # <<<<<<<<<<<<<<
 *         sys.stdout.flush()
 * 
 */
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_C); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1123, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1123, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_kp_u_Corr);
  __Pyx_GIVEREF(__pyx_kp_u_Corr);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_Corr);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1123, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1124
 *         print('traj shape:', np.shape(traj))
 *         print('Corr =', C)
 *         sys.stdout.flush()             # <<<<<<<<<<<<<<
 * 
 *         return C
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sys); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1124, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_stdout); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1124, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_flush); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1124, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1124, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1126
 *         sys.stdout.flush()
 * 
 *         return C             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_C); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1126, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "vcstring.pyx":1076
 * 
 * 
 *     cpdef calc_corr_q2_ensemble(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=1] b, np.ndarray[DTYPE_t, ndim=2] ids):             # <<<<<<<<<<<<<<
 *         """
 *         Compute correlation function using committor at time t and t+tau, <[q(tau)-q(0)] ** 2>.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_corr_q2_ensemble", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_27calc_corr_q2_ensemble(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8vcstring_8vcstring_26calc_corr_q2_ensemble[] = "\n        Compute correlation function using committor at time t and t+tau, <[q(tau)-q(0)] ** 2>.\n        ";
static PyObject *__pyx_pw_8vcstring_8vcstring_27calc_corr_q2_ensemble(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_traj = 0;
  int __pyx_v_tau;
  PyArrayObject *__pyx_v_b = 0;
  PyArrayObject *__pyx_v_ids = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("calc_corr_q2_ensemble (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_traj,&__pyx_n_s_tau,&__pyx_n_s_b_2,&__pyx_n_s_ids,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_traj)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tau)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_corr_q2_ensemble", 1, 4, 4, 1); __PYX_ERR(0, 1076, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_b_2)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_corr_q2_ensemble", 1, 4, 4, 2); __PYX_ERR(0, 1076, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ids)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_corr_q2_ensemble", 1, 4, 4, 3); __PYX_ERR(0, 1076, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "calc_corr_q2_ensemble") < 0)) __PYX_ERR(0, 1076, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
    }
    __pyx_v_traj = ((PyObject*)values[0]);
    __pyx_v_tau = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_tau == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1076, __pyx_L3_error)
    __pyx_v_b = ((PyArrayObject *)values[2]);
    __pyx_v_ids = ((PyArrayObject *)values[3]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("calc_corr_q2_ensemble", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1076, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.vcstring.calc_corr_q2_ensemble", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_traj), (&PyList_Type), 1, "traj", 1))) __PYX_ERR(0, 1076, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_b), __pyx_ptype_5numpy_ndarray, 1, "b", 0))) __PYX_ERR(0, 1076, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ids), __pyx_ptype_5numpy_ndarray, 1, "ids", 0))) __PYX_ERR(0, 1076, __pyx_L1_error)
  __pyx_r = __pyx_pf_8vcstring_8vcstring_26calc_corr_q2_ensemble(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self), __pyx_v_traj, __pyx_v_tau, __pyx_v_b, __pyx_v_ids);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_26calc_corr_q2_ensemble(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_b, PyArrayObject *__pyx_v_ids) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ids;
  __Pyx_Buffer __pyx_pybuffer_ids;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_corr_q2_ensemble", 0);
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  __pyx_pybuffer_ids.pybuffer.buf = NULL;
  __pyx_pybuffer_ids.refcount = 0;
  __pyx_pybuffernd_ids.data = NULL;
  __pyx_pybuffernd_ids.rcbuffer = &__pyx_pybuffer_ids;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1076, __pyx_L1_error)
  }
  __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1076, __pyx_L1_error)
  }
  __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __pyx_f_8vcstring_8vcstring_calc_corr_q2_ensemble(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, __pyx_v_b, __pyx_v_ids, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1076, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_corr_q2_ensemble", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":1129
 * 
 * 
 *     cpdef calc_corr_q2_ensemble_timeavg(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=1] b, list weights=None):             # <<<<<<<<<<<<<<
 *         """
 *         Compute correlation function using committor at time t and t+tau, <[q(tau)-q(0)] ** 2>.
 */

static PyObject *__pyx_pw_8vcstring_8vcstring_29calc_corr_q2_ensemble_timeavg(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_b, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg *__pyx_optional_args) {
  PyObject *__pyx_v_weights = ((PyObject*)Py_None);
  PyArrayObject *__pyx_v_ids = 0;
  int __pyx_v_N;
  int __pyx_v_id_vor_t;
  int __pyx_v_id_vor_tau;
  int __pyx_v_t0;
  double __pyx_v_q_t;
  double __pyx_v_q_tau;
  double __pyx_v_dq;
  double __pyx_v_weight;
  double __pyx_v_C;
  PyObject *__pyx_v_count = NULL;
  int __pyx_v_i;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ids;
  __Pyx_Buffer __pyx_pybuffer_ids;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  Py_ssize_t __pyx_t_9;
  Py_ssize_t __pyx_t_10;
  int __pyx_t_11;
  struct __pyx_opt_args_8vcstring_8vcstring_assign_states_ensemble __pyx_t_12;
  PyArrayObject *__pyx_t_13 = NULL;
  int __pyx_t_14;
  PyObject *__pyx_t_15 = NULL;
  PyObject *__pyx_t_16 = NULL;
  PyObject *__pyx_t_17 = NULL;
  int __pyx_t_18;
  int __pyx_t_19;
  double __pyx_t_20;
  double __pyx_t_21;
  int __pyx_t_22;
  int __pyx_t_23;
  Py_ssize_t __pyx_t_24;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_corr_q2_ensemble_timeavg", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args->__pyx_n > 0) {
      __pyx_v_weights = __pyx_optional_args->weights;
    }
  }
  __pyx_pybuffer_ids.pybuffer.buf = NULL;
  __pyx_pybuffer_ids.refcount = 0;
  __pyx_pybuffernd_ids.data = NULL;
  __pyx_pybuffernd_ids.rcbuffer = &__pyx_pybuffer_ids;
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1129, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1129, __pyx_L1_error)
  }
  __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_calc_corr_q2_ensemble_timeavg); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1129, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_8vcstring_8vcstring_29calc_corr_q2_ensemble_timeavg)) {
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1129, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
        __pyx_t_6 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
          __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
          if (likely(__pyx_t_5)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
            __Pyx_INCREF(__pyx_t_5);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_4, function);
            __pyx_t_6 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[6] = {__pyx_t_5, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_z), ((PyObject *)__pyx_v_b), __pyx_v_weights};
          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 5+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1129, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[6] = {__pyx_t_5, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_z), ((PyObject *)__pyx_v_b), __pyx_v_weights};
          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 5+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1129, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        } else
        #endif
        {
          __pyx_t_7 = PyTuple_New(5+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1129, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          if (__pyx_t_5) {
            __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
          }
          __Pyx_INCREF(__pyx_v_traj);
          __Pyx_GIVEREF(__pyx_v_traj);
          PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_traj);
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_t_3);
          __Pyx_INCREF(((PyObject *)__pyx_v_z));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
          PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_6, ((PyObject *)__pyx_v_z));
          __Pyx_INCREF(((PyObject *)__pyx_v_b));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
          PyTuple_SET_ITEM(__pyx_t_7, 3+__pyx_t_6, ((PyObject *)__pyx_v_b));
          __Pyx_INCREF(__pyx_v_weights);
          __Pyx_GIVEREF(__pyx_v_weights);
          PyTuple_SET_ITEM(__pyx_t_7, 4+__pyx_t_6, __pyx_v_weights);
          __pyx_t_3 = 0;
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1129, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        }
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }

  /* "vcstring.pyx":1138
 *         cdef double x_t, y_t, x_tau, y_tau, q_t, q_tau, dq, weight, C
 * 
 *         print('\n=================================')             # <<<<<<<<<<<<<<
 *         print('CALCULATING CORRELATION FUNCTION')
 *         print('=================================')
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__36, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1138, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1139
 * 
 *         print('\n=================================')
 *         print('CALCULATING CORRELATION FUNCTION')             # <<<<<<<<<<<<<<
 *         print('=================================')
 *         sys.stdout.flush()
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__37, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1139, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1140
 *         print('\n=================================')
 *         print('CALCULATING CORRELATION FUNCTION')
 *         print('=================================')             # <<<<<<<<<<<<<<
 *         sys.stdout.flush()
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__39, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1140, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1141
 *         print('CALCULATING CORRELATION FUNCTION')
 *         print('=================================')
 *         sys.stdout.flush()             # <<<<<<<<<<<<<<
 * 
 *         N = len(traj)  # Number of aggregate trajectories
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_sys); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1141, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_stdout); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1141, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_flush); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1141, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1141, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1143
 *         sys.stdout.flush()
 * 
 *         N = len(traj)  # Number of aggregate trajectories             # <<<<<<<<<<<<<<
 *         dq = 0.0
 *         count = 0
 */
  if (unlikely(__pyx_v_traj == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
    __PYX_ERR(0, 1143, __pyx_L1_error)
  }
  __pyx_t_8 = PyList_GET_SIZE(__pyx_v_traj); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1143, __pyx_L1_error)
  __pyx_v_N = __pyx_t_8;

  /* "vcstring.pyx":1144
 * 
 *         N = len(traj)  # Number of aggregate trajectories
 *         dq = 0.0             # <<<<<<<<<<<<<<
 *         count = 0
 *         for t0 in range(len(traj[0])):
 */
  __pyx_v_dq = 0.0;

  /* "vcstring.pyx":1145
 *         N = len(traj)  # Number of aggregate trajectories
 *         dq = 0.0
 *         count = 0             # <<<<<<<<<<<<<<
 *         for t0 in range(len(traj[0])):
 *             print('t0:', t0)
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_v_count = __pyx_int_0;

  /* "vcstring.pyx":1146
 *         dq = 0.0
 *         count = 0
 *         for t0 in range(len(traj[0])):             # <<<<<<<<<<<<<<
 *             print('t0:', t0)
 *             sys.stdout.flush()
 */
  if (unlikely(__pyx_v_traj == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(0, 1146, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_v_traj, 0, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1146, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_8 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1146, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_9 = __pyx_t_8;
  for (__pyx_t_6 = 0; __pyx_t_6 < __pyx_t_9; __pyx_t_6+=1) {
    __pyx_v_t0 = __pyx_t_6;

    /* "vcstring.pyx":1147
 *         count = 0
 *         for t0 in range(len(traj[0])):
 *             print('t0:', t0)             # <<<<<<<<<<<<<<
 *             sys.stdout.flush()
 *             if t0 + tau >= len(traj[0]) - 1:
 */
    __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_t0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1147, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1147, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_kp_u_t0_3);
    __Pyx_GIVEREF(__pyx_kp_u_t0_3);
    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_t0_3);
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1147, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "vcstring.pyx":1148
 *         for t0 in range(len(traj[0])):
 *             print('t0:', t0)
 *             sys.stdout.flush()             # <<<<<<<<<<<<<<
 *             if t0 + tau >= len(traj[0]) - 1:
 *                 print('out of index')
 */
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_sys); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1148, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_stdout); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1148, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_flush); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1148, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1148, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "vcstring.pyx":1149
 *             print('t0:', t0)
 *             sys.stdout.flush()
 *             if t0 + tau >= len(traj[0]) - 1:             # <<<<<<<<<<<<<<
 *                 print('out of index')
 *                 break
 */
    if (unlikely(__pyx_v_traj == Py_None)) {
      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
      __PYX_ERR(0, 1149, __pyx_L1_error)
    }
    __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_v_traj, 0, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1149, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_10 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1149, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_11 = (((__pyx_v_t0 + __pyx_v_tau) >= (__pyx_t_10 - 1)) != 0);
    if (__pyx_t_11) {

      /* "vcstring.pyx":1150
 *             sys.stdout.flush()
 *             if t0 + tau >= len(traj[0]) - 1:
 *                 print('out of index')             # <<<<<<<<<<<<<<
 *                 break
 *             ids = self.assign_states_ensemble(traj, tau, z, t0=t0, weights=weights)
 */
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__31, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1150, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":1151
 *             if t0 + tau >= len(traj[0]) - 1:
 *                 print('out of index')
 *                 break             # <<<<<<<<<<<<<<
 *             ids = self.assign_states_ensemble(traj, tau, z, t0=t0, weights=weights)
 * 
 */
      goto __pyx_L4_break;

      /* "vcstring.pyx":1149
 *             print('t0:', t0)
 *             sys.stdout.flush()
 *             if t0 + tau >= len(traj[0]) - 1:             # <<<<<<<<<<<<<<
 *                 print('out of index')
 *                 break
 */
    }

    /* "vcstring.pyx":1152
 *                 print('out of index')
 *                 break
 *             ids = self.assign_states_ensemble(traj, tau, z, t0=t0, weights=weights)             # <<<<<<<<<<<<<<
 * 
 *             for i in range(N):
 */
    __pyx_t_12.__pyx_n = 2;
    __pyx_t_12.t0 = __pyx_v_t0;
    __pyx_t_12.weights = __pyx_v_weights;
    __pyx_t_1 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->assign_states_ensemble(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, ((PyArrayObject *)__pyx_v_z), 0, &__pyx_t_12); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1152, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1152, __pyx_L1_error)
    __pyx_t_13 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
      __pyx_t_14 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_t_13, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
      if (unlikely(__pyx_t_14 < 0)) {
        PyErr_Fetch(&__pyx_t_15, &__pyx_t_16, &__pyx_t_17);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_16); Py_XDECREF(__pyx_t_17);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_15, __pyx_t_16, __pyx_t_17);
        }
        __pyx_t_15 = __pyx_t_16 = __pyx_t_17 = 0;
      }
      __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
      if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1152, __pyx_L1_error)
    }
    __pyx_t_13 = 0;
    __Pyx_XDECREF_SET(__pyx_v_ids, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "vcstring.pyx":1154
 *             ids = self.assign_states_ensemble(traj, tau, z, t0=t0, weights=weights)
 * 
 *             for i in range(N):             # <<<<<<<<<<<<<<
 *                 q_t, q_tau = 0., 0.
 * 
 */
    __pyx_t_14 = __pyx_v_N;
    __pyx_t_18 = __pyx_t_14;
    for (__pyx_t_19 = 0; __pyx_t_19 < __pyx_t_18; __pyx_t_19+=1) {
      __pyx_v_i = __pyx_t_19;

      /* "vcstring.pyx":1155
 * 
 *             for i in range(N):
 *                 q_t, q_tau = 0., 0.             # <<<<<<<<<<<<<<
 * 
 *                 # Calculate q(0) for i-th Trajectory
 */
      __pyx_t_20 = 0.;
      __pyx_t_21 = 0.;
      __pyx_v_q_t = __pyx_t_20;
      __pyx_v_q_tau = __pyx_t_21;

      /* "vcstring.pyx":1158
 * 
 *                 # Calculate q(0) for i-th Trajectory
 *                 if ids[i][0] == 0.0 and ids[i][1] == 0.0:  # State A             # <<<<<<<<<<<<<<
 *                     q_t = 0.0
 *                 elif ids[i][0] == 0.0 and ids[i][1] == 1.0:  # State B
 */
      __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1158, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1158, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1158, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_22 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_22 < 0)) __PYX_ERR(0, 1158, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_22) {
      } else {
        __pyx_t_11 = __pyx_t_22;
        goto __pyx_L9_bool_binop_done;
      }
      __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1158, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1158, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1158, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_22 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_22 < 0)) __PYX_ERR(0, 1158, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_11 = __pyx_t_22;
      __pyx_L9_bool_binop_done:;
      if (__pyx_t_11) {

        /* "vcstring.pyx":1159
 *                 # Calculate q(0) for i-th Trajectory
 *                 if ids[i][0] == 0.0 and ids[i][1] == 0.0:  # State A
 *                     q_t = 0.0             # <<<<<<<<<<<<<<
 *                 elif ids[i][0] == 0.0 and ids[i][1] == 1.0:  # State B
 *                     q_t = 1.0
 */
        __pyx_v_q_t = 0.0;

        /* "vcstring.pyx":1158
 * 
 *                 # Calculate q(0) for i-th Trajectory
 *                 if ids[i][0] == 0.0 and ids[i][1] == 0.0:  # State A             # <<<<<<<<<<<<<<
 *                     q_t = 0.0
 *                 elif ids[i][0] == 0.0 and ids[i][1] == 1.0:  # State B
 */
        goto __pyx_L8;
      }

      /* "vcstring.pyx":1160
 *                 if ids[i][0] == 0.0 and ids[i][1] == 0.0:  # State A
 *                     q_t = 0.0
 *                 elif ids[i][0] == 0.0 and ids[i][1] == 1.0:  # State B             # <<<<<<<<<<<<<<
 *                     q_t = 1.0
 *                 else:                                      # State I
 */
      __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1160, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1160, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1160, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_22 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_22 < 0)) __PYX_ERR(0, 1160, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_22) {
      } else {
        __pyx_t_11 = __pyx_t_22;
        goto __pyx_L11_bool_binop_done;
      }
      __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1160, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1160, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_1_0, 1.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1160, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_22 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_22 < 0)) __PYX_ERR(0, 1160, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_11 = __pyx_t_22;
      __pyx_L11_bool_binop_done:;
      if (__pyx_t_11) {

        /* "vcstring.pyx":1161
 *                     q_t = 0.0
 *                 elif ids[i][0] == 0.0 and ids[i][1] == 1.0:  # State B
 *                     q_t = 1.0             # <<<<<<<<<<<<<<
 *                 else:                                      # State I
 *                     id_vor_t = int(ids[i][4])              # Check Voronoi index for Traj i
 */
        __pyx_v_q_t = 1.0;

        /* "vcstring.pyx":1160
 *                 if ids[i][0] == 0.0 and ids[i][1] == 0.0:  # State A
 *                     q_t = 0.0
 *                 elif ids[i][0] == 0.0 and ids[i][1] == 1.0:  # State B             # <<<<<<<<<<<<<<
 *                     q_t = 1.0
 *                 else:                                      # State I
 */
        goto __pyx_L8;
      }

      /* "vcstring.pyx":1163
 *                     q_t = 1.0
 *                 else:                                      # State I
 *                     id_vor_t = int(ids[i][4])              # Check Voronoi index for Traj i             # <<<<<<<<<<<<<<
 *                     q_t = b[id_vor_t]
 * 
 */
      /*else*/ {
        __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1163, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1163, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_PyNumber_Int(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1163, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_23 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_23 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1163, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_v_id_vor_t = __pyx_t_23;

        /* "vcstring.pyx":1164
 *                 else:                                      # State I
 *                     id_vor_t = int(ids[i][4])              # Check Voronoi index for Traj i
 *                     q_t = b[id_vor_t]             # <<<<<<<<<<<<<<
 * 
 *                 # Calculate q(tau) for i-th Trajectory
 */
        __pyx_t_24 = __pyx_v_id_vor_t;
        __pyx_t_23 = -1;
        if (__pyx_t_24 < 0) {
          __pyx_t_24 += __pyx_pybuffernd_b.diminfo[0].shape;
          if (unlikely(__pyx_t_24 < 0)) __pyx_t_23 = 0;
        } else if (unlikely(__pyx_t_24 >= __pyx_pybuffernd_b.diminfo[0].shape)) __pyx_t_23 = 0;
        if (unlikely(__pyx_t_23 != -1)) {
          __Pyx_RaiseBufferIndexError(__pyx_t_23);
          __PYX_ERR(0, 1164, __pyx_L1_error)
        }
        __pyx_v_q_t = (*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_b.rcbuffer->pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_b.diminfo[0].strides));
      }
      __pyx_L8:;

      /* "vcstring.pyx":1167
 * 
 *                 # Calculate q(tau) for i-th Trajectory
 *                 if ids[i][2] == 0.0 and ids[i][3] == 0.0:  # State A             # <<<<<<<<<<<<<<
 *                     q_tau = 0.0
 *                 elif ids[i][2] == 0.0 and ids[i][3] == 1.0: # State B
 */
      __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1167, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1167, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1167, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_22 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_22 < 0)) __PYX_ERR(0, 1167, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_22) {
      } else {
        __pyx_t_11 = __pyx_t_22;
        goto __pyx_L14_bool_binop_done;
      }
      __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1167, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1167, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1167, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_22 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_22 < 0)) __PYX_ERR(0, 1167, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_11 = __pyx_t_22;
      __pyx_L14_bool_binop_done:;
      if (__pyx_t_11) {

        /* "vcstring.pyx":1168
 *                 # Calculate q(tau) for i-th Trajectory
 *                 if ids[i][2] == 0.0 and ids[i][3] == 0.0:  # State A
 *                     q_tau = 0.0             # <<<<<<<<<<<<<<
 *                 elif ids[i][2] == 0.0 and ids[i][3] == 1.0: # State B
 *                     q_tau = 1.0
 */
        __pyx_v_q_tau = 0.0;

        /* "vcstring.pyx":1167
 * 
 *                 # Calculate q(tau) for i-th Trajectory
 *                 if ids[i][2] == 0.0 and ids[i][3] == 0.0:  # State A             # <<<<<<<<<<<<<<
 *                     q_tau = 0.0
 *                 elif ids[i][2] == 0.0 and ids[i][3] == 1.0: # State B
 */
        goto __pyx_L13;
      }

      /* "vcstring.pyx":1169
 *                 if ids[i][2] == 0.0 and ids[i][3] == 0.0:  # State A
 *                     q_tau = 0.0
 *                 elif ids[i][2] == 0.0 and ids[i][3] == 1.0: # State B             # <<<<<<<<<<<<<<
 *                     q_tau = 1.0
 *                 else:                                      # State I
 */
      __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1169, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1169, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1169, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_22 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_22 < 0)) __PYX_ERR(0, 1169, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_22) {
      } else {
        __pyx_t_11 = __pyx_t_22;
        goto __pyx_L16_bool_binop_done;
      }
      __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1169, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1169, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyFloat_EqObjC(__pyx_t_2, __pyx_float_1_0, 1.0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1169, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_22 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_22 < 0)) __PYX_ERR(0, 1169, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_11 = __pyx_t_22;
      __pyx_L16_bool_binop_done:;
      if (__pyx_t_11) {

        /* "vcstring.pyx":1170
 *                     q_tau = 0.0
 *                 elif ids[i][2] == 0.0 and ids[i][3] == 1.0: # State B
 *                     q_tau = 1.0             # <<<<<<<<<<<<<<
 *                 else:                                      # State I
 *                     id_vor_tau = int(ids[i][5])            # Check Voronoi index for Traj i
 */
        __pyx_v_q_tau = 1.0;

        /* "vcstring.pyx":1169
 *                 if ids[i][2] == 0.0 and ids[i][3] == 0.0:  # State A
 *                     q_tau = 0.0
 *                 elif ids[i][2] == 0.0 and ids[i][3] == 1.0: # State B             # <<<<<<<<<<<<<<
 *                     q_tau = 1.0
 *                 else:                                      # State I
 */
        goto __pyx_L13;
      }

      /* "vcstring.pyx":1172
 *                     q_tau = 1.0
 *                 else:                                      # State I
 *                     id_vor_tau = int(ids[i][5])            # Check Voronoi index for Traj i             # <<<<<<<<<<<<<<
 *                     q_tau = b[id_vor_tau]
 * 
 */
      /*else*/ {
        __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1172, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1172, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_PyNumber_Int(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1172, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_23 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_23 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1172, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_v_id_vor_tau = __pyx_t_23;

        /* "vcstring.pyx":1173
 *                 else:                                      # State I
 *                     id_vor_tau = int(ids[i][5])            # Check Voronoi index for Traj i
 *                     q_tau = b[id_vor_tau]             # <<<<<<<<<<<<<<
 * 
 *                 if self.state_assignment == '1d':
 */
        __pyx_t_24 = __pyx_v_id_vor_tau;
        __pyx_t_23 = -1;
        if (__pyx_t_24 < 0) {
          __pyx_t_24 += __pyx_pybuffernd_b.diminfo[0].shape;
          if (unlikely(__pyx_t_24 < 0)) __pyx_t_23 = 0;
        } else if (unlikely(__pyx_t_24 >= __pyx_pybuffernd_b.diminfo[0].shape)) __pyx_t_23 = 0;
        if (unlikely(__pyx_t_23 != -1)) {
          __Pyx_RaiseBufferIndexError(__pyx_t_23);
          __PYX_ERR(0, 1173, __pyx_L1_error)
        }
        __pyx_v_q_tau = (*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_b.rcbuffer->pybuffer.buf, __pyx_t_24, __pyx_pybuffernd_b.diminfo[0].strides));
      }
      __pyx_L13:;

      /* "vcstring.pyx":1175
 *                     q_tau = b[id_vor_tau]
 * 
 *                 if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                     weight = ids[i][8]
 *                 else:
 */
      __pyx_t_11 = (__Pyx_PyUnicode_Equals(__pyx_v_self->state_assignment, __pyx_kp_u_1d, Py_EQ)); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 1175, __pyx_L1_error)
      __pyx_t_22 = (__pyx_t_11 != 0);
      if (__pyx_t_22) {

        /* "vcstring.pyx":1176
 * 
 *                 if self.state_assignment == '1d':
 *                     weight = ids[i][8]             # <<<<<<<<<<<<<<
 *                 else:
 *                     weight = ids[i][10]
 */
        __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1176, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 8, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1176, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_21 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_21 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1176, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_v_weight = __pyx_t_21;

        /* "vcstring.pyx":1175
 *                     q_tau = b[id_vor_tau]
 * 
 *                 if self.state_assignment == '1d':             # <<<<<<<<<<<<<<
 *                     weight = ids[i][8]
 *                 else:
 */
        goto __pyx_L18;
      }

      /* "vcstring.pyx":1178
 *                     weight = ids[i][8]
 *                 else:
 *                     weight = ids[i][10]             # <<<<<<<<<<<<<<
 * 
 *                 dq += weight * (q_tau - q_t) ** 2
 */
      /*else*/ {
        __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1178, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 10, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1178, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_21 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_21 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1178, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_v_weight = __pyx_t_21;
      }
      __pyx_L18:;

      /* "vcstring.pyx":1180
 *                     weight = ids[i][10]
 * 
 *                 dq += weight * (q_tau - q_t) ** 2             # <<<<<<<<<<<<<<
 *                 # dq += (q_tau - q_t) ** 2
 *                 count += 1
 */
      __pyx_v_dq = (__pyx_v_dq + (__pyx_v_weight * pow((__pyx_v_q_tau - __pyx_v_q_t), 2.0)));

      /* "vcstring.pyx":1182
 *                 dq += weight * (q_tau - q_t) ** 2
 *                 # dq += (q_tau - q_t) ** 2
 *                 count += 1             # <<<<<<<<<<<<<<
 *         C = dq / count
 *         print('N =', N)
 */
      __pyx_t_1 = __Pyx_PyInt_AddObjC(__pyx_v_count, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1182, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF_SET(__pyx_v_count, __pyx_t_1);
      __pyx_t_1 = 0;
    }
  }
  __pyx_L4_break:;

  /* "vcstring.pyx":1183
 *                 # dq += (q_tau - q_t) ** 2
 *                 count += 1
 *         C = dq / count             # <<<<<<<<<<<<<<
 *         print('N =', N)
 *         print('count =', count)
 */
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_dq); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1183, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyNumber_Divide(__pyx_t_1, __pyx_v_count); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1183, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_21 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_21 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1183, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_C = __pyx_t_21;

  /* "vcstring.pyx":1184
 *                 count += 1
 *         C = dq / count
 *         print('N =', N)             # <<<<<<<<<<<<<<
 *         print('count =', count)
 *         print('traj shape:', np.shape(traj))
 */
  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_N); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1184, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1184, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_N_2);
  __Pyx_GIVEREF(__pyx_kp_u_N_2);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_N_2);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1184, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":1185
 *         C = dq / count
 *         print('N =', N)
 *         print('count =', count)             # <<<<<<<<<<<<<<
 *         print('traj shape:', np.shape(traj))
 *         print('Corr =', C)
 */
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1185, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_count);
  __Pyx_GIVEREF(__pyx_kp_u_count);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_count);
  __Pyx_INCREF(__pyx_v_count);
  __Pyx_GIVEREF(__pyx_v_count);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_count);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1185, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1186
 *         print('N =', N)
 *         print('count =', count)
 *         print('traj shape:', np.shape(traj))             # <<<<<<<<<<<<<<
 *         print('Corr =', C)
 *         sys.stdout.flush()
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1186, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_shape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1186, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_v_traj) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_traj);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1186, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1186, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_kp_u_traj_shape);
  __Pyx_GIVEREF(__pyx_kp_u_traj_shape);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_traj_shape);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1186, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1187
 *         print('count =', count)
 *         print('traj shape:', np.shape(traj))
 *         print('Corr =', C)             # <<<<<<<<<<<<<<
 *         sys.stdout.flush()
 * 
 */
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_C); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1187, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1187, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_kp_u_Corr);
  __Pyx_GIVEREF(__pyx_kp_u_Corr);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_Corr);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1187, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1188
 *         print('traj shape:', np.shape(traj))
 *         print('Corr =', C)
 *         sys.stdout.flush()             # <<<<<<<<<<<<<<
 * 
 *         return C
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sys); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1188, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_stdout); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1188, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_flush); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1188, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1188, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1190
 *         sys.stdout.flush()
 * 
 *         return C             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_C); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1190, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "vcstring.pyx":1129
 * 
 * 
 *     cpdef calc_corr_q2_ensemble_timeavg(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=1] b, list weights=None):             # <<<<<<<<<<<<<<
 *         """
 *         Compute correlation function using committor at time t and t+tau, <[q(tau)-q(0)] ** 2>.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_corr_q2_ensemble_timeavg", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XDECREF((PyObject *)__pyx_v_ids);
  __Pyx_XDECREF(__pyx_v_count);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_29calc_corr_q2_ensemble_timeavg(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8vcstring_8vcstring_28calc_corr_q2_ensemble_timeavg[] = "\n        Compute correlation function using committor at time t and t+tau, <[q(tau)-q(0)] ** 2>.\n        ";
static PyObject *__pyx_pw_8vcstring_8vcstring_29calc_corr_q2_ensemble_timeavg(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_traj = 0;
  int __pyx_v_tau;
  PyArrayObject *__pyx_v_z = 0;
  PyArrayObject *__pyx_v_b = 0;
  PyObject *__pyx_v_weights = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("calc_corr_q2_ensemble_timeavg (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_traj,&__pyx_n_s_tau,&__pyx_n_s_z,&__pyx_n_s_b_2,&__pyx_n_s_weights,0};
    PyObject* values[5] = {0,0,0,0,0};
    values[4] = ((PyObject*)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_traj)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tau)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_corr_q2_ensemble_timeavg", 0, 4, 5, 1); __PYX_ERR(0, 1129, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_corr_q2_ensemble_timeavg", 0, 4, 5, 2); __PYX_ERR(0, 1129, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_b_2)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_corr_q2_ensemble_timeavg", 0, 4, 5, 3); __PYX_ERR(0, 1129, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weights);
          if (value) { values[4] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "calc_corr_q2_ensemble_timeavg") < 0)) __PYX_ERR(0, 1129, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_traj = ((PyObject*)values[0]);
    __pyx_v_tau = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_tau == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1129, __pyx_L3_error)
    __pyx_v_z = ((PyArrayObject *)values[2]);
    __pyx_v_b = ((PyArrayObject *)values[3]);
    __pyx_v_weights = ((PyObject*)values[4]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("calc_corr_q2_ensemble_timeavg", 0, 4, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1129, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.vcstring.calc_corr_q2_ensemble_timeavg", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_traj), (&PyList_Type), 1, "traj", 1))) __PYX_ERR(0, 1129, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_z), __pyx_ptype_5numpy_ndarray, 1, "z", 0))) __PYX_ERR(0, 1129, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_b), __pyx_ptype_5numpy_ndarray, 1, "b", 0))) __PYX_ERR(0, 1129, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_weights), (&PyList_Type), 1, "weights", 1))) __PYX_ERR(0, 1129, __pyx_L1_error)
  __pyx_r = __pyx_pf_8vcstring_8vcstring_28calc_corr_q2_ensemble_timeavg(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self), __pyx_v_traj, __pyx_v_tau, __pyx_v_z, __pyx_v_b, __pyx_v_weights);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_28calc_corr_q2_ensemble_timeavg(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_b, PyObject *__pyx_v_weights) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  struct __pyx_opt_args_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg __pyx_t_2;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_corr_q2_ensemble_timeavg", 0);
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1129, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1129, __pyx_L1_error)
  }
  __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2.__pyx_n = 1;
  __pyx_t_2.weights = __pyx_v_weights;
  __pyx_t_1 = __pyx_vtabptr_8vcstring_vcstring->calc_corr_q2_ensemble_timeavg(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, __pyx_v_z, __pyx_v_b, 1, &__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1129, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_corr_q2_ensemble_timeavg", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":1193
 * 
 * 
 *     cpdef calc_corr_q2_ensemble_timeavg_fast(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=1] b, list weights=None):             # <<<<<<<<<<<<<<
 *         """
 *         Compute correlation function using committor at time t and t+tau, <[q(tau)-q(0)] ** 2>.
 */

static PyObject *__pyx_pw_8vcstring_8vcstring_31calc_corr_q2_ensemble_timeavg_fast(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg_fast(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_b, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg_fast *__pyx_optional_args) {
  PyObject *__pyx_v_weights = ((PyObject*)Py_None);
  PyArrayObject *__pyx_v_ids = 0;
  int __pyx_v_N;
  int __pyx_v_t;
  int __pyx_v_id_vor_t;
  int __pyx_v_id_vor_tau;
  double __pyx_v_q_t;
  double __pyx_v_q_tau;
  double __pyx_v_dq;
  double __pyx_v_weight;
  double __pyx_v_C;
  PyObject *__pyx_v_count = NULL;
  int __pyx_v_k;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ids;
  __Pyx_Buffer __pyx_pybuffer_ids;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  Py_ssize_t __pyx_t_8;
  int __pyx_t_9;
  int __pyx_t_10;
  int __pyx_t_11;
  PyArrayObject *__pyx_t_12 = NULL;
  int __pyx_t_13;
  PyObject *__pyx_t_14 = NULL;
  PyObject *__pyx_t_15 = NULL;
  PyObject *__pyx_t_16 = NULL;
  double __pyx_t_17;
  Py_ssize_t __pyx_t_18;
  double __pyx_t_19;
  int __pyx_t_20;
  int __pyx_t_21;
  Py_ssize_t __pyx_t_22;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_corr_q2_ensemble_timeavg_fast", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args->__pyx_n > 0) {
      __pyx_v_weights = __pyx_optional_args->weights;
    }
  }
  __Pyx_INCREF(__pyx_v_weights);
  __pyx_pybuffer_ids.pybuffer.buf = NULL;
  __pyx_pybuffer_ids.refcount = 0;
  __pyx_pybuffernd_ids.data = NULL;
  __pyx_pybuffernd_ids.rcbuffer = &__pyx_pybuffer_ids;
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1193, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1193, __pyx_L1_error)
  }
  __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_calc_corr_q2_ensemble_timeavg_fa); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1193, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_8vcstring_8vcstring_31calc_corr_q2_ensemble_timeavg_fast)) {
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1193, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
        __pyx_t_6 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
          __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
          if (likely(__pyx_t_5)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
            __Pyx_INCREF(__pyx_t_5);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_4, function);
            __pyx_t_6 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[6] = {__pyx_t_5, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_z), ((PyObject *)__pyx_v_b), __pyx_v_weights};
          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 5+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1193, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[6] = {__pyx_t_5, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_z), ((PyObject *)__pyx_v_b), __pyx_v_weights};
          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 5+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1193, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        } else
        #endif
        {
          __pyx_t_7 = PyTuple_New(5+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1193, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          if (__pyx_t_5) {
            __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
          }
          __Pyx_INCREF(__pyx_v_traj);
          __Pyx_GIVEREF(__pyx_v_traj);
          PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_traj);
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_t_3);
          __Pyx_INCREF(((PyObject *)__pyx_v_z));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
          PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_6, ((PyObject *)__pyx_v_z));
          __Pyx_INCREF(((PyObject *)__pyx_v_b));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
          PyTuple_SET_ITEM(__pyx_t_7, 3+__pyx_t_6, ((PyObject *)__pyx_v_b));
          __Pyx_INCREF(__pyx_v_weights);
          __Pyx_GIVEREF(__pyx_v_weights);
          PyTuple_SET_ITEM(__pyx_t_7, 4+__pyx_t_6, __pyx_v_weights);
          __pyx_t_3 = 0;
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1193, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        }
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }

  /* "vcstring.pyx":1202
 *         cdef double x_t, y_t, x_tau, y_tau, q_t, q_tau, dq, weight, C
 * 
 *         print('\n=================================')             # <<<<<<<<<<<<<<
 *         print('CALCULATING CORRELATION FUNCTION')
 *         print('=================================')
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__36, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1202, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1203
 * 
 *         print('\n=================================')
 *         print('CALCULATING CORRELATION FUNCTION')             # <<<<<<<<<<<<<<
 *         print('=================================')
 *         sys.stdout.flush()
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__37, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1203, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1204
 *         print('\n=================================')
 *         print('CALCULATING CORRELATION FUNCTION')
 *         print('=================================')             # <<<<<<<<<<<<<<
 *         sys.stdout.flush()
 * 
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__39, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1204, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1205
 *         print('CALCULATING CORRELATION FUNCTION')
 *         print('=================================')
 *         sys.stdout.flush()             # <<<<<<<<<<<<<<
 * 
 *         N = len(traj)  # Number of aggregate trajectories
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_sys); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1205, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_stdout); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1205, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_flush); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1205, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1205, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1207
 *         sys.stdout.flush()
 * 
 *         N = len(traj)  # Number of aggregate trajectories             # <<<<<<<<<<<<<<
 *         dq = 0.0
 *         count = 0
 */
  if (unlikely(__pyx_v_traj == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
    __PYX_ERR(0, 1207, __pyx_L1_error)
  }
  __pyx_t_8 = PyList_GET_SIZE(__pyx_v_traj); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1207, __pyx_L1_error)
  __pyx_v_N = __pyx_t_8;

  /* "vcstring.pyx":1208
 * 
 *         N = len(traj)  # Number of aggregate trajectories
 *         dq = 0.0             # <<<<<<<<<<<<<<
 *         count = 0
 *         if weights == None:
 */
  __pyx_v_dq = 0.0;

  /* "vcstring.pyx":1209
 *         N = len(traj)  # Number of aggregate trajectories
 *         dq = 0.0
 *         count = 0             # <<<<<<<<<<<<<<
 *         if weights == None:
 *             weights = [1.0] * N
 */
  __Pyx_INCREF(__pyx_int_0);
  __pyx_v_count = __pyx_int_0;

  /* "vcstring.pyx":1210
 *         dq = 0.0
 *         count = 0
 *         if weights == None:             # <<<<<<<<<<<<<<
 *             weights = [1.0] * N
 *             print('Using uniform weights')
 */
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_weights, Py_None, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1210, __pyx_L1_error)
  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 1210, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_9) {

    /* "vcstring.pyx":1211
 *         count = 0
 *         if weights == None:
 *             weights = [1.0] * N             # <<<<<<<<<<<<<<
 *             print('Using uniform weights')
 * 
 */
    __pyx_t_1 = PyList_New(1 * ((__pyx_v_N<0) ? 0:__pyx_v_N)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1211, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    { Py_ssize_t __pyx_temp;
      for (__pyx_temp=0; __pyx_temp < __pyx_v_N; __pyx_temp++) {
        __Pyx_INCREF(__pyx_float_1_0);
        __Pyx_GIVEREF(__pyx_float_1_0);
        PyList_SET_ITEM(__pyx_t_1, __pyx_temp, __pyx_float_1_0);
      }
    }
    __Pyx_DECREF_SET(__pyx_v_weights, ((PyObject*)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "vcstring.pyx":1212
 *         if weights == None:
 *             weights = [1.0] * N
 *             print('Using uniform weights')             # <<<<<<<<<<<<<<
 * 
 *         for k in range(N):  # Iterate over number of aggregate trajectories
 */
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__33, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1212, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "vcstring.pyx":1210
 *         dq = 0.0
 *         count = 0
 *         if weights == None:             # <<<<<<<<<<<<<<
 *             weights = [1.0] * N
 *             print('Using uniform weights')
 */
  }

  /* "vcstring.pyx":1214
 *             print('Using uniform weights')
 * 
 *         for k in range(N):  # Iterate over number of aggregate trajectories             # <<<<<<<<<<<<<<
 *             ids = self.assign_states(traj[k], tau, z)
 *             weight = weights[k]
 */
  __pyx_t_6 = __pyx_v_N;
  __pyx_t_10 = __pyx_t_6;
  for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
    __pyx_v_k = __pyx_t_11;

    /* "vcstring.pyx":1215
 * 
 *         for k in range(N):  # Iterate over number of aggregate trajectories
 *             ids = self.assign_states(traj[k], tau, z)             # <<<<<<<<<<<<<<
 *             weight = weights[k]
 *             for t in range(len(traj[k])-tau):  # Iterate over trajectory steps
 */
    if (unlikely(__pyx_v_traj == Py_None)) {
      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
      __PYX_ERR(0, 1215, __pyx_L1_error)
    }
    __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_v_traj, __pyx_v_k, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1215, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(0, 1215, __pyx_L1_error)
    __pyx_t_2 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->assign_states(__pyx_v_self, ((PyObject*)__pyx_t_1), __pyx_v_tau, ((PyArrayObject *)__pyx_v_z), 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1215, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1215, __pyx_L1_error)
    __pyx_t_12 = ((PyArrayObject *)__pyx_t_2);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
      __pyx_t_13 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_t_12, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
      if (unlikely(__pyx_t_13 < 0)) {
        PyErr_Fetch(&__pyx_t_14, &__pyx_t_15, &__pyx_t_16);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_16);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_14, __pyx_t_15, __pyx_t_16);
        }
        __pyx_t_14 = __pyx_t_15 = __pyx_t_16 = 0;
      }
      __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
      if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 1215, __pyx_L1_error)
    }
    __pyx_t_12 = 0;
    __Pyx_XDECREF_SET(__pyx_v_ids, ((PyArrayObject *)__pyx_t_2));
    __pyx_t_2 = 0;

    /* "vcstring.pyx":1216
 *         for k in range(N):  # Iterate over number of aggregate trajectories
 *             ids = self.assign_states(traj[k], tau, z)
 *             weight = weights[k]             # <<<<<<<<<<<<<<
 *             for t in range(len(traj[k])-tau):  # Iterate over trajectory steps
 *                 q_t, q_tau = 0., 0.
 */
    if (unlikely(__pyx_v_weights == Py_None)) {
      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
      __PYX_ERR(0, 1216, __pyx_L1_error)
    }
    __pyx_t_2 = __Pyx_GetItemInt_List(__pyx_v_weights, __pyx_v_k, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1216, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_17 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_17 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1216, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_weight = __pyx_t_17;

    /* "vcstring.pyx":1217
 *             ids = self.assign_states(traj[k], tau, z)
 *             weight = weights[k]
 *             for t in range(len(traj[k])-tau):  # Iterate over trajectory steps             # <<<<<<<<<<<<<<
 *                 q_t, q_tau = 0., 0.
 * 
 */
    if (unlikely(__pyx_v_traj == Py_None)) {
      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
      __PYX_ERR(0, 1217, __pyx_L1_error)
    }
    __pyx_t_2 = __Pyx_GetItemInt_List(__pyx_v_traj, __pyx_v_k, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1217, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_8 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1217, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_18 = (__pyx_t_8 - __pyx_v_tau);
    __pyx_t_8 = __pyx_t_18;
    for (__pyx_t_13 = 0; __pyx_t_13 < __pyx_t_8; __pyx_t_13+=1) {
      __pyx_v_t = __pyx_t_13;

      /* "vcstring.pyx":1218
 *             weight = weights[k]
 *             for t in range(len(traj[k])-tau):  # Iterate over trajectory steps
 *                 q_t, q_tau = 0., 0.             # <<<<<<<<<<<<<<
 * 
 *                 # Calculate q(0) for k-th Trajectory at time t
 */
      __pyx_t_17 = 0.;
      __pyx_t_19 = 0.;
      __pyx_v_q_t = __pyx_t_17;
      __pyx_v_q_tau = __pyx_t_19;

      /* "vcstring.pyx":1221
 * 
 *                 # Calculate q(0) for k-th Trajectory at time t
 *                 if ids[t][0] == 0.0 and ids[t][1] == 0.0:  # State A at time t             # <<<<<<<<<<<<<<
 *                     q_t = 0.0
 *                 elif ids[t][1] == 1.0: # State B at time t
 */
      __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1221, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1221, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyFloat_EqObjC(__pyx_t_1, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1221, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_20 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_20 < 0)) __PYX_ERR(0, 1221, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (__pyx_t_20) {
      } else {
        __pyx_t_9 = __pyx_t_20;
        goto __pyx_L9_bool_binop_done;
      }
      __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1221, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1221, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyFloat_EqObjC(__pyx_t_1, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1221, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_20 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_20 < 0)) __PYX_ERR(0, 1221, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_9 = __pyx_t_20;
      __pyx_L9_bool_binop_done:;
      if (__pyx_t_9) {

        /* "vcstring.pyx":1222
 *                 # Calculate q(0) for k-th Trajectory at time t
 *                 if ids[t][0] == 0.0 and ids[t][1] == 0.0:  # State A at time t
 *                     q_t = 0.0             # <<<<<<<<<<<<<<
 *                 elif ids[t][1] == 1.0: # State B at time t
 *                     q_t = 1.0
 */
        __pyx_v_q_t = 0.0;

        /* "vcstring.pyx":1221
 * 
 *                 # Calculate q(0) for k-th Trajectory at time t
 *                 if ids[t][0] == 0.0 and ids[t][1] == 0.0:  # State A at time t             # <<<<<<<<<<<<<<
 *                     q_t = 0.0
 *                 elif ids[t][1] == 1.0: # State B at time t
 */
        goto __pyx_L8;
      }

      /* "vcstring.pyx":1223
 *                 if ids[t][0] == 0.0 and ids[t][1] == 0.0:  # State A at time t
 *                     q_t = 0.0
 *                 elif ids[t][1] == 1.0: # State B at time t             # <<<<<<<<<<<<<<
 *                     q_t = 1.0
 *                 else:                                      # State I at time t
 */
      __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1223, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1223, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyFloat_EqObjC(__pyx_t_1, __pyx_float_1_0, 1.0, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1223, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 1223, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (__pyx_t_9) {

        /* "vcstring.pyx":1224
 *                     q_t = 0.0
 *                 elif ids[t][1] == 1.0: # State B at time t
 *                     q_t = 1.0             # <<<<<<<<<<<<<<
 *                 else:                                      # State I at time t
 *                     id_vor_t = int(ids[t][2])              # Check voronoi index at time t
 */
        __pyx_v_q_t = 1.0;

        /* "vcstring.pyx":1223
 *                 if ids[t][0] == 0.0 and ids[t][1] == 0.0:  # State A at time t
 *                     q_t = 0.0
 *                 elif ids[t][1] == 1.0: # State B at time t             # <<<<<<<<<<<<<<
 *                     q_t = 1.0
 *                 else:                                      # State I at time t
 */
        goto __pyx_L8;
      }

      /* "vcstring.pyx":1226
 *                     q_t = 1.0
 *                 else:                                      # State I at time t
 *                     id_vor_t = int(ids[t][2])              # Check voronoi index at time t             # <<<<<<<<<<<<<<
 *                     q_t = b[id_vor_t]
 * 
 */
      /*else*/ {
        __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1226, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1226, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_2 = __Pyx_PyNumber_Int(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1226, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_21 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_21 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1226, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_v_id_vor_t = __pyx_t_21;

        /* "vcstring.pyx":1227
 *                 else:                                      # State I at time t
 *                     id_vor_t = int(ids[t][2])              # Check voronoi index at time t
 *                     q_t = b[id_vor_t]             # <<<<<<<<<<<<<<
 * 
 *                 if ids[t+tau][0] == 0.0 and ids[t+tau][1] == 0.0:  # State A at time t + tau
 */
        __pyx_t_22 = __pyx_v_id_vor_t;
        __pyx_t_21 = -1;
        if (__pyx_t_22 < 0) {
          __pyx_t_22 += __pyx_pybuffernd_b.diminfo[0].shape;
          if (unlikely(__pyx_t_22 < 0)) __pyx_t_21 = 0;
        } else if (unlikely(__pyx_t_22 >= __pyx_pybuffernd_b.diminfo[0].shape)) __pyx_t_21 = 0;
        if (unlikely(__pyx_t_21 != -1)) {
          __Pyx_RaiseBufferIndexError(__pyx_t_21);
          __PYX_ERR(0, 1227, __pyx_L1_error)
        }
        __pyx_v_q_t = (*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_b.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_b.diminfo[0].strides));
      }
      __pyx_L8:;

      /* "vcstring.pyx":1229
 *                     q_t = b[id_vor_t]
 * 
 *                 if ids[t+tau][0] == 0.0 and ids[t+tau][1] == 0.0:  # State A at time t + tau             # <<<<<<<<<<<<<<
 *                     q_tau = 0.0
 *                 elif ids[t+tau][1] == 1.0:                         # State B at time t + tau
 */
      __pyx_t_21 = (__pyx_v_t + __pyx_v_tau);
      __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_t_21, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1229, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1229, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyFloat_EqObjC(__pyx_t_1, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1229, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_20 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_20 < 0)) __PYX_ERR(0, 1229, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (__pyx_t_20) {
      } else {
        __pyx_t_9 = __pyx_t_20;
        goto __pyx_L12_bool_binop_done;
      }
      __pyx_t_21 = (__pyx_v_t + __pyx_v_tau);
      __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_t_21, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1229, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1229, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyFloat_EqObjC(__pyx_t_1, __pyx_float_0_0, 0.0, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1229, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_20 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_20 < 0)) __PYX_ERR(0, 1229, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_9 = __pyx_t_20;
      __pyx_L12_bool_binop_done:;
      if (__pyx_t_9) {

        /* "vcstring.pyx":1230
 * 
 *                 if ids[t+tau][0] == 0.0 and ids[t+tau][1] == 0.0:  # State A at time t + tau
 *                     q_tau = 0.0             # <<<<<<<<<<<<<<
 *                 elif ids[t+tau][1] == 1.0:                         # State B at time t + tau
 *                     q_tau = 1.0
 */
        __pyx_v_q_tau = 0.0;

        /* "vcstring.pyx":1229
 *                     q_t = b[id_vor_t]
 * 
 *                 if ids[t+tau][0] == 0.0 and ids[t+tau][1] == 0.0:  # State A at time t + tau             # <<<<<<<<<<<<<<
 *                     q_tau = 0.0
 *                 elif ids[t+tau][1] == 1.0:                         # State B at time t + tau
 */
        goto __pyx_L11;
      }

      /* "vcstring.pyx":1231
 *                 if ids[t+tau][0] == 0.0 and ids[t+tau][1] == 0.0:  # State A at time t + tau
 *                     q_tau = 0.0
 *                 elif ids[t+tau][1] == 1.0:                         # State B at time t + tau             # <<<<<<<<<<<<<<
 *                     q_tau = 1.0
 *                 else:                                              # State I at time t + tau
 */
      __pyx_t_21 = (__pyx_v_t + __pyx_v_tau);
      __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_t_21, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1231, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1231, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyFloat_EqObjC(__pyx_t_1, __pyx_float_1_0, 1.0, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1231, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 1231, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (__pyx_t_9) {

        /* "vcstring.pyx":1232
 *                     q_tau = 0.0
 *                 elif ids[t+tau][1] == 1.0:                         # State B at time t + tau
 *                     q_tau = 1.0             # <<<<<<<<<<<<<<
 *                 else:                                              # State I at time t + tau
 *                     id_vor_tau = int(ids[t+tau][2])                # Check voronoi index at time t + tau
 */
        __pyx_v_q_tau = 1.0;

        /* "vcstring.pyx":1231
 *                 if ids[t+tau][0] == 0.0 and ids[t+tau][1] == 0.0:  # State A at time t + tau
 *                     q_tau = 0.0
 *                 elif ids[t+tau][1] == 1.0:                         # State B at time t + tau             # <<<<<<<<<<<<<<
 *                     q_tau = 1.0
 *                 else:                                              # State I at time t + tau
 */
        goto __pyx_L11;
      }

      /* "vcstring.pyx":1234
 *                     q_tau = 1.0
 *                 else:                                              # State I at time t + tau
 *                     id_vor_tau = int(ids[t+tau][2])                # Check voronoi index at time t + tau             # <<<<<<<<<<<<<<
 *                     q_tau = b[id_vor_tau]
 * 
 */
      /*else*/ {
        __pyx_t_21 = (__pyx_v_t + __pyx_v_tau);
        __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_ids), __pyx_t_21, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1234, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1234, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_2 = __Pyx_PyNumber_Int(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1234, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_21 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_21 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1234, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_v_id_vor_tau = __pyx_t_21;

        /* "vcstring.pyx":1235
 *                 else:                                              # State I at time t + tau
 *                     id_vor_tau = int(ids[t+tau][2])                # Check voronoi index at time t + tau
 *                     q_tau = b[id_vor_tau]             # <<<<<<<<<<<<<<
 * 
 *                 dq += weight * (q_tau - q_t) ** 2
 */
        __pyx_t_22 = __pyx_v_id_vor_tau;
        __pyx_t_21 = -1;
        if (__pyx_t_22 < 0) {
          __pyx_t_22 += __pyx_pybuffernd_b.diminfo[0].shape;
          if (unlikely(__pyx_t_22 < 0)) __pyx_t_21 = 0;
        } else if (unlikely(__pyx_t_22 >= __pyx_pybuffernd_b.diminfo[0].shape)) __pyx_t_21 = 0;
        if (unlikely(__pyx_t_21 != -1)) {
          __Pyx_RaiseBufferIndexError(__pyx_t_21);
          __PYX_ERR(0, 1235, __pyx_L1_error)
        }
        __pyx_v_q_tau = (*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_b.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_b.diminfo[0].strides));
      }
      __pyx_L11:;

      /* "vcstring.pyx":1237
 *                     q_tau = b[id_vor_tau]
 * 
 *                 dq += weight * (q_tau - q_t) ** 2             # <<<<<<<<<<<<<<
 *                 count += 1
 *         C = dq / count
 */
      __pyx_v_dq = (__pyx_v_dq + (__pyx_v_weight * pow((__pyx_v_q_tau - __pyx_v_q_t), 2.0)));

      /* "vcstring.pyx":1238
 * 
 *                 dq += weight * (q_tau - q_t) ** 2
 *                 count += 1             # <<<<<<<<<<<<<<
 *         C = dq / count
 *         print('N =', N)
 */
      __pyx_t_2 = __Pyx_PyInt_AddObjC(__pyx_v_count, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1238, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF_SET(__pyx_v_count, __pyx_t_2);
      __pyx_t_2 = 0;
    }
  }

  /* "vcstring.pyx":1239
 *                 dq += weight * (q_tau - q_t) ** 2
 *                 count += 1
 *         C = dq / count             # <<<<<<<<<<<<<<
 *         print('N =', N)
 *         print('count =', count)
 */
  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_dq); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1239, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_t_2, __pyx_v_count); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1239, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_19 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_19 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1239, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_C = __pyx_t_19;

  /* "vcstring.pyx":1240
 *                 count += 1
 *         C = dq / count
 *         print('N =', N)             # <<<<<<<<<<<<<<
 *         print('count =', count)
 *         print('traj shape:', np.shape(traj))
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_N); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1240, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1240, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_N_2);
  __Pyx_GIVEREF(__pyx_kp_u_N_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_N_2);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1240, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1241
 *         C = dq / count
 *         print('N =', N)
 *         print('count =', count)             # <<<<<<<<<<<<<<
 *         print('traj shape:', np.shape(traj))
 *         print('Corr =', C)
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1241, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_count);
  __Pyx_GIVEREF(__pyx_kp_u_count);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_count);
  __Pyx_INCREF(__pyx_v_count);
  __Pyx_GIVEREF(__pyx_v_count);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_count);
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1241, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":1242
 *         print('N =', N)
 *         print('count =', count)
 *         print('traj shape:', np.shape(traj))             # <<<<<<<<<<<<<<
 *         print('Corr =', C)
 *         sys.stdout.flush()
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1242, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_shape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1242, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_2 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_1, __pyx_v_traj) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_traj);
  __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1242, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1242, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_kp_u_traj_shape);
  __Pyx_GIVEREF(__pyx_kp_u_traj_shape);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_traj_shape);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1242, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":1243
 *         print('count =', count)
 *         print('traj shape:', np.shape(traj))
 *         print('Corr =', C)             # <<<<<<<<<<<<<<
 *         sys.stdout.flush()
 * 
 */
  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_C); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1243, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1243, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_kp_u_Corr);
  __Pyx_GIVEREF(__pyx_kp_u_Corr);
  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_Corr);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1243, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":1244
 *         print('traj shape:', np.shape(traj))
 *         print('Corr =', C)
 *         sys.stdout.flush()             # <<<<<<<<<<<<<<
 * 
 *         return C
 */
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sys); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1244, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_stdout); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1244, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_flush); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1244, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_2 = (__pyx_t_1) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_1) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1244, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":1246
 *         sys.stdout.flush()
 * 
 *         return C             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_C); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1246, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "vcstring.pyx":1193
 * 
 * 
 *     cpdef calc_corr_q2_ensemble_timeavg_fast(self, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=1] b, list weights=None):             # <<<<<<<<<<<<<<
 *         """
 *         Compute correlation function using committor at time t and t+tau, <[q(tau)-q(0)] ** 2>.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_corr_q2_ensemble_timeavg_fast", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XDECREF((PyObject *)__pyx_v_ids);
  __Pyx_XDECREF(__pyx_v_count);
  __Pyx_XDECREF(__pyx_v_weights);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_31calc_corr_q2_ensemble_timeavg_fast(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8vcstring_8vcstring_30calc_corr_q2_ensemble_timeavg_fast[] = "\n        Compute correlation function using committor at time t and t+tau, <[q(tau)-q(0)] ** 2>.\n        ";
static PyObject *__pyx_pw_8vcstring_8vcstring_31calc_corr_q2_ensemble_timeavg_fast(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_traj = 0;
  int __pyx_v_tau;
  PyArrayObject *__pyx_v_z = 0;
  PyArrayObject *__pyx_v_b = 0;
  PyObject *__pyx_v_weights = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("calc_corr_q2_ensemble_timeavg_fast (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_traj,&__pyx_n_s_tau,&__pyx_n_s_z,&__pyx_n_s_b_2,&__pyx_n_s_weights,0};
    PyObject* values[5] = {0,0,0,0,0};
    values[4] = ((PyObject*)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_traj)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tau)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_corr_q2_ensemble_timeavg_fast", 0, 4, 5, 1); __PYX_ERR(0, 1193, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_corr_q2_ensemble_timeavg_fast", 0, 4, 5, 2); __PYX_ERR(0, 1193, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_b_2)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("calc_corr_q2_ensemble_timeavg_fast", 0, 4, 5, 3); __PYX_ERR(0, 1193, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weights);
          if (value) { values[4] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "calc_corr_q2_ensemble_timeavg_fast") < 0)) __PYX_ERR(0, 1193, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_traj = ((PyObject*)values[0]);
    __pyx_v_tau = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_tau == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1193, __pyx_L3_error)
    __pyx_v_z = ((PyArrayObject *)values[2]);
    __pyx_v_b = ((PyArrayObject *)values[3]);
    __pyx_v_weights = ((PyObject*)values[4]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("calc_corr_q2_ensemble_timeavg_fast", 0, 4, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1193, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.vcstring.calc_corr_q2_ensemble_timeavg_fast", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_traj), (&PyList_Type), 1, "traj", 1))) __PYX_ERR(0, 1193, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_z), __pyx_ptype_5numpy_ndarray, 1, "z", 0))) __PYX_ERR(0, 1193, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_b), __pyx_ptype_5numpy_ndarray, 1, "b", 0))) __PYX_ERR(0, 1193, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_weights), (&PyList_Type), 1, "weights", 1))) __PYX_ERR(0, 1193, __pyx_L1_error)
  __pyx_r = __pyx_pf_8vcstring_8vcstring_30calc_corr_q2_ensemble_timeavg_fast(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self), __pyx_v_traj, __pyx_v_tau, __pyx_v_z, __pyx_v_b, __pyx_v_weights);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_30calc_corr_q2_ensemble_timeavg_fast(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_b, PyObject *__pyx_v_weights) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  struct __pyx_opt_args_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg_fast __pyx_t_2;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("calc_corr_q2_ensemble_timeavg_fast", 0);
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1193, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1193, __pyx_L1_error)
  }
  __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2.__pyx_n = 1;
  __pyx_t_2.weights = __pyx_v_weights;
  __pyx_t_1 = __pyx_vtabptr_8vcstring_vcstring->calc_corr_q2_ensemble_timeavg_fast(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, __pyx_v_z, __pyx_v_b, 1, &__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1193, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.calc_corr_q2_ensemble_timeavg_fast", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":1249
 * 
 * 
 *     cpdef finite_diff_corr(self, int image, int dim, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=2] ids, double delta=0.1):             # <<<<<<<<<<<<<<
 *         """
 *         Calculate the finite difference gradient of the committor correlation function.
 */

static PyObject *__pyx_pw_8vcstring_8vcstring_33finite_diff_corr(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_finite_diff_corr(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_v_image, int __pyx_v_dim, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_ids, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_finite_diff_corr *__pyx_optional_args) {
  double __pyx_v_delta = ((double)0.1);
  PyArrayObject *__pyx_v_zm = 0;
  PyArrayObject *__pyx_v_zp = 0;
  PyObject *__pyx_v_Cp_list = 0;
  PyObject *__pyx_v_Cm_list = 0;
  PyObject *__pyx_v_gradC_list = 0;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_N;
  double __pyx_v_Cp;
  double __pyx_v_Cm;
  double __pyx_v_dC;
  PyObject *__pyx_v_b = NULL;
  PyObject *__pyx_v_D_0 = NULL;
  PyObject *__pyx_v_D_tau = NULL;
  PyObject *__pyx_v_g_0 = NULL;
  PyObject *__pyx_v_g_tau = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ids;
  __Pyx_Buffer __pyx_pybuffer_ids;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_zm;
  __Pyx_Buffer __pyx_pybuffer_zm;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_zp;
  __Pyx_Buffer __pyx_pybuffer_zp;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  Py_ssize_t __pyx_t_11;
  Py_ssize_t __pyx_t_12;
  PyArrayObject *__pyx_t_13 = NULL;
  PyObject *__pyx_t_14 = NULL;
  PyObject *__pyx_t_15 = NULL;
  PyObject *__pyx_t_16 = NULL;
  PyObject *(*__pyx_t_17)(PyObject *);
  double __pyx_t_18;
  int __pyx_t_19;
  double __pyx_t_20;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("finite_diff_corr", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args->__pyx_n > 0) {
      __pyx_v_delta = __pyx_optional_args->delta;
    }
  }
  __pyx_pybuffer_zm.pybuffer.buf = NULL;
  __pyx_pybuffer_zm.refcount = 0;
  __pyx_pybuffernd_zm.data = NULL;
  __pyx_pybuffernd_zm.rcbuffer = &__pyx_pybuffer_zm;
  __pyx_pybuffer_zp.pybuffer.buf = NULL;
  __pyx_pybuffer_zp.refcount = 0;
  __pyx_pybuffernd_zp.data = NULL;
  __pyx_pybuffernd_zp.rcbuffer = &__pyx_pybuffer_zp;
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  __pyx_pybuffer_ids.pybuffer.buf = NULL;
  __pyx_pybuffer_ids.refcount = 0;
  __pyx_pybuffernd_ids.data = NULL;
  __pyx_pybuffernd_ids.rcbuffer = &__pyx_pybuffer_ids;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1249, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1249, __pyx_L1_error)
  }
  __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_finite_diff_corr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1249, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_8vcstring_8vcstring_33finite_diff_corr)) {
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_image); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1249, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_dim); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1249, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1249, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_6 = PyFloat_FromDouble(__pyx_v_delta); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1249, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_7 = __pyx_t_1; __pyx_t_8 = NULL;
        __pyx_t_9 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
          __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
          if (likely(__pyx_t_8)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_8);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_7, function);
            __pyx_t_9 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_7)) {
          PyObject *__pyx_temp[8] = {__pyx_t_8, __pyx_t_3, __pyx_t_4, __pyx_v_traj, __pyx_t_5, ((PyObject *)__pyx_v_z), ((PyObject *)__pyx_v_ids), __pyx_t_6};
          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_9, 7+__pyx_t_9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1249, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
          PyObject *__pyx_temp[8] = {__pyx_t_8, __pyx_t_3, __pyx_t_4, __pyx_v_traj, __pyx_t_5, ((PyObject *)__pyx_v_z), ((PyObject *)__pyx_v_ids), __pyx_t_6};
          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_9, 7+__pyx_t_9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1249, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        {
          __pyx_t_10 = PyTuple_New(7+__pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1249, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          if (__pyx_t_8) {
            __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_8); __pyx_t_8 = NULL;
          }
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_10, 0+__pyx_t_9, __pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_4);
          PyTuple_SET_ITEM(__pyx_t_10, 1+__pyx_t_9, __pyx_t_4);
          __Pyx_INCREF(__pyx_v_traj);
          __Pyx_GIVEREF(__pyx_v_traj);
          PyTuple_SET_ITEM(__pyx_t_10, 2+__pyx_t_9, __pyx_v_traj);
          __Pyx_GIVEREF(__pyx_t_5);
          PyTuple_SET_ITEM(__pyx_t_10, 3+__pyx_t_9, __pyx_t_5);
          __Pyx_INCREF(((PyObject *)__pyx_v_z));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
          PyTuple_SET_ITEM(__pyx_t_10, 4+__pyx_t_9, ((PyObject *)__pyx_v_z));
          __Pyx_INCREF(((PyObject *)__pyx_v_ids));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_ids));
          PyTuple_SET_ITEM(__pyx_t_10, 5+__pyx_t_9, ((PyObject *)__pyx_v_ids));
          __Pyx_GIVEREF(__pyx_t_6);
          PyTuple_SET_ITEM(__pyx_t_10, 6+__pyx_t_9, __pyx_t_6);
          __pyx_t_3 = 0;
          __pyx_t_4 = 0;
          __pyx_t_5 = 0;
          __pyx_t_6 = 0;
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_10, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1249, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        }
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }

  /* "vcstring.pyx":1274
 *         cdef int i, j, N
 *         cdef double Cp, Cm, dC
 *         N = len(traj)             # <<<<<<<<<<<<<<
 *         print('\nFINITE DIFFERENCE PARAMETERS')
 *         print('----------------------------')
 */
  if (unlikely(__pyx_v_traj == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
    __PYX_ERR(0, 1274, __pyx_L1_error)
  }
  __pyx_t_11 = PyList_GET_SIZE(__pyx_v_traj); if (unlikely(__pyx_t_11 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1274, __pyx_L1_error)
  __pyx_v_N = __pyx_t_11;

  /* "vcstring.pyx":1275
 *         cdef double Cp, Cm, dC
 *         N = len(traj)
 *         print('\nFINITE DIFFERENCE PARAMETERS')             # <<<<<<<<<<<<<<
 *         print('----------------------------')
 *         print('Step change in position =', delta)
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__40, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1275, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1276
 *         N = len(traj)
 *         print('\nFINITE DIFFERENCE PARAMETERS')
 *         print('----------------------------')             # <<<<<<<<<<<<<<
 *         print('Step change in position =', delta)
 *         print(z)
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__42, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1276, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1277
 *         print('\nFINITE DIFFERENCE PARAMETERS')
 *         print('----------------------------')
 *         print('Step change in position =', delta)             # <<<<<<<<<<<<<<
 *         print(z)
 * 
 */
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_delta); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1277, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1277, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_Step_change_in_position);
  __Pyx_GIVEREF(__pyx_kp_u_Step_change_in_position);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_Step_change_in_position);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1277, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1278
 *         print('----------------------------')
 *         print('Step change in position =', delta)
 *         print(z)             # <<<<<<<<<<<<<<
 * 
 *         Cp_list = []
 */
  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, ((PyObject *)__pyx_v_z)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1278, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1280
 *         print(z)
 * 
 *         Cp_list = []             # <<<<<<<<<<<<<<
 *         Cm_list = []
 *         gradC_list = []
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1280, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_Cp_list = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":1281
 * 
 *         Cp_list = []
 *         Cm_list = []             # <<<<<<<<<<<<<<
 *         gradC_list = []
 *         for i in [image]:
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1281, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_Cm_list = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":1282
 *         Cp_list = []
 *         Cm_list = []
 *         gradC_list = []             # <<<<<<<<<<<<<<
 *         for i in [image]:
 *             for j in [dim]:
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1282, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_gradC_list = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":1283
 *         Cm_list = []
 *         gradC_list = []
 *         for i in [image]:             # <<<<<<<<<<<<<<
 *             for j in [dim]:
 *                 print('\n\n======================================')
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_image); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1283, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1283, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __pyx_t_2; __Pyx_INCREF(__pyx_t_1); __pyx_t_11 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (__pyx_t_11 >= 1) break;
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_11); __Pyx_INCREF(__pyx_t_2); __pyx_t_11++; if (unlikely(0 < 0)) __PYX_ERR(0, 1283, __pyx_L1_error)
    #else
    __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1283, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    #endif
    __pyx_t_9 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1283, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_i = __pyx_t_9;

    /* "vcstring.pyx":1284
 *         gradC_list = []
 *         for i in [image]:
 *             for j in [dim]:             # <<<<<<<<<<<<<<
 *                 print('\n\n======================================')
 *                 print('CALCULATING FINITE DIFFERENCE GRADIENT')
 */
    __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_dim); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1284, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1284, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_GIVEREF(__pyx_t_2);
    PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_2);
    __pyx_t_2 = 0;
    __pyx_t_2 = __pyx_t_7; __Pyx_INCREF(__pyx_t_2); __pyx_t_12 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    for (;;) {
      if (__pyx_t_12 >= 1) break;
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_12); __Pyx_INCREF(__pyx_t_7); __pyx_t_12++; if (unlikely(0 < 0)) __PYX_ERR(0, 1284, __pyx_L1_error)
      #else
      __pyx_t_7 = PySequence_ITEM(__pyx_t_2, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1284, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      #endif
      __pyx_t_9 = __Pyx_PyInt_As_int(__pyx_t_7); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1284, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_v_j = __pyx_t_9;

      /* "vcstring.pyx":1285
 *         for i in [image]:
 *             for j in [dim]:
 *                 print('\n\n======================================')             # <<<<<<<<<<<<<<
 *                 print('CALCULATING FINITE DIFFERENCE GRADIENT')
 *                 print('======================================')
 */
      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__44, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1285, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "vcstring.pyx":1286
 *             for j in [dim]:
 *                 print('\n\n======================================')
 *                 print('CALCULATING FINITE DIFFERENCE GRADIENT')             # <<<<<<<<<<<<<<
 *                 print('======================================')
 *                 print('image, dim:', i, j)
 */
      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__45, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1286, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "vcstring.pyx":1287
 *                 print('\n\n======================================')
 *                 print('CALCULATING FINITE DIFFERENCE GRADIENT')
 *                 print('======================================')             # <<<<<<<<<<<<<<
 *                 print('image, dim:', i, j)
 *                 print('Initial position:', z[i][j])
 */
      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__24, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1287, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "vcstring.pyx":1288
 *                 print('CALCULATING FINITE DIFFERENCE GRADIENT')
 *                 print('======================================')
 *                 print('image, dim:', i, j)             # <<<<<<<<<<<<<<
 *                 print('Initial position:', z[i][j])
 *                 sys.stdout.flush()
 */
      __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1288, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_10 = __Pyx_PyInt_From_int(__pyx_v_j); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1288, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1288, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_INCREF(__pyx_kp_u_image_dim);
      __Pyx_GIVEREF(__pyx_kp_u_image_dim);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_kp_u_image_dim);
      __Pyx_GIVEREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_7);
      __Pyx_GIVEREF(__pyx_t_10);
      PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_10);
      __pyx_t_7 = 0;
      __pyx_t_10 = 0;
      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_6, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1288, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

      /* "vcstring.pyx":1289
 *                 print('======================================')
 *                 print('image, dim:', i, j)
 *                 print('Initial position:', z[i][j])             # <<<<<<<<<<<<<<
 *                 sys.stdout.flush()
 * 
 */
      __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1289, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_10, __pyx_v_j, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1289, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1289, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_INCREF(__pyx_kp_u_Initial_position);
      __Pyx_GIVEREF(__pyx_kp_u_Initial_position);
      PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_kp_u_Initial_position);
      __Pyx_GIVEREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_6);
      __pyx_t_6 = 0;
      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_10, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1289, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

      /* "vcstring.pyx":1290
 *                 print('image, dim:', i, j)
 *                 print('Initial position:', z[i][j])
 *                 sys.stdout.flush()             # <<<<<<<<<<<<<<
 * 
 *                 # Calculate the finite difference gradient
 */
      __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_sys); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1290, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_stdout); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1290, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_flush); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1290, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_10))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_10);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_10, function);
        }
      }
      __pyx_t_6 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_10);
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1290, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

      /* "vcstring.pyx":1293
 * 
 *                 # Calculate the finite difference gradient
 *                 z[i][j] = z[i][j] + delta             # <<<<<<<<<<<<<<
 *                 zp = deepcopy(z)
 *                 b, D_0, D_tau, g_0, g_tau = self.calc_coeffs(N, tau, zp, ids) # Note: will be overwritten if saved
 */
      __pyx_t_6 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1293, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_10 = __Pyx_GetItemInt(__pyx_t_6, __pyx_v_j, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1293, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = PyFloat_FromDouble(__pyx_v_delta); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1293, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = PyNumber_Add(__pyx_t_10, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1293, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1293, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      if (unlikely(__Pyx_SetItemInt(__pyx_t_6, __pyx_v_j, __pyx_t_7, int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 1293, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "vcstring.pyx":1294
 *                 # Calculate the finite difference gradient
 *                 z[i][j] = z[i][j] + delta
 *                 zp = deepcopy(z)             # <<<<<<<<<<<<<<
 *                 b, D_0, D_tau, g_0, g_tau = self.calc_coeffs(N, tau, zp, ids) # Note: will be overwritten if saved
 *                 Cp = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)
 */
      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_deepcopy); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1294, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_10 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_6);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_6, function);
        }
      }
      __pyx_t_7 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_10, ((PyObject *)__pyx_v_z)) : __Pyx_PyObject_CallOneArg(__pyx_t_6, ((PyObject *)__pyx_v_z));
      __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1294, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1294, __pyx_L1_error)
      __pyx_t_13 = ((PyArrayObject *)__pyx_t_7);
      {
        __Pyx_BufFmt_StackElem __pyx_stack[1];
        __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_zp.rcbuffer->pybuffer);
        __pyx_t_9 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_zp.rcbuffer->pybuffer, (PyObject*)__pyx_t_13, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
        if (unlikely(__pyx_t_9 < 0)) {
          PyErr_Fetch(&__pyx_t_14, &__pyx_t_15, &__pyx_t_16);
          if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_zp.rcbuffer->pybuffer, (PyObject*)__pyx_v_zp, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
            Py_XDECREF(__pyx_t_14); Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_16);
            __Pyx_RaiseBufferFallbackError();
          } else {
            PyErr_Restore(__pyx_t_14, __pyx_t_15, __pyx_t_16);
          }
          __pyx_t_14 = __pyx_t_15 = __pyx_t_16 = 0;
        }
        __pyx_pybuffernd_zp.diminfo[0].strides = __pyx_pybuffernd_zp.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_zp.diminfo[0].shape = __pyx_pybuffernd_zp.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_zp.diminfo[1].strides = __pyx_pybuffernd_zp.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_zp.diminfo[1].shape = __pyx_pybuffernd_zp.rcbuffer->pybuffer.shape[1];
        if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 1294, __pyx_L1_error)
      }
      __pyx_t_13 = 0;
      __Pyx_XDECREF_SET(__pyx_v_zp, ((PyArrayObject *)__pyx_t_7));
      __pyx_t_7 = 0;

      /* "vcstring.pyx":1295
 *                 z[i][j] = z[i][j] + delta
 *                 zp = deepcopy(z)
 *                 b, D_0, D_tau, g_0, g_tau = self.calc_coeffs(N, tau, zp, ids) # Note: will be overwritten if saved             # <<<<<<<<<<<<<<
 *                 Cp = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)
 *                 Cp_list.append(Cp)
 */
      __pyx_t_7 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->calc_coeffs(__pyx_v_self, __pyx_v_N, __pyx_v_tau, ((PyArrayObject *)__pyx_v_zp), ((PyArrayObject *)__pyx_v_ids), 0, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1295, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      if ((likely(PyTuple_CheckExact(__pyx_t_7))) || (PyList_CheckExact(__pyx_t_7))) {
        PyObject* sequence = __pyx_t_7;
        Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
        if (unlikely(size != 5)) {
          if (size > 5) __Pyx_RaiseTooManyValuesError(5);
          else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
          __PYX_ERR(0, 1295, __pyx_L1_error)
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        if (likely(PyTuple_CheckExact(sequence))) {
          __pyx_t_6 = PyTuple_GET_ITEM(sequence, 0); 
          __pyx_t_10 = PyTuple_GET_ITEM(sequence, 1); 
          __pyx_t_5 = PyTuple_GET_ITEM(sequence, 2); 
          __pyx_t_4 = PyTuple_GET_ITEM(sequence, 3); 
          __pyx_t_3 = PyTuple_GET_ITEM(sequence, 4); 
        } else {
          __pyx_t_6 = PyList_GET_ITEM(sequence, 0); 
          __pyx_t_10 = PyList_GET_ITEM(sequence, 1); 
          __pyx_t_5 = PyList_GET_ITEM(sequence, 2); 
          __pyx_t_4 = PyList_GET_ITEM(sequence, 3); 
          __pyx_t_3 = PyList_GET_ITEM(sequence, 4); 
        }
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_3);
        #else
        {
          Py_ssize_t i;
          PyObject** temps[5] = {&__pyx_t_6,&__pyx_t_10,&__pyx_t_5,&__pyx_t_4,&__pyx_t_3};
          for (i=0; i < 5; i++) {
            PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) __PYX_ERR(0, 1295, __pyx_L1_error)
            __Pyx_GOTREF(item);
            *(temps[i]) = item;
          }
        }
        #endif
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      } else {
        Py_ssize_t index = -1;
        PyObject** temps[5] = {&__pyx_t_6,&__pyx_t_10,&__pyx_t_5,&__pyx_t_4,&__pyx_t_3};
        __pyx_t_8 = PyObject_GetIter(__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1295, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_17 = Py_TYPE(__pyx_t_8)->tp_iternext;
        for (index=0; index < 5; index++) {
          PyObject* item = __pyx_t_17(__pyx_t_8); if (unlikely(!item)) goto __pyx_L7_unpacking_failed;
          __Pyx_GOTREF(item);
          *(temps[index]) = item;
        }
        if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_8), 5) < 0) __PYX_ERR(0, 1295, __pyx_L1_error)
        __pyx_t_17 = NULL;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        goto __pyx_L8_unpacking_done;
        __pyx_L7_unpacking_failed:;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_t_17 = NULL;
        if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
        __PYX_ERR(0, 1295, __pyx_L1_error)
        __pyx_L8_unpacking_done:;
      }
      __Pyx_XDECREF_SET(__pyx_v_b, __pyx_t_6);
      __pyx_t_6 = 0;
      __Pyx_XDECREF_SET(__pyx_v_D_0, __pyx_t_10);
      __pyx_t_10 = 0;
      __Pyx_XDECREF_SET(__pyx_v_D_tau, __pyx_t_5);
      __pyx_t_5 = 0;
      __Pyx_XDECREF_SET(__pyx_v_g_0, __pyx_t_4);
      __pyx_t_4 = 0;
      __Pyx_XDECREF_SET(__pyx_v_g_tau, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "vcstring.pyx":1296
 *                 zp = deepcopy(z)
 *                 b, D_0, D_tau, g_0, g_tau = self.calc_coeffs(N, tau, zp, ids) # Note: will be overwritten if saved
 *                 Cp = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)             # <<<<<<<<<<<<<<
 *                 Cp_list.append(Cp)
 *                 print('Corr (+) =', Cp)
 */
      if (!(likely(((__pyx_v_b) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_b, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1296, __pyx_L1_error)
      if (!(likely(((__pyx_v_D_0) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_D_0, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1296, __pyx_L1_error)
      if (!(likely(((__pyx_v_D_tau) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_D_tau, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1296, __pyx_L1_error)
      if (!(likely(((__pyx_v_g_0) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_g_0, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1296, __pyx_L1_error)
      if (!(likely(((__pyx_v_g_tau) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_g_tau, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1296, __pyx_L1_error)
      __pyx_t_7 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->calc_corr(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, ((PyArrayObject *)__pyx_v_b), ((PyArrayObject *)__pyx_v_D_0), ((PyArrayObject *)__pyx_v_D_tau), ((PyArrayObject *)__pyx_v_g_0), ((PyArrayObject *)__pyx_v_g_tau), 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1296, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_18 = __pyx_PyFloat_AsDouble(__pyx_t_7); if (unlikely((__pyx_t_18 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1296, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_v_Cp = __pyx_t_18;

      /* "vcstring.pyx":1297
 *                 b, D_0, D_tau, g_0, g_tau = self.calc_coeffs(N, tau, zp, ids) # Note: will be overwritten if saved
 *                 Cp = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)
 *                 Cp_list.append(Cp)             # <<<<<<<<<<<<<<
 *                 print('Corr (+) =', Cp)
 *                 print()
 */
      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_Cp); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1297, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_19 = __Pyx_PyList_Append(__pyx_v_Cp_list, __pyx_t_7); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 1297, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "vcstring.pyx":1298
 *                 Cp = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)
 *                 Cp_list.append(Cp)
 *                 print('Corr (+) =', Cp)             # <<<<<<<<<<<<<<
 *                 print()
 *                 z[i][j] = z[i][j] - 2 * delta
 */
      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_Cp); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1298, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1298, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_INCREF(__pyx_kp_u_Corr_2);
      __Pyx_GIVEREF(__pyx_kp_u_Corr_2);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_u_Corr_2);
      __Pyx_GIVEREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_7);
      __pyx_t_7 = 0;
      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_3, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1298, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "vcstring.pyx":1299
 *                 Cp_list.append(Cp)
 *                 print('Corr (+) =', Cp)
 *                 print()             # <<<<<<<<<<<<<<
 *                 z[i][j] = z[i][j] - 2 * delta
 *                 zm = deepcopy(z)
 */
      __pyx_t_7 = __Pyx_PyObject_CallNoArg(__pyx_builtin_print); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1299, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "vcstring.pyx":1300
 *                 print('Corr (+) =', Cp)
 *                 print()
 *                 z[i][j] = z[i][j] - 2 * delta             # <<<<<<<<<<<<<<
 *                 zm = deepcopy(z)
 *                 b, D_0, D_tau, g_0, g_tau = self.calc_coeffs(N, tau, zm, ids)
 */
      __pyx_t_7 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1300, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_7, __pyx_v_j, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1300, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = PyFloat_FromDouble((2.0 * __pyx_v_delta)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1300, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_4 = PyNumber_Subtract(__pyx_t_3, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1300, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1300, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      if (unlikely(__Pyx_SetItemInt(__pyx_t_7, __pyx_v_j, __pyx_t_4, int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 1300, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "vcstring.pyx":1301
 *                 print()
 *                 z[i][j] = z[i][j] - 2 * delta
 *                 zm = deepcopy(z)             # <<<<<<<<<<<<<<
 *                 b, D_0, D_tau, g_0, g_tau = self.calc_coeffs(N, tau, zm, ids)
 *                 Cm = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)
 */
      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_deepcopy); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1301, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_3 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
        __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_7);
        if (likely(__pyx_t_3)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_7, function);
        }
      }
      __pyx_t_4 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_3, ((PyObject *)__pyx_v_z)) : __Pyx_PyObject_CallOneArg(__pyx_t_7, ((PyObject *)__pyx_v_z));
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1301, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1301, __pyx_L1_error)
      __pyx_t_13 = ((PyArrayObject *)__pyx_t_4);
      {
        __Pyx_BufFmt_StackElem __pyx_stack[1];
        __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_zm.rcbuffer->pybuffer);
        __pyx_t_9 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_zm.rcbuffer->pybuffer, (PyObject*)__pyx_t_13, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
        if (unlikely(__pyx_t_9 < 0)) {
          PyErr_Fetch(&__pyx_t_16, &__pyx_t_15, &__pyx_t_14);
          if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_zm.rcbuffer->pybuffer, (PyObject*)__pyx_v_zm, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
            Py_XDECREF(__pyx_t_16); Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_14);
            __Pyx_RaiseBufferFallbackError();
          } else {
            PyErr_Restore(__pyx_t_16, __pyx_t_15, __pyx_t_14);
          }
          __pyx_t_16 = __pyx_t_15 = __pyx_t_14 = 0;
        }
        __pyx_pybuffernd_zm.diminfo[0].strides = __pyx_pybuffernd_zm.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_zm.diminfo[0].shape = __pyx_pybuffernd_zm.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_zm.diminfo[1].strides = __pyx_pybuffernd_zm.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_zm.diminfo[1].shape = __pyx_pybuffernd_zm.rcbuffer->pybuffer.shape[1];
        if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 1301, __pyx_L1_error)
      }
      __pyx_t_13 = 0;
      __Pyx_XDECREF_SET(__pyx_v_zm, ((PyArrayObject *)__pyx_t_4));
      __pyx_t_4 = 0;

      /* "vcstring.pyx":1302
 *                 z[i][j] = z[i][j] - 2 * delta
 *                 zm = deepcopy(z)
 *                 b, D_0, D_tau, g_0, g_tau = self.calc_coeffs(N, tau, zm, ids)             # <<<<<<<<<<<<<<
 *                 Cm = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)
 *                 Cm_list.append(Cm)
 */
      __pyx_t_4 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->calc_coeffs(__pyx_v_self, __pyx_v_N, __pyx_v_tau, ((PyArrayObject *)__pyx_v_zm), ((PyArrayObject *)__pyx_v_ids), 0, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1302, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
        PyObject* sequence = __pyx_t_4;
        Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
        if (unlikely(size != 5)) {
          if (size > 5) __Pyx_RaiseTooManyValuesError(5);
          else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
          __PYX_ERR(0, 1302, __pyx_L1_error)
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        if (likely(PyTuple_CheckExact(sequence))) {
          __pyx_t_7 = PyTuple_GET_ITEM(sequence, 0); 
          __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
          __pyx_t_5 = PyTuple_GET_ITEM(sequence, 2); 
          __pyx_t_10 = PyTuple_GET_ITEM(sequence, 3); 
          __pyx_t_6 = PyTuple_GET_ITEM(sequence, 4); 
        } else {
          __pyx_t_7 = PyList_GET_ITEM(sequence, 0); 
          __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
          __pyx_t_5 = PyList_GET_ITEM(sequence, 2); 
          __pyx_t_10 = PyList_GET_ITEM(sequence, 3); 
          __pyx_t_6 = PyList_GET_ITEM(sequence, 4); 
        }
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(__pyx_t_6);
        #else
        {
          Py_ssize_t i;
          PyObject** temps[5] = {&__pyx_t_7,&__pyx_t_3,&__pyx_t_5,&__pyx_t_10,&__pyx_t_6};
          for (i=0; i < 5; i++) {
            PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) __PYX_ERR(0, 1302, __pyx_L1_error)
            __Pyx_GOTREF(item);
            *(temps[i]) = item;
          }
        }
        #endif
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      } else {
        Py_ssize_t index = -1;
        PyObject** temps[5] = {&__pyx_t_7,&__pyx_t_3,&__pyx_t_5,&__pyx_t_10,&__pyx_t_6};
        __pyx_t_8 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1302, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_17 = Py_TYPE(__pyx_t_8)->tp_iternext;
        for (index=0; index < 5; index++) {
          PyObject* item = __pyx_t_17(__pyx_t_8); if (unlikely(!item)) goto __pyx_L9_unpacking_failed;
          __Pyx_GOTREF(item);
          *(temps[index]) = item;
        }
        if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_8), 5) < 0) __PYX_ERR(0, 1302, __pyx_L1_error)
        __pyx_t_17 = NULL;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        goto __pyx_L10_unpacking_done;
        __pyx_L9_unpacking_failed:;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_t_17 = NULL;
        if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
        __PYX_ERR(0, 1302, __pyx_L1_error)
        __pyx_L10_unpacking_done:;
      }
      __Pyx_DECREF_SET(__pyx_v_b, __pyx_t_7);
      __pyx_t_7 = 0;
      __Pyx_DECREF_SET(__pyx_v_D_0, __pyx_t_3);
      __pyx_t_3 = 0;
      __Pyx_DECREF_SET(__pyx_v_D_tau, __pyx_t_5);
      __pyx_t_5 = 0;
      __Pyx_DECREF_SET(__pyx_v_g_0, __pyx_t_10);
      __pyx_t_10 = 0;
      __Pyx_DECREF_SET(__pyx_v_g_tau, __pyx_t_6);
      __pyx_t_6 = 0;

      /* "vcstring.pyx":1303
 *                 zm = deepcopy(z)
 *                 b, D_0, D_tau, g_0, g_tau = self.calc_coeffs(N, tau, zm, ids)
 *                 Cm = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)             # <<<<<<<<<<<<<<
 *                 Cm_list.append(Cm)
 *                 print('Corr (-) =', Cm)
 */
      if (!(likely(((__pyx_v_b) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_b, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1303, __pyx_L1_error)
      if (!(likely(((__pyx_v_D_0) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_D_0, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1303, __pyx_L1_error)
      if (!(likely(((__pyx_v_D_tau) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_D_tau, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1303, __pyx_L1_error)
      if (!(likely(((__pyx_v_g_0) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_g_0, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1303, __pyx_L1_error)
      if (!(likely(((__pyx_v_g_tau) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_g_tau, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1303, __pyx_L1_error)
      __pyx_t_4 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->calc_corr(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, ((PyArrayObject *)__pyx_v_b), ((PyArrayObject *)__pyx_v_D_0), ((PyArrayObject *)__pyx_v_D_tau), ((PyArrayObject *)__pyx_v_g_0), ((PyArrayObject *)__pyx_v_g_tau), 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1303, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_18 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_18 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1303, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_v_Cm = __pyx_t_18;

      /* "vcstring.pyx":1304
 *                 b, D_0, D_tau, g_0, g_tau = self.calc_coeffs(N, tau, zm, ids)
 *                 Cm = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)
 *                 Cm_list.append(Cm)             # <<<<<<<<<<<<<<
 *                 print('Corr (-) =', Cm)
 *                 dC = (Cp - Cm) / (2 * delta)  # derivative
 */
      __pyx_t_4 = PyFloat_FromDouble(__pyx_v_Cm); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1304, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_19 = __Pyx_PyList_Append(__pyx_v_Cm_list, __pyx_t_4); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 1304, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "vcstring.pyx":1305
 *                 Cm = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)
 *                 Cm_list.append(Cm)
 *                 print('Corr (-) =', Cm)             # <<<<<<<<<<<<<<
 *                 dC = (Cp - Cm) / (2 * delta)  # derivative
 *                 z[i][j] = z[i][j] + delta  # move z back to original value for next iteration
 */
      __pyx_t_4 = PyFloat_FromDouble(__pyx_v_Cm); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1305, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1305, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_INCREF(__pyx_kp_u_Corr_3);
      __Pyx_GIVEREF(__pyx_kp_u_Corr_3);
      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_kp_u_Corr_3);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_4);
      __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_6, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1305, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "vcstring.pyx":1306
 *                 Cm_list.append(Cm)
 *                 print('Corr (-) =', Cm)
 *                 dC = (Cp - Cm) / (2 * delta)  # derivative             # <<<<<<<<<<<<<<
 *                 z[i][j] = z[i][j] + delta  # move z back to original value for next iteration
 *                 print('\nInitial position:', z[i][j])
 */
      __pyx_t_18 = (__pyx_v_Cp - __pyx_v_Cm);
      __pyx_t_20 = (2.0 * __pyx_v_delta);
      if (unlikely(__pyx_t_20 == 0)) {
        PyErr_SetString(PyExc_ZeroDivisionError, "float division");
        __PYX_ERR(0, 1306, __pyx_L1_error)
      }
      __pyx_v_dC = (__pyx_t_18 / __pyx_t_20);

      /* "vcstring.pyx":1307
 *                 print('Corr (-) =', Cm)
 *                 dC = (Cp - Cm) / (2 * delta)  # derivative
 *                 z[i][j] = z[i][j] + delta  # move z back to original value for next iteration             # <<<<<<<<<<<<<<
 *                 print('\nInitial position:', z[i][j])
 *                 print('Plus/minus delta:', zp[i][j], zm[i][j])
 */
      __pyx_t_4 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1307, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_4, __pyx_v_j, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1307, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyFloat_FromDouble(__pyx_v_delta); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1307, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_10 = PyNumber_Add(__pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1307, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1307, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      if (unlikely(__Pyx_SetItemInt(__pyx_t_4, __pyx_v_j, __pyx_t_10, int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 1307, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

      /* "vcstring.pyx":1308
 *                 dC = (Cp - Cm) / (2 * delta)  # derivative
 *                 z[i][j] = z[i][j] + delta  # move z back to original value for next iteration
 *                 print('\nInitial position:', z[i][j])             # <<<<<<<<<<<<<<
 *                 print('Plus/minus delta:', zp[i][j], zm[i][j])
 *                 print('gradC:', dC)
 */
      __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1308, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_10, __pyx_v_j, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1308, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1308, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_INCREF(__pyx_kp_u_Initial_position_2);
      __Pyx_GIVEREF(__pyx_kp_u_Initial_position_2);
      PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_kp_u_Initial_position_2);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_4);
      __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_10, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1308, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "vcstring.pyx":1309
 *                 z[i][j] = z[i][j] + delta  # move z back to original value for next iteration
 *                 print('\nInitial position:', z[i][j])
 *                 print('Plus/minus delta:', zp[i][j], zm[i][j])             # <<<<<<<<<<<<<<
 *                 print('gradC:', dC)
 *                 gradC_list.append(dC)
 */
      __pyx_t_4 = __Pyx_GetItemInt(((PyObject *)__pyx_v_zp), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1309, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_10 = __Pyx_GetItemInt(__pyx_t_4, __pyx_v_j, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1309, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_GetItemInt(((PyObject *)__pyx_v_zm), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1309, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_4, __pyx_v_j, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1309, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1309, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_INCREF(__pyx_kp_u_Plus_minus_delta);
      __Pyx_GIVEREF(__pyx_kp_u_Plus_minus_delta);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_Plus_minus_delta);
      __Pyx_GIVEREF(__pyx_t_10);
      PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_t_6);
      __pyx_t_10 = 0;
      __pyx_t_6 = 0;
      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1309, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

      /* "vcstring.pyx":1310
 *                 print('\nInitial position:', z[i][j])
 *                 print('Plus/minus delta:', zp[i][j], zm[i][j])
 *                 print('gradC:', dC)             # <<<<<<<<<<<<<<
 *                 gradC_list.append(dC)
 *                 # else:
 */
      __pyx_t_6 = PyFloat_FromDouble(__pyx_v_dC); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1310, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1310, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_INCREF(__pyx_kp_u_gradC);
      __Pyx_GIVEREF(__pyx_kp_u_gradC);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_gradC);
      __Pyx_GIVEREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_6);
      __pyx_t_6 = 0;
      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1310, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

      /* "vcstring.pyx":1311
 *                 print('Plus/minus delta:', zp[i][j], zm[i][j])
 *                 print('gradC:', dC)
 *                 gradC_list.append(dC)             # <<<<<<<<<<<<<<
 *                 # else:
 *                 #     print('\nWARNING: No finite difference computed')
 */
      __pyx_t_6 = PyFloat_FromDouble(__pyx_v_dC); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1311, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_19 = __Pyx_PyList_Append(__pyx_v_gradC_list, __pyx_t_6); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 1311, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

      /* "vcstring.pyx":1284
 *         gradC_list = []
 *         for i in [image]:
 *             for j in [dim]:             # <<<<<<<<<<<<<<
 *                 print('\n\n======================================')
 *                 print('CALCULATING FINITE DIFFERENCE GRADIENT')
 */
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "vcstring.pyx":1283
 *         Cm_list = []
 *         gradC_list = []
 *         for i in [image]:             # <<<<<<<<<<<<<<
 *             for j in [dim]:
 *                 print('\n\n======================================')
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1314
 *                 # else:
 *                 #     print('\nWARNING: No finite difference computed')
 *         np.savez('output/gradC.npz',             # <<<<<<<<<<<<<<
 *                  Cp=Cp_list,
 *                  Cm=Cm_list,
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1314, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_savez); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1314, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1315
 *                 #     print('\nWARNING: No finite difference computed')
 *         np.savez('output/gradC.npz',
 *                  Cp=Cp_list,             # <<<<<<<<<<<<<<
 *                  Cm=Cm_list,
 *                  gradC=gradC_list,)
 */
  __pyx_t_1 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1315, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_Cp, __pyx_v_Cp_list) < 0) __PYX_ERR(0, 1315, __pyx_L1_error)

  /* "vcstring.pyx":1316
 *         np.savez('output/gradC.npz',
 *                  Cp=Cp_list,
 *                  Cm=Cm_list,             # <<<<<<<<<<<<<<
 *                  gradC=gradC_list,)
 *         print('\nFINITE DIFFERENCE COMPLETED')
 */
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_Cm, __pyx_v_Cm_list) < 0) __PYX_ERR(0, 1315, __pyx_L1_error)

  /* "vcstring.pyx":1317
 *                  Cp=Cp_list,
 *                  Cm=Cm_list,
 *                  gradC=gradC_list,)             # <<<<<<<<<<<<<<
 *         print('\nFINITE DIFFERENCE COMPLETED')
 *         print('\n\n===============')
 */
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_gradC_2, __pyx_v_gradC_list) < 0) __PYX_ERR(0, 1315, __pyx_L1_error)

  /* "vcstring.pyx":1314
 *                 # else:
 *                 #     print('\nWARNING: No finite difference computed')
 *         np.savez('output/gradC.npz',             # <<<<<<<<<<<<<<
 *                  Cp=Cp_list,
 *                  Cm=Cm_list,
 */
  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_tuple__46, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1314, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "vcstring.pyx":1318
 *                  Cm=Cm_list,
 *                  gradC=gradC_list,)
 *         print('\nFINITE DIFFERENCE COMPLETED')             # <<<<<<<<<<<<<<
 *         print('\n\n===============')
 *         print('    SUMMARY    ')
 */
  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__47, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1318, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "vcstring.pyx":1319
 *                  gradC=gradC_list,)
 *         print('\nFINITE DIFFERENCE COMPLETED')
 *         print('\n\n===============')             # <<<<<<<<<<<<<<
 *         print('    SUMMARY    ')
 *         print('===============')
 */
  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__49, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "vcstring.pyx":1320
 *         print('\nFINITE DIFFERENCE COMPLETED')
 *         print('\n\n===============')
 *         print('    SUMMARY    ')             # <<<<<<<<<<<<<<
 *         print('===============')
 *         print('\nCp =', Cp_list)
 */
  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__50, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1320, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "vcstring.pyx":1321
 *         print('\n\n===============')
 *         print('    SUMMARY    ')
 *         print('===============')             # <<<<<<<<<<<<<<
 *         print('\nCp =', Cp_list)
 *         print('Cm =', Cm_list)
 */
  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__52, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1321, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "vcstring.pyx":1322
 *         print('    SUMMARY    ')
 *         print('===============')
 *         print('\nCp =', Cp_list)             # <<<<<<<<<<<<<<
 *         print('Cm =', Cm_list)
 *         print('gradC', gradC_list)
 */
  __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1322, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_INCREF(__pyx_kp_u_Cp_2);
  __Pyx_GIVEREF(__pyx_kp_u_Cp_2);
  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_kp_u_Cp_2);
  __Pyx_INCREF(__pyx_v_Cp_list);
  __Pyx_GIVEREF(__pyx_v_Cp_list);
  PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_v_Cp_list);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1322, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1323
 *         print('===============')
 *         print('\nCp =', Cp_list)
 *         print('Cm =', Cm_list)             # <<<<<<<<<<<<<<
 *         print('gradC', gradC_list)
 * 
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1323, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_Cm_2);
  __Pyx_GIVEREF(__pyx_kp_u_Cm_2);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Cm_2);
  __Pyx_INCREF(__pyx_v_Cm_list);
  __Pyx_GIVEREF(__pyx_v_Cm_list);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_Cm_list);
  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1323, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "vcstring.pyx":1324
 *         print('\nCp =', Cp_list)
 *         print('Cm =', Cm_list)
 *         print('gradC', gradC_list)             # <<<<<<<<<<<<<<
 * 
 *         return Cp_list, Cm_list, gradC_list
 */
  __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1324, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_INCREF(__pyx_n_u_gradC_2);
  __Pyx_GIVEREF(__pyx_n_u_gradC_2);
  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_n_u_gradC_2);
  __Pyx_INCREF(__pyx_v_gradC_list);
  __Pyx_GIVEREF(__pyx_v_gradC_list);
  PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_v_gradC_list);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1324, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1326
 *         print('gradC', gradC_list)
 * 
 *         return Cp_list, Cm_list, gradC_list             # <<<<<<<<<<<<<<
 * 
 *     cpdef finite_diff_committor(self, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=1] b, list start, double delta=0.1, double epsilon=1.0):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1326, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_Cp_list);
  __Pyx_GIVEREF(__pyx_v_Cp_list);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_Cp_list);
  __Pyx_INCREF(__pyx_v_Cm_list);
  __Pyx_GIVEREF(__pyx_v_Cm_list);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_Cm_list);
  __Pyx_INCREF(__pyx_v_gradC_list);
  __Pyx_GIVEREF(__pyx_v_gradC_list);
  PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_v_gradC_list);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "vcstring.pyx":1249
 * 
 * 
 *     cpdef finite_diff_corr(self, int image, int dim, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=2] ids, double delta=0.1):             # <<<<<<<<<<<<<<
 *         """
 *         Calculate the finite difference gradient of the committor correlation function.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_10);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_zm.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_zp.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.finite_diff_corr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_zm.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_zp.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XDECREF((PyObject *)__pyx_v_zm);
  __Pyx_XDECREF((PyObject *)__pyx_v_zp);
  __Pyx_XDECREF(__pyx_v_Cp_list);
  __Pyx_XDECREF(__pyx_v_Cm_list);
  __Pyx_XDECREF(__pyx_v_gradC_list);
  __Pyx_XDECREF(__pyx_v_b);
  __Pyx_XDECREF(__pyx_v_D_0);
  __Pyx_XDECREF(__pyx_v_D_tau);
  __Pyx_XDECREF(__pyx_v_g_0);
  __Pyx_XDECREF(__pyx_v_g_tau);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_33finite_diff_corr(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8vcstring_8vcstring_32finite_diff_corr[] = "\n        Calculate the finite difference gradient of the committor correlation function.\n        A central finite difference is computed here.\n    \n        Parameters:\n        -----------\n        N  :  dimension of the state space. E.g., N=2 can be described by (x,y) coordinates\n        M  :  number of images on the Voronoi string\n        traj : trajectory\n        delta : Step change in the Voronoi centroid position, default = 0.01\n        mode  : 'full' computes the full finite difference derivative (default), 'plus' computes the \n                 positive change in correlation, 'min' computes the negative change in correlation.\n        save  : specifies whether to save results as numpy file. \n                'coeffs' saves results from calc_coeffs(),\n                'fd' saves correlation and gradient information. \n                'all' saves all results. Default='all'\n\n        Return:\n        -------\n        ";
static PyObject *__pyx_pw_8vcstring_8vcstring_33finite_diff_corr(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_image;
  int __pyx_v_dim;
  PyObject *__pyx_v_traj = 0;
  int __pyx_v_tau;
  PyArrayObject *__pyx_v_z = 0;
  PyArrayObject *__pyx_v_ids = 0;
  double __pyx_v_delta;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("finite_diff_corr (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_image,&__pyx_n_s_dim,&__pyx_n_s_traj,&__pyx_n_s_tau,&__pyx_n_s_z,&__pyx_n_s_ids,&__pyx_n_s_delta,0};
    PyObject* values[7] = {0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_image)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dim)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("finite_diff_corr", 0, 6, 7, 1); __PYX_ERR(0, 1249, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_traj)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("finite_diff_corr", 0, 6, 7, 2); __PYX_ERR(0, 1249, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tau)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("finite_diff_corr", 0, 6, 7, 3); __PYX_ERR(0, 1249, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("finite_diff_corr", 0, 6, 7, 4); __PYX_ERR(0, 1249, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ids)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("finite_diff_corr", 0, 6, 7, 5); __PYX_ERR(0, 1249, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_delta);
          if (value) { values[6] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "finite_diff_corr") < 0)) __PYX_ERR(0, 1249, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_image = __Pyx_PyInt_As_int(values[0]); if (unlikely((__pyx_v_image == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1249, __pyx_L3_error)
    __pyx_v_dim = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_dim == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1249, __pyx_L3_error)
    __pyx_v_traj = ((PyObject*)values[2]);
    __pyx_v_tau = __Pyx_PyInt_As_int(values[3]); if (unlikely((__pyx_v_tau == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1249, __pyx_L3_error)
    __pyx_v_z = ((PyArrayObject *)values[4]);
    __pyx_v_ids = ((PyArrayObject *)values[5]);
    if (values[6]) {
      __pyx_v_delta = __pyx_PyFloat_AsDouble(values[6]); if (unlikely((__pyx_v_delta == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1249, __pyx_L3_error)
    } else {
      __pyx_v_delta = ((double)0.1);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("finite_diff_corr", 0, 6, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1249, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.vcstring.finite_diff_corr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_traj), (&PyList_Type), 1, "traj", 1))) __PYX_ERR(0, 1249, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_z), __pyx_ptype_5numpy_ndarray, 1, "z", 0))) __PYX_ERR(0, 1249, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ids), __pyx_ptype_5numpy_ndarray, 1, "ids", 0))) __PYX_ERR(0, 1249, __pyx_L1_error)
  __pyx_r = __pyx_pf_8vcstring_8vcstring_32finite_diff_corr(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self), __pyx_v_image, __pyx_v_dim, __pyx_v_traj, __pyx_v_tau, __pyx_v_z, __pyx_v_ids, __pyx_v_delta);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_32finite_diff_corr(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, int __pyx_v_image, int __pyx_v_dim, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_ids, double __pyx_v_delta) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ids;
  __Pyx_Buffer __pyx_pybuffer_ids;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  struct __pyx_opt_args_8vcstring_8vcstring_finite_diff_corr __pyx_t_2;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("finite_diff_corr", 0);
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  __pyx_pybuffer_ids.pybuffer.buf = NULL;
  __pyx_pybuffer_ids.refcount = 0;
  __pyx_pybuffernd_ids.data = NULL;
  __pyx_pybuffernd_ids.rcbuffer = &__pyx_pybuffer_ids;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1249, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1249, __pyx_L1_error)
  }
  __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2.__pyx_n = 1;
  __pyx_t_2.delta = __pyx_v_delta;
  __pyx_t_1 = __pyx_vtabptr_8vcstring_vcstring->finite_diff_corr(__pyx_v_self, __pyx_v_image, __pyx_v_dim, __pyx_v_traj, __pyx_v_tau, __pyx_v_z, __pyx_v_ids, 1, &__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1249, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.finite_diff_corr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":1328
 *         return Cp_list, Cm_list, gradC_list
 * 
 *     cpdef finite_diff_committor(self, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=1] b, list start, double delta=0.1, double epsilon=1.0):             # <<<<<<<<<<<<<<
 *         """Finite difference to get the gradient of the committor"""
 *         cdef np.ndarray[DTYPE_t, ndim=1] dist, dist_p, dist_m, dist_new
 */

static PyObject *__pyx_pw_8vcstring_8vcstring_35finite_diff_committor(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_finite_diff_committor(CYTHON_UNUSED struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_b, PyObject *__pyx_v_start, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_finite_diff_committor *__pyx_optional_args) {
  double __pyx_v_delta = ((double)0.1);
  double __pyx_v_epsilon = ((double)1.0);
  PyArrayObject *__pyx_v_dist = 0;
  PyArrayObject *__pyx_v_dist_p = 0;
  PyArrayObject *__pyx_v_dist_m = 0;
  PyArrayObject *__pyx_v_dist_new = 0;
  PyArrayObject *__pyx_v_zp = 0;
  PyArrayObject *__pyx_v_zm = 0;
  int __pyx_v_id_start;
  int __pyx_v_i;
  int __pyx_v_id_p;
  int __pyx_v_id_m;
  int __pyx_v_id_new;
  double __pyx_v_qp;
  double __pyx_v_qm;
  double __pyx_v_znew_x;
  double __pyx_v_znew_y;
  PyObject *__pyx_v_dq_list = 0;
  CYTHON_UNUSED PyObject *__pyx_v_znew = 0;
  double __pyx_v_dq;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_dist;
  __Pyx_Buffer __pyx_pybuffer_dist;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_dist_m;
  __Pyx_Buffer __pyx_pybuffer_dist_m;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_dist_new;
  __Pyx_Buffer __pyx_pybuffer_dist_new;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_dist_p;
  __Pyx_Buffer __pyx_pybuffer_dist_p;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_zm;
  __Pyx_Buffer __pyx_pybuffer_zm;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_zp;
  __Pyx_Buffer __pyx_pybuffer_zp;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyArrayObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyArrayObject *__pyx_t_13 = NULL;
  int __pyx_t_14;
  Py_ssize_t __pyx_t_15;
  double __pyx_t_16;
  double __pyx_t_17;
  int __pyx_t_18;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("finite_diff_committor", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args->__pyx_n > 0) {
      __pyx_v_delta = __pyx_optional_args->delta;
      if (__pyx_optional_args->__pyx_n > 1) {
        __pyx_v_epsilon = __pyx_optional_args->epsilon;
      }
    }
  }
  __pyx_pybuffer_dist.pybuffer.buf = NULL;
  __pyx_pybuffer_dist.refcount = 0;
  __pyx_pybuffernd_dist.data = NULL;
  __pyx_pybuffernd_dist.rcbuffer = &__pyx_pybuffer_dist;
  __pyx_pybuffer_dist_p.pybuffer.buf = NULL;
  __pyx_pybuffer_dist_p.refcount = 0;
  __pyx_pybuffernd_dist_p.data = NULL;
  __pyx_pybuffernd_dist_p.rcbuffer = &__pyx_pybuffer_dist_p;
  __pyx_pybuffer_dist_m.pybuffer.buf = NULL;
  __pyx_pybuffer_dist_m.refcount = 0;
  __pyx_pybuffernd_dist_m.data = NULL;
  __pyx_pybuffernd_dist_m.rcbuffer = &__pyx_pybuffer_dist_m;
  __pyx_pybuffer_dist_new.pybuffer.buf = NULL;
  __pyx_pybuffer_dist_new.refcount = 0;
  __pyx_pybuffernd_dist_new.data = NULL;
  __pyx_pybuffernd_dist_new.rcbuffer = &__pyx_pybuffer_dist_new;
  __pyx_pybuffer_zp.pybuffer.buf = NULL;
  __pyx_pybuffer_zp.refcount = 0;
  __pyx_pybuffernd_zp.data = NULL;
  __pyx_pybuffernd_zp.rcbuffer = &__pyx_pybuffer_zp;
  __pyx_pybuffer_zm.pybuffer.buf = NULL;
  __pyx_pybuffer_zm.refcount = 0;
  __pyx_pybuffernd_zm.data = NULL;
  __pyx_pybuffernd_zm.rcbuffer = &__pyx_pybuffer_zm;
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1328, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1328, __pyx_L1_error)
  }
  __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_finite_diff_committor); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1328, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_8vcstring_8vcstring_35finite_diff_committor)) {
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_delta); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1328, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_epsilon); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1328, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_5 = __pyx_t_1; __pyx_t_6 = NULL;
        __pyx_t_7 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
          __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
          if (likely(__pyx_t_6)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
            __Pyx_INCREF(__pyx_t_6);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_5, function);
            __pyx_t_7 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[6] = {__pyx_t_6, ((PyObject *)__pyx_v_z), ((PyObject *)__pyx_v_b), __pyx_v_start, __pyx_t_3, __pyx_t_4};
          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 5+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1328, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[6] = {__pyx_t_6, ((PyObject *)__pyx_v_z), ((PyObject *)__pyx_v_b), __pyx_v_start, __pyx_t_3, __pyx_t_4};
          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 5+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1328, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        } else
        #endif
        {
          __pyx_t_8 = PyTuple_New(5+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1328, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          if (__pyx_t_6) {
            __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
          }
          __Pyx_INCREF(((PyObject *)__pyx_v_z));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
          PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, ((PyObject *)__pyx_v_z));
          __Pyx_INCREF(((PyObject *)__pyx_v_b));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
          PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, ((PyObject *)__pyx_v_b));
          __Pyx_INCREF(__pyx_v_start);
          __Pyx_GIVEREF(__pyx_v_start);
          PyTuple_SET_ITEM(__pyx_t_8, 2+__pyx_t_7, __pyx_v_start);
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_8, 3+__pyx_t_7, __pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_4);
          PyTuple_SET_ITEM(__pyx_t_8, 4+__pyx_t_7, __pyx_t_4);
          __pyx_t_3 = 0;
          __pyx_t_4 = 0;
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1328, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        }
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }

  /* "vcstring.pyx":1337
 * 
 *         # print('Starting position:', start)
 *         dist = sqrt((z[:, 0] - start[0]) ** 2 + (z[:, 1] - start[1]) ** 2) # Find closest point in z             # <<<<<<<<<<<<<<
 *         id_start = np.argmin(dist)
 *         dq_list = []
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1337, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_z), __pyx_tuple__9); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1337, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  if (unlikely(__pyx_v_start == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(0, 1337, __pyx_L1_error)
  }
  __pyx_t_8 = __Pyx_GetItemInt_List(__pyx_v_start, 0, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1337, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_4 = PyNumber_Subtract(__pyx_t_5, __pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1337, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = PyNumber_Power(__pyx_t_4, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1337, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_z), __pyx_tuple__10); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1337, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (unlikely(__pyx_v_start == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(0, 1337, __pyx_L1_error)
  }
  __pyx_t_5 = __Pyx_GetItemInt_List(__pyx_v_start, 1, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1337, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_3 = PyNumber_Subtract(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1337, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = PyNumber_Power(__pyx_t_3, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1337, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_Add(__pyx_t_8, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1337, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1337, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1337, __pyx_L1_error)
  __pyx_t_9 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist.rcbuffer->pybuffer, (PyObject*)__pyx_t_9, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_10, &__pyx_t_11, &__pyx_t_12);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist.rcbuffer->pybuffer, (PyObject*)__pyx_v_dist, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_12);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_10, __pyx_t_11, __pyx_t_12);
      }
      __pyx_t_10 = __pyx_t_11 = __pyx_t_12 = 0;
    }
    __pyx_pybuffernd_dist.diminfo[0].strides = __pyx_pybuffernd_dist.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_dist.diminfo[0].shape = __pyx_pybuffernd_dist.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1337, __pyx_L1_error)
  }
  __pyx_t_9 = 0;
  __pyx_v_dist = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":1338
 *         # print('Starting position:', start)
 *         dist = sqrt((z[:, 0] - start[0]) ** 2 + (z[:, 1] - start[1]) ** 2) # Find closest point in z
 *         id_start = np.argmin(dist)             # <<<<<<<<<<<<<<
 *         dq_list = []
 *         for i in range(2): # Finite difference in 2 dimensions (x and y)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1338, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_argmin); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1338, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, ((PyObject *)__pyx_v_dist)) : __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_dist));
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1338, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_7 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1338, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_id_start = __pyx_t_7;

  /* "vcstring.pyx":1339
 *         dist = sqrt((z[:, 0] - start[0]) ** 2 + (z[:, 1] - start[1]) ** 2) # Find closest point in z
 *         id_start = np.argmin(dist)
 *         dq_list = []             # <<<<<<<<<<<<<<
 *         for i in range(2): # Finite difference in 2 dimensions (x and y)
 *             zp = deepcopy(z)
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1339, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_dq_list = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":1340
 *         id_start = np.argmin(dist)
 *         dq_list = []
 *         for i in range(2): # Finite difference in 2 dimensions (x and y)             # <<<<<<<<<<<<<<
 *             zp = deepcopy(z)
 *             zp[id_start][i] += delta
 */
  for (__pyx_t_7 = 0; __pyx_t_7 < 2; __pyx_t_7+=1) {
    __pyx_v_i = __pyx_t_7;

    /* "vcstring.pyx":1341
 *         dq_list = []
 *         for i in range(2): # Finite difference in 2 dimensions (x and y)
 *             zp = deepcopy(z)             # <<<<<<<<<<<<<<
 *             zp[id_start][i] += delta
 *             dist_p = sqrt((z[:, 0] - zp[id_start][0]) ** 2 + (z[:, 1] - zp[id_start][1]) ** 2)
 */
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_deepcopy); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1341, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
      }
    }
    __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, ((PyObject *)__pyx_v_z)) : __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_z));
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1341, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1341, __pyx_L1_error)
    __pyx_t_13 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_zp.rcbuffer->pybuffer);
      __pyx_t_14 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_zp.rcbuffer->pybuffer, (PyObject*)__pyx_t_13, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
      if (unlikely(__pyx_t_14 < 0)) {
        PyErr_Fetch(&__pyx_t_12, &__pyx_t_11, &__pyx_t_10);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_zp.rcbuffer->pybuffer, (PyObject*)__pyx_v_zp, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_12); Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_12, __pyx_t_11, __pyx_t_10);
        }
        __pyx_t_12 = __pyx_t_11 = __pyx_t_10 = 0;
      }
      __pyx_pybuffernd_zp.diminfo[0].strides = __pyx_pybuffernd_zp.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_zp.diminfo[0].shape = __pyx_pybuffernd_zp.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_zp.diminfo[1].strides = __pyx_pybuffernd_zp.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_zp.diminfo[1].shape = __pyx_pybuffernd_zp.rcbuffer->pybuffer.shape[1];
      if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1341, __pyx_L1_error)
    }
    __pyx_t_13 = 0;
    __Pyx_XDECREF_SET(__pyx_v_zp, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "vcstring.pyx":1342
 *         for i in range(2): # Finite difference in 2 dimensions (x and y)
 *             zp = deepcopy(z)
 *             zp[id_start][i] += delta             # <<<<<<<<<<<<<<
 *             dist_p = sqrt((z[:, 0] - zp[id_start][0]) ** 2 + (z[:, 1] - zp[id_start][1]) ** 2)
 *             id_p = np.argmin(dist_p)
 */
    __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_zp), __pyx_v_id_start, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1342, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_14 = __pyx_v_i;
    __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_1, __pyx_t_14, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1342, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyFloat_FromDouble(__pyx_v_delta); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1342, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1342, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(__Pyx_SetItemInt(__pyx_t_1, __pyx_t_14, __pyx_t_5, int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 1342, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "vcstring.pyx":1343
 *             zp = deepcopy(z)
 *             zp[id_start][i] += delta
 *             dist_p = sqrt((z[:, 0] - zp[id_start][0]) ** 2 + (z[:, 1] - zp[id_start][1]) ** 2)             # <<<<<<<<<<<<<<
 *             id_p = np.argmin(dist_p)
 *             qp = b[id_p]
 */
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1343, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_2 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_z), __pyx_tuple__9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1343, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_zp), __pyx_v_id_start, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1343, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_8 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1343, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_Subtract(__pyx_t_2, __pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1343, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = PyNumber_Power(__pyx_t_3, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1343, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_z), __pyx_tuple__10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1343, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_zp), __pyx_v_id_start, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1343, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_2, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1343, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyNumber_Subtract(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1343, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyNumber_Power(__pyx_t_2, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1343, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyNumber_Add(__pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1343, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_2);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1343, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1343, __pyx_L1_error)
    __pyx_t_9 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_p.rcbuffer->pybuffer);
      __pyx_t_14 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist_p.rcbuffer->pybuffer, (PyObject*)__pyx_t_9, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_14 < 0)) {
        PyErr_Fetch(&__pyx_t_10, &__pyx_t_11, &__pyx_t_12);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist_p.rcbuffer->pybuffer, (PyObject*)__pyx_v_dist_p, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_12);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_10, __pyx_t_11, __pyx_t_12);
        }
        __pyx_t_10 = __pyx_t_11 = __pyx_t_12 = 0;
      }
      __pyx_pybuffernd_dist_p.diminfo[0].strides = __pyx_pybuffernd_dist_p.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_dist_p.diminfo[0].shape = __pyx_pybuffernd_dist_p.rcbuffer->pybuffer.shape[0];
      if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1343, __pyx_L1_error)
    }
    __pyx_t_9 = 0;
    __Pyx_XDECREF_SET(__pyx_v_dist_p, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "vcstring.pyx":1344
 *             zp[id_start][i] += delta
 *             dist_p = sqrt((z[:, 0] - zp[id_start][0]) ** 2 + (z[:, 1] - zp[id_start][1]) ** 2)
 *             id_p = np.argmin(dist_p)             # <<<<<<<<<<<<<<
 *             qp = b[id_p]
 * 
 */
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1344, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_argmin); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1344, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, ((PyObject *)__pyx_v_dist_p)) : __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)__pyx_v_dist_p));
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1344, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_14 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_14 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1344, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_id_p = __pyx_t_14;

    /* "vcstring.pyx":1345
 *             dist_p = sqrt((z[:, 0] - zp[id_start][0]) ** 2 + (z[:, 1] - zp[id_start][1]) ** 2)
 *             id_p = np.argmin(dist_p)
 *             qp = b[id_p]             # <<<<<<<<<<<<<<
 * 
 *             zm = deepcopy(z)
 */
    __pyx_t_15 = __pyx_v_id_p;
    __pyx_t_14 = -1;
    if (__pyx_t_15 < 0) {
      __pyx_t_15 += __pyx_pybuffernd_b.diminfo[0].shape;
      if (unlikely(__pyx_t_15 < 0)) __pyx_t_14 = 0;
    } else if (unlikely(__pyx_t_15 >= __pyx_pybuffernd_b.diminfo[0].shape)) __pyx_t_14 = 0;
    if (unlikely(__pyx_t_14 != -1)) {
      __Pyx_RaiseBufferIndexError(__pyx_t_14);
      __PYX_ERR(0, 1345, __pyx_L1_error)
    }
    __pyx_v_qp = (*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_b.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_b.diminfo[0].strides));

    /* "vcstring.pyx":1347
 *             qp = b[id_p]
 * 
 *             zm = deepcopy(z)             # <<<<<<<<<<<<<<
 *             zm[id_start][i] -= delta
 *             dist_m = sqrt((z[:, 0] - zm[id_start][0]) ** 2 + (z[:, 1] - zm[id_start][1]) ** 2)
 */
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_deepcopy); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1347, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, ((PyObject *)__pyx_v_z)) : __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)__pyx_v_z));
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1347, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1347, __pyx_L1_error)
    __pyx_t_13 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_zm.rcbuffer->pybuffer);
      __pyx_t_14 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_zm.rcbuffer->pybuffer, (PyObject*)__pyx_t_13, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
      if (unlikely(__pyx_t_14 < 0)) {
        PyErr_Fetch(&__pyx_t_12, &__pyx_t_11, &__pyx_t_10);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_zm.rcbuffer->pybuffer, (PyObject*)__pyx_v_zm, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_12); Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_12, __pyx_t_11, __pyx_t_10);
        }
        __pyx_t_12 = __pyx_t_11 = __pyx_t_10 = 0;
      }
      __pyx_pybuffernd_zm.diminfo[0].strides = __pyx_pybuffernd_zm.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_zm.diminfo[0].shape = __pyx_pybuffernd_zm.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_zm.diminfo[1].strides = __pyx_pybuffernd_zm.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_zm.diminfo[1].shape = __pyx_pybuffernd_zm.rcbuffer->pybuffer.shape[1];
      if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1347, __pyx_L1_error)
    }
    __pyx_t_13 = 0;
    __Pyx_XDECREF_SET(__pyx_v_zm, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "vcstring.pyx":1348
 * 
 *             zm = deepcopy(z)
 *             zm[id_start][i] -= delta             # <<<<<<<<<<<<<<
 *             dist_m = sqrt((z[:, 0] - zm[id_start][0]) ** 2 + (z[:, 1] - zm[id_start][1]) ** 2)
 *             id_m = np.argmin(dist_m)
 */
    __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_zm), __pyx_v_id_start, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1348, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_14 = __pyx_v_i;
    __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, __pyx_t_14, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1348, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = PyFloat_FromDouble(__pyx_v_delta); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1348, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_4 = PyNumber_InPlaceSubtract(__pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1348, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(__Pyx_SetItemInt(__pyx_t_1, __pyx_t_14, __pyx_t_4, int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 1348, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "vcstring.pyx":1349
 *             zm = deepcopy(z)
 *             zm[id_start][i] -= delta
 *             dist_m = sqrt((z[:, 0] - zm[id_start][0]) ** 2 + (z[:, 1] - zm[id_start][1]) ** 2)             # <<<<<<<<<<<<<<
 *             id_m = np.argmin(dist_m)
 *             qm = b[id_m]
 */
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_z), __pyx_tuple__9); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)__pyx_v_zm), __pyx_v_id_start, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_8 = __Pyx_GetItemInt(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyNumber_Subtract(__pyx_t_5, __pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = PyNumber_Power(__pyx_t_2, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_z), __pyx_tuple__10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_zm), __pyx_v_id_start, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_5, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = PyNumber_Subtract(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_Power(__pyx_t_5, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = PyNumber_Add(__pyx_t_8, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
      }
    }
    __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1349, __pyx_L1_error)
    __pyx_t_9 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_m.rcbuffer->pybuffer);
      __pyx_t_14 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist_m.rcbuffer->pybuffer, (PyObject*)__pyx_t_9, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_14 < 0)) {
        PyErr_Fetch(&__pyx_t_10, &__pyx_t_11, &__pyx_t_12);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist_m.rcbuffer->pybuffer, (PyObject*)__pyx_v_dist_m, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_12);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_10, __pyx_t_11, __pyx_t_12);
        }
        __pyx_t_10 = __pyx_t_11 = __pyx_t_12 = 0;
      }
      __pyx_pybuffernd_dist_m.diminfo[0].strides = __pyx_pybuffernd_dist_m.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_dist_m.diminfo[0].shape = __pyx_pybuffernd_dist_m.rcbuffer->pybuffer.shape[0];
      if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1349, __pyx_L1_error)
    }
    __pyx_t_9 = 0;
    __Pyx_XDECREF_SET(__pyx_v_dist_m, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "vcstring.pyx":1350
 *             zm[id_start][i] -= delta
 *             dist_m = sqrt((z[:, 0] - zm[id_start][0]) ** 2 + (z[:, 1] - zm[id_start][1]) ** 2)
 *             id_m = np.argmin(dist_m)             # <<<<<<<<<<<<<<
 *             qm = b[id_m]
 * 
 */
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1350, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_argmin); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1350, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
      }
    }
    __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_4, ((PyObject *)__pyx_v_dist_m)) : __Pyx_PyObject_CallOneArg(__pyx_t_5, ((PyObject *)__pyx_v_dist_m));
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1350, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_14 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_14 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1350, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_id_m = __pyx_t_14;

    /* "vcstring.pyx":1351
 *             dist_m = sqrt((z[:, 0] - zm[id_start][0]) ** 2 + (z[:, 1] - zm[id_start][1]) ** 2)
 *             id_m = np.argmin(dist_m)
 *             qm = b[id_m]             # <<<<<<<<<<<<<<
 * 
 *             dq = (qp - qm) / (2 * delta)
 */
    __pyx_t_15 = __pyx_v_id_m;
    __pyx_t_14 = -1;
    if (__pyx_t_15 < 0) {
      __pyx_t_15 += __pyx_pybuffernd_b.diminfo[0].shape;
      if (unlikely(__pyx_t_15 < 0)) __pyx_t_14 = 0;
    } else if (unlikely(__pyx_t_15 >= __pyx_pybuffernd_b.diminfo[0].shape)) __pyx_t_14 = 0;
    if (unlikely(__pyx_t_14 != -1)) {
      __Pyx_RaiseBufferIndexError(__pyx_t_14);
      __PYX_ERR(0, 1351, __pyx_L1_error)
    }
    __pyx_v_qm = (*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_b.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_b.diminfo[0].strides));

    /* "vcstring.pyx":1353
 *             qm = b[id_m]
 * 
 *             dq = (qp - qm) / (2 * delta)             # <<<<<<<<<<<<<<
 *             dq_list.append(dq)
 *         # print('dq_list =', dq_list)
 */
    __pyx_t_16 = (__pyx_v_qp - __pyx_v_qm);
    __pyx_t_17 = (2.0 * __pyx_v_delta);
    if (unlikely(__pyx_t_17 == 0)) {
      PyErr_SetString(PyExc_ZeroDivisionError, "float division");
      __PYX_ERR(0, 1353, __pyx_L1_error)
    }
    __pyx_v_dq = (__pyx_t_16 / __pyx_t_17);

    /* "vcstring.pyx":1354
 * 
 *             dq = (qp - qm) / (2 * delta)
 *             dq_list.append(dq)             # <<<<<<<<<<<<<<
 *         # print('dq_list =', dq_list)
 *         znew_x = start[0] - epsilon * dq_list[0]
 */
    __pyx_t_1 = PyFloat_FromDouble(__pyx_v_dq); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1354, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_dq_list, __pyx_t_1); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 1354, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }

  /* "vcstring.pyx":1356
 *             dq_list.append(dq)
 *         # print('dq_list =', dq_list)
 *         znew_x = start[0] - epsilon * dq_list[0]             # <<<<<<<<<<<<<<
 *         znew_y = start[1] - epsilon * dq_list[1]
 *         znew = [znew_x, znew_y]
 */
  if (unlikely(__pyx_v_start == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(0, 1356, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_v_start, 0, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1356, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = PyFloat_FromDouble(__pyx_v_epsilon); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1356, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_4 = __Pyx_GetItemInt_List(__pyx_v_dq_list, 0, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1356, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = PyNumber_Multiply(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1356, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyNumber_Subtract(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1356, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_17 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_17 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1356, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_znew_x = __pyx_t_17;

  /* "vcstring.pyx":1357
 *         # print('dq_list =', dq_list)
 *         znew_x = start[0] - epsilon * dq_list[0]
 *         znew_y = start[1] - epsilon * dq_list[1]             # <<<<<<<<<<<<<<
 *         znew = [znew_x, znew_y]
 *         dist_new = sqrt((z[:, 0] - znew_x) ** 2 + (z[:, 1] - znew_y) ** 2)
 */
  if (unlikely(__pyx_v_start == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(0, 1357, __pyx_L1_error)
  }
  __pyx_t_4 = __Pyx_GetItemInt_List(__pyx_v_start, 1, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1357, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_epsilon); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1357, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_v_dq_list, 1, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1357, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = PyNumber_Multiply(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1357, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Subtract(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1357, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_17 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_17 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1357, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_znew_y = __pyx_t_17;

  /* "vcstring.pyx":1358
 *         znew_x = start[0] - epsilon * dq_list[0]
 *         znew_y = start[1] - epsilon * dq_list[1]
 *         znew = [znew_x, znew_y]             # <<<<<<<<<<<<<<
 *         dist_new = sqrt((z[:, 0] - znew_x) ** 2 + (z[:, 1] - znew_y) ** 2)
 *         id_new = np.argmin(dist_new)
 */
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_znew_x); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1358, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = PyFloat_FromDouble(__pyx_v_znew_y); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1358, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_4 = PyList_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1358, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_1);
  PyList_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_5);
  PyList_SET_ITEM(__pyx_t_4, 1, __pyx_t_5);
  __pyx_t_1 = 0;
  __pyx_t_5 = 0;
  __pyx_v_znew = ((PyObject*)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "vcstring.pyx":1359
 *         znew_y = start[1] - epsilon * dq_list[1]
 *         znew = [znew_x, znew_y]
 *         dist_new = sqrt((z[:, 0] - znew_x) ** 2 + (z[:, 1] - znew_y) ** 2)             # <<<<<<<<<<<<<<
 *         id_new = np.argmin(dist_new)
 *         # print('znew =', znew)
 */
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_1 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_z), __pyx_tuple__9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_znew_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_8 = PyNumber_Subtract(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_Power(__pyx_t_8, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_z), __pyx_tuple__10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_znew_y); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Subtract(__pyx_t_8, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Power(__pyx_t_2, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Add(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
    }
  }
  __pyx_t_4 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_1, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_2);
  __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1359, __pyx_L1_error)
  __pyx_t_9 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_new.rcbuffer->pybuffer);
    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist_new.rcbuffer->pybuffer, (PyObject*)__pyx_t_9, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_7 < 0)) {
      PyErr_Fetch(&__pyx_t_12, &__pyx_t_11, &__pyx_t_10);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist_new.rcbuffer->pybuffer, (PyObject*)__pyx_v_dist_new, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_12); Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_12, __pyx_t_11, __pyx_t_10);
      }
      __pyx_t_12 = __pyx_t_11 = __pyx_t_10 = 0;
    }
    __pyx_pybuffernd_dist_new.diminfo[0].strides = __pyx_pybuffernd_dist_new.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_dist_new.diminfo[0].shape = __pyx_pybuffernd_dist_new.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1359, __pyx_L1_error)
  }
  __pyx_t_9 = 0;
  __pyx_v_dist_new = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "vcstring.pyx":1360
 *         znew = [znew_x, znew_y]
 *         dist_new = sqrt((z[:, 0] - znew_x) ** 2 + (z[:, 1] - znew_y) ** 2)
 *         id_new = np.argmin(dist_new)             # <<<<<<<<<<<<<<
 *         # print('znew =', znew)
 *         # print('z[id_new] =', z[id_new])
 */
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1360, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_argmin); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1360, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, ((PyObject *)__pyx_v_dist_new)) : __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)__pyx_v_dist_new));
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1360, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_7 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1360, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_id_new = __pyx_t_7;

  /* "vcstring.pyx":1364
 *         # print('z[id_new] =', z[id_new])
 *         # print('b[id_new] =', b[id_new])
 *         return dq_list, z[id_new], b[id_new]             # <<<<<<<<<<<<<<
 * 
 *     cpdef montecarlo(self, list images, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, double target, double delta=0.01, int n=100, ensemble_timeavg_v1=False, ensemble_timeavg_v2=False, ensemble_avg=False, stride=None, list weights=None, symmetric=True, manual=False, hx_man=None, hy_man=None, reparm=True, mindist_constraint=False, mindist=0.25, accelerated=False, corr_method='matrix_elements', save=True):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_id_new, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1364, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_15 = __pyx_v_id_new;
  __pyx_t_7 = -1;
  if (__pyx_t_15 < 0) {
    __pyx_t_15 += __pyx_pybuffernd_b.diminfo[0].shape;
    if (unlikely(__pyx_t_15 < 0)) __pyx_t_7 = 0;
  } else if (unlikely(__pyx_t_15 >= __pyx_pybuffernd_b.diminfo[0].shape)) __pyx_t_7 = 0;
  if (unlikely(__pyx_t_7 != -1)) {
    __Pyx_RaiseBufferIndexError(__pyx_t_7);
    __PYX_ERR(0, 1364, __pyx_L1_error)
  }
  __pyx_t_2 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_b.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_b.diminfo[0].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1364, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1364, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_INCREF(__pyx_v_dq_list);
  __Pyx_GIVEREF(__pyx_v_dq_list);
  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_dq_list);
  __Pyx_GIVEREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_t_2);
  __pyx_t_4 = 0;
  __pyx_t_2 = 0;
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;

  /* "vcstring.pyx":1328
 *         return Cp_list, Cm_list, gradC_list
 * 
 *     cpdef finite_diff_committor(self, np.ndarray[DTYPE_t, ndim=2] z, np.ndarray[DTYPE_t, ndim=1] b, list start, double delta=0.1, double epsilon=1.0):             # <<<<<<<<<<<<<<
 *         """Finite difference to get the gradient of the committor"""
 *         cdef np.ndarray[DTYPE_t, ndim=1] dist, dist_p, dist_m, dist_new
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_m.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_new.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_p.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_zm.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_zp.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.finite_diff_committor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_m.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_new.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_p.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_zm.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_zp.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XDECREF((PyObject *)__pyx_v_dist);
  __Pyx_XDECREF((PyObject *)__pyx_v_dist_p);
  __Pyx_XDECREF((PyObject *)__pyx_v_dist_m);
  __Pyx_XDECREF((PyObject *)__pyx_v_dist_new);
  __Pyx_XDECREF((PyObject *)__pyx_v_zp);
  __Pyx_XDECREF((PyObject *)__pyx_v_zm);
  __Pyx_XDECREF(__pyx_v_dq_list);
  __Pyx_XDECREF(__pyx_v_znew);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_35finite_diff_committor(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8vcstring_8vcstring_34finite_diff_committor[] = "Finite difference to get the gradient of the committor";
static PyObject *__pyx_pw_8vcstring_8vcstring_35finite_diff_committor(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_z = 0;
  PyArrayObject *__pyx_v_b = 0;
  PyObject *__pyx_v_start = 0;
  double __pyx_v_delta;
  double __pyx_v_epsilon;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("finite_diff_committor (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_z,&__pyx_n_s_b_2,&__pyx_n_s_start,&__pyx_n_s_delta,&__pyx_n_s_epsilon,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_b_2)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("finite_diff_committor", 0, 3, 5, 1); __PYX_ERR(0, 1328, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_start)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("finite_diff_committor", 0, 3, 5, 2); __PYX_ERR(0, 1328, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_delta);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_epsilon);
          if (value) { values[4] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "finite_diff_committor") < 0)) __PYX_ERR(0, 1328, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_z = ((PyArrayObject *)values[0]);
    __pyx_v_b = ((PyArrayObject *)values[1]);
    __pyx_v_start = ((PyObject*)values[2]);
    if (values[3]) {
      __pyx_v_delta = __pyx_PyFloat_AsDouble(values[3]); if (unlikely((__pyx_v_delta == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1328, __pyx_L3_error)
    } else {
      __pyx_v_delta = ((double)0.1);
    }
    if (values[4]) {
      __pyx_v_epsilon = __pyx_PyFloat_AsDouble(values[4]); if (unlikely((__pyx_v_epsilon == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1328, __pyx_L3_error)
    } else {
      __pyx_v_epsilon = ((double)1.0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("finite_diff_committor", 0, 3, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1328, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.vcstring.finite_diff_committor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_z), __pyx_ptype_5numpy_ndarray, 1, "z", 0))) __PYX_ERR(0, 1328, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_b), __pyx_ptype_5numpy_ndarray, 1, "b", 0))) __PYX_ERR(0, 1328, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_start), (&PyList_Type), 1, "start", 1))) __PYX_ERR(0, 1328, __pyx_L1_error)
  __pyx_r = __pyx_pf_8vcstring_8vcstring_34finite_diff_committor(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self), __pyx_v_z, __pyx_v_b, __pyx_v_start, __pyx_v_delta, __pyx_v_epsilon);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_34finite_diff_committor(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyArrayObject *__pyx_v_z, PyArrayObject *__pyx_v_b, PyObject *__pyx_v_start, double __pyx_v_delta, double __pyx_v_epsilon) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  struct __pyx_opt_args_8vcstring_8vcstring_finite_diff_committor __pyx_t_2;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("finite_diff_committor", 0);
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1328, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1328, __pyx_L1_error)
  }
  __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2.__pyx_n = 2;
  __pyx_t_2.delta = __pyx_v_delta;
  __pyx_t_2.epsilon = __pyx_v_epsilon;
  __pyx_t_1 = __pyx_vtabptr_8vcstring_vcstring->finite_diff_committor(__pyx_v_self, __pyx_v_z, __pyx_v_b, __pyx_v_start, 1, &__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1328, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.finite_diff_committor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":1366
 *         return dq_list, z[id_new], b[id_new]
 * 
 *     cpdef montecarlo(self, list images, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, double target, double delta=0.01, int n=100, ensemble_timeavg_v1=False, ensemble_timeavg_v2=False, ensemble_avg=False, stride=None, list weights=None, symmetric=True, manual=False, hx_man=None, hy_man=None, reparm=True, mindist_constraint=False, mindist=0.25, accelerated=False, corr_method='matrix_elements', save=True):             # <<<<<<<<<<<<<<
 *         """
 *         Monte Carlo accept/reject of correlation given a target value.
 */

static PyObject *__pyx_pw_8vcstring_8vcstring_37montecarlo(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_montecarlo(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_images, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, double __pyx_v_target, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_montecarlo *__pyx_optional_args) {
  double __pyx_v_delta = ((double)0.01);
  int __pyx_v_n = ((int)0x64);
  PyObject *__pyx_v_ensemble_timeavg_v1 = ((PyObject *)Py_False);
  PyObject *__pyx_v_ensemble_timeavg_v2 = ((PyObject *)Py_False);
  PyObject *__pyx_v_ensemble_avg = ((PyObject *)Py_False);
  PyObject *__pyx_v_stride = ((PyObject *)Py_None);
  PyObject *__pyx_v_weights = ((PyObject*)Py_None);
  PyObject *__pyx_v_symmetric = ((PyObject *)Py_True);
  PyObject *__pyx_v_manual = ((PyObject *)Py_False);
  PyObject *__pyx_v_hx_man = ((PyObject *)Py_None);
  PyObject *__pyx_v_hy_man = ((PyObject *)Py_None);
  PyObject *__pyx_v_reparm = ((PyObject *)Py_True);
  PyObject *__pyx_v_mindist_constraint = ((PyObject *)Py_False);
  PyObject *__pyx_v_mindist = ((PyObject *)__pyx_float_0_25);
  PyObject *__pyx_v_accelerated = ((PyObject *)Py_False);
  PyObject *__pyx_v_corr_method = ((PyObject *)__pyx_n_u_matrix_elements);
  PyObject *__pyx_v_save = ((PyObject *)Py_True);
  PyObject *__pyx_v_MC_list = 0;
  int __pyx_v_it;
  int __pyx_v_i;
  int __pyx_v_N;
  int __pyx_v_k;
  double __pyx_v_hx;
  double __pyx_v_hy;
  double __pyx_v_Cnew;
  double __pyx_v_C_k;
  double __pyx_v_d1;
  double __pyx_v_d2;
  PyArrayObject *__pyx_v_D_0 = 0;
  PyArrayObject *__pyx_v_D_tau = 0;
  PyArrayObject *__pyx_v_ids = 0;
  PyArrayObject *__pyx_v_D_0_ens = 0;
  PyArrayObject *__pyx_v_D_tau_ens = 0;
  PyArrayObject *__pyx_v_b = 0;
  PyArrayObject *__pyx_v_g_0 = 0;
  PyArrayObject *__pyx_v_g_tau = 0;
  PyArrayObject *__pyx_v_b_ens = 0;
  PyArrayObject *__pyx_v_g_0_ens = 0;
  PyArrayObject *__pyx_v_g_tau_ens = 0;
  PyObject *__pyx_v_z_init = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_0;
  __Pyx_Buffer __pyx_pybuffer_D_0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_0_ens;
  __Pyx_Buffer __pyx_pybuffer_D_0_ens;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_tau;
  __Pyx_Buffer __pyx_pybuffer_D_tau;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_tau_ens;
  __Pyx_Buffer __pyx_pybuffer_D_tau_ens;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b_ens;
  __Pyx_Buffer __pyx_pybuffer_b_ens;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_0;
  __Pyx_Buffer __pyx_pybuffer_g_0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_0_ens;
  __Pyx_Buffer __pyx_pybuffer_g_0_ens;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_tau;
  __Pyx_Buffer __pyx_pybuffer_g_tau;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_tau_ens;
  __Pyx_Buffer __pyx_pybuffer_g_tau_ens;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ids;
  __Pyx_Buffer __pyx_pybuffer_ids;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  Py_ssize_t __pyx_t_11;
  int __pyx_t_12;
  int __pyx_t_13;
  int __pyx_t_14;
  int __pyx_t_15;
  double __pyx_t_16;
  PyArrayObject *__pyx_t_17 = NULL;
  PyObject *__pyx_t_18 = NULL;
  PyObject *__pyx_t_19 = NULL;
  PyObject *__pyx_t_20 = NULL;
  int __pyx_t_21;
  Py_ssize_t __pyx_t_22;
  long __pyx_t_23;
  PyObject *(*__pyx_t_24)(PyObject *);
  PyArrayObject *__pyx_t_25 = NULL;
  PyArrayObject *__pyx_t_26 = NULL;
  int __pyx_t_27;
  int __pyx_t_28;
  int __pyx_t_29;
  struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs __pyx_t_30;
  PyArrayObject *__pyx_t_31 = NULL;
  PyArrayObject *__pyx_t_32 = NULL;
  struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast __pyx_t_33;
  struct __pyx_opt_args_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg_fast __pyx_t_34;
  struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble __pyx_t_35;
  int __pyx_t_36;
  int __pyx_t_37;
  int __pyx_t_38;
  int __pyx_t_39;
  int __pyx_t_40;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("montecarlo", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args->__pyx_n > 0) {
      __pyx_v_delta = __pyx_optional_args->delta;
      if (__pyx_optional_args->__pyx_n > 1) {
        __pyx_v_n = __pyx_optional_args->n;
        if (__pyx_optional_args->__pyx_n > 2) {
          __pyx_v_ensemble_timeavg_v1 = __pyx_optional_args->ensemble_timeavg_v1;
          if (__pyx_optional_args->__pyx_n > 3) {
            __pyx_v_ensemble_timeavg_v2 = __pyx_optional_args->ensemble_timeavg_v2;
            if (__pyx_optional_args->__pyx_n > 4) {
              __pyx_v_ensemble_avg = __pyx_optional_args->ensemble_avg;
              if (__pyx_optional_args->__pyx_n > 5) {
                __pyx_v_stride = __pyx_optional_args->stride;
                if (__pyx_optional_args->__pyx_n > 6) {
                  __pyx_v_weights = __pyx_optional_args->weights;
                  if (__pyx_optional_args->__pyx_n > 7) {
                    __pyx_v_symmetric = __pyx_optional_args->symmetric;
                    if (__pyx_optional_args->__pyx_n > 8) {
                      __pyx_v_manual = __pyx_optional_args->manual;
                      if (__pyx_optional_args->__pyx_n > 9) {
                        __pyx_v_hx_man = __pyx_optional_args->hx_man;
                        if (__pyx_optional_args->__pyx_n > 10) {
                          __pyx_v_hy_man = __pyx_optional_args->hy_man;
                          if (__pyx_optional_args->__pyx_n > 11) {
                            __pyx_v_reparm = __pyx_optional_args->reparm;
                            if (__pyx_optional_args->__pyx_n > 12) {
                              __pyx_v_mindist_constraint = __pyx_optional_args->mindist_constraint;
                              if (__pyx_optional_args->__pyx_n > 13) {
                                __pyx_v_mindist = __pyx_optional_args->mindist;
                                if (__pyx_optional_args->__pyx_n > 14) {
                                  __pyx_v_accelerated = __pyx_optional_args->accelerated;
                                  if (__pyx_optional_args->__pyx_n > 15) {
                                    __pyx_v_corr_method = __pyx_optional_args->corr_method;
                                    if (__pyx_optional_args->__pyx_n > 16) {
                                      __pyx_v_save = __pyx_optional_args->save;
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
  __Pyx_INCREF((PyObject *)__pyx_v_z);
  __Pyx_INCREF(__pyx_v_weights);
  __pyx_pybuffer_D_0.pybuffer.buf = NULL;
  __pyx_pybuffer_D_0.refcount = 0;
  __pyx_pybuffernd_D_0.data = NULL;
  __pyx_pybuffernd_D_0.rcbuffer = &__pyx_pybuffer_D_0;
  __pyx_pybuffer_D_tau.pybuffer.buf = NULL;
  __pyx_pybuffer_D_tau.refcount = 0;
  __pyx_pybuffernd_D_tau.data = NULL;
  __pyx_pybuffernd_D_tau.rcbuffer = &__pyx_pybuffer_D_tau;
  __pyx_pybuffer_ids.pybuffer.buf = NULL;
  __pyx_pybuffer_ids.refcount = 0;
  __pyx_pybuffernd_ids.data = NULL;
  __pyx_pybuffernd_ids.rcbuffer = &__pyx_pybuffer_ids;
  __pyx_pybuffer_D_0_ens.pybuffer.buf = NULL;
  __pyx_pybuffer_D_0_ens.refcount = 0;
  __pyx_pybuffernd_D_0_ens.data = NULL;
  __pyx_pybuffernd_D_0_ens.rcbuffer = &__pyx_pybuffer_D_0_ens;
  __pyx_pybuffer_D_tau_ens.pybuffer.buf = NULL;
  __pyx_pybuffer_D_tau_ens.refcount = 0;
  __pyx_pybuffernd_D_tau_ens.data = NULL;
  __pyx_pybuffernd_D_tau_ens.rcbuffer = &__pyx_pybuffer_D_tau_ens;
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  __pyx_pybuffer_g_0.pybuffer.buf = NULL;
  __pyx_pybuffer_g_0.refcount = 0;
  __pyx_pybuffernd_g_0.data = NULL;
  __pyx_pybuffernd_g_0.rcbuffer = &__pyx_pybuffer_g_0;
  __pyx_pybuffer_g_tau.pybuffer.buf = NULL;
  __pyx_pybuffer_g_tau.refcount = 0;
  __pyx_pybuffernd_g_tau.data = NULL;
  __pyx_pybuffernd_g_tau.rcbuffer = &__pyx_pybuffer_g_tau;
  __pyx_pybuffer_b_ens.pybuffer.buf = NULL;
  __pyx_pybuffer_b_ens.refcount = 0;
  __pyx_pybuffernd_b_ens.data = NULL;
  __pyx_pybuffernd_b_ens.rcbuffer = &__pyx_pybuffer_b_ens;
  __pyx_pybuffer_g_0_ens.pybuffer.buf = NULL;
  __pyx_pybuffer_g_0_ens.refcount = 0;
  __pyx_pybuffernd_g_0_ens.data = NULL;
  __pyx_pybuffernd_g_0_ens.rcbuffer = &__pyx_pybuffer_g_0_ens;
  __pyx_pybuffer_g_tau_ens.pybuffer.buf = NULL;
  __pyx_pybuffer_g_tau_ens.refcount = 0;
  __pyx_pybuffernd_g_tau_ens.data = NULL;
  __pyx_pybuffernd_g_tau_ens.rcbuffer = &__pyx_pybuffer_g_tau_ens;
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1366, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_montecarlo); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1366, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_8vcstring_8vcstring_37montecarlo)) {
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1366, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_target); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1366, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_5 = PyFloat_FromDouble(__pyx_v_delta); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1366, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_n); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1366, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_7 = __pyx_t_1; __pyx_t_8 = NULL;
        __pyx_t_9 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
          __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
          if (likely(__pyx_t_8)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_8);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_7, function);
            __pyx_t_9 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_7)) {
          PyObject *__pyx_temp[23] = {__pyx_t_8, __pyx_v_images, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_z), __pyx_t_4, __pyx_t_5, __pyx_t_6, __pyx_v_ensemble_timeavg_v1, __pyx_v_ensemble_timeavg_v2, __pyx_v_ensemble_avg, __pyx_v_stride, __pyx_v_weights, __pyx_v_symmetric, __pyx_v_manual, __pyx_v_hx_man, __pyx_v_hy_man, __pyx_v_reparm, __pyx_v_mindist_constraint, __pyx_v_mindist, __pyx_v_accelerated, __pyx_v_corr_method, __pyx_v_save};
          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_9, 22+__pyx_t_9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1366, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
          PyObject *__pyx_temp[23] = {__pyx_t_8, __pyx_v_images, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_z), __pyx_t_4, __pyx_t_5, __pyx_t_6, __pyx_v_ensemble_timeavg_v1, __pyx_v_ensemble_timeavg_v2, __pyx_v_ensemble_avg, __pyx_v_stride, __pyx_v_weights, __pyx_v_symmetric, __pyx_v_manual, __pyx_v_hx_man, __pyx_v_hy_man, __pyx_v_reparm, __pyx_v_mindist_constraint, __pyx_v_mindist, __pyx_v_accelerated, __pyx_v_corr_method, __pyx_v_save};
          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_9, 22+__pyx_t_9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1366, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        {
          __pyx_t_10 = PyTuple_New(22+__pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1366, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          if (__pyx_t_8) {
            __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_8); __pyx_t_8 = NULL;
          }
          __Pyx_INCREF(__pyx_v_images);
          __Pyx_GIVEREF(__pyx_v_images);
          PyTuple_SET_ITEM(__pyx_t_10, 0+__pyx_t_9, __pyx_v_images);
          __Pyx_INCREF(__pyx_v_traj);
          __Pyx_GIVEREF(__pyx_v_traj);
          PyTuple_SET_ITEM(__pyx_t_10, 1+__pyx_t_9, __pyx_v_traj);
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_10, 2+__pyx_t_9, __pyx_t_3);
          __Pyx_INCREF(((PyObject *)__pyx_v_z));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
          PyTuple_SET_ITEM(__pyx_t_10, 3+__pyx_t_9, ((PyObject *)__pyx_v_z));
          __Pyx_GIVEREF(__pyx_t_4);
          PyTuple_SET_ITEM(__pyx_t_10, 4+__pyx_t_9, __pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_5);
          PyTuple_SET_ITEM(__pyx_t_10, 5+__pyx_t_9, __pyx_t_5);
          __Pyx_GIVEREF(__pyx_t_6);
          PyTuple_SET_ITEM(__pyx_t_10, 6+__pyx_t_9, __pyx_t_6);
          __Pyx_INCREF(__pyx_v_ensemble_timeavg_v1);
          __Pyx_GIVEREF(__pyx_v_ensemble_timeavg_v1);
          PyTuple_SET_ITEM(__pyx_t_10, 7+__pyx_t_9, __pyx_v_ensemble_timeavg_v1);
          __Pyx_INCREF(__pyx_v_ensemble_timeavg_v2);
          __Pyx_GIVEREF(__pyx_v_ensemble_timeavg_v2);
          PyTuple_SET_ITEM(__pyx_t_10, 8+__pyx_t_9, __pyx_v_ensemble_timeavg_v2);
          __Pyx_INCREF(__pyx_v_ensemble_avg);
          __Pyx_GIVEREF(__pyx_v_ensemble_avg);
          PyTuple_SET_ITEM(__pyx_t_10, 9+__pyx_t_9, __pyx_v_ensemble_avg);
          __Pyx_INCREF(__pyx_v_stride);
          __Pyx_GIVEREF(__pyx_v_stride);
          PyTuple_SET_ITEM(__pyx_t_10, 10+__pyx_t_9, __pyx_v_stride);
          __Pyx_INCREF(__pyx_v_weights);
          __Pyx_GIVEREF(__pyx_v_weights);
          PyTuple_SET_ITEM(__pyx_t_10, 11+__pyx_t_9, __pyx_v_weights);
          __Pyx_INCREF(__pyx_v_symmetric);
          __Pyx_GIVEREF(__pyx_v_symmetric);
          PyTuple_SET_ITEM(__pyx_t_10, 12+__pyx_t_9, __pyx_v_symmetric);
          __Pyx_INCREF(__pyx_v_manual);
          __Pyx_GIVEREF(__pyx_v_manual);
          PyTuple_SET_ITEM(__pyx_t_10, 13+__pyx_t_9, __pyx_v_manual);
          __Pyx_INCREF(__pyx_v_hx_man);
          __Pyx_GIVEREF(__pyx_v_hx_man);
          PyTuple_SET_ITEM(__pyx_t_10, 14+__pyx_t_9, __pyx_v_hx_man);
          __Pyx_INCREF(__pyx_v_hy_man);
          __Pyx_GIVEREF(__pyx_v_hy_man);
          PyTuple_SET_ITEM(__pyx_t_10, 15+__pyx_t_9, __pyx_v_hy_man);
          __Pyx_INCREF(__pyx_v_reparm);
          __Pyx_GIVEREF(__pyx_v_reparm);
          PyTuple_SET_ITEM(__pyx_t_10, 16+__pyx_t_9, __pyx_v_reparm);
          __Pyx_INCREF(__pyx_v_mindist_constraint);
          __Pyx_GIVEREF(__pyx_v_mindist_constraint);
          PyTuple_SET_ITEM(__pyx_t_10, 17+__pyx_t_9, __pyx_v_mindist_constraint);
          __Pyx_INCREF(__pyx_v_mindist);
          __Pyx_GIVEREF(__pyx_v_mindist);
          PyTuple_SET_ITEM(__pyx_t_10, 18+__pyx_t_9, __pyx_v_mindist);
          __Pyx_INCREF(__pyx_v_accelerated);
          __Pyx_GIVEREF(__pyx_v_accelerated);
          PyTuple_SET_ITEM(__pyx_t_10, 19+__pyx_t_9, __pyx_v_accelerated);
          __Pyx_INCREF(__pyx_v_corr_method);
          __Pyx_GIVEREF(__pyx_v_corr_method);
          PyTuple_SET_ITEM(__pyx_t_10, 20+__pyx_t_9, __pyx_v_corr_method);
          __Pyx_INCREF(__pyx_v_save);
          __Pyx_GIVEREF(__pyx_v_save);
          PyTuple_SET_ITEM(__pyx_t_10, 21+__pyx_t_9, __pyx_v_save);
          __pyx_t_3 = 0;
          __pyx_t_4 = 0;
          __pyx_t_5 = 0;
          __pyx_t_6 = 0;
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_10, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1366, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        }
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }

  /* "vcstring.pyx":1396
 *         cdef np.ndarray[DTYPE_t, ndim=1] b_ens, g_0_ens, g_tau_ens
 * 
 *         N = len(traj)             # <<<<<<<<<<<<<<
 *         print('\n=================================')
 *         print('MONTE CARLO SAMPLING')
 */
  if (unlikely(__pyx_v_traj == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
    __PYX_ERR(0, 1396, __pyx_L1_error)
  }
  __pyx_t_11 = PyList_GET_SIZE(__pyx_v_traj); if (unlikely(__pyx_t_11 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1396, __pyx_L1_error)
  __pyx_v_N = __pyx_t_11;

  /* "vcstring.pyx":1397
 * 
 *         N = len(traj)
 *         print('\n=================================')             # <<<<<<<<<<<<<<
 *         print('MONTE CARLO SAMPLING')
 *         print('=================================')
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__36, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1397, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1398
 *         N = len(traj)
 *         print('\n=================================')
 *         print('MONTE CARLO SAMPLING')             # <<<<<<<<<<<<<<
 *         print('=================================')
 *         print('\nMONTE CARLO PARAMETERS')
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__53, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1398, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1399
 *         print('\n=================================')
 *         print('MONTE CARLO SAMPLING')
 *         print('=================================')             # <<<<<<<<<<<<<<
 *         print('\nMONTE CARLO PARAMETERS')
 *         print('-------------------------')
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__39, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1399, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1400
 *         print('MONTE CARLO SAMPLING')
 *         print('=================================')
 *         print('\nMONTE CARLO PARAMETERS')             # <<<<<<<<<<<<<<
 *         print('-------------------------')
 *         print('Target for accept/reject:', target)
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__54, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1400, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1401
 *         print('=================================')
 *         print('\nMONTE CARLO PARAMETERS')
 *         print('-------------------------')             # <<<<<<<<<<<<<<
 *         print('Target for accept/reject:', target)
 *         print('Step change in position:', delta)
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__56, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1401, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1402
 *         print('\nMONTE CARLO PARAMETERS')
 *         print('-------------------------')
 *         print('Target for accept/reject:', target)             # <<<<<<<<<<<<<<
 *         print('Step change in position:', delta)
 *         print('Number of MC steps per image:', n)
 */
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_target); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1402, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1402, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_Target_for_accept_reject);
  __Pyx_GIVEREF(__pyx_kp_u_Target_for_accept_reject);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_Target_for_accept_reject);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1402, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1403
 *         print('-------------------------')
 *         print('Target for accept/reject:', target)
 *         print('Step change in position:', delta)             # <<<<<<<<<<<<<<
 *         print('Number of MC steps per image:', n)
 *         print('lag time:', tau)
 */
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_delta); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1403, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1403, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_Step_change_in_position_2);
  __Pyx_GIVEREF(__pyx_kp_u_Step_change_in_position_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_Step_change_in_position_2);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1403, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1404
 *         print('Target for accept/reject:', target)
 *         print('Step change in position:', delta)
 *         print('Number of MC steps per image:', n)             # <<<<<<<<<<<<<<
 *         print('lag time:', tau)
 *         print('Input positions:\n', z)
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1404, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1404, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_Number_of_MC_steps_per_image);
  __Pyx_GIVEREF(__pyx_kp_u_Number_of_MC_steps_per_image);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_Number_of_MC_steps_per_image);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1404, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1405
 *         print('Step change in position:', delta)
 *         print('Number of MC steps per image:', n)
 *         print('lag time:', tau)             # <<<<<<<<<<<<<<
 *         print('Input positions:\n', z)
 *         print('\nStarting Monte Carlo calculations')
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1405, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1405, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_lag_time_2);
  __Pyx_GIVEREF(__pyx_kp_u_lag_time_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_lag_time_2);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1405, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1406
 *         print('Number of MC steps per image:', n)
 *         print('lag time:', tau)
 *         print('Input positions:\n', z)             # <<<<<<<<<<<<<<
 *         print('\nStarting Monte Carlo calculations')
 *         sys.stdout.flush()
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1406, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_Input_positions);
  __Pyx_GIVEREF(__pyx_kp_u_Input_positions);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Input_positions);
  __Pyx_INCREF(((PyObject *)__pyx_v_z));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_z));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1406, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":1407
 *         print('lag time:', tau)
 *         print('Input positions:\n', z)
 *         print('\nStarting Monte Carlo calculations')             # <<<<<<<<<<<<<<
 *         sys.stdout.flush()
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__57, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1407, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":1408
 *         print('Input positions:\n', z)
 *         print('\nStarting Monte Carlo calculations')
 *         sys.stdout.flush()             # <<<<<<<<<<<<<<
 * 
 *         # for i in range(self.num_basis): # Move each bead on the string
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sys); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1408, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_stdout); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1408, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_flush); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1408, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_2 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1408, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":1411
 * 
 *         # for i in range(self.num_basis): # Move each bead on the string
 *         for i in images:  # Move the i-th bead(s) on the string             # <<<<<<<<<<<<<<
 *             z_init = deepcopy(z[i])
 *             print('\nIMAGE', i)
 */
  if (unlikely(__pyx_v_images == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
    __PYX_ERR(0, 1411, __pyx_L1_error)
  }
  __pyx_t_2 = __pyx_v_images; __Pyx_INCREF(__pyx_t_2); __pyx_t_11 = 0;
  for (;;) {
    if (__pyx_t_11 >= PyList_GET_SIZE(__pyx_t_2)) break;
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_11); __Pyx_INCREF(__pyx_t_1); __pyx_t_11++; if (unlikely(0 < 0)) __PYX_ERR(0, 1411, __pyx_L1_error)
    #else
    __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1411, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    #endif
    __pyx_t_9 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1411, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_i = __pyx_t_9;

    /* "vcstring.pyx":1412
 *         # for i in range(self.num_basis): # Move each bead on the string
 *         for i in images:  # Move the i-th bead(s) on the string
 *             z_init = deepcopy(z[i])             # <<<<<<<<<<<<<<
 *             print('\nIMAGE', i)
 *             print('--------------------')
 */
    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_deepcopy); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1412, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1412, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_6, __pyx_t_10) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_10);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1412, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_XDECREF_SET(__pyx_v_z_init, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "vcstring.pyx":1413
 *         for i in images:  # Move the i-th bead(s) on the string
 *             z_init = deepcopy(z[i])
 *             print('\nIMAGE', i)             # <<<<<<<<<<<<<<
 *             print('--------------------')
 *             print('Initial position:', z_init)
 */
    __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1413, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1413, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_INCREF(__pyx_kp_u_IMAGE);
    __Pyx_GIVEREF(__pyx_kp_u_IMAGE);
    PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_kp_u_IMAGE);
    __Pyx_GIVEREF(__pyx_t_1);
    PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1413, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "vcstring.pyx":1414
 *             z_init = deepcopy(z[i])
 *             print('\nIMAGE', i)
 *             print('--------------------')             # <<<<<<<<<<<<<<
 *             print('Initial position:', z_init)
 * 
 */
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__59, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1414, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "vcstring.pyx":1415
 *             print('\nIMAGE', i)
 *             print('--------------------')
 *             print('Initial position:', z_init)             # <<<<<<<<<<<<<<
 * 
 *             MC_list = []
 */
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1415, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_kp_u_Initial_position);
    __Pyx_GIVEREF(__pyx_kp_u_Initial_position);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Initial_position);
    __Pyx_INCREF(__pyx_v_z_init);
    __Pyx_GIVEREF(__pyx_v_z_init);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_z_init);
    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1415, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

    /* "vcstring.pyx":1417
 *             print('Initial position:', z_init)
 * 
 *             MC_list = []             # <<<<<<<<<<<<<<
 *             for it in range(n): # Run n numbers of MC steps
 *                 print('\nCALCULATING MONTE CARLO STEP', it)
 */
    __pyx_t_7 = PyList_New(0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1417, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_XDECREF_SET(__pyx_v_MC_list, ((PyObject*)__pyx_t_7));
    __pyx_t_7 = 0;

    /* "vcstring.pyx":1418
 * 
 *             MC_list = []
 *             for it in range(n): # Run n numbers of MC steps             # <<<<<<<<<<<<<<
 *                 print('\nCALCULATING MONTE CARLO STEP', it)
 *                 print('-------------------------------')
 */
    __pyx_t_9 = __pyx_v_n;
    __pyx_t_12 = __pyx_t_9;
    for (__pyx_t_13 = 0; __pyx_t_13 < __pyx_t_12; __pyx_t_13+=1) {
      __pyx_v_it = __pyx_t_13;

      /* "vcstring.pyx":1419
 *             MC_list = []
 *             for it in range(n): # Run n numbers of MC steps
 *                 print('\nCALCULATING MONTE CARLO STEP', it)             # <<<<<<<<<<<<<<
 *                 print('-------------------------------')
 *                 sys.stdout.flush()
 */
      __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_it); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1419, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1419, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_kp_u_CALCULATING_MONTE_CARLO_STEP);
      __Pyx_GIVEREF(__pyx_kp_u_CALCULATING_MONTE_CARLO_STEP);
      PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_CALCULATING_MONTE_CARLO_STEP);
      __Pyx_GIVEREF(__pyx_t_7);
      PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_7);
      __pyx_t_7 = 0;
      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1419, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "vcstring.pyx":1420
 *             for it in range(n): # Run n numbers of MC steps
 *                 print('\nCALCULATING MONTE CARLO STEP', it)
 *                 print('-------------------------------')             # <<<<<<<<<<<<<<
 *                 sys.stdout.flush()
 *                 if manual == False:
 */
      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__61, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1420, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "vcstring.pyx":1421
 *                 print('\nCALCULATING MONTE CARLO STEP', it)
 *                 print('-------------------------------')
 *                 sys.stdout.flush()             # <<<<<<<<<<<<<<
 *                 if manual == False:
 *                     hx = random.uniform(-delta, delta) # get random value to move z
 */
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sys); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1421, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_stdout); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1421, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_flush); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1421, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
        }
      }
      __pyx_t_7 = (__pyx_t_10) ? __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_10) : __Pyx_PyObject_CallNoArg(__pyx_t_1);
      __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1421, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

      /* "vcstring.pyx":1422
 *                 print('-------------------------------')
 *                 sys.stdout.flush()
 *                 if manual == False:             # <<<<<<<<<<<<<<
 *                     hx = random.uniform(-delta, delta) # get random value to move z
 *                     hy = random.uniform(-delta, delta)
 */
      __pyx_t_7 = PyObject_RichCompare(__pyx_v_manual, Py_False, Py_EQ); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1422, __pyx_L1_error)
      __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1422, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (__pyx_t_14) {

        /* "vcstring.pyx":1423
 *                 sys.stdout.flush()
 *                 if manual == False:
 *                     hx = random.uniform(-delta, delta) # get random value to move z             # <<<<<<<<<<<<<<
 *                     hy = random.uniform(-delta, delta)
 *                 else:
 */
        __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_random); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1423, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_uniform); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1423, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = PyFloat_FromDouble((-__pyx_v_delta)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1423, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_6 = PyFloat_FromDouble(__pyx_v_delta); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1423, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_5 = NULL;
        __pyx_t_15 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
          __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_10);
          if (likely(__pyx_t_5)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
            __Pyx_INCREF(__pyx_t_5);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_10, function);
            __pyx_t_15 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_10)) {
          PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_1, __pyx_t_6};
          __pyx_t_7 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1423, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
          PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_1, __pyx_t_6};
          __pyx_t_7 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1423, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        {
          __pyx_t_4 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1423, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          if (__pyx_t_5) {
            __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5); __pyx_t_5 = NULL;
          }
          __Pyx_GIVEREF(__pyx_t_1);
          PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_15, __pyx_t_1);
          __Pyx_GIVEREF(__pyx_t_6);
          PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_15, __pyx_t_6);
          __pyx_t_1 = 0;
          __pyx_t_6 = 0;
          __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_4, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1423, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        }
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_7); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1423, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_v_hx = __pyx_t_16;

        /* "vcstring.pyx":1424
 *                 if manual == False:
 *                     hx = random.uniform(-delta, delta) # get random value to move z
 *                     hy = random.uniform(-delta, delta)             # <<<<<<<<<<<<<<
 *                 else:
 *                     hx = hx_man  # MC with manually selected move
 */
        __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_random); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1424, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_uniform); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1424, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = PyFloat_FromDouble((-__pyx_v_delta)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1424, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_6 = PyFloat_FromDouble(__pyx_v_delta); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1424, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_1 = NULL;
        __pyx_t_15 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
          __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_4);
          if (likely(__pyx_t_1)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
            __Pyx_INCREF(__pyx_t_1);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_4, function);
            __pyx_t_15 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_t_10, __pyx_t_6};
          __pyx_t_7 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1424, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_t_10, __pyx_t_6};
          __pyx_t_7 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1424, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        {
          __pyx_t_5 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1424, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          if (__pyx_t_1) {
            __Pyx_GIVEREF(__pyx_t_1); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1); __pyx_t_1 = NULL;
          }
          __Pyx_GIVEREF(__pyx_t_10);
          PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_15, __pyx_t_10);
          __Pyx_GIVEREF(__pyx_t_6);
          PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_15, __pyx_t_6);
          __pyx_t_10 = 0;
          __pyx_t_6 = 0;
          __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1424, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        }
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_7); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1424, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_v_hy = __pyx_t_16;

        /* "vcstring.pyx":1422
 *                 print('-------------------------------')
 *                 sys.stdout.flush()
 *                 if manual == False:             # <<<<<<<<<<<<<<
 *                     hx = random.uniform(-delta, delta) # get random value to move z
 *                     hy = random.uniform(-delta, delta)
 */
        goto __pyx_L7;
      }

      /* "vcstring.pyx":1426
 *                     hy = random.uniform(-delta, delta)
 *                 else:
 *                     hx = hx_man  # MC with manually selected move             # <<<<<<<<<<<<<<
 *                     hy = hy_man
 *                 z[i][0] = z[i][0] + hx  # Update z
 */
      /*else*/ {
        __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_v_hx_man); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1426, __pyx_L1_error)
        __pyx_v_hx = __pyx_t_16;

        /* "vcstring.pyx":1427
 *                 else:
 *                     hx = hx_man  # MC with manually selected move
 *                     hy = hy_man             # <<<<<<<<<<<<<<
 *                 z[i][0] = z[i][0] + hx  # Update z
 *                 z[i][1] = z[i][1] + hy
 */
        __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_v_hy_man); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1427, __pyx_L1_error)
        __pyx_v_hy = __pyx_t_16;
      }
      __pyx_L7:;

      /* "vcstring.pyx":1428
 *                     hx = hx_man  # MC with manually selected move
 *                     hy = hy_man
 *                 z[i][0] = z[i][0] + hx  # Update z             # <<<<<<<<<<<<<<
 *                 z[i][1] = z[i][1] + hy
 *                 print('Moving position by {0} , {1}'.format(hx, hy))
 */
      __pyx_t_7 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1428, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1428, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_hx); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1428, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_5 = PyNumber_Add(__pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1428, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1428, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      if (unlikely(__Pyx_SetItemInt(__pyx_t_7, 0, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 1428, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "vcstring.pyx":1429
 *                     hy = hy_man
 *                 z[i][0] = z[i][0] + hx  # Update z
 *                 z[i][1] = z[i][1] + hy             # <<<<<<<<<<<<<<
 *                 print('Moving position by {0} , {1}'.format(hx, hy))
 *                 print('New position for image {0} is: {1} , {2}'.format(i, z[i][0], z[i][1]))
 */
      __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1429, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_5, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1429, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_hy); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1429, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = PyNumber_Add(__pyx_t_7, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1429, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1429, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      if (unlikely(__Pyx_SetItemInt(__pyx_t_5, 1, __pyx_t_4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 1429, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "vcstring.pyx":1430
 *                 z[i][0] = z[i][0] + hx  # Update z
 *                 z[i][1] = z[i][1] + hy
 *                 print('Moving position by {0} , {1}'.format(hx, hy))             # <<<<<<<<<<<<<<
 *                 print('New position for image {0} is: {1} , {2}'.format(i, z[i][0], z[i][1]))
 * 
 */
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_Moving_position_by_0_1, __pyx_n_s_format); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1430, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_hx); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1430, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_6 = PyFloat_FromDouble(__pyx_v_hy); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1430, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_10 = NULL;
      __pyx_t_15 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
          __pyx_t_15 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_5)) {
        PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_7, __pyx_t_6};
        __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1430, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
        PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_7, __pyx_t_6};
        __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1430, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      {
        __pyx_t_1 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1430, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        if (__pyx_t_10) {
          __Pyx_GIVEREF(__pyx_t_10); PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_10); __pyx_t_10 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_7);
        PyTuple_SET_ITEM(__pyx_t_1, 0+__pyx_t_15, __pyx_t_7);
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_1, 1+__pyx_t_15, __pyx_t_6);
        __pyx_t_7 = 0;
        __pyx_t_6 = 0;
        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_1, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1430, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1430, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "vcstring.pyx":1431
 *                 z[i][1] = z[i][1] + hy
 *                 print('Moving position by {0} , {1}'.format(hx, hy))
 *                 print('New position for image {0} is: {1} , {2}'.format(i, z[i][0], z[i][1]))             # <<<<<<<<<<<<<<
 * 
 *                 # Reparametrization of string: images are equidistance from one another
 */
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_New_position_for_image_0_is_1_2, __pyx_n_s_format); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1431, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1431, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_6 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1431, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1431, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1431, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_10 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1431, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = NULL;
      __pyx_t_15 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
          __pyx_t_15 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_4)) {
        PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_t_1, __pyx_t_7, __pyx_t_10};
        __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1431, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
        PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_t_1, __pyx_t_7, __pyx_t_10};
        __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1431, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      } else
      #endif
      {
        __pyx_t_3 = PyTuple_New(3+__pyx_t_15); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1431, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        if (__pyx_t_6) {
          __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_6); __pyx_t_6 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_15, __pyx_t_1);
        __Pyx_GIVEREF(__pyx_t_7);
        PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_15, __pyx_t_7);
        __Pyx_GIVEREF(__pyx_t_10);
        PyTuple_SET_ITEM(__pyx_t_3, 2+__pyx_t_15, __pyx_t_10);
        __pyx_t_1 = 0;
        __pyx_t_7 = 0;
        __pyx_t_10 = 0;
        __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1431, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      }
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1431, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

      /* "vcstring.pyx":1434
 * 
 *                 # Reparametrization of string: images are equidistance from one another
 *                 if reparm == True:             # <<<<<<<<<<<<<<
 *                     z = reparm_string(z)
 * 
 */
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_reparm, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1434, __pyx_L1_error)
      __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1434, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_14) {

        /* "vcstring.pyx":1435
 *                 # Reparametrization of string: images are equidistance from one another
 *                 if reparm == True:
 *                     z = reparm_string(z)             # <<<<<<<<<<<<<<
 * 
 *                 # Check distance between neighboring beads
 */
        __pyx_t_4 = __pyx_f_8vcstring_reparm_string(((PyArrayObject *)__pyx_v_z), 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1435, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1435, __pyx_L1_error)
        __pyx_t_17 = ((PyArrayObject *)__pyx_t_4);
        {
          __Pyx_BufFmt_StackElem __pyx_stack[1];
          __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
          __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_t_17, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
          if (unlikely(__pyx_t_15 < 0)) {
            PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
            if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
              Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
              __Pyx_RaiseBufferFallbackError();
            } else {
              PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
            }
            __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
          }
          __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
          if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1435, __pyx_L1_error)
        }
        __pyx_t_17 = 0;
        __Pyx_DECREF_SET(__pyx_v_z, ((PyArrayObject *)__pyx_t_4));
        __pyx_t_4 = 0;

        /* "vcstring.pyx":1434
 * 
 *                 # Reparametrization of string: images are equidistance from one another
 *                 if reparm == True:             # <<<<<<<<<<<<<<
 *                     z = reparm_string(z)
 * 
 */
      }

      /* "vcstring.pyx":1438
 * 
 *                 # Check distance between neighboring beads
 *                 if mindist_constraint == True:             # <<<<<<<<<<<<<<
 *                     if i != 0 or i != len(z)-1:  # If not first or last image on the string
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 */
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_mindist_constraint, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1438, __pyx_L1_error)
      __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1438, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (__pyx_t_14) {

        /* "vcstring.pyx":1439
 *                 # Check distance between neighboring beads
 *                 if mindist_constraint == True:
 *                     if i != 0 or i != len(z)-1:  # If not first or last image on the string             # <<<<<<<<<<<<<<
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 *                         d2 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 */
        __pyx_t_21 = ((__pyx_v_i != 0) != 0);
        if (!__pyx_t_21) {
        } else {
          __pyx_t_14 = __pyx_t_21;
          goto __pyx_L11_bool_binop_done;
        }
        __pyx_t_22 = PyObject_Length(((PyObject *)__pyx_v_z)); if (unlikely(__pyx_t_22 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1439, __pyx_L1_error)
        __pyx_t_21 = ((__pyx_v_i != (__pyx_t_22 - 1)) != 0);
        __pyx_t_14 = __pyx_t_21;
        __pyx_L11_bool_binop_done:;
        if (__pyx_t_14) {

          /* "vcstring.pyx":1440
 *                 if mindist_constraint == True:
 *                     if i != 0 or i != len(z)-1:  # If not first or last image on the string
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)             # <<<<<<<<<<<<<<
 *                         d2 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 *                     elif i == 0:  # If first image on string
 */
          __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_math); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1440, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1440, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1440, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_10 = __Pyx_GetItemInt(__pyx_t_5, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1440, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_23 = (__pyx_v_i - 1);
          __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_t_23, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1440, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_5, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1440, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = PyNumber_Subtract(__pyx_t_10, __pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1440, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_7 = PyNumber_Power(__pyx_t_5, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1440, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1440, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_10 = __Pyx_GetItemInt(__pyx_t_5, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1440, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_23 = (__pyx_v_i - 1);
          __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_t_23, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1440, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_5, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1440, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = PyNumber_Subtract(__pyx_t_10, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1440, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = PyNumber_Power(__pyx_t_5, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1440, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = PyNumber_Add(__pyx_t_7, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1440, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
            __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
            if (likely(__pyx_t_1)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
              __Pyx_INCREF(__pyx_t_1);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_3, function);
            }
          }
          __pyx_t_4 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_1, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_5);
          __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1440, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1440, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_v_d1 = __pyx_t_16;

          /* "vcstring.pyx":1441
 *                     if i != 0 or i != len(z)-1:  # If not first or last image on the string
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 *                         d2 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)             # <<<<<<<<<<<<<<
 *                     elif i == 0:  # If first image on string
 *                         d1 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 */
          __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_math); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1441, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1441, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1441, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1441, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_23 = (__pyx_v_i + 1);
          __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_t_23, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1441, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1441, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = PyNumber_Subtract(__pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1441, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_7 = PyNumber_Power(__pyx_t_3, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1441, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1441, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_3, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1441, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_23 = (__pyx_v_i + 1);
          __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_t_23, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1441, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_10 = __Pyx_GetItemInt(__pyx_t_3, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1441, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = PyNumber_Subtract(__pyx_t_1, __pyx_t_10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1441, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = PyNumber_Power(__pyx_t_3, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1441, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = PyNumber_Add(__pyx_t_7, __pyx_t_10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1441, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
            __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_5);
            if (likely(__pyx_t_10)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
              __Pyx_INCREF(__pyx_t_10);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_5, function);
            }
          }
          __pyx_t_4 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_10, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_3);
          __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1441, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1441, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_v_d2 = __pyx_t_16;

          /* "vcstring.pyx":1439
 *                 # Check distance between neighboring beads
 *                 if mindist_constraint == True:
 *                     if i != 0 or i != len(z)-1:  # If not first or last image on the string             # <<<<<<<<<<<<<<
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 *                         d2 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 */
          goto __pyx_L10;
        }

        /* "vcstring.pyx":1442
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 *                         d2 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 *                     elif i == 0:  # If first image on string             # <<<<<<<<<<<<<<
 *                         d1 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 *                         d2 = mindist
 */
        __pyx_t_14 = ((__pyx_v_i == 0) != 0);
        if (__pyx_t_14) {

          /* "vcstring.pyx":1443
 *                         d2 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 *                     elif i == 0:  # If first image on string
 *                         d1 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)             # <<<<<<<<<<<<<<
 *                         d2 = mindist
 *                     elif i == len(z)-1:  # If last image on string
 */
          __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_math); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1443, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1443, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1443, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_10 = __Pyx_GetItemInt(__pyx_t_5, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1443, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_23 = (__pyx_v_i + 1);
          __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_t_23, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1443, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_5, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1443, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = PyNumber_Subtract(__pyx_t_10, __pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1443, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_7 = PyNumber_Power(__pyx_t_5, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1443, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1443, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_10 = __Pyx_GetItemInt(__pyx_t_5, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1443, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_23 = (__pyx_v_i + 1);
          __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_t_23, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1443, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_5, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1443, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = PyNumber_Subtract(__pyx_t_10, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1443, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = PyNumber_Power(__pyx_t_5, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1443, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = PyNumber_Add(__pyx_t_7, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1443, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
            __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
            if (likely(__pyx_t_1)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
              __Pyx_INCREF(__pyx_t_1);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_3, function);
            }
          }
          __pyx_t_4 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_1, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_5);
          __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1443, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1443, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_v_d1 = __pyx_t_16;

          /* "vcstring.pyx":1444
 *                     elif i == 0:  # If first image on string
 *                         d1 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 *                         d2 = mindist             # <<<<<<<<<<<<<<
 *                     elif i == len(z)-1:  # If last image on string
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 */
          __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_v_mindist); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1444, __pyx_L1_error)
          __pyx_v_d2 = __pyx_t_16;

          /* "vcstring.pyx":1442
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 *                         d2 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 *                     elif i == 0:  # If first image on string             # <<<<<<<<<<<<<<
 *                         d1 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 *                         d2 = mindist
 */
          goto __pyx_L10;
        }

        /* "vcstring.pyx":1445
 *                         d1 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 *                         d2 = mindist
 *                     elif i == len(z)-1:  # If last image on string             # <<<<<<<<<<<<<<
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 *                         d2 = mindist
 */
        __pyx_t_22 = PyObject_Length(((PyObject *)__pyx_v_z)); if (unlikely(__pyx_t_22 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1445, __pyx_L1_error)
        __pyx_t_14 = ((__pyx_v_i == (__pyx_t_22 - 1)) != 0);
        if (__pyx_t_14) {

          /* "vcstring.pyx":1446
 *                         d2 = mindist
 *                     elif i == len(z)-1:  # If last image on string
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)             # <<<<<<<<<<<<<<
 *                         d2 = mindist
 *                     print('\nEnforcing minimum distance constraint')
 */
          __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_math); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1446, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1446, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1446, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1446, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_23 = (__pyx_v_i - 1);
          __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_t_23, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1446, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1446, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = PyNumber_Subtract(__pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1446, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_7 = PyNumber_Power(__pyx_t_3, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1446, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1446, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_3, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1446, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_23 = (__pyx_v_i - 1);
          __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_t_23, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1446, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_10 = __Pyx_GetItemInt(__pyx_t_3, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1446, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = PyNumber_Subtract(__pyx_t_1, __pyx_t_10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1446, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = PyNumber_Power(__pyx_t_3, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1446, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = PyNumber_Add(__pyx_t_7, __pyx_t_10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1446, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
            __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_5);
            if (likely(__pyx_t_10)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
              __Pyx_INCREF(__pyx_t_10);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_5, function);
            }
          }
          __pyx_t_4 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_10, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_3);
          __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1446, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1446, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_v_d1 = __pyx_t_16;

          /* "vcstring.pyx":1447
 *                     elif i == len(z)-1:  # If last image on string
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 *                         d2 = mindist             # <<<<<<<<<<<<<<
 *                     print('\nEnforcing minimum distance constraint')
 *                     print('Minimum distance allowed between images:', mindist)
 */
          __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_v_mindist); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1447, __pyx_L1_error)
          __pyx_v_d2 = __pyx_t_16;

          /* "vcstring.pyx":1445
 *                         d1 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 *                         d2 = mindist
 *                     elif i == len(z)-1:  # If last image on string             # <<<<<<<<<<<<<<
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 *                         d2 = mindist
 */
        }
        __pyx_L10:;

        /* "vcstring.pyx":1448
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 *                         d2 = mindist
 *                     print('\nEnforcing minimum distance constraint')             # <<<<<<<<<<<<<<
 *                     print('Minimum distance allowed between images:', mindist)
 *                     print('Distance to neighbhoring images:', d1, d2)
 */
        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__62, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1448, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

        /* "vcstring.pyx":1449
 *                         d2 = mindist
 *                     print('\nEnforcing minimum distance constraint')
 *                     print('Minimum distance allowed between images:', mindist)             # <<<<<<<<<<<<<<
 *                     print('Distance to neighbhoring images:', d1, d2)
 *                     if d1 < mindist or d2 < mindist:  # If smaller than the minimum distance allowed
 */
        __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1449, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_kp_u_Minimum_distance_allowed_between);
        __Pyx_GIVEREF(__pyx_kp_u_Minimum_distance_allowed_between);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_Minimum_distance_allowed_between);
        __Pyx_INCREF(__pyx_v_mindist);
        __Pyx_GIVEREF(__pyx_v_mindist);
        PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_mindist);
        __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1449, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

        /* "vcstring.pyx":1450
 *                     print('\nEnforcing minimum distance constraint')
 *                     print('Minimum distance allowed between images:', mindist)
 *                     print('Distance to neighbhoring images:', d1, d2)             # <<<<<<<<<<<<<<
 *                     if d1 < mindist or d2 < mindist:  # If smaller than the minimum distance allowed
 *                         z[i][0] = z[i][0] - hx  # Move back to original position
 */
        __pyx_t_5 = PyFloat_FromDouble(__pyx_v_d1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1450, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_d2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1450, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1450, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_kp_u_Distance_to_neighbhoring_images);
        __Pyx_GIVEREF(__pyx_kp_u_Distance_to_neighbhoring_images);
        PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_u_Distance_to_neighbhoring_images);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_t_4);
        __pyx_t_5 = 0;
        __pyx_t_4 = 0;
        __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1450, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

        /* "vcstring.pyx":1451
 *                     print('Minimum distance allowed between images:', mindist)
 *                     print('Distance to neighbhoring images:', d1, d2)
 *                     if d1 < mindist or d2 < mindist:  # If smaller than the minimum distance allowed             # <<<<<<<<<<<<<<
 *                         z[i][0] = z[i][0] - hx  # Move back to original position
 *                         z[i][1] = z[i][1] - hy
 */
        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_d1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1451, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_3 = PyObject_RichCompare(__pyx_t_4, __pyx_v_mindist, Py_LT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1451, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 1451, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        if (!__pyx_t_21) {
        } else {
          __pyx_t_14 = __pyx_t_21;
          goto __pyx_L14_bool_binop_done;
        }
        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_d2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1451, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_4 = PyObject_RichCompare(__pyx_t_3, __pyx_v_mindist, Py_LT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1451, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 1451, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_14 = __pyx_t_21;
        __pyx_L14_bool_binop_done:;
        if (__pyx_t_14) {

          /* "vcstring.pyx":1452
 *                     print('Distance to neighbhoring images:', d1, d2)
 *                     if d1 < mindist or d2 < mindist:  # If smaller than the minimum distance allowed
 *                         z[i][0] = z[i][0] - hx  # Move back to original position             # <<<<<<<<<<<<<<
 *                         z[i][1] = z[i][1] - hy
 *                         print('Rejected: Moved position by {0} , {1}. Too close to neighboring images.'.format(hx, hy))
 */
          __pyx_t_4 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1452, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_4, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1452, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = PyFloat_FromDouble(__pyx_v_hx); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1452, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_5 = PyNumber_Subtract(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1452, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1452, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          if (unlikely(__Pyx_SetItemInt(__pyx_t_4, 0, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 1452, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

          /* "vcstring.pyx":1453
 *                     if d1 < mindist or d2 < mindist:  # If smaller than the minimum distance allowed
 *                         z[i][0] = z[i][0] - hx  # Move back to original position
 *                         z[i][1] = z[i][1] - hy             # <<<<<<<<<<<<<<
 *                         print('Rejected: Moved position by {0} , {1}. Too close to neighboring images.'.format(hx, hy))
 *                         continue
 */
          __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1453, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_5, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1453, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = PyFloat_FromDouble(__pyx_v_hy); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1453, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_3 = PyNumber_Subtract(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1453, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1453, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          if (unlikely(__Pyx_SetItemInt(__pyx_t_5, 1, __pyx_t_3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 1453, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

          /* "vcstring.pyx":1454
 *                         z[i][0] = z[i][0] - hx  # Move back to original position
 *                         z[i][1] = z[i][1] - hy
 *                         print('Rejected: Moved position by {0} , {1}. Too close to neighboring images.'.format(hx, hy))             # <<<<<<<<<<<<<<
 *                         continue
 * 
 */
          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_Rejected_Moved_position_by_0_1_T, __pyx_n_s_format); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1454, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_4 = PyFloat_FromDouble(__pyx_v_hx); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1454, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_10 = PyFloat_FromDouble(__pyx_v_hy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1454, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_7 = NULL;
          __pyx_t_15 = 0;
          if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
            __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
            if (likely(__pyx_t_7)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
              __Pyx_INCREF(__pyx_t_7);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_5, function);
              __pyx_t_15 = 1;
            }
          }
          #if CYTHON_FAST_PYCALL
          if (PyFunction_Check(__pyx_t_5)) {
            PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_4, __pyx_t_10};
            __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1454, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
            __Pyx_GOTREF(__pyx_t_3);
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
            PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_4, __pyx_t_10};
            __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1454, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
            __Pyx_GOTREF(__pyx_t_3);
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          } else
          #endif
          {
            __pyx_t_1 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1454, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_1);
            if (__pyx_t_7) {
              __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_7); __pyx_t_7 = NULL;
            }
            __Pyx_GIVEREF(__pyx_t_4);
            PyTuple_SET_ITEM(__pyx_t_1, 0+__pyx_t_15, __pyx_t_4);
            __Pyx_GIVEREF(__pyx_t_10);
            PyTuple_SET_ITEM(__pyx_t_1, 1+__pyx_t_15, __pyx_t_10);
            __pyx_t_4 = 0;
            __pyx_t_10 = 0;
            __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1454, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_3);
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          }
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1454, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

          /* "vcstring.pyx":1455
 *                         z[i][1] = z[i][1] - hy
 *                         print('Rejected: Moved position by {0} , {1}. Too close to neighboring images.'.format(hx, hy))
 *                         continue             # <<<<<<<<<<<<<<
 * 
 *                 # Solve linear coeff equation, calculate correlation function
 */
          goto __pyx_L5_continue;

          /* "vcstring.pyx":1451
 *                     print('Minimum distance allowed between images:', mindist)
 *                     print('Distance to neighbhoring images:', d1, d2)
 *                     if d1 < mindist or d2 < mindist:  # If smaller than the minimum distance allowed             # <<<<<<<<<<<<<<
 *                         z[i][0] = z[i][0] - hx  # Move back to original position
 *                         z[i][1] = z[i][1] - hy
 */
        }

        /* "vcstring.pyx":1438
 * 
 *                 # Check distance between neighboring beads
 *                 if mindist_constraint == True:             # <<<<<<<<<<<<<<
 *                     if i != 0 or i != len(z)-1:  # If not first or last image on the string
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 */
      }

      /* "vcstring.pyx":1458
 * 
 *                 # Solve linear coeff equation, calculate correlation function
 *                 if accelerated == True:             # <<<<<<<<<<<<<<
 *                     if (i != 0) and (it != 1): # If not the 1st image of the 1st iteration
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs_accelerated(i, traj, tau, z)
 */
      __pyx_t_5 = PyObject_RichCompare(__pyx_v_accelerated, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1458, __pyx_L1_error)
      __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1458, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_14) {

        /* "vcstring.pyx":1459
 *                 # Solve linear coeff equation, calculate correlation function
 *                 if accelerated == True:
 *                     if (i != 0) and (it != 1): # If not the 1st image of the 1st iteration             # <<<<<<<<<<<<<<
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs_accelerated(i, traj, tau, z)
 *                 else:
 */
        __pyx_t_21 = ((__pyx_v_i != 0) != 0);
        if (__pyx_t_21) {
        } else {
          __pyx_t_14 = __pyx_t_21;
          goto __pyx_L18_bool_binop_done;
        }
        __pyx_t_21 = ((__pyx_v_it != 1) != 0);
        __pyx_t_14 = __pyx_t_21;
        __pyx_L18_bool_binop_done:;
        if (__pyx_t_14) {

          /* "vcstring.pyx":1460
 *                 if accelerated == True:
 *                     if (i != 0) and (it != 1): # If not the 1st image of the 1st iteration
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs_accelerated(i, traj, tau, z)             # <<<<<<<<<<<<<<
 *                 else:
 *                     # Average of time averages (best for a few aggregate long trajectories)
 */
          __pyx_t_5 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->calc_coeffs_accelerated(__pyx_v_self, __pyx_v_i, __pyx_v_traj, __pyx_v_tau, ((PyArrayObject *)__pyx_v_z), 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1460, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          if ((likely(PyTuple_CheckExact(__pyx_t_5))) || (PyList_CheckExact(__pyx_t_5))) {
            PyObject* sequence = __pyx_t_5;
            Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
            if (unlikely(size != 5)) {
              if (size > 5) __Pyx_RaiseTooManyValuesError(5);
              else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
              __PYX_ERR(0, 1460, __pyx_L1_error)
            }
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            if (likely(PyTuple_CheckExact(sequence))) {
              __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
              __pyx_t_1 = PyTuple_GET_ITEM(sequence, 1); 
              __pyx_t_10 = PyTuple_GET_ITEM(sequence, 2); 
              __pyx_t_4 = PyTuple_GET_ITEM(sequence, 3); 
              __pyx_t_7 = PyTuple_GET_ITEM(sequence, 4); 
            } else {
              __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
              __pyx_t_1 = PyList_GET_ITEM(sequence, 1); 
              __pyx_t_10 = PyList_GET_ITEM(sequence, 2); 
              __pyx_t_4 = PyList_GET_ITEM(sequence, 3); 
              __pyx_t_7 = PyList_GET_ITEM(sequence, 4); 
            }
            __Pyx_INCREF(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_1);
            __Pyx_INCREF(__pyx_t_10);
            __Pyx_INCREF(__pyx_t_4);
            __Pyx_INCREF(__pyx_t_7);
            #else
            {
              Py_ssize_t i;
              PyObject** temps[5] = {&__pyx_t_3,&__pyx_t_1,&__pyx_t_10,&__pyx_t_4,&__pyx_t_7};
              for (i=0; i < 5; i++) {
                PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) __PYX_ERR(0, 1460, __pyx_L1_error)
                __Pyx_GOTREF(item);
                *(temps[i]) = item;
              }
            }
            #endif
            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          } else {
            Py_ssize_t index = -1;
            PyObject** temps[5] = {&__pyx_t_3,&__pyx_t_1,&__pyx_t_10,&__pyx_t_4,&__pyx_t_7};
            __pyx_t_6 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1460, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_6);
            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_t_24 = Py_TYPE(__pyx_t_6)->tp_iternext;
            for (index=0; index < 5; index++) {
              PyObject* item = __pyx_t_24(__pyx_t_6); if (unlikely(!item)) goto __pyx_L20_unpacking_failed;
              __Pyx_GOTREF(item);
              *(temps[index]) = item;
            }
            if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_6), 5) < 0) __PYX_ERR(0, 1460, __pyx_L1_error)
            __pyx_t_24 = NULL;
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
            goto __pyx_L21_unpacking_done;
            __pyx_L20_unpacking_failed:;
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
            __pyx_t_24 = NULL;
            if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
            __PYX_ERR(0, 1460, __pyx_L1_error)
            __pyx_L21_unpacking_done:;
          }
          if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1460, __pyx_L1_error)
          if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1460, __pyx_L1_error)
          if (!(likely(((__pyx_t_10) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_10, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1460, __pyx_L1_error)
          if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1460, __pyx_L1_error)
          if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1460, __pyx_L1_error)
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_3);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1460, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_XDECREF_SET(__pyx_v_b, ((PyArrayObject *)__pyx_t_3));
          __pyx_t_3 = 0;
          __pyx_t_26 = ((PyArrayObject *)__pyx_t_1);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
              }
              __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
            }
            __pyx_pybuffernd_D_0.diminfo[0].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0.diminfo[0].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0.diminfo[1].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0.diminfo[1].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[1];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1460, __pyx_L1_error)
          }
          __pyx_t_26 = 0;
          __Pyx_XDECREF_SET(__pyx_v_D_0, ((PyArrayObject *)__pyx_t_1));
          __pyx_t_1 = 0;
          __pyx_t_26 = ((PyArrayObject *)__pyx_t_10);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_D_tau.diminfo[0].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau.diminfo[0].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau.diminfo[1].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau.diminfo[1].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[1];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1460, __pyx_L1_error)
          }
          __pyx_t_26 = 0;
          __Pyx_XDECREF_SET(__pyx_v_D_tau, ((PyArrayObject *)__pyx_t_10));
          __pyx_t_10 = 0;
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_4);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
              }
              __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
            }
            __pyx_pybuffernd_g_0.diminfo[0].strides = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_0.diminfo[0].shape = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1460, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_XDECREF_SET(__pyx_v_g_0, ((PyArrayObject *)__pyx_t_4));
          __pyx_t_4 = 0;
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_7);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_g_tau.diminfo[0].strides = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_tau.diminfo[0].shape = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1460, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_XDECREF_SET(__pyx_v_g_tau, ((PyArrayObject *)__pyx_t_7));
          __pyx_t_7 = 0;

          /* "vcstring.pyx":1459
 *                 # Solve linear coeff equation, calculate correlation function
 *                 if accelerated == True:
 *                     if (i != 0) and (it != 1): # If not the 1st image of the 1st iteration             # <<<<<<<<<<<<<<
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs_accelerated(i, traj, tau, z)
 *                 else:
 */
        }

        /* "vcstring.pyx":1458
 * 
 *                 # Solve linear coeff equation, calculate correlation function
 *                 if accelerated == True:             # <<<<<<<<<<<<<<
 *                     if (i != 0) and (it != 1): # If not the 1st image of the 1st iteration
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs_accelerated(i, traj, tau, z)
 */
        goto __pyx_L16;
      }

      /* "vcstring.pyx":1463
 *                 else:
 *                     # Average of time averages (best for a few aggregate long trajectories)
 *                     if ensemble_timeavg_v1 == True:             # <<<<<<<<<<<<<<
 *                         print('\n================================')
 *                         print('ENSEMBLE TIME AVERAGE - method 1')
 */
      /*else*/ {
        __pyx_t_5 = PyObject_RichCompare(__pyx_v_ensemble_timeavg_v1, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1463, __pyx_L1_error)
        __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1463, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        if (__pyx_t_14) {

          /* "vcstring.pyx":1464
 *                     # Average of time averages (best for a few aggregate long trajectories)
 *                     if ensemble_timeavg_v1 == True:
 *                         print('\n================================')             # <<<<<<<<<<<<<<
 *                         print('ENSEMBLE TIME AVERAGE - method 1')
 *                         print('================================')
 */
          __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__64, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1464, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

          /* "vcstring.pyx":1465
 *                     if ensemble_timeavg_v1 == True:
 *                         print('\n================================')
 *                         print('ENSEMBLE TIME AVERAGE - method 1')             # <<<<<<<<<<<<<<
 *                         print('================================')
 *                         print('Number of trajectories:', N)
 */
          __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__65, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1465, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

          /* "vcstring.pyx":1466
 *                         print('\n================================')
 *                         print('ENSEMBLE TIME AVERAGE - method 1')
 *                         print('================================')             # <<<<<<<<<<<<<<
 *                         print('Number of trajectories:', N)
 *                         b = np.zeros(self.num_basis)
 */
          __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__67, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1466, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

          /* "vcstring.pyx":1467
 *                         print('ENSEMBLE TIME AVERAGE - method 1')
 *                         print('================================')
 *                         print('Number of trajectories:', N)             # <<<<<<<<<<<<<<
 *                         b = np.zeros(self.num_basis)
 *                         D_0 = np.zeros((self.num_basis, self.num_basis))
 */
          __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_N); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1467, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1467, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_INCREF(__pyx_kp_u_Number_of_trajectories);
          __Pyx_GIVEREF(__pyx_kp_u_Number_of_trajectories);
          PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_kp_u_Number_of_trajectories);
          __Pyx_GIVEREF(__pyx_t_5);
          PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_5);
          __pyx_t_5 = 0;
          __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_7, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1467, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

          /* "vcstring.pyx":1468
 *                         print('================================')
 *                         print('Number of trajectories:', N)
 *                         b = np.zeros(self.num_basis)             # <<<<<<<<<<<<<<
 *                         D_0 = np.zeros((self.num_basis, self.num_basis))
 *                         D_tau = np.zeros((self.num_basis, self.num_basis))
 */
          __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1468, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1468, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1468, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_10 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
            __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_4);
            if (likely(__pyx_t_10)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
              __Pyx_INCREF(__pyx_t_10);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_4, function);
            }
          }
          __pyx_t_5 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_10, __pyx_t_7) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_7);
          __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1468, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1468, __pyx_L1_error)
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_5);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
              }
              __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
            }
            __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1468, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_XDECREF_SET(__pyx_v_b, ((PyArrayObject *)__pyx_t_5));
          __pyx_t_5 = 0;

          /* "vcstring.pyx":1469
 *                         print('Number of trajectories:', N)
 *                         b = np.zeros(self.num_basis)
 *                         D_0 = np.zeros((self.num_basis, self.num_basis))             # <<<<<<<<<<<<<<
 *                         D_tau = np.zeros((self.num_basis, self.num_basis))
 *                         g_0 = np.zeros(self.num_basis)
 */
          __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1469, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1469, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1469, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_10 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1469, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1469, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_GIVEREF(__pyx_t_4);
          PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_10);
          PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_10);
          __pyx_t_4 = 0;
          __pyx_t_10 = 0;
          __pyx_t_10 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
            __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_7);
            if (likely(__pyx_t_10)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
              __Pyx_INCREF(__pyx_t_10);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_7, function);
            }
          }
          __pyx_t_5 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_10, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_1);
          __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1469, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1469, __pyx_L1_error)
          __pyx_t_26 = ((PyArrayObject *)__pyx_t_5);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_D_0.diminfo[0].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0.diminfo[0].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0.diminfo[1].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0.diminfo[1].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[1];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1469, __pyx_L1_error)
          }
          __pyx_t_26 = 0;
          __Pyx_XDECREF_SET(__pyx_v_D_0, ((PyArrayObject *)__pyx_t_5));
          __pyx_t_5 = 0;

          /* "vcstring.pyx":1470
 *                         b = np.zeros(self.num_basis)
 *                         D_0 = np.zeros((self.num_basis, self.num_basis))
 *                         D_tau = np.zeros((self.num_basis, self.num_basis))             # <<<<<<<<<<<<<<
 *                         g_0 = np.zeros(self.num_basis)
 *                         g_tau = np.zeros(self.num_basis)
 */
          __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1470, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1470, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1470, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_10 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1470, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1470, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_7);
          PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_7);
          __Pyx_GIVEREF(__pyx_t_10);
          PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_10);
          __pyx_t_7 = 0;
          __pyx_t_10 = 0;
          __pyx_t_10 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
            __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_1);
            if (likely(__pyx_t_10)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
              __Pyx_INCREF(__pyx_t_10);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_1, function);
            }
          }
          __pyx_t_5 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_10, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_4);
          __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1470, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1470, __pyx_L1_error)
          __pyx_t_26 = ((PyArrayObject *)__pyx_t_5);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
              }
              __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
            }
            __pyx_pybuffernd_D_tau.diminfo[0].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau.diminfo[0].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau.diminfo[1].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau.diminfo[1].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[1];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1470, __pyx_L1_error)
          }
          __pyx_t_26 = 0;
          __Pyx_XDECREF_SET(__pyx_v_D_tau, ((PyArrayObject *)__pyx_t_5));
          __pyx_t_5 = 0;

          /* "vcstring.pyx":1471
 *                         D_0 = np.zeros((self.num_basis, self.num_basis))
 *                         D_tau = np.zeros((self.num_basis, self.num_basis))
 *                         g_0 = np.zeros(self.num_basis)             # <<<<<<<<<<<<<<
 *                         g_tau = np.zeros(self.num_basis)
 *                         C_k = 0.0
 */
          __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1471, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1471, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1471, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_10 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
            __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_4);
            if (likely(__pyx_t_10)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
              __Pyx_INCREF(__pyx_t_10);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_4, function);
            }
          }
          __pyx_t_5 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_10, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_1);
          __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1471, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1471, __pyx_L1_error)
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_5);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_g_0.diminfo[0].strides = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_0.diminfo[0].shape = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1471, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_XDECREF_SET(__pyx_v_g_0, ((PyArrayObject *)__pyx_t_5));
          __pyx_t_5 = 0;

          /* "vcstring.pyx":1472
 *                         D_tau = np.zeros((self.num_basis, self.num_basis))
 *                         g_0 = np.zeros(self.num_basis)
 *                         g_tau = np.zeros(self.num_basis)             # <<<<<<<<<<<<<<
 *                         C_k = 0.0
 * 
 */
          __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1472, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1472, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1472, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_10 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
            __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_1);
            if (likely(__pyx_t_10)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
              __Pyx_INCREF(__pyx_t_10);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_1, function);
            }
          }
          __pyx_t_5 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_10, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_4);
          __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1472, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1472, __pyx_L1_error)
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_5);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
              }
              __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
            }
            __pyx_pybuffernd_g_tau.diminfo[0].strides = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_tau.diminfo[0].shape = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1472, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_XDECREF_SET(__pyx_v_g_tau, ((PyArrayObject *)__pyx_t_5));
          __pyx_t_5 = 0;

          /* "vcstring.pyx":1473
 *                         g_0 = np.zeros(self.num_basis)
 *                         g_tau = np.zeros(self.num_basis)
 *                         C_k = 0.0             # <<<<<<<<<<<<<<
 * 
 *                         for k in range(N):
 */
          __pyx_v_C_k = 0.0;

          /* "vcstring.pyx":1475
 *                         C_k = 0.0
 * 
 *                         for k in range(N):             # <<<<<<<<<<<<<<
 *                             print('\nTrajectory', k)
 *                             # time = np.arange(len(traj[k]))
 */
          __pyx_t_15 = __pyx_v_N;
          __pyx_t_27 = __pyx_t_15;
          for (__pyx_t_28 = 0; __pyx_t_28 < __pyx_t_27; __pyx_t_28+=1) {
            __pyx_v_k = __pyx_t_28;

            /* "vcstring.pyx":1476
 * 
 *                         for k in range(N):
 *                             print('\nTrajectory', k)             # <<<<<<<<<<<<<<
 *                             # time = np.arange(len(traj[k]))
 *                             # traj_k = np.c_[time, traj[k]]
 */
            __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_k); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1476, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_5);
            __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1476, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_1);
            __Pyx_INCREF(__pyx_kp_u_Trajectory);
            __Pyx_GIVEREF(__pyx_kp_u_Trajectory);
            PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Trajectory);
            __Pyx_GIVEREF(__pyx_t_5);
            PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_5);
            __pyx_t_5 = 0;
            __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1476, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_5);
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

            /* "vcstring.pyx":1480
 *                             # traj_k = np.c_[time, traj[k]]
 *                             # traj_k_list = traj_k.tolist()
 *                             ids = self.assign_states(traj[k], tau, z)             # <<<<<<<<<<<<<<
 *                             b_ens, D_0_ens, D_tau_ens, g_0_ens, g_tau_ens = self.calc_coeffs(len(traj[k]), tau, z, ids, symmetric=symmetric)
 *                             b += b_ens
 */
            if (unlikely(__pyx_v_traj == Py_None)) {
              PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
              __PYX_ERR(0, 1480, __pyx_L1_error)
            }
            __pyx_t_5 = __Pyx_GetItemInt_List(__pyx_v_traj, __pyx_v_k, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1480, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_5);
            if (!(likely(PyList_CheckExact(__pyx_t_5))||((__pyx_t_5) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_5)->tp_name), 0))) __PYX_ERR(0, 1480, __pyx_L1_error)
            __pyx_t_1 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->assign_states(__pyx_v_self, ((PyObject*)__pyx_t_5), __pyx_v_tau, ((PyArrayObject *)__pyx_v_z), 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1480, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_1);
            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
            if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1480, __pyx_L1_error)
            __pyx_t_26 = ((PyArrayObject *)__pyx_t_1);
            {
              __Pyx_BufFmt_StackElem __pyx_stack[1];
              __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
              __pyx_t_29 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
              if (unlikely(__pyx_t_29 < 0)) {
                PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
                if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                  Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                  __Pyx_RaiseBufferFallbackError();
                } else {
                  PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
                }
                __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
              }
              __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
              if (unlikely(__pyx_t_29 < 0)) __PYX_ERR(0, 1480, __pyx_L1_error)
            }
            __pyx_t_26 = 0;
            __Pyx_XDECREF_SET(__pyx_v_ids, ((PyArrayObject *)__pyx_t_1));
            __pyx_t_1 = 0;

            /* "vcstring.pyx":1481
 *                             # traj_k_list = traj_k.tolist()
 *                             ids = self.assign_states(traj[k], tau, z)
 *                             b_ens, D_0_ens, D_tau_ens, g_0_ens, g_tau_ens = self.calc_coeffs(len(traj[k]), tau, z, ids, symmetric=symmetric)             # <<<<<<<<<<<<<<
 *                             b += b_ens
 *                             D_0 += D_0_ens
 */
            if (unlikely(__pyx_v_traj == Py_None)) {
              PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
              __PYX_ERR(0, 1481, __pyx_L1_error)
            }
            __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_v_traj, __pyx_v_k, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1481, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_1);
            __pyx_t_22 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_22 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1481, __pyx_L1_error)
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
            __pyx_t_30.__pyx_n = 1;
            __pyx_t_30.symmetric = __pyx_v_symmetric;
            __pyx_t_1 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->calc_coeffs(__pyx_v_self, __pyx_t_22, __pyx_v_tau, ((PyArrayObject *)__pyx_v_z), ((PyArrayObject *)__pyx_v_ids), 0, &__pyx_t_30); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1481, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_1);
            if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
              PyObject* sequence = __pyx_t_1;
              Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
              if (unlikely(size != 5)) {
                if (size > 5) __Pyx_RaiseTooManyValuesError(5);
                else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
                __PYX_ERR(0, 1481, __pyx_L1_error)
              }
              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
              if (likely(PyTuple_CheckExact(sequence))) {
                __pyx_t_5 = PyTuple_GET_ITEM(sequence, 0); 
                __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
                __pyx_t_10 = PyTuple_GET_ITEM(sequence, 2); 
                __pyx_t_7 = PyTuple_GET_ITEM(sequence, 3); 
                __pyx_t_3 = PyTuple_GET_ITEM(sequence, 4); 
              } else {
                __pyx_t_5 = PyList_GET_ITEM(sequence, 0); 
                __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
                __pyx_t_10 = PyList_GET_ITEM(sequence, 2); 
                __pyx_t_7 = PyList_GET_ITEM(sequence, 3); 
                __pyx_t_3 = PyList_GET_ITEM(sequence, 4); 
              }
              __Pyx_INCREF(__pyx_t_5);
              __Pyx_INCREF(__pyx_t_4);
              __Pyx_INCREF(__pyx_t_10);
              __Pyx_INCREF(__pyx_t_7);
              __Pyx_INCREF(__pyx_t_3);
              #else
              {
                Py_ssize_t i;
                PyObject** temps[5] = {&__pyx_t_5,&__pyx_t_4,&__pyx_t_10,&__pyx_t_7,&__pyx_t_3};
                for (i=0; i < 5; i++) {
                  PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) __PYX_ERR(0, 1481, __pyx_L1_error)
                  __Pyx_GOTREF(item);
                  *(temps[i]) = item;
                }
              }
              #endif
              __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
            } else {
              Py_ssize_t index = -1;
              PyObject** temps[5] = {&__pyx_t_5,&__pyx_t_4,&__pyx_t_10,&__pyx_t_7,&__pyx_t_3};
              __pyx_t_6 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1481, __pyx_L1_error)
              __Pyx_GOTREF(__pyx_t_6);
              __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
              __pyx_t_24 = Py_TYPE(__pyx_t_6)->tp_iternext;
              for (index=0; index < 5; index++) {
                PyObject* item = __pyx_t_24(__pyx_t_6); if (unlikely(!item)) goto __pyx_L25_unpacking_failed;
                __Pyx_GOTREF(item);
                *(temps[index]) = item;
              }
              if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_6), 5) < 0) __PYX_ERR(0, 1481, __pyx_L1_error)
              __pyx_t_24 = NULL;
              __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
              goto __pyx_L26_unpacking_done;
              __pyx_L25_unpacking_failed:;
              __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
              __pyx_t_24 = NULL;
              if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
              __PYX_ERR(0, 1481, __pyx_L1_error)
              __pyx_L26_unpacking_done:;
            }
            if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1481, __pyx_L1_error)
            if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1481, __pyx_L1_error)
            if (!(likely(((__pyx_t_10) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_10, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1481, __pyx_L1_error)
            if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1481, __pyx_L1_error)
            if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1481, __pyx_L1_error)
            __pyx_t_31 = ((PyArrayObject *)__pyx_t_5);
            {
              __Pyx_BufFmt_StackElem __pyx_stack[1];
              __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b_ens.rcbuffer->pybuffer);
              __pyx_t_29 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b_ens.rcbuffer->pybuffer, (PyObject*)__pyx_t_31, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
              if (unlikely(__pyx_t_29 < 0)) {
                PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
                if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b_ens.rcbuffer->pybuffer, (PyObject*)__pyx_v_b_ens, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                  Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                  __Pyx_RaiseBufferFallbackError();
                } else {
                  PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
                }
                __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
              }
              __pyx_pybuffernd_b_ens.diminfo[0].strides = __pyx_pybuffernd_b_ens.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b_ens.diminfo[0].shape = __pyx_pybuffernd_b_ens.rcbuffer->pybuffer.shape[0];
              if (unlikely(__pyx_t_29 < 0)) __PYX_ERR(0, 1481, __pyx_L1_error)
            }
            __pyx_t_31 = 0;
            __Pyx_XDECREF_SET(__pyx_v_b_ens, ((PyArrayObject *)__pyx_t_5));
            __pyx_t_5 = 0;
            __pyx_t_32 = ((PyArrayObject *)__pyx_t_4);
            {
              __Pyx_BufFmt_StackElem __pyx_stack[1];
              __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_ens.rcbuffer->pybuffer);
              __pyx_t_29 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_ens.rcbuffer->pybuffer, (PyObject*)__pyx_t_32, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
              if (unlikely(__pyx_t_29 < 0)) {
                PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
                if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0_ens.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0_ens, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                  Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                  __Pyx_RaiseBufferFallbackError();
                } else {
                  PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
                }
                __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
              }
              __pyx_pybuffernd_D_0_ens.diminfo[0].strides = __pyx_pybuffernd_D_0_ens.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0_ens.diminfo[0].shape = __pyx_pybuffernd_D_0_ens.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0_ens.diminfo[1].strides = __pyx_pybuffernd_D_0_ens.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0_ens.diminfo[1].shape = __pyx_pybuffernd_D_0_ens.rcbuffer->pybuffer.shape[1];
              if (unlikely(__pyx_t_29 < 0)) __PYX_ERR(0, 1481, __pyx_L1_error)
            }
            __pyx_t_32 = 0;
            __Pyx_XDECREF_SET(__pyx_v_D_0_ens, ((PyArrayObject *)__pyx_t_4));
            __pyx_t_4 = 0;
            __pyx_t_32 = ((PyArrayObject *)__pyx_t_10);
            {
              __Pyx_BufFmt_StackElem __pyx_stack[1];
              __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_ens.rcbuffer->pybuffer);
              __pyx_t_29 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_ens.rcbuffer->pybuffer, (PyObject*)__pyx_t_32, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
              if (unlikely(__pyx_t_29 < 0)) {
                PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
                if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau_ens.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau_ens, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                  Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                  __Pyx_RaiseBufferFallbackError();
                } else {
                  PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
                }
                __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
              }
              __pyx_pybuffernd_D_tau_ens.diminfo[0].strides = __pyx_pybuffernd_D_tau_ens.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau_ens.diminfo[0].shape = __pyx_pybuffernd_D_tau_ens.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau_ens.diminfo[1].strides = __pyx_pybuffernd_D_tau_ens.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau_ens.diminfo[1].shape = __pyx_pybuffernd_D_tau_ens.rcbuffer->pybuffer.shape[1];
              if (unlikely(__pyx_t_29 < 0)) __PYX_ERR(0, 1481, __pyx_L1_error)
            }
            __pyx_t_32 = 0;
            __Pyx_XDECREF_SET(__pyx_v_D_tau_ens, ((PyArrayObject *)__pyx_t_10));
            __pyx_t_10 = 0;
            __pyx_t_31 = ((PyArrayObject *)__pyx_t_7);
            {
              __Pyx_BufFmt_StackElem __pyx_stack[1];
              __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_ens.rcbuffer->pybuffer);
              __pyx_t_29 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0_ens.rcbuffer->pybuffer, (PyObject*)__pyx_t_31, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
              if (unlikely(__pyx_t_29 < 0)) {
                PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
                if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0_ens.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_0_ens, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                  Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                  __Pyx_RaiseBufferFallbackError();
                } else {
                  PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
                }
                __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
              }
              __pyx_pybuffernd_g_0_ens.diminfo[0].strides = __pyx_pybuffernd_g_0_ens.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_0_ens.diminfo[0].shape = __pyx_pybuffernd_g_0_ens.rcbuffer->pybuffer.shape[0];
              if (unlikely(__pyx_t_29 < 0)) __PYX_ERR(0, 1481, __pyx_L1_error)
            }
            __pyx_t_31 = 0;
            __Pyx_XDECREF_SET(__pyx_v_g_0_ens, ((PyArrayObject *)__pyx_t_7));
            __pyx_t_7 = 0;
            __pyx_t_31 = ((PyArrayObject *)__pyx_t_3);
            {
              __Pyx_BufFmt_StackElem __pyx_stack[1];
              __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_ens.rcbuffer->pybuffer);
              __pyx_t_29 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau_ens.rcbuffer->pybuffer, (PyObject*)__pyx_t_31, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
              if (unlikely(__pyx_t_29 < 0)) {
                PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
                if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau_ens.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_tau_ens, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                  Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                  __Pyx_RaiseBufferFallbackError();
                } else {
                  PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
                }
                __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
              }
              __pyx_pybuffernd_g_tau_ens.diminfo[0].strides = __pyx_pybuffernd_g_tau_ens.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_tau_ens.diminfo[0].shape = __pyx_pybuffernd_g_tau_ens.rcbuffer->pybuffer.shape[0];
              if (unlikely(__pyx_t_29 < 0)) __PYX_ERR(0, 1481, __pyx_L1_error)
            }
            __pyx_t_31 = 0;
            __Pyx_XDECREF_SET(__pyx_v_g_tau_ens, ((PyArrayObject *)__pyx_t_3));
            __pyx_t_3 = 0;

            /* "vcstring.pyx":1482
 *                             ids = self.assign_states(traj[k], tau, z)
 *                             b_ens, D_0_ens, D_tau_ens, g_0_ens, g_tau_ens = self.calc_coeffs(len(traj[k]), tau, z, ids, symmetric=symmetric)
 *                             b += b_ens             # <<<<<<<<<<<<<<
 *                             D_0 += D_0_ens
 *                             D_tau += D_tau_ens
 */
            __pyx_t_1 = PyNumber_InPlaceAdd(((PyObject *)__pyx_v_b), ((PyObject *)__pyx_v_b_ens)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1482, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_1);
            if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1482, __pyx_L1_error)
            __pyx_t_25 = ((PyArrayObject *)__pyx_t_1);
            {
              __Pyx_BufFmt_StackElem __pyx_stack[1];
              __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
              __pyx_t_29 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
              if (unlikely(__pyx_t_29 < 0)) {
                PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
                if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                  Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                  __Pyx_RaiseBufferFallbackError();
                } else {
                  PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
                }
                __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
              }
              __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
              if (unlikely(__pyx_t_29 < 0)) __PYX_ERR(0, 1482, __pyx_L1_error)
            }
            __pyx_t_25 = 0;
            __Pyx_DECREF_SET(__pyx_v_b, ((PyArrayObject *)__pyx_t_1));
            __pyx_t_1 = 0;

            /* "vcstring.pyx":1483
 *                             b_ens, D_0_ens, D_tau_ens, g_0_ens, g_tau_ens = self.calc_coeffs(len(traj[k]), tau, z, ids, symmetric=symmetric)
 *                             b += b_ens
 *                             D_0 += D_0_ens             # <<<<<<<<<<<<<<
 *                             D_tau += D_tau_ens
 *                             g_0 += g_0_ens
 */
            __pyx_t_1 = PyNumber_InPlaceAdd(((PyObject *)__pyx_v_D_0), ((PyObject *)__pyx_v_D_0_ens)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1483, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_1);
            if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1483, __pyx_L1_error)
            __pyx_t_26 = ((PyArrayObject *)__pyx_t_1);
            {
              __Pyx_BufFmt_StackElem __pyx_stack[1];
              __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
              __pyx_t_29 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
              if (unlikely(__pyx_t_29 < 0)) {
                PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
                if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                  Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                  __Pyx_RaiseBufferFallbackError();
                } else {
                  PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
                }
                __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
              }
              __pyx_pybuffernd_D_0.diminfo[0].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0.diminfo[0].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0.diminfo[1].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0.diminfo[1].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[1];
              if (unlikely(__pyx_t_29 < 0)) __PYX_ERR(0, 1483, __pyx_L1_error)
            }
            __pyx_t_26 = 0;
            __Pyx_DECREF_SET(__pyx_v_D_0, ((PyArrayObject *)__pyx_t_1));
            __pyx_t_1 = 0;

            /* "vcstring.pyx":1484
 *                             b += b_ens
 *                             D_0 += D_0_ens
 *                             D_tau += D_tau_ens             # <<<<<<<<<<<<<<
 *                             g_0 += g_0_ens
 *                             g_tau += g_tau_ens
 */
            __pyx_t_1 = PyNumber_InPlaceAdd(((PyObject *)__pyx_v_D_tau), ((PyObject *)__pyx_v_D_tau_ens)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1484, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_1);
            if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1484, __pyx_L1_error)
            __pyx_t_26 = ((PyArrayObject *)__pyx_t_1);
            {
              __Pyx_BufFmt_StackElem __pyx_stack[1];
              __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
              __pyx_t_29 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
              if (unlikely(__pyx_t_29 < 0)) {
                PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
                if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                  Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                  __Pyx_RaiseBufferFallbackError();
                } else {
                  PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
                }
                __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
              }
              __pyx_pybuffernd_D_tau.diminfo[0].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau.diminfo[0].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau.diminfo[1].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau.diminfo[1].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[1];
              if (unlikely(__pyx_t_29 < 0)) __PYX_ERR(0, 1484, __pyx_L1_error)
            }
            __pyx_t_26 = 0;
            __Pyx_DECREF_SET(__pyx_v_D_tau, ((PyArrayObject *)__pyx_t_1));
            __pyx_t_1 = 0;

            /* "vcstring.pyx":1485
 *                             D_0 += D_0_ens
 *                             D_tau += D_tau_ens
 *                             g_0 += g_0_ens             # <<<<<<<<<<<<<<
 *                             g_tau += g_tau_ens
 *                             # print('b_ens =', b_ens)
 */
            __pyx_t_1 = PyNumber_InPlaceAdd(((PyObject *)__pyx_v_g_0), ((PyObject *)__pyx_v_g_0_ens)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1485, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_1);
            if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1485, __pyx_L1_error)
            __pyx_t_25 = ((PyArrayObject *)__pyx_t_1);
            {
              __Pyx_BufFmt_StackElem __pyx_stack[1];
              __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
              __pyx_t_29 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
              if (unlikely(__pyx_t_29 < 0)) {
                PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
                if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                  Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                  __Pyx_RaiseBufferFallbackError();
                } else {
                  PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
                }
                __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
              }
              __pyx_pybuffernd_g_0.diminfo[0].strides = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_0.diminfo[0].shape = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.shape[0];
              if (unlikely(__pyx_t_29 < 0)) __PYX_ERR(0, 1485, __pyx_L1_error)
            }
            __pyx_t_25 = 0;
            __Pyx_DECREF_SET(__pyx_v_g_0, ((PyArrayObject *)__pyx_t_1));
            __pyx_t_1 = 0;

            /* "vcstring.pyx":1486
 *                             D_tau += D_tau_ens
 *                             g_0 += g_0_ens
 *                             g_tau += g_tau_ens             # <<<<<<<<<<<<<<
 *                             # print('b_ens =', b_ens)
 *                             # print('b     =', b)
 */
            __pyx_t_1 = PyNumber_InPlaceAdd(((PyObject *)__pyx_v_g_tau), ((PyObject *)__pyx_v_g_tau_ens)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1486, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_1);
            if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1486, __pyx_L1_error)
            __pyx_t_25 = ((PyArrayObject *)__pyx_t_1);
            {
              __Pyx_BufFmt_StackElem __pyx_stack[1];
              __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
              __pyx_t_29 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
              if (unlikely(__pyx_t_29 < 0)) {
                PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
                if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                  Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                  __Pyx_RaiseBufferFallbackError();
                } else {
                  PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
                }
                __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
              }
              __pyx_pybuffernd_g_tau.diminfo[0].strides = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_tau.diminfo[0].shape = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.shape[0];
              if (unlikely(__pyx_t_29 < 0)) __PYX_ERR(0, 1486, __pyx_L1_error)
            }
            __pyx_t_25 = 0;
            __Pyx_DECREF_SET(__pyx_v_g_tau, ((PyArrayObject *)__pyx_t_1));
            __pyx_t_1 = 0;

            /* "vcstring.pyx":1491
 * 
 *                             # Calculate correlation function
 *                             if corr_method == 'matrix_elements':             # <<<<<<<<<<<<<<
 *                                 C_k += self.calc_corr(traj[k], tau, b_ens, D_0_ens, D_tau_ens, g_0_ens, g_tau_ens)
 *                             elif corr_method == 'q2':
 */
            __pyx_t_14 = (__Pyx_PyUnicode_Equals(__pyx_v_corr_method, __pyx_n_u_matrix_elements, Py_EQ)); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1491, __pyx_L1_error)
            if (__pyx_t_14) {

              /* "vcstring.pyx":1492
 *                             # Calculate correlation function
 *                             if corr_method == 'matrix_elements':
 *                                 C_k += self.calc_corr(traj[k], tau, b_ens, D_0_ens, D_tau_ens, g_0_ens, g_tau_ens)             # <<<<<<<<<<<<<<
 *                             elif corr_method == 'q2':
 *                                 C_k += self.calc_corr_q2(traj[k], tau, b_ens, ids)
 */
              __pyx_t_1 = PyFloat_FromDouble(__pyx_v_C_k); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1492, __pyx_L1_error)
              __Pyx_GOTREF(__pyx_t_1);
              if (unlikely(__pyx_v_traj == Py_None)) {
                PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
                __PYX_ERR(0, 1492, __pyx_L1_error)
              }
              __pyx_t_3 = __Pyx_GetItemInt_List(__pyx_v_traj, __pyx_v_k, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1492, __pyx_L1_error)
              __Pyx_GOTREF(__pyx_t_3);
              if (!(likely(PyList_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 1492, __pyx_L1_error)
              __pyx_t_7 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->calc_corr(__pyx_v_self, ((PyObject*)__pyx_t_3), __pyx_v_tau, ((PyArrayObject *)__pyx_v_b_ens), ((PyArrayObject *)__pyx_v_D_0_ens), ((PyArrayObject *)__pyx_v_D_tau_ens), ((PyArrayObject *)__pyx_v_g_0_ens), ((PyArrayObject *)__pyx_v_g_tau_ens), 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1492, __pyx_L1_error)
              __Pyx_GOTREF(__pyx_t_7);
              __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
              __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1492, __pyx_L1_error)
              __Pyx_GOTREF(__pyx_t_3);
              __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
              __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
              __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1492, __pyx_L1_error)
              __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
              __pyx_v_C_k = __pyx_t_16;

              /* "vcstring.pyx":1491
 * 
 *                             # Calculate correlation function
 *                             if corr_method == 'matrix_elements':             # <<<<<<<<<<<<<<
 *                                 C_k += self.calc_corr(traj[k], tau, b_ens, D_0_ens, D_tau_ens, g_0_ens, g_tau_ens)
 *                             elif corr_method == 'q2':
 */
              goto __pyx_L27;
            }

            /* "vcstring.pyx":1493
 *                             if corr_method == 'matrix_elements':
 *                                 C_k += self.calc_corr(traj[k], tau, b_ens, D_0_ens, D_tau_ens, g_0_ens, g_tau_ens)
 *                             elif corr_method == 'q2':             # <<<<<<<<<<<<<<
 *                                 C_k += self.calc_corr_q2(traj[k], tau, b_ens, ids)
 *                             # print('C_k =', C_k)
 */
            __pyx_t_14 = (__Pyx_PyUnicode_Equals(__pyx_v_corr_method, __pyx_n_u_q2, Py_EQ)); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1493, __pyx_L1_error)
            if (__pyx_t_14) {

              /* "vcstring.pyx":1494
 *                                 C_k += self.calc_corr(traj[k], tau, b_ens, D_0_ens, D_tau_ens, g_0_ens, g_tau_ens)
 *                             elif corr_method == 'q2':
 *                                 C_k += self.calc_corr_q2(traj[k], tau, b_ens, ids)             # <<<<<<<<<<<<<<
 *                             # print('C_k =', C_k)
 * 
 */
              __pyx_t_3 = PyFloat_FromDouble(__pyx_v_C_k); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1494, __pyx_L1_error)
              __Pyx_GOTREF(__pyx_t_3);
              if (unlikely(__pyx_v_traj == Py_None)) {
                PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
                __PYX_ERR(0, 1494, __pyx_L1_error)
              }
              __pyx_t_7 = __Pyx_GetItemInt_List(__pyx_v_traj, __pyx_v_k, int, 1, __Pyx_PyInt_From_int, 1, 1, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1494, __pyx_L1_error)
              __Pyx_GOTREF(__pyx_t_7);
              if (!(likely(PyList_CheckExact(__pyx_t_7))||((__pyx_t_7) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "list", Py_TYPE(__pyx_t_7)->tp_name), 0))) __PYX_ERR(0, 1494, __pyx_L1_error)
              __pyx_t_1 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->calc_corr_q2(__pyx_v_self, ((PyObject*)__pyx_t_7), __pyx_v_tau, ((PyArrayObject *)__pyx_v_b_ens), ((PyArrayObject *)__pyx_v_ids), 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1494, __pyx_L1_error)
              __Pyx_GOTREF(__pyx_t_1);
              __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
              __pyx_t_7 = PyNumber_InPlaceAdd(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1494, __pyx_L1_error)
              __Pyx_GOTREF(__pyx_t_7);
              __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
              __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
              __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_7); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1494, __pyx_L1_error)
              __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
              __pyx_v_C_k = __pyx_t_16;

              /* "vcstring.pyx":1493
 *                             if corr_method == 'matrix_elements':
 *                                 C_k += self.calc_corr(traj[k], tau, b_ens, D_0_ens, D_tau_ens, g_0_ens, g_tau_ens)
 *                             elif corr_method == 'q2':             # <<<<<<<<<<<<<<
 *                                 C_k += self.calc_corr_q2(traj[k], tau, b_ens, ids)
 *                             # print('C_k =', C_k)
 */
            }
            __pyx_L27:;
          }

          /* "vcstring.pyx":1497
 *                             # print('C_k =', C_k)
 * 
 *                         b = b / float(N)             # <<<<<<<<<<<<<<
 *                         D_0 = D_0 / float(N)
 *                         D_tau = D_tau / float(N)
 */
          __pyx_t_7 = PyFloat_FromDouble(((double)__pyx_v_N)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1497, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_1 = __Pyx_PyNumber_Divide(((PyObject *)__pyx_v_b), __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1497, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1497, __pyx_L1_error)
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_1);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
              }
              __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
            }
            __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1497, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_DECREF_SET(__pyx_v_b, ((PyArrayObject *)__pyx_t_1));
          __pyx_t_1 = 0;

          /* "vcstring.pyx":1498
 * 
 *                         b = b / float(N)
 *                         D_0 = D_0 / float(N)             # <<<<<<<<<<<<<<
 *                         D_tau = D_tau / float(N)
 *                         g_0 = g_0 / float(N)
 */
          __pyx_t_1 = PyFloat_FromDouble(((double)__pyx_v_N)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1498, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_7 = __Pyx_PyNumber_Divide(((PyObject *)__pyx_v_D_0), __pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1498, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1498, __pyx_L1_error)
          __pyx_t_26 = ((PyArrayObject *)__pyx_t_7);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_D_0.diminfo[0].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0.diminfo[0].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0.diminfo[1].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0.diminfo[1].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[1];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1498, __pyx_L1_error)
          }
          __pyx_t_26 = 0;
          __Pyx_DECREF_SET(__pyx_v_D_0, ((PyArrayObject *)__pyx_t_7));
          __pyx_t_7 = 0;

          /* "vcstring.pyx":1499
 *                         b = b / float(N)
 *                         D_0 = D_0 / float(N)
 *                         D_tau = D_tau / float(N)             # <<<<<<<<<<<<<<
 *                         g_0 = g_0 / float(N)
 *                         g_tau = g_tau / float(N)
 */
          __pyx_t_7 = PyFloat_FromDouble(((double)__pyx_v_N)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1499, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_1 = __Pyx_PyNumber_Divide(((PyObject *)__pyx_v_D_tau), __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1499, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1499, __pyx_L1_error)
          __pyx_t_26 = ((PyArrayObject *)__pyx_t_1);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
              }
              __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
            }
            __pyx_pybuffernd_D_tau.diminfo[0].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau.diminfo[0].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau.diminfo[1].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau.diminfo[1].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[1];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1499, __pyx_L1_error)
          }
          __pyx_t_26 = 0;
          __Pyx_DECREF_SET(__pyx_v_D_tau, ((PyArrayObject *)__pyx_t_1));
          __pyx_t_1 = 0;

          /* "vcstring.pyx":1500
 *                         D_0 = D_0 / float(N)
 *                         D_tau = D_tau / float(N)
 *                         g_0 = g_0 / float(N)             # <<<<<<<<<<<<<<
 *                         g_tau = g_tau / float(N)
 *                         Cnew = C_k / float(N)
 */
          __pyx_t_1 = PyFloat_FromDouble(((double)__pyx_v_N)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1500, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_7 = __Pyx_PyNumber_Divide(((PyObject *)__pyx_v_g_0), __pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1500, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1500, __pyx_L1_error)
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_7);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_g_0.diminfo[0].strides = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_0.diminfo[0].shape = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1500, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_DECREF_SET(__pyx_v_g_0, ((PyArrayObject *)__pyx_t_7));
          __pyx_t_7 = 0;

          /* "vcstring.pyx":1501
 *                         D_tau = D_tau / float(N)
 *                         g_0 = g_0 / float(N)
 *                         g_tau = g_tau / float(N)             # <<<<<<<<<<<<<<
 *                         Cnew = C_k / float(N)
 *                         print('\nb from ensemble time average =', b)
 */
          __pyx_t_7 = PyFloat_FromDouble(((double)__pyx_v_N)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1501, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_1 = __Pyx_PyNumber_Divide(((PyObject *)__pyx_v_g_tau), __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1501, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1501, __pyx_L1_error)
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_1);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
              }
              __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
            }
            __pyx_pybuffernd_g_tau.diminfo[0].strides = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_tau.diminfo[0].shape = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1501, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_DECREF_SET(__pyx_v_g_tau, ((PyArrayObject *)__pyx_t_1));
          __pyx_t_1 = 0;

          /* "vcstring.pyx":1502
 *                         g_0 = g_0 / float(N)
 *                         g_tau = g_tau / float(N)
 *                         Cnew = C_k / float(N)             # <<<<<<<<<<<<<<
 *                         print('\nb from ensemble time average =', b)
 *                         print('Corr from ensemble time average =', Cnew, '\n')
 */
          if (unlikely(((double)__pyx_v_N) == 0)) {
            PyErr_SetString(PyExc_ZeroDivisionError, "float division");
            __PYX_ERR(0, 1502, __pyx_L1_error)
          }
          __pyx_v_Cnew = (__pyx_v_C_k / ((double)__pyx_v_N));

          /* "vcstring.pyx":1503
 *                         g_tau = g_tau / float(N)
 *                         Cnew = C_k / float(N)
 *                         print('\nb from ensemble time average =', b)             # <<<<<<<<<<<<<<
 *                         print('Corr from ensemble time average =', Cnew, '\n')
 * 
 */
          __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1503, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_INCREF(__pyx_kp_u_b_from_ensemble_time_average);
          __Pyx_GIVEREF(__pyx_kp_u_b_from_ensemble_time_average);
          PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_b_from_ensemble_time_average);
          __Pyx_INCREF(((PyObject *)__pyx_v_b));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
          PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_b));
          __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1503, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

          /* "vcstring.pyx":1504
 *                         Cnew = C_k / float(N)
 *                         print('\nb from ensemble time average =', b)
 *                         print('Corr from ensemble time average =', Cnew, '\n')             # <<<<<<<<<<<<<<
 * 
 *                     # Ensemble time average (best for a lot of short aggregate trajectories)
 */
          __pyx_t_7 = PyFloat_FromDouble(__pyx_v_Cnew); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1504, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1504, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_INCREF(__pyx_kp_u_Corr_from_ensemble_time_average);
          __Pyx_GIVEREF(__pyx_kp_u_Corr_from_ensemble_time_average);
          PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Corr_from_ensemble_time_average);
          __Pyx_GIVEREF(__pyx_t_7);
          PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_7);
          __Pyx_INCREF(__pyx_kp_u__34);
          __Pyx_GIVEREF(__pyx_kp_u__34);
          PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u__34);
          __pyx_t_7 = 0;
          __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1504, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

          /* "vcstring.pyx":1463
 *                 else:
 *                     # Average of time averages (best for a few aggregate long trajectories)
 *                     if ensemble_timeavg_v1 == True:             # <<<<<<<<<<<<<<
 *                         print('\n================================')
 *                         print('ENSEMBLE TIME AVERAGE - method 1')
 */
          goto __pyx_L22;
        }

        /* "vcstring.pyx":1507
 * 
 *                     # Ensemble time average (best for a lot of short aggregate trajectories)
 *                     elif ensemble_timeavg_v2 == True:             # <<<<<<<<<<<<<<
 *                         print('\n================================')
 *                         print('ENSEMBLE TIME AVERAGE - method 2')
 */
        __pyx_t_7 = PyObject_RichCompare(__pyx_v_ensemble_timeavg_v2, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1507, __pyx_L1_error)
        __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1507, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        if (__pyx_t_14) {

          /* "vcstring.pyx":1508
 *                     # Ensemble time average (best for a lot of short aggregate trajectories)
 *                     elif ensemble_timeavg_v2 == True:
 *                         print('\n================================')             # <<<<<<<<<<<<<<
 *                         print('ENSEMBLE TIME AVERAGE - method 2')
 *                         print('================================')
 */
          __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__64, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1508, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

          /* "vcstring.pyx":1509
 *                     elif ensemble_timeavg_v2 == True:
 *                         print('\n================================')
 *                         print('ENSEMBLE TIME AVERAGE - method 2')             # <<<<<<<<<<<<<<
 *                         print('================================')
 *                         print('Number of trajectories:', N)
 */
          __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__68, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1509, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

          /* "vcstring.pyx":1510
 *                         print('\n================================')
 *                         print('ENSEMBLE TIME AVERAGE - method 2')
 *                         print('================================')             # <<<<<<<<<<<<<<
 *                         print('Number of trajectories:', N)
 *                         if weights == None:
 */
          __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__67, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1510, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

          /* "vcstring.pyx":1511
 *                         print('ENSEMBLE TIME AVERAGE - method 2')
 *                         print('================================')
 *                         print('Number of trajectories:', N)             # <<<<<<<<<<<<<<
 *                         if weights == None:
 *                             weights = [1.] * N
 */
          __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_N); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1511, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1511, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_INCREF(__pyx_kp_u_Number_of_trajectories);
          __Pyx_GIVEREF(__pyx_kp_u_Number_of_trajectories);
          PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Number_of_trajectories);
          __Pyx_GIVEREF(__pyx_t_7);
          PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_7);
          __pyx_t_7 = 0;
          __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1511, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

          /* "vcstring.pyx":1512
 *                         print('================================')
 *                         print('Number of trajectories:', N)
 *                         if weights == None:             # <<<<<<<<<<<<<<
 *                             weights = [1.] * N
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs_ensemble_timeavg_fast(traj, tau, z, weights=weights, symmetric=symmetric)
 */
          __pyx_t_7 = PyObject_RichCompare(__pyx_v_weights, Py_None, Py_EQ); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1512, __pyx_L1_error)
          __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1512, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          if (__pyx_t_14) {

            /* "vcstring.pyx":1513
 *                         print('Number of trajectories:', N)
 *                         if weights == None:
 *                             weights = [1.] * N             # <<<<<<<<<<<<<<
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs_ensemble_timeavg_fast(traj, tau, z, weights=weights, symmetric=symmetric)
 *                         Cnew = self.calc_corr_q2_ensemble_timeavg_fast(traj, tau, z, b, weights=weights)
 */
            __pyx_t_7 = PyList_New(1 * ((__pyx_v_N<0) ? 0:__pyx_v_N)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1513, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_7);
            { Py_ssize_t __pyx_temp;
              for (__pyx_temp=0; __pyx_temp < __pyx_v_N; __pyx_temp++) {
                __Pyx_INCREF(__pyx_float_1_);
                __Pyx_GIVEREF(__pyx_float_1_);
                PyList_SET_ITEM(__pyx_t_7, __pyx_temp, __pyx_float_1_);
              }
            }
            __Pyx_DECREF_SET(__pyx_v_weights, ((PyObject*)__pyx_t_7));
            __pyx_t_7 = 0;

            /* "vcstring.pyx":1512
 *                         print('================================')
 *                         print('Number of trajectories:', N)
 *                         if weights == None:             # <<<<<<<<<<<<<<
 *                             weights = [1.] * N
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs_ensemble_timeavg_fast(traj, tau, z, weights=weights, symmetric=symmetric)
 */
          }

          /* "vcstring.pyx":1514
 *                         if weights == None:
 *                             weights = [1.] * N
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs_ensemble_timeavg_fast(traj, tau, z, weights=weights, symmetric=symmetric)             # <<<<<<<<<<<<<<
 *                         Cnew = self.calc_corr_q2_ensemble_timeavg_fast(traj, tau, z, b, weights=weights)
 *                         # print('\nb from ensemble time average =', b)
 */
          __pyx_t_33.__pyx_n = 2;
          __pyx_t_33.weights = __pyx_v_weights;
          __pyx_t_33.symmetric = __pyx_v_symmetric;
          __pyx_t_7 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->calc_coeffs_ensemble_timeavg_fast(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, ((PyArrayObject *)__pyx_v_z), 0, &__pyx_t_33); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1514, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          if ((likely(PyTuple_CheckExact(__pyx_t_7))) || (PyList_CheckExact(__pyx_t_7))) {
            PyObject* sequence = __pyx_t_7;
            Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
            if (unlikely(size != 5)) {
              if (size > 5) __Pyx_RaiseTooManyValuesError(5);
              else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
              __PYX_ERR(0, 1514, __pyx_L1_error)
            }
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            if (likely(PyTuple_CheckExact(sequence))) {
              __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
              __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
              __pyx_t_10 = PyTuple_GET_ITEM(sequence, 2); 
              __pyx_t_4 = PyTuple_GET_ITEM(sequence, 3); 
              __pyx_t_5 = PyTuple_GET_ITEM(sequence, 4); 
            } else {
              __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
              __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
              __pyx_t_10 = PyList_GET_ITEM(sequence, 2); 
              __pyx_t_4 = PyList_GET_ITEM(sequence, 3); 
              __pyx_t_5 = PyList_GET_ITEM(sequence, 4); 
            }
            __Pyx_INCREF(__pyx_t_1);
            __Pyx_INCREF(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_10);
            __Pyx_INCREF(__pyx_t_4);
            __Pyx_INCREF(__pyx_t_5);
            #else
            {
              Py_ssize_t i;
              PyObject** temps[5] = {&__pyx_t_1,&__pyx_t_3,&__pyx_t_10,&__pyx_t_4,&__pyx_t_5};
              for (i=0; i < 5; i++) {
                PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) __PYX_ERR(0, 1514, __pyx_L1_error)
                __Pyx_GOTREF(item);
                *(temps[i]) = item;
              }
            }
            #endif
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          } else {
            Py_ssize_t index = -1;
            PyObject** temps[5] = {&__pyx_t_1,&__pyx_t_3,&__pyx_t_10,&__pyx_t_4,&__pyx_t_5};
            __pyx_t_6 = PyObject_GetIter(__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1514, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_6);
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
            __pyx_t_24 = Py_TYPE(__pyx_t_6)->tp_iternext;
            for (index=0; index < 5; index++) {
              PyObject* item = __pyx_t_24(__pyx_t_6); if (unlikely(!item)) goto __pyx_L29_unpacking_failed;
              __Pyx_GOTREF(item);
              *(temps[index]) = item;
            }
            if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_6), 5) < 0) __PYX_ERR(0, 1514, __pyx_L1_error)
            __pyx_t_24 = NULL;
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
            goto __pyx_L30_unpacking_done;
            __pyx_L29_unpacking_failed:;
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
            __pyx_t_24 = NULL;
            if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
            __PYX_ERR(0, 1514, __pyx_L1_error)
            __pyx_L30_unpacking_done:;
          }
          if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1514, __pyx_L1_error)
          if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1514, __pyx_L1_error)
          if (!(likely(((__pyx_t_10) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_10, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1514, __pyx_L1_error)
          if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1514, __pyx_L1_error)
          if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1514, __pyx_L1_error)
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_1);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1514, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_XDECREF_SET(__pyx_v_b, ((PyArrayObject *)__pyx_t_1));
          __pyx_t_1 = 0;
          __pyx_t_26 = ((PyArrayObject *)__pyx_t_3);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
              }
              __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
            }
            __pyx_pybuffernd_D_0.diminfo[0].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0.diminfo[0].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0.diminfo[1].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0.diminfo[1].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[1];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1514, __pyx_L1_error)
          }
          __pyx_t_26 = 0;
          __Pyx_XDECREF_SET(__pyx_v_D_0, ((PyArrayObject *)__pyx_t_3));
          __pyx_t_3 = 0;
          __pyx_t_26 = ((PyArrayObject *)__pyx_t_10);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_D_tau.diminfo[0].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau.diminfo[0].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau.diminfo[1].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau.diminfo[1].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[1];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1514, __pyx_L1_error)
          }
          __pyx_t_26 = 0;
          __Pyx_XDECREF_SET(__pyx_v_D_tau, ((PyArrayObject *)__pyx_t_10));
          __pyx_t_10 = 0;
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_4);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
              }
              __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
            }
            __pyx_pybuffernd_g_0.diminfo[0].strides = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_0.diminfo[0].shape = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1514, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_XDECREF_SET(__pyx_v_g_0, ((PyArrayObject *)__pyx_t_4));
          __pyx_t_4 = 0;
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_5);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_g_tau.diminfo[0].strides = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_tau.diminfo[0].shape = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1514, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_XDECREF_SET(__pyx_v_g_tau, ((PyArrayObject *)__pyx_t_5));
          __pyx_t_5 = 0;

          /* "vcstring.pyx":1515
 *                             weights = [1.] * N
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs_ensemble_timeavg_fast(traj, tau, z, weights=weights, symmetric=symmetric)
 *                         Cnew = self.calc_corr_q2_ensemble_timeavg_fast(traj, tau, z, b, weights=weights)             # <<<<<<<<<<<<<<
 *                         # print('\nb from ensemble time average =', b)
 *                         # print('Corr from ensemble time average =', Cnew, '\n')
 */
          __pyx_t_34.__pyx_n = 1;
          __pyx_t_34.weights = __pyx_v_weights;
          __pyx_t_7 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->calc_corr_q2_ensemble_timeavg_fast(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, ((PyArrayObject *)__pyx_v_z), ((PyArrayObject *)__pyx_v_b), 0, &__pyx_t_34); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1515, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_7); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1515, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_v_Cnew = __pyx_t_16;

          /* "vcstring.pyx":1507
 * 
 *                     # Ensemble time average (best for a lot of short aggregate trajectories)
 *                     elif ensemble_timeavg_v2 == True:             # <<<<<<<<<<<<<<
 *                         print('\n================================')
 *                         print('ENSEMBLE TIME AVERAGE - method 2')
 */
          goto __pyx_L22;
        }

        /* "vcstring.pyx":1520
 * 
 *                     # Ensemble averaging (best with lots of aggregate trajectories)
 *                     elif ensemble_avg == True:             # <<<<<<<<<<<<<<
 *                         print('\n==============================')
 *                         print('ENSEMBLE AVERAGE')
 */
        __pyx_t_7 = PyObject_RichCompare(__pyx_v_ensemble_avg, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1520, __pyx_L1_error)
        __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1520, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        if (__pyx_t_14) {

          /* "vcstring.pyx":1521
 *                     # Ensemble averaging (best with lots of aggregate trajectories)
 *                     elif ensemble_avg == True:
 *                         print('\n==============================')             # <<<<<<<<<<<<<<
 *                         print('ENSEMBLE AVERAGE')
 *                         print('==============================')
 */
          __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__70, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1521, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

          /* "vcstring.pyx":1522
 *                     elif ensemble_avg == True:
 *                         print('\n==============================')
 *                         print('ENSEMBLE AVERAGE')             # <<<<<<<<<<<<<<
 *                         print('==============================')
 *                         print('Number of trajectories:', N)
 */
          __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__71, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1522, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

          /* "vcstring.pyx":1523
 *                         print('\n==============================')
 *                         print('ENSEMBLE AVERAGE')
 *                         print('==============================')             # <<<<<<<<<<<<<<
 *                         print('Number of trajectories:', N)
 *                         if weights == None:
 */
          __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__73, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1523, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

          /* "vcstring.pyx":1524
 *                         print('ENSEMBLE AVERAGE')
 *                         print('==============================')
 *                         print('Number of trajectories:', N)             # <<<<<<<<<<<<<<
 *                         if weights == None:
 *                             weights = [1.] * N
 */
          __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_N); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1524, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1524, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_INCREF(__pyx_kp_u_Number_of_trajectories);
          __Pyx_GIVEREF(__pyx_kp_u_Number_of_trajectories);
          PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_kp_u_Number_of_trajectories);
          __Pyx_GIVEREF(__pyx_t_7);
          PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_7);
          __pyx_t_7 = 0;
          __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_5, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1524, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

          /* "vcstring.pyx":1525
 *                         print('==============================')
 *                         print('Number of trajectories:', N)
 *                         if weights == None:             # <<<<<<<<<<<<<<
 *                             weights = [1.] * N
 *                         ids = self.assign_states_ensemble(traj, tau, z, weights=weights)
 */
          __pyx_t_7 = PyObject_RichCompare(__pyx_v_weights, Py_None, Py_EQ); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1525, __pyx_L1_error)
          __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1525, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          if (__pyx_t_14) {

            /* "vcstring.pyx":1526
 *                         print('Number of trajectories:', N)
 *                         if weights == None:
 *                             weights = [1.] * N             # <<<<<<<<<<<<<<
 *                         ids = self.assign_states_ensemble(traj, tau, z, weights=weights)
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs_ensemble(N, tau, z, ids, symmetric=symmetric)
 */
            __pyx_t_7 = PyList_New(1 * ((__pyx_v_N<0) ? 0:__pyx_v_N)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1526, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_7);
            { Py_ssize_t __pyx_temp;
              for (__pyx_temp=0; __pyx_temp < __pyx_v_N; __pyx_temp++) {
                __Pyx_INCREF(__pyx_float_1_);
                __Pyx_GIVEREF(__pyx_float_1_);
                PyList_SET_ITEM(__pyx_t_7, __pyx_temp, __pyx_float_1_);
              }
            }
            __Pyx_DECREF_SET(__pyx_v_weights, ((PyObject*)__pyx_t_7));
            __pyx_t_7 = 0;

            /* "vcstring.pyx":1525
 *                         print('==============================')
 *                         print('Number of trajectories:', N)
 *                         if weights == None:             # <<<<<<<<<<<<<<
 *                             weights = [1.] * N
 *                         ids = self.assign_states_ensemble(traj, tau, z, weights=weights)
 */
          }

          /* "vcstring.pyx":1527
 *                         if weights == None:
 *                             weights = [1.] * N
 *                         ids = self.assign_states_ensemble(traj, tau, z, weights=weights)             # <<<<<<<<<<<<<<
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs_ensemble(N, tau, z, ids, symmetric=symmetric)
 *                         # WARNING: calc_corr with matrixelms method is not currently supported
 */
          __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_assign_states_ensemble); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1527, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1527, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1527, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_INCREF(__pyx_v_traj);
          __Pyx_GIVEREF(__pyx_v_traj);
          PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_traj);
          __Pyx_GIVEREF(__pyx_t_5);
          PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_5);
          __Pyx_INCREF(((PyObject *)__pyx_v_z));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
          PyTuple_SET_ITEM(__pyx_t_4, 2, ((PyObject *)__pyx_v_z));
          __pyx_t_5 = 0;
          __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1527, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_weights, __pyx_v_weights) < 0) __PYX_ERR(0, 1527, __pyx_L1_error)
          __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1527, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          if (!(likely(((__pyx_t_10) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_10, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1527, __pyx_L1_error)
          __pyx_t_26 = ((PyArrayObject *)__pyx_t_10);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
              }
              __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
            }
            __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1527, __pyx_L1_error)
          }
          __pyx_t_26 = 0;
          __Pyx_XDECREF_SET(__pyx_v_ids, ((PyArrayObject *)__pyx_t_10));
          __pyx_t_10 = 0;

          /* "vcstring.pyx":1528
 *                             weights = [1.] * N
 *                         ids = self.assign_states_ensemble(traj, tau, z, weights=weights)
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs_ensemble(N, tau, z, ids, symmetric=symmetric)             # <<<<<<<<<<<<<<
 *                         # WARNING: calc_corr with matrixelms method is not currently supported
 *                         Cnew = self.calc_corr_q2_ensemble(traj, tau, b, ids)
 */
          __pyx_t_35.__pyx_n = 1;
          __pyx_t_35.symmetric = __pyx_v_symmetric;
          __pyx_t_10 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->calc_coeffs_ensemble(__pyx_v_self, __pyx_v_N, __pyx_v_tau, ((PyArrayObject *)__pyx_v_z), ((PyArrayObject *)__pyx_v_ids), 0, &__pyx_t_35); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1528, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          if ((likely(PyTuple_CheckExact(__pyx_t_10))) || (PyList_CheckExact(__pyx_t_10))) {
            PyObject* sequence = __pyx_t_10;
            Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
            if (unlikely(size != 5)) {
              if (size > 5) __Pyx_RaiseTooManyValuesError(5);
              else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
              __PYX_ERR(0, 1528, __pyx_L1_error)
            }
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            if (likely(PyTuple_CheckExact(sequence))) {
              __pyx_t_5 = PyTuple_GET_ITEM(sequence, 0); 
              __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
              __pyx_t_7 = PyTuple_GET_ITEM(sequence, 2); 
              __pyx_t_3 = PyTuple_GET_ITEM(sequence, 3); 
              __pyx_t_1 = PyTuple_GET_ITEM(sequence, 4); 
            } else {
              __pyx_t_5 = PyList_GET_ITEM(sequence, 0); 
              __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
              __pyx_t_7 = PyList_GET_ITEM(sequence, 2); 
              __pyx_t_3 = PyList_GET_ITEM(sequence, 3); 
              __pyx_t_1 = PyList_GET_ITEM(sequence, 4); 
            }
            __Pyx_INCREF(__pyx_t_5);
            __Pyx_INCREF(__pyx_t_4);
            __Pyx_INCREF(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_1);
            #else
            {
              Py_ssize_t i;
              PyObject** temps[5] = {&__pyx_t_5,&__pyx_t_4,&__pyx_t_7,&__pyx_t_3,&__pyx_t_1};
              for (i=0; i < 5; i++) {
                PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) __PYX_ERR(0, 1528, __pyx_L1_error)
                __Pyx_GOTREF(item);
                *(temps[i]) = item;
              }
            }
            #endif
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          } else {
            Py_ssize_t index = -1;
            PyObject** temps[5] = {&__pyx_t_5,&__pyx_t_4,&__pyx_t_7,&__pyx_t_3,&__pyx_t_1};
            __pyx_t_6 = PyObject_GetIter(__pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1528, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_6);
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            __pyx_t_24 = Py_TYPE(__pyx_t_6)->tp_iternext;
            for (index=0; index < 5; index++) {
              PyObject* item = __pyx_t_24(__pyx_t_6); if (unlikely(!item)) goto __pyx_L32_unpacking_failed;
              __Pyx_GOTREF(item);
              *(temps[index]) = item;
            }
            if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_6), 5) < 0) __PYX_ERR(0, 1528, __pyx_L1_error)
            __pyx_t_24 = NULL;
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
            goto __pyx_L33_unpacking_done;
            __pyx_L32_unpacking_failed:;
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
            __pyx_t_24 = NULL;
            if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
            __PYX_ERR(0, 1528, __pyx_L1_error)
            __pyx_L33_unpacking_done:;
          }
          if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1528, __pyx_L1_error)
          if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1528, __pyx_L1_error)
          if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1528, __pyx_L1_error)
          if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1528, __pyx_L1_error)
          if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1528, __pyx_L1_error)
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_5);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1528, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_XDECREF_SET(__pyx_v_b, ((PyArrayObject *)__pyx_t_5));
          __pyx_t_5 = 0;
          __pyx_t_26 = ((PyArrayObject *)__pyx_t_4);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
              }
              __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
            }
            __pyx_pybuffernd_D_0.diminfo[0].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0.diminfo[0].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0.diminfo[1].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0.diminfo[1].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[1];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1528, __pyx_L1_error)
          }
          __pyx_t_26 = 0;
          __Pyx_XDECREF_SET(__pyx_v_D_0, ((PyArrayObject *)__pyx_t_4));
          __pyx_t_4 = 0;
          __pyx_t_26 = ((PyArrayObject *)__pyx_t_7);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_D_tau.diminfo[0].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau.diminfo[0].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau.diminfo[1].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau.diminfo[1].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[1];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1528, __pyx_L1_error)
          }
          __pyx_t_26 = 0;
          __Pyx_XDECREF_SET(__pyx_v_D_tau, ((PyArrayObject *)__pyx_t_7));
          __pyx_t_7 = 0;
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_3);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
              }
              __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
            }
            __pyx_pybuffernd_g_0.diminfo[0].strides = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_0.diminfo[0].shape = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1528, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_XDECREF_SET(__pyx_v_g_0, ((PyArrayObject *)__pyx_t_3));
          __pyx_t_3 = 0;
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_1);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_g_tau.diminfo[0].strides = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_tau.diminfo[0].shape = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1528, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_XDECREF_SET(__pyx_v_g_tau, ((PyArrayObject *)__pyx_t_1));
          __pyx_t_1 = 0;

          /* "vcstring.pyx":1530
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs_ensemble(N, tau, z, ids, symmetric=symmetric)
 *                         # WARNING: calc_corr with matrixelms method is not currently supported
 *                         Cnew = self.calc_corr_q2_ensemble(traj, tau, b, ids)             # <<<<<<<<<<<<<<
 *                         # print('\nq from ensemble average =', b)
 *                         # print('Corr from ensemble average =', Cnew, '\n')
 */
          __pyx_t_10 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->calc_corr_q2_ensemble(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, ((PyArrayObject *)__pyx_v_b), ((PyArrayObject *)__pyx_v_ids), 0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1530, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_10); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1530, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_v_Cnew = __pyx_t_16;

          /* "vcstring.pyx":1520
 * 
 *                     # Ensemble averaging (best with lots of aggregate trajectories)
 *                     elif ensemble_avg == True:             # <<<<<<<<<<<<<<
 *                         print('\n==============================')
 *                         print('ENSEMBLE AVERAGE')
 */
          goto __pyx_L22;
        }

        /* "vcstring.pyx":1536
 *                     # Simple time average for a single trajectory
 *                     else:
 *                         ids = self.assign_states(traj, tau, z)  # Reassign states since z is changed             # <<<<<<<<<<<<<<
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs(N, tau, z, ids, symmetric=symmetric)
 *                         # Calculate correlation function
 */
        /*else*/ {
          __pyx_t_10 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->assign_states(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, ((PyArrayObject *)__pyx_v_z), 0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1536, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          if (!(likely(((__pyx_t_10) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_10, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1536, __pyx_L1_error)
          __pyx_t_26 = ((PyArrayObject *)__pyx_t_10);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
              }
              __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
            }
            __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1536, __pyx_L1_error)
          }
          __pyx_t_26 = 0;
          __Pyx_XDECREF_SET(__pyx_v_ids, ((PyArrayObject *)__pyx_t_10));
          __pyx_t_10 = 0;

          /* "vcstring.pyx":1537
 *                     else:
 *                         ids = self.assign_states(traj, tau, z)  # Reassign states since z is changed
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs(N, tau, z, ids, symmetric=symmetric)             # <<<<<<<<<<<<<<
 *                         # Calculate correlation function
 *                         if corr_method == 'matrix_elements':
 */
          __pyx_t_30.__pyx_n = 1;
          __pyx_t_30.symmetric = __pyx_v_symmetric;
          __pyx_t_10 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->calc_coeffs(__pyx_v_self, __pyx_v_N, __pyx_v_tau, ((PyArrayObject *)__pyx_v_z), ((PyArrayObject *)__pyx_v_ids), 0, &__pyx_t_30); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1537, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          if ((likely(PyTuple_CheckExact(__pyx_t_10))) || (PyList_CheckExact(__pyx_t_10))) {
            PyObject* sequence = __pyx_t_10;
            Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
            if (unlikely(size != 5)) {
              if (size > 5) __Pyx_RaiseTooManyValuesError(5);
              else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
              __PYX_ERR(0, 1537, __pyx_L1_error)
            }
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            if (likely(PyTuple_CheckExact(sequence))) {
              __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
              __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
              __pyx_t_7 = PyTuple_GET_ITEM(sequence, 2); 
              __pyx_t_4 = PyTuple_GET_ITEM(sequence, 3); 
              __pyx_t_5 = PyTuple_GET_ITEM(sequence, 4); 
            } else {
              __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
              __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
              __pyx_t_7 = PyList_GET_ITEM(sequence, 2); 
              __pyx_t_4 = PyList_GET_ITEM(sequence, 3); 
              __pyx_t_5 = PyList_GET_ITEM(sequence, 4); 
            }
            __Pyx_INCREF(__pyx_t_1);
            __Pyx_INCREF(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_4);
            __Pyx_INCREF(__pyx_t_5);
            #else
            {
              Py_ssize_t i;
              PyObject** temps[5] = {&__pyx_t_1,&__pyx_t_3,&__pyx_t_7,&__pyx_t_4,&__pyx_t_5};
              for (i=0; i < 5; i++) {
                PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) __PYX_ERR(0, 1537, __pyx_L1_error)
                __Pyx_GOTREF(item);
                *(temps[i]) = item;
              }
            }
            #endif
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          } else {
            Py_ssize_t index = -1;
            PyObject** temps[5] = {&__pyx_t_1,&__pyx_t_3,&__pyx_t_7,&__pyx_t_4,&__pyx_t_5};
            __pyx_t_6 = PyObject_GetIter(__pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1537, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_6);
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            __pyx_t_24 = Py_TYPE(__pyx_t_6)->tp_iternext;
            for (index=0; index < 5; index++) {
              PyObject* item = __pyx_t_24(__pyx_t_6); if (unlikely(!item)) goto __pyx_L34_unpacking_failed;
              __Pyx_GOTREF(item);
              *(temps[index]) = item;
            }
            if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_6), 5) < 0) __PYX_ERR(0, 1537, __pyx_L1_error)
            __pyx_t_24 = NULL;
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
            goto __pyx_L35_unpacking_done;
            __pyx_L34_unpacking_failed:;
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
            __pyx_t_24 = NULL;
            if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
            __PYX_ERR(0, 1537, __pyx_L1_error)
            __pyx_L35_unpacking_done:;
          }
          if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1537, __pyx_L1_error)
          if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1537, __pyx_L1_error)
          if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1537, __pyx_L1_error)
          if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1537, __pyx_L1_error)
          if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1537, __pyx_L1_error)
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_1);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1537, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_XDECREF_SET(__pyx_v_b, ((PyArrayObject *)__pyx_t_1));
          __pyx_t_1 = 0;
          __pyx_t_26 = ((PyArrayObject *)__pyx_t_3);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
              }
              __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
            }
            __pyx_pybuffernd_D_0.diminfo[0].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0.diminfo[0].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0.diminfo[1].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0.diminfo[1].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[1];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1537, __pyx_L1_error)
          }
          __pyx_t_26 = 0;
          __Pyx_XDECREF_SET(__pyx_v_D_0, ((PyArrayObject *)__pyx_t_3));
          __pyx_t_3 = 0;
          __pyx_t_26 = ((PyArrayObject *)__pyx_t_7);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_D_tau.diminfo[0].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau.diminfo[0].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau.diminfo[1].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau.diminfo[1].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[1];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1537, __pyx_L1_error)
          }
          __pyx_t_26 = 0;
          __Pyx_XDECREF_SET(__pyx_v_D_tau, ((PyArrayObject *)__pyx_t_7));
          __pyx_t_7 = 0;
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_4);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
              }
              __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
            }
            __pyx_pybuffernd_g_0.diminfo[0].strides = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_0.diminfo[0].shape = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1537, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_XDECREF_SET(__pyx_v_g_0, ((PyArrayObject *)__pyx_t_4));
          __pyx_t_4 = 0;
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_5);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_g_tau.diminfo[0].strides = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_tau.diminfo[0].shape = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1537, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_XDECREF_SET(__pyx_v_g_tau, ((PyArrayObject *)__pyx_t_5));
          __pyx_t_5 = 0;

          /* "vcstring.pyx":1539
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs(N, tau, z, ids, symmetric=symmetric)
 *                         # Calculate correlation function
 *                         if corr_method == 'matrix_elements':             # <<<<<<<<<<<<<<
 *                             Cnew = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)
 *                         elif corr_method == 'q2':
 */
          __pyx_t_14 = (__Pyx_PyUnicode_Equals(__pyx_v_corr_method, __pyx_n_u_matrix_elements, Py_EQ)); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1539, __pyx_L1_error)
          if (__pyx_t_14) {

            /* "vcstring.pyx":1540
 *                         # Calculate correlation function
 *                         if corr_method == 'matrix_elements':
 *                             Cnew = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)             # <<<<<<<<<<<<<<
 *                         elif corr_method == 'q2':
 *                             Cnew = self.calc_corr_q2(traj, tau, b, ids)
 */
            __pyx_t_10 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->calc_corr(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, ((PyArrayObject *)__pyx_v_b), ((PyArrayObject *)__pyx_v_D_0), ((PyArrayObject *)__pyx_v_D_tau), ((PyArrayObject *)__pyx_v_g_0), ((PyArrayObject *)__pyx_v_g_tau), 0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1540, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_10);
            __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_10); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1540, __pyx_L1_error)
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            __pyx_v_Cnew = __pyx_t_16;

            /* "vcstring.pyx":1539
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs(N, tau, z, ids, symmetric=symmetric)
 *                         # Calculate correlation function
 *                         if corr_method == 'matrix_elements':             # <<<<<<<<<<<<<<
 *                             Cnew = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)
 *                         elif corr_method == 'q2':
 */
            goto __pyx_L36;
          }

          /* "vcstring.pyx":1541
 *                         if corr_method == 'matrix_elements':
 *                             Cnew = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)
 *                         elif corr_method == 'q2':             # <<<<<<<<<<<<<<
 *                             Cnew = self.calc_corr_q2(traj, tau, b, ids)
 * 
 */
          __pyx_t_14 = (__Pyx_PyUnicode_Equals(__pyx_v_corr_method, __pyx_n_u_q2, Py_EQ)); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1541, __pyx_L1_error)
          if (__pyx_t_14) {

            /* "vcstring.pyx":1542
 *                             Cnew = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)
 *                         elif corr_method == 'q2':
 *                             Cnew = self.calc_corr_q2(traj, tau, b, ids)             # <<<<<<<<<<<<<<
 * 
 *                 # Accept or reject the move
 */
            __pyx_t_10 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->calc_corr_q2(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, ((PyArrayObject *)__pyx_v_b), ((PyArrayObject *)__pyx_v_ids), 0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1542, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_10);
            __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_10); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1542, __pyx_L1_error)
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            __pyx_v_Cnew = __pyx_t_16;

            /* "vcstring.pyx":1541
 *                         if corr_method == 'matrix_elements':
 *                             Cnew = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)
 *                         elif corr_method == 'q2':             # <<<<<<<<<<<<<<
 *                             Cnew = self.calc_corr_q2(traj, tau, b, ids)
 * 
 */
          }
          __pyx_L36:;
        }
        __pyx_L22:;
      }
      __pyx_L16:;

      /* "vcstring.pyx":1545
 * 
 *                 # Accept or reject the move
 *                 if Cnew < target:             # <<<<<<<<<<<<<<
 *                     MC_list.extend([hx, hy, Cnew, z[i][0], z[i][1]])
 *                     if save == True:
 */
      __pyx_t_14 = ((__pyx_v_Cnew < __pyx_v_target) != 0);
      if (__pyx_t_14) {

        /* "vcstring.pyx":1546
 *                 # Accept or reject the move
 *                 if Cnew < target:
 *                     MC_list.extend([hx, hy, Cnew, z[i][0], z[i][1]])             # <<<<<<<<<<<<<<
 *                     if save == True:
 *                         np.savetxt('output/mc.txt', MC_list)
 */
        __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1546, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_10, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1546, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1546, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1546, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = PyFloat_FromDouble(__pyx_v_hx); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1546, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_36 = __Pyx_ListComp_Append(__pyx_v_MC_list, __pyx_t_10); if (unlikely(__pyx_t_36 == ((int)-1))) __PYX_ERR(0, 1546, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = PyFloat_FromDouble(__pyx_v_hy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1546, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_37 = __Pyx_ListComp_Append(__pyx_v_MC_list, __pyx_t_10); if (unlikely(__pyx_t_37 == ((int)-1))) __PYX_ERR(0, 1546, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = PyFloat_FromDouble(__pyx_v_Cnew); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1546, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_38 = __Pyx_ListComp_Append(__pyx_v_MC_list, __pyx_t_10); if (unlikely(__pyx_t_38 == ((int)-1))) __PYX_ERR(0, 1546, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_39 = __Pyx_ListComp_Append(__pyx_v_MC_list, __pyx_t_5); if (unlikely(__pyx_t_39 == ((int)-1))) __PYX_ERR(0, 1546, __pyx_L1_error)
        __pyx_t_40 = __Pyx_PyList_Append(__pyx_v_MC_list, __pyx_t_4); if (unlikely(__pyx_t_40 == ((int)-1))) __PYX_ERR(0, 1546, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        (void)((__pyx_t_36 | (__pyx_t_37 | (__pyx_t_38 | (__pyx_t_39 | __pyx_t_40)))));

        /* "vcstring.pyx":1547
 *                 if Cnew < target:
 *                     MC_list.extend([hx, hy, Cnew, z[i][0], z[i][1]])
 *                     if save == True:             # <<<<<<<<<<<<<<
 *                         np.savetxt('output/mc.txt', MC_list)
 *                         np.savetxt('output/z_new.txt', z)
 */
        __pyx_t_5 = PyObject_RichCompare(__pyx_v_save, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1547, __pyx_L1_error)
        __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1547, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        if (__pyx_t_14) {

          /* "vcstring.pyx":1548
 *                     MC_list.extend([hx, hy, Cnew, z[i][0], z[i][1]])
 *                     if save == True:
 *                         np.savetxt('output/mc.txt', MC_list)             # <<<<<<<<<<<<<<
 *                         np.savetxt('output/z_new.txt', z)
 *                         np.savetxt('output/C_new.txt', [Cnew])
 */
          __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1548, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_savetxt); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1548, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = NULL;
          __pyx_t_15 = 0;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
            __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_10);
            if (likely(__pyx_t_4)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
              __Pyx_INCREF(__pyx_t_4);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_10, function);
              __pyx_t_15 = 1;
            }
          }
          #if CYTHON_FAST_PYCALL
          if (PyFunction_Check(__pyx_t_10)) {
            PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_kp_u_output_mc_txt, __pyx_v_MC_list};
            __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1548, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
            __Pyx_GOTREF(__pyx_t_5);
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
            PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_kp_u_output_mc_txt, __pyx_v_MC_list};
            __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1548, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
            __Pyx_GOTREF(__pyx_t_5);
          } else
          #endif
          {
            __pyx_t_7 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1548, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_7);
            if (__pyx_t_4) {
              __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_4); __pyx_t_4 = NULL;
            }
            __Pyx_INCREF(__pyx_kp_u_output_mc_txt);
            __Pyx_GIVEREF(__pyx_kp_u_output_mc_txt);
            PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_15, __pyx_kp_u_output_mc_txt);
            __Pyx_INCREF(__pyx_v_MC_list);
            __Pyx_GIVEREF(__pyx_v_MC_list);
            PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_15, __pyx_v_MC_list);
            __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_7, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1548, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_5);
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          }
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

          /* "vcstring.pyx":1549
 *                     if save == True:
 *                         np.savetxt('output/mc.txt', MC_list)
 *                         np.savetxt('output/z_new.txt', z)             # <<<<<<<<<<<<<<
 *                         np.savetxt('output/C_new.txt', [Cnew])
 *                         np.savetxt('output/q_new.txt', b)
 */
          __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1549, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_savetxt); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1549, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = NULL;
          __pyx_t_15 = 0;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
            __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_7);
            if (likely(__pyx_t_10)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
              __Pyx_INCREF(__pyx_t_10);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_7, function);
              __pyx_t_15 = 1;
            }
          }
          #if CYTHON_FAST_PYCALL
          if (PyFunction_Check(__pyx_t_7)) {
            PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_kp_u_output_z_new_txt, ((PyObject *)__pyx_v_z)};
            __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1549, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
            __Pyx_GOTREF(__pyx_t_5);
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
            PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_kp_u_output_z_new_txt, ((PyObject *)__pyx_v_z)};
            __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1549, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
            __Pyx_GOTREF(__pyx_t_5);
          } else
          #endif
          {
            __pyx_t_4 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1549, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_4);
            if (__pyx_t_10) {
              __Pyx_GIVEREF(__pyx_t_10); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_10); __pyx_t_10 = NULL;
            }
            __Pyx_INCREF(__pyx_kp_u_output_z_new_txt);
            __Pyx_GIVEREF(__pyx_kp_u_output_z_new_txt);
            PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_15, __pyx_kp_u_output_z_new_txt);
            __Pyx_INCREF(((PyObject *)__pyx_v_z));
            __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
            PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_15, ((PyObject *)__pyx_v_z));
            __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1549, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_5);
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          }
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

          /* "vcstring.pyx":1550
 *                         np.savetxt('output/mc.txt', MC_list)
 *                         np.savetxt('output/z_new.txt', z)
 *                         np.savetxt('output/C_new.txt', [Cnew])             # <<<<<<<<<<<<<<
 *                         np.savetxt('output/q_new.txt', b)
 *                         np.savez('output/coeffs_new.npz',
 */
          __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1550, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_savetxt); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1550, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_7 = PyFloat_FromDouble(__pyx_v_Cnew); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1550, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_10 = PyList_New(1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1550, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_GIVEREF(__pyx_t_7);
          PyList_SET_ITEM(__pyx_t_10, 0, __pyx_t_7);
          __pyx_t_7 = 0;
          __pyx_t_7 = NULL;
          __pyx_t_15 = 0;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
            __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
            if (likely(__pyx_t_7)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
              __Pyx_INCREF(__pyx_t_7);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_4, function);
              __pyx_t_15 = 1;
            }
          }
          #if CYTHON_FAST_PYCALL
          if (PyFunction_Check(__pyx_t_4)) {
            PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_kp_u_output_C_new_txt, __pyx_t_10};
            __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1550, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
            __Pyx_GOTREF(__pyx_t_5);
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
            PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_kp_u_output_C_new_txt, __pyx_t_10};
            __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1550, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
            __Pyx_GOTREF(__pyx_t_5);
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          } else
          #endif
          {
            __pyx_t_3 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1550, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_3);
            if (__pyx_t_7) {
              __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_7); __pyx_t_7 = NULL;
            }
            __Pyx_INCREF(__pyx_kp_u_output_C_new_txt);
            __Pyx_GIVEREF(__pyx_kp_u_output_C_new_txt);
            PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_15, __pyx_kp_u_output_C_new_txt);
            __Pyx_GIVEREF(__pyx_t_10);
            PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_15, __pyx_t_10);
            __pyx_t_10 = 0;
            __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1550, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_5);
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          }
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

          /* "vcstring.pyx":1551
 *                         np.savetxt('output/z_new.txt', z)
 *                         np.savetxt('output/C_new.txt', [Cnew])
 *                         np.savetxt('output/q_new.txt', b)             # <<<<<<<<<<<<<<
 *                         np.savez('output/coeffs_new.npz',
 *                                  b=b,
 */
          __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1551, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_savetxt); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1551, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = NULL;
          __pyx_t_15 = 0;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
            __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
            if (likely(__pyx_t_4)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
              __Pyx_INCREF(__pyx_t_4);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_3, function);
              __pyx_t_15 = 1;
            }
          }
          #if CYTHON_FAST_PYCALL
          if (PyFunction_Check(__pyx_t_3)) {
            PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_kp_u_output_q_new_txt, ((PyObject *)__pyx_v_b)};
            __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1551, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
            __Pyx_GOTREF(__pyx_t_5);
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
            PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_kp_u_output_q_new_txt, ((PyObject *)__pyx_v_b)};
            __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1551, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
            __Pyx_GOTREF(__pyx_t_5);
          } else
          #endif
          {
            __pyx_t_10 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1551, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_10);
            if (__pyx_t_4) {
              __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_4); __pyx_t_4 = NULL;
            }
            __Pyx_INCREF(__pyx_kp_u_output_q_new_txt);
            __Pyx_GIVEREF(__pyx_kp_u_output_q_new_txt);
            PyTuple_SET_ITEM(__pyx_t_10, 0+__pyx_t_15, __pyx_kp_u_output_q_new_txt);
            __Pyx_INCREF(((PyObject *)__pyx_v_b));
            __Pyx_GIVEREF(((PyObject *)__pyx_v_b));
            PyTuple_SET_ITEM(__pyx_t_10, 1+__pyx_t_15, ((PyObject *)__pyx_v_b));
            __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_10, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1551, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_5);
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          }
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

          /* "vcstring.pyx":1552
 *                         np.savetxt('output/C_new.txt', [Cnew])
 *                         np.savetxt('output/q_new.txt', b)
 *                         np.savez('output/coeffs_new.npz',             # <<<<<<<<<<<<<<
 *                                  b=b,
 *                                  D_0=D_0,
 */
          __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1552, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_savez); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1552, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

          /* "vcstring.pyx":1553
 *                         np.savetxt('output/q_new.txt', b)
 *                         np.savez('output/coeffs_new.npz',
 *                                  b=b,             # <<<<<<<<<<<<<<
 *                                  D_0=D_0,
 *                                  D_tau=D_tau,
 */
          __pyx_t_5 = __Pyx_PyDict_NewPresized(5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1553, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_b_2, ((PyObject *)__pyx_v_b)) < 0) __PYX_ERR(0, 1553, __pyx_L1_error)

          /* "vcstring.pyx":1554
 *                         np.savez('output/coeffs_new.npz',
 *                                  b=b,
 *                                  D_0=D_0,             # <<<<<<<<<<<<<<
 *                                  D_tau=D_tau,
 *                                  g_0=g_0,
 */
          if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_D_0_2, ((PyObject *)__pyx_v_D_0)) < 0) __PYX_ERR(0, 1553, __pyx_L1_error)

          /* "vcstring.pyx":1555
 *                                  b=b,
 *                                  D_0=D_0,
 *                                  D_tau=D_tau,             # <<<<<<<<<<<<<<
 *                                  g_0=g_0,
 *                                  g_tau=g_tau)
 */
          if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_D_tau_2, ((PyObject *)__pyx_v_D_tau)) < 0) __PYX_ERR(0, 1553, __pyx_L1_error)

          /* "vcstring.pyx":1556
 *                                  D_0=D_0,
 *                                  D_tau=D_tau,
 *                                  g_0=g_0,             # <<<<<<<<<<<<<<
 *                                  g_tau=g_tau)
 *                     print('Accepted: Moved position by {0} , {1}. Cnew {2} is less than Cmax {3}'.format(hx, hy, Cnew, target))
 */
          if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_g_0_2, ((PyObject *)__pyx_v_g_0)) < 0) __PYX_ERR(0, 1553, __pyx_L1_error)

          /* "vcstring.pyx":1557
 *                                  D_tau=D_tau,
 *                                  g_0=g_0,
 *                                  g_tau=g_tau)             # <<<<<<<<<<<<<<
 *                     print('Accepted: Moved position by {0} , {1}. Cnew {2} is less than Cmax {3}'.format(hx, hy, Cnew, target))
 *                     print('Old position:', z_init)
 */
          if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_g_tau_2, ((PyObject *)__pyx_v_g_tau)) < 0) __PYX_ERR(0, 1553, __pyx_L1_error)

          /* "vcstring.pyx":1552
 *                         np.savetxt('output/C_new.txt', [Cnew])
 *                         np.savetxt('output/q_new.txt', b)
 *                         np.savez('output/coeffs_new.npz',             # <<<<<<<<<<<<<<
 *                                  b=b,
 *                                  D_0=D_0,
 */
          __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_tuple__74, __pyx_t_5); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1552, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

          /* "vcstring.pyx":1547
 *                 if Cnew < target:
 *                     MC_list.extend([hx, hy, Cnew, z[i][0], z[i][1]])
 *                     if save == True:             # <<<<<<<<<<<<<<
 *                         np.savetxt('output/mc.txt', MC_list)
 *                         np.savetxt('output/z_new.txt', z)
 */
        }

        /* "vcstring.pyx":1558
 *                                  g_0=g_0,
 *                                  g_tau=g_tau)
 *                     print('Accepted: Moved position by {0} , {1}. Cnew {2} is less than Cmax {3}'.format(hx, hy, Cnew, target))             # <<<<<<<<<<<<<<
 *                     print('Old position:', z_init)
 *                     print('New position:', z[i])
 */
        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_Accepted_Moved_position_by_0_1_C, __pyx_n_s_format); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1558, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_hx); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1558, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_hy); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1558, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_7 = PyFloat_FromDouble(__pyx_v_Cnew); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1558, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_1 = PyFloat_FromDouble(__pyx_v_target); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1558, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_6 = NULL;
        __pyx_t_15 = 0;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
          __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
          if (likely(__pyx_t_6)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
            __Pyx_INCREF(__pyx_t_6);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_5, function);
            __pyx_t_15 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[5] = {__pyx_t_6, __pyx_t_3, __pyx_t_4, __pyx_t_7, __pyx_t_1};
          __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_15, 4+__pyx_t_15); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1558, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[5] = {__pyx_t_6, __pyx_t_3, __pyx_t_4, __pyx_t_7, __pyx_t_1};
          __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_15, 4+__pyx_t_15); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1558, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        } else
        #endif
        {
          __pyx_t_8 = PyTuple_New(4+__pyx_t_15); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1558, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          if (__pyx_t_6) {
            __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
          }
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_15, __pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_4);
          PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_15, __pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_7);
          PyTuple_SET_ITEM(__pyx_t_8, 2+__pyx_t_15, __pyx_t_7);
          __Pyx_GIVEREF(__pyx_t_1);
          PyTuple_SET_ITEM(__pyx_t_8, 3+__pyx_t_15, __pyx_t_1);
          __pyx_t_3 = 0;
          __pyx_t_4 = 0;
          __pyx_t_7 = 0;
          __pyx_t_1 = 0;
          __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_8, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1558, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        }
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1558, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

        /* "vcstring.pyx":1559
 *                                  g_tau=g_tau)
 *                     print('Accepted: Moved position by {0} , {1}. Cnew {2} is less than Cmax {3}'.format(hx, hy, Cnew, target))
 *                     print('Old position:', z_init)             # <<<<<<<<<<<<<<
 *                     print('New position:', z[i])
 *                     return z
 */
        __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1559, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_INCREF(__pyx_kp_u_Old_position);
        __Pyx_GIVEREF(__pyx_kp_u_Old_position);
        PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_kp_u_Old_position);
        __Pyx_INCREF(__pyx_v_z_init);
        __Pyx_GIVEREF(__pyx_v_z_init);
        PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_v_z_init);
        __pyx_t_10 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_5, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1559, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

        /* "vcstring.pyx":1560
 *                     print('Accepted: Moved position by {0} , {1}. Cnew {2} is less than Cmax {3}'.format(hx, hy, Cnew, target))
 *                     print('Old position:', z_init)
 *                     print('New position:', z[i])             # <<<<<<<<<<<<<<
 *                     return z
 *                 else:
 */
        __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1560, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1560, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_INCREF(__pyx_kp_u_New_position);
        __Pyx_GIVEREF(__pyx_kp_u_New_position);
        PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_kp_u_New_position);
        __Pyx_GIVEREF(__pyx_t_10);
        PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_10);
        __pyx_t_10 = 0;
        __pyx_t_10 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_5, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1560, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

        /* "vcstring.pyx":1561
 *                     print('Old position:', z_init)
 *                     print('New position:', z[i])
 *                     return z             # <<<<<<<<<<<<<<
 *                 else:
 *                     z[i][0] = z_init[0]       # Move back to original position
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(((PyObject *)__pyx_v_z));
        __pyx_r = ((PyObject *)__pyx_v_z);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L0;

        /* "vcstring.pyx":1545
 * 
 *                 # Accept or reject the move
 *                 if Cnew < target:             # <<<<<<<<<<<<<<
 *                     MC_list.extend([hx, hy, Cnew, z[i][0], z[i][1]])
 *                     if save == True:
 */
      }

      /* "vcstring.pyx":1563
 *                     return z
 *                 else:
 *                     z[i][0] = z_init[0]       # Move back to original position             # <<<<<<<<<<<<<<
 *                     z[i][1] = z_init[1]
 *                     # z[i][0] = z[i][0] - hx  # Move back to original position
 */
      /*else*/ {
        __pyx_t_10 = __Pyx_GetItemInt(__pyx_v_z_init, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1563, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1563, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        if (unlikely(__Pyx_SetItemInt(__pyx_t_5, 0, __pyx_t_10, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 1563, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

        /* "vcstring.pyx":1564
 *                 else:
 *                     z[i][0] = z_init[0]       # Move back to original position
 *                     z[i][1] = z_init[1]             # <<<<<<<<<<<<<<
 *                     # z[i][0] = z[i][0] - hx  # Move back to original position
 *                     # z[i][1] = z[i][1] - hy
 */
        __pyx_t_10 = __Pyx_GetItemInt(__pyx_v_z_init, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1564, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1564, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        if (unlikely(__Pyx_SetItemInt(__pyx_t_5, 1, __pyx_t_10, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 1564, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

        /* "vcstring.pyx":1567
 *                     # z[i][0] = z[i][0] - hx  # Move back to original position
 *                     # z[i][1] = z[i][1] - hy
 *                     print('Rejected: Moved position by {0} , {1}. Cnew {2} is greater than Cmax {3}'.format(hx, hy, Cnew, target))             # <<<<<<<<<<<<<<
 *                     continue
 * 
 */
        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_Rejected_Moved_position_by_0_1_C, __pyx_n_s_format); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1567, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_8 = PyFloat_FromDouble(__pyx_v_hx); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1567, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_1 = PyFloat_FromDouble(__pyx_v_hy); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1567, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_7 = PyFloat_FromDouble(__pyx_v_Cnew); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1567, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_target); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1567, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_3 = NULL;
        __pyx_t_15 = 0;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
          __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_5);
          if (likely(__pyx_t_3)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
            __Pyx_INCREF(__pyx_t_3);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_5, function);
            __pyx_t_15 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[5] = {__pyx_t_3, __pyx_t_8, __pyx_t_1, __pyx_t_7, __pyx_t_4};
          __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_15, 4+__pyx_t_15); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1567, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[5] = {__pyx_t_3, __pyx_t_8, __pyx_t_1, __pyx_t_7, __pyx_t_4};
          __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_15, 4+__pyx_t_15); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1567, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        } else
        #endif
        {
          __pyx_t_6 = PyTuple_New(4+__pyx_t_15); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1567, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          if (__pyx_t_3) {
            __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_3); __pyx_t_3 = NULL;
          }
          __Pyx_GIVEREF(__pyx_t_8);
          PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_15, __pyx_t_8);
          __Pyx_GIVEREF(__pyx_t_1);
          PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_15, __pyx_t_1);
          __Pyx_GIVEREF(__pyx_t_7);
          PyTuple_SET_ITEM(__pyx_t_6, 2+__pyx_t_15, __pyx_t_7);
          __Pyx_GIVEREF(__pyx_t_4);
          PyTuple_SET_ITEM(__pyx_t_6, 3+__pyx_t_15, __pyx_t_4);
          __pyx_t_8 = 0;
          __pyx_t_1 = 0;
          __pyx_t_7 = 0;
          __pyx_t_4 = 0;
          __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1567, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        }
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1567, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

        /* "vcstring.pyx":1568
 *                     # z[i][1] = z[i][1] - hy
 *                     print('Rejected: Moved position by {0} , {1}. Cnew {2} is greater than Cmax {3}'.format(hx, hy, Cnew, target))
 *                     continue             # <<<<<<<<<<<<<<
 * 
 *             # In the case when all values were rejected
 */
        goto __pyx_L5_continue;
      }
      __pyx_L5_continue:;
    }

    /* "vcstring.pyx":1571
 * 
 *             # In the case when all values were rejected
 *             print('\nWARNING: No values were accepted. Try increasing the number of MC steps.')             # <<<<<<<<<<<<<<
 *             print('Old position:', z_init)
 * 
 */
    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__75, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1571, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "vcstring.pyx":1572
 *             # In the case when all values were rejected
 *             print('\nWARNING: No values were accepted. Try increasing the number of MC steps.')
 *             print('Old position:', z_init)             # <<<<<<<<<<<<<<
 * 
 *         return
 */
    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1572, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_INCREF(__pyx_kp_u_Old_position);
    __Pyx_GIVEREF(__pyx_kp_u_Old_position);
    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_kp_u_Old_position);
    __Pyx_INCREF(__pyx_v_z_init);
    __Pyx_GIVEREF(__pyx_v_z_init);
    PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_v_z_init);
    __pyx_t_10 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_5, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1572, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

    /* "vcstring.pyx":1411
 * 
 *         # for i in range(self.num_basis): # Move each bead on the string
 *         for i in images:  # Move the i-th bead(s) on the string             # <<<<<<<<<<<<<<
 *             z_init = deepcopy(z[i])
 *             print('\nIMAGE', i)
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":1574
 *             print('Old position:', z_init)
 * 
 *         return             # <<<<<<<<<<<<<<
 * 
 *     cpdef montecarlo_symmetric(self, list images, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, double target, double delta=0.01, int n=100, manual=False, hx_man=None, hy_man=None, reparm=True, mindist_constraint=False, mindist=0.25, accelerated=False, corr_method='matrix_elements', save=True):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;

  /* "vcstring.pyx":1366
 *         return dq_list, z[id_new], b[id_new]
 * 
 *     cpdef montecarlo(self, list images, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, double target, double delta=0.01, int n=100, ensemble_timeavg_v1=False, ensemble_timeavg_v2=False, ensemble_avg=False, stride=None, list weights=None, symmetric=True, manual=False, hx_man=None, hy_man=None, reparm=True, mindist_constraint=False, mindist=0.25, accelerated=False, corr_method='matrix_elements', save=True):             # <<<<<<<<<<<<<<
 *         """
 *         Monte Carlo accept/reject of correlation given a target value.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_10);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_ens.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_ens.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b_ens.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_ens.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_ens.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.montecarlo", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0_ens.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau_ens.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b_ens.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0_ens.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau_ens.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XDECREF(__pyx_v_MC_list);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_0);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_tau);
  __Pyx_XDECREF((PyObject *)__pyx_v_ids);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_0_ens);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_tau_ens);
  __Pyx_XDECREF((PyObject *)__pyx_v_b);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_0);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_tau);
  __Pyx_XDECREF((PyObject *)__pyx_v_b_ens);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_0_ens);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_tau_ens);
  __Pyx_XDECREF(__pyx_v_z_init);
  __Pyx_XDECREF((PyObject *)__pyx_v_z);
  __Pyx_XDECREF(__pyx_v_weights);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_37montecarlo(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8vcstring_8vcstring_36montecarlo[] = "\n        Monte Carlo accept/reject of correlation given a target value.\n\n        Parameters:\n        -----------\n        images : List of indices of the images on the Voronoi string\n        traj   : trajectory\n        z      : Voronoi centroid positions\n        target : Value to compare for acceptance or rejection\n        delta  : Step change in the Voronoi centroid position, default = 0.01\n        n      : How many MC steps to perform to find an accepted value. Should be divisible \n                 by self.num_basis to include all images on the string in each MC iteration. \n                 Default = 100.\n        accelerated  :  Specifies which method to solve the linear equations for b, D, g.\n        save   : Specifies whether to save results as numpy file. Default = True.\n\n        Return:\n        -------\n        Returns the updated position of z upon acceptance\n        ";
static PyObject *__pyx_pw_8vcstring_8vcstring_37montecarlo(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_images = 0;
  PyObject *__pyx_v_traj = 0;
  int __pyx_v_tau;
  PyArrayObject *__pyx_v_z = 0;
  double __pyx_v_target;
  double __pyx_v_delta;
  int __pyx_v_n;
  PyObject *__pyx_v_ensemble_timeavg_v1 = 0;
  PyObject *__pyx_v_ensemble_timeavg_v2 = 0;
  PyObject *__pyx_v_ensemble_avg = 0;
  PyObject *__pyx_v_stride = 0;
  PyObject *__pyx_v_weights = 0;
  PyObject *__pyx_v_symmetric = 0;
  PyObject *__pyx_v_manual = 0;
  PyObject *__pyx_v_hx_man = 0;
  PyObject *__pyx_v_hy_man = 0;
  PyObject *__pyx_v_reparm = 0;
  PyObject *__pyx_v_mindist_constraint = 0;
  PyObject *__pyx_v_mindist = 0;
  PyObject *__pyx_v_accelerated = 0;
  PyObject *__pyx_v_corr_method = 0;
  PyObject *__pyx_v_save = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("montecarlo (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_images,&__pyx_n_s_traj,&__pyx_n_s_tau,&__pyx_n_s_z,&__pyx_n_s_target,&__pyx_n_s_delta,&__pyx_n_s_n,&__pyx_n_s_ensemble_timeavg_v1,&__pyx_n_s_ensemble_timeavg_v2,&__pyx_n_s_ensemble_avg,&__pyx_n_s_stride,&__pyx_n_s_weights,&__pyx_n_s_symmetric,&__pyx_n_s_manual,&__pyx_n_s_hx_man,&__pyx_n_s_hy_man,&__pyx_n_s_reparm,&__pyx_n_s_mindist_constraint,&__pyx_n_s_mindist,&__pyx_n_s_accelerated,&__pyx_n_s_corr_method,&__pyx_n_s_save,0};
    PyObject* values[22] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    values[7] = ((PyObject *)Py_False);
    values[8] = ((PyObject *)Py_False);
    values[9] = ((PyObject *)Py_False);
    values[10] = ((PyObject *)Py_None);
    values[11] = ((PyObject*)Py_None);
    values[12] = ((PyObject *)Py_True);
    values[13] = ((PyObject *)Py_False);
    values[14] = ((PyObject *)Py_None);
    values[15] = ((PyObject *)Py_None);
    values[16] = ((PyObject *)Py_True);
    values[17] = ((PyObject *)Py_False);
    values[18] = ((PyObject *)__pyx_float_0_25);
    values[19] = ((PyObject *)Py_False);
    values[20] = ((PyObject *)__pyx_n_u_matrix_elements);
    values[21] = ((PyObject *)Py_True);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case 22: values[21] = PyTuple_GET_ITEM(__pyx_args, 21);
        CYTHON_FALLTHROUGH;
        case 21: values[20] = PyTuple_GET_ITEM(__pyx_args, 20);
        CYTHON_FALLTHROUGH;
        case 20: values[19] = PyTuple_GET_ITEM(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = PyTuple_GET_ITEM(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = PyTuple_GET_ITEM(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = PyTuple_GET_ITEM(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = PyTuple_GET_ITEM(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = PyTuple_GET_ITEM(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = PyTuple_GET_ITEM(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = PyTuple_GET_ITEM(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = PyTuple_GET_ITEM(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = PyTuple_GET_ITEM(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = PyTuple_GET_ITEM(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_images)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_traj)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("montecarlo", 0, 5, 22, 1); __PYX_ERR(0, 1366, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tau)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("montecarlo", 0, 5, 22, 2); __PYX_ERR(0, 1366, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("montecarlo", 0, 5, 22, 3); __PYX_ERR(0, 1366, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_target)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("montecarlo", 0, 5, 22, 4); __PYX_ERR(0, 1366, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_delta);
          if (value) { values[5] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_n);
          if (value) { values[6] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ensemble_timeavg_v1);
          if (value) { values[7] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ensemble_timeavg_v2);
          if (value) { values[8] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ensemble_avg);
          if (value) { values[9] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_stride);
          if (value) { values[10] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weights);
          if (value) { values[11] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_symmetric);
          if (value) { values[12] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_manual);
          if (value) { values[13] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_hx_man);
          if (value) { values[14] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_hy_man);
          if (value) { values[15] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 16:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_reparm);
          if (value) { values[16] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 17:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_mindist_constraint);
          if (value) { values[17] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 18:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_mindist);
          if (value) { values[18] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 19:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_accelerated);
          if (value) { values[19] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 20:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_corr_method);
          if (value) { values[20] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 21:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_save);
          if (value) { values[21] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "montecarlo") < 0)) __PYX_ERR(0, 1366, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case 22: values[21] = PyTuple_GET_ITEM(__pyx_args, 21);
        CYTHON_FALLTHROUGH;
        case 21: values[20] = PyTuple_GET_ITEM(__pyx_args, 20);
        CYTHON_FALLTHROUGH;
        case 20: values[19] = PyTuple_GET_ITEM(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = PyTuple_GET_ITEM(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = PyTuple_GET_ITEM(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = PyTuple_GET_ITEM(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = PyTuple_GET_ITEM(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = PyTuple_GET_ITEM(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = PyTuple_GET_ITEM(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = PyTuple_GET_ITEM(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = PyTuple_GET_ITEM(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = PyTuple_GET_ITEM(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = PyTuple_GET_ITEM(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_images = ((PyObject*)values[0]);
    __pyx_v_traj = ((PyObject*)values[1]);
    __pyx_v_tau = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_tau == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1366, __pyx_L3_error)
    __pyx_v_z = ((PyArrayObject *)values[3]);
    __pyx_v_target = __pyx_PyFloat_AsDouble(values[4]); if (unlikely((__pyx_v_target == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1366, __pyx_L3_error)
    if (values[5]) {
      __pyx_v_delta = __pyx_PyFloat_AsDouble(values[5]); if (unlikely((__pyx_v_delta == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1366, __pyx_L3_error)
    } else {
      __pyx_v_delta = ((double)0.01);
    }
    if (values[6]) {
      __pyx_v_n = __Pyx_PyInt_As_int(values[6]); if (unlikely((__pyx_v_n == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1366, __pyx_L3_error)
    } else {
      __pyx_v_n = ((int)0x64);
    }
    __pyx_v_ensemble_timeavg_v1 = values[7];
    __pyx_v_ensemble_timeavg_v2 = values[8];
    __pyx_v_ensemble_avg = values[9];
    __pyx_v_stride = values[10];
    __pyx_v_weights = ((PyObject*)values[11]);
    __pyx_v_symmetric = values[12];
    __pyx_v_manual = values[13];
    __pyx_v_hx_man = values[14];
    __pyx_v_hy_man = values[15];
    __pyx_v_reparm = values[16];
    __pyx_v_mindist_constraint = values[17];
    __pyx_v_mindist = values[18];
    __pyx_v_accelerated = values[19];
    __pyx_v_corr_method = values[20];
    __pyx_v_save = values[21];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("montecarlo", 0, 5, 22, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1366, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.vcstring.montecarlo", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_images), (&PyList_Type), 1, "images", 1))) __PYX_ERR(0, 1366, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_traj), (&PyList_Type), 1, "traj", 1))) __PYX_ERR(0, 1366, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_z), __pyx_ptype_5numpy_ndarray, 1, "z", 0))) __PYX_ERR(0, 1366, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_weights), (&PyList_Type), 1, "weights", 1))) __PYX_ERR(0, 1366, __pyx_L1_error)
  __pyx_r = __pyx_pf_8vcstring_8vcstring_36montecarlo(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self), __pyx_v_images, __pyx_v_traj, __pyx_v_tau, __pyx_v_z, __pyx_v_target, __pyx_v_delta, __pyx_v_n, __pyx_v_ensemble_timeavg_v1, __pyx_v_ensemble_timeavg_v2, __pyx_v_ensemble_avg, __pyx_v_stride, __pyx_v_weights, __pyx_v_symmetric, __pyx_v_manual, __pyx_v_hx_man, __pyx_v_hy_man, __pyx_v_reparm, __pyx_v_mindist_constraint, __pyx_v_mindist, __pyx_v_accelerated, __pyx_v_corr_method, __pyx_v_save);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_36montecarlo(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_images, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, double __pyx_v_target, double __pyx_v_delta, int __pyx_v_n, PyObject *__pyx_v_ensemble_timeavg_v1, PyObject *__pyx_v_ensemble_timeavg_v2, PyObject *__pyx_v_ensemble_avg, PyObject *__pyx_v_stride, PyObject *__pyx_v_weights, PyObject *__pyx_v_symmetric, PyObject *__pyx_v_manual, PyObject *__pyx_v_hx_man, PyObject *__pyx_v_hy_man, PyObject *__pyx_v_reparm, PyObject *__pyx_v_mindist_constraint, PyObject *__pyx_v_mindist, PyObject *__pyx_v_accelerated, PyObject *__pyx_v_corr_method, PyObject *__pyx_v_save) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  struct __pyx_opt_args_8vcstring_8vcstring_montecarlo __pyx_t_2;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("montecarlo", 0);
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1366, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2.__pyx_n = 17;
  __pyx_t_2.delta = __pyx_v_delta;
  __pyx_t_2.n = __pyx_v_n;
  __pyx_t_2.ensemble_timeavg_v1 = __pyx_v_ensemble_timeavg_v1;
  __pyx_t_2.ensemble_timeavg_v2 = __pyx_v_ensemble_timeavg_v2;
  __pyx_t_2.ensemble_avg = __pyx_v_ensemble_avg;
  __pyx_t_2.stride = __pyx_v_stride;
  __pyx_t_2.weights = __pyx_v_weights;
  __pyx_t_2.symmetric = __pyx_v_symmetric;
  __pyx_t_2.manual = __pyx_v_manual;
  __pyx_t_2.hx_man = __pyx_v_hx_man;
  __pyx_t_2.hy_man = __pyx_v_hy_man;
  __pyx_t_2.reparm = __pyx_v_reparm;
  __pyx_t_2.mindist_constraint = __pyx_v_mindist_constraint;
  __pyx_t_2.mindist = __pyx_v_mindist;
  __pyx_t_2.accelerated = __pyx_v_accelerated;
  __pyx_t_2.corr_method = __pyx_v_corr_method;
  __pyx_t_2.save = __pyx_v_save;
  __pyx_t_1 = __pyx_vtabptr_8vcstring_vcstring->montecarlo(__pyx_v_self, __pyx_v_images, __pyx_v_traj, __pyx_v_tau, __pyx_v_z, __pyx_v_target, 1, &__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1366, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.montecarlo", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":1576
 *         return
 * 
 *     cpdef montecarlo_symmetric(self, list images, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, double target, double delta=0.01, int n=100, manual=False, hx_man=None, hy_man=None, reparm=True, mindist_constraint=False, mindist=0.25, accelerated=False, corr_method='matrix_elements', save=True):             # <<<<<<<<<<<<<<
 *         """
 *         For systems that are symmetric about some axis of rotation.
 */

static PyObject *__pyx_pw_8vcstring_8vcstring_39montecarlo_symmetric(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8vcstring_8vcstring_montecarlo_symmetric(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_images, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, double __pyx_v_target, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_montecarlo_symmetric *__pyx_optional_args) {
  double __pyx_v_delta = ((double)0.01);
  int __pyx_v_n = ((int)0x64);
  PyObject *__pyx_v_manual = ((PyObject *)Py_False);
  PyObject *__pyx_v_hx_man = ((PyObject *)Py_None);
  PyObject *__pyx_v_hy_man = ((PyObject *)Py_None);
  PyObject *__pyx_v_reparm = ((PyObject *)Py_True);
  PyObject *__pyx_v_mindist_constraint = ((PyObject *)Py_False);
  PyObject *__pyx_v_mindist = ((PyObject *)__pyx_float_0_25);
  PyObject *__pyx_v_accelerated = ((PyObject *)Py_False);
  PyObject *__pyx_v_corr_method = ((PyObject *)__pyx_n_u_matrix_elements);
  PyObject *__pyx_v_save = ((PyObject *)Py_True);
  PyObject *__pyx_v_MC_list = 0;
  int __pyx_v_it;
  int __pyx_v_i;
  int __pyx_v_ii;
  double __pyx_v_hx;
  double __pyx_v_hy;
  double __pyx_v_Cnew;
  double __pyx_v_d1;
  double __pyx_v_d2;
  PyArrayObject *__pyx_v_D_0 = 0;
  PyArrayObject *__pyx_v_D_tau = 0;
  PyArrayObject *__pyx_v_ids = 0;
  PyArrayObject *__pyx_v_b = 0;
  PyArrayObject *__pyx_v_g_0 = 0;
  PyArrayObject *__pyx_v_g_tau = 0;
  Py_ssize_t __pyx_v_N;
  PyObject *__pyx_v_z_init = NULL;
  PyObject *__pyx_v_z_init_opp = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_0;
  __Pyx_Buffer __pyx_pybuffer_D_0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_D_tau;
  __Pyx_Buffer __pyx_pybuffer_D_tau;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_0;
  __Pyx_Buffer __pyx_pybuffer_g_0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_g_tau;
  __Pyx_Buffer __pyx_pybuffer_g_tau;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_ids;
  __Pyx_Buffer __pyx_pybuffer_ids;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  Py_ssize_t __pyx_t_11;
  int __pyx_t_12;
  int __pyx_t_13;
  int __pyx_t_14;
  int __pyx_t_15;
  double __pyx_t_16;
  PyArrayObject *__pyx_t_17 = NULL;
  PyObject *__pyx_t_18 = NULL;
  PyObject *__pyx_t_19 = NULL;
  PyObject *__pyx_t_20 = NULL;
  int __pyx_t_21;
  Py_ssize_t __pyx_t_22;
  long __pyx_t_23;
  PyObject *(*__pyx_t_24)(PyObject *);
  PyArrayObject *__pyx_t_25 = NULL;
  PyArrayObject *__pyx_t_26 = NULL;
  struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs __pyx_t_27;
  int __pyx_t_28;
  int __pyx_t_29;
  int __pyx_t_30;
  int __pyx_t_31;
  int __pyx_t_32;
  int __pyx_t_33;
  int __pyx_t_34;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("montecarlo_symmetric", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args->__pyx_n > 0) {
      __pyx_v_delta = __pyx_optional_args->delta;
      if (__pyx_optional_args->__pyx_n > 1) {
        __pyx_v_n = __pyx_optional_args->n;
        if (__pyx_optional_args->__pyx_n > 2) {
          __pyx_v_manual = __pyx_optional_args->manual;
          if (__pyx_optional_args->__pyx_n > 3) {
            __pyx_v_hx_man = __pyx_optional_args->hx_man;
            if (__pyx_optional_args->__pyx_n > 4) {
              __pyx_v_hy_man = __pyx_optional_args->hy_man;
              if (__pyx_optional_args->__pyx_n > 5) {
                __pyx_v_reparm = __pyx_optional_args->reparm;
                if (__pyx_optional_args->__pyx_n > 6) {
                  __pyx_v_mindist_constraint = __pyx_optional_args->mindist_constraint;
                  if (__pyx_optional_args->__pyx_n > 7) {
                    __pyx_v_mindist = __pyx_optional_args->mindist;
                    if (__pyx_optional_args->__pyx_n > 8) {
                      __pyx_v_accelerated = __pyx_optional_args->accelerated;
                      if (__pyx_optional_args->__pyx_n > 9) {
                        __pyx_v_corr_method = __pyx_optional_args->corr_method;
                        if (__pyx_optional_args->__pyx_n > 10) {
                          __pyx_v_save = __pyx_optional_args->save;
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
  __Pyx_INCREF((PyObject *)__pyx_v_z);
  __pyx_pybuffer_D_0.pybuffer.buf = NULL;
  __pyx_pybuffer_D_0.refcount = 0;
  __pyx_pybuffernd_D_0.data = NULL;
  __pyx_pybuffernd_D_0.rcbuffer = &__pyx_pybuffer_D_0;
  __pyx_pybuffer_D_tau.pybuffer.buf = NULL;
  __pyx_pybuffer_D_tau.refcount = 0;
  __pyx_pybuffernd_D_tau.data = NULL;
  __pyx_pybuffernd_D_tau.rcbuffer = &__pyx_pybuffer_D_tau;
  __pyx_pybuffer_ids.pybuffer.buf = NULL;
  __pyx_pybuffer_ids.refcount = 0;
  __pyx_pybuffernd_ids.data = NULL;
  __pyx_pybuffernd_ids.rcbuffer = &__pyx_pybuffer_ids;
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  __pyx_pybuffer_g_0.pybuffer.buf = NULL;
  __pyx_pybuffer_g_0.refcount = 0;
  __pyx_pybuffernd_g_0.data = NULL;
  __pyx_pybuffernd_g_0.rcbuffer = &__pyx_pybuffer_g_0;
  __pyx_pybuffer_g_tau.pybuffer.buf = NULL;
  __pyx_pybuffer_g_tau.refcount = 0;
  __pyx_pybuffernd_g_tau.data = NULL;
  __pyx_pybuffernd_g_tau.rcbuffer = &__pyx_pybuffer_g_tau;
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1576, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
    #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_montecarlo_symmetric); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1576, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_8vcstring_8vcstring_39montecarlo_symmetric)) {
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1576, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_target); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1576, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_5 = PyFloat_FromDouble(__pyx_v_delta); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1576, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_n); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1576, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_1);
        __pyx_t_7 = __pyx_t_1; __pyx_t_8 = NULL;
        __pyx_t_9 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
          __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
          if (likely(__pyx_t_8)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_8);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_7, function);
            __pyx_t_9 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_7)) {
          PyObject *__pyx_temp[17] = {__pyx_t_8, __pyx_v_images, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_z), __pyx_t_4, __pyx_t_5, __pyx_t_6, __pyx_v_manual, __pyx_v_hx_man, __pyx_v_hy_man, __pyx_v_reparm, __pyx_v_mindist_constraint, __pyx_v_mindist, __pyx_v_accelerated, __pyx_v_corr_method, __pyx_v_save};
          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_9, 16+__pyx_t_9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1576, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
          PyObject *__pyx_temp[17] = {__pyx_t_8, __pyx_v_images, __pyx_v_traj, __pyx_t_3, ((PyObject *)__pyx_v_z), __pyx_t_4, __pyx_t_5, __pyx_t_6, __pyx_v_manual, __pyx_v_hx_man, __pyx_v_hy_man, __pyx_v_reparm, __pyx_v_mindist_constraint, __pyx_v_mindist, __pyx_v_accelerated, __pyx_v_corr_method, __pyx_v_save};
          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_9, 16+__pyx_t_9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1576, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        {
          __pyx_t_10 = PyTuple_New(16+__pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1576, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          if (__pyx_t_8) {
            __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_8); __pyx_t_8 = NULL;
          }
          __Pyx_INCREF(__pyx_v_images);
          __Pyx_GIVEREF(__pyx_v_images);
          PyTuple_SET_ITEM(__pyx_t_10, 0+__pyx_t_9, __pyx_v_images);
          __Pyx_INCREF(__pyx_v_traj);
          __Pyx_GIVEREF(__pyx_v_traj);
          PyTuple_SET_ITEM(__pyx_t_10, 1+__pyx_t_9, __pyx_v_traj);
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_10, 2+__pyx_t_9, __pyx_t_3);
          __Pyx_INCREF(((PyObject *)__pyx_v_z));
          __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
          PyTuple_SET_ITEM(__pyx_t_10, 3+__pyx_t_9, ((PyObject *)__pyx_v_z));
          __Pyx_GIVEREF(__pyx_t_4);
          PyTuple_SET_ITEM(__pyx_t_10, 4+__pyx_t_9, __pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_5);
          PyTuple_SET_ITEM(__pyx_t_10, 5+__pyx_t_9, __pyx_t_5);
          __Pyx_GIVEREF(__pyx_t_6);
          PyTuple_SET_ITEM(__pyx_t_10, 6+__pyx_t_9, __pyx_t_6);
          __Pyx_INCREF(__pyx_v_manual);
          __Pyx_GIVEREF(__pyx_v_manual);
          PyTuple_SET_ITEM(__pyx_t_10, 7+__pyx_t_9, __pyx_v_manual);
          __Pyx_INCREF(__pyx_v_hx_man);
          __Pyx_GIVEREF(__pyx_v_hx_man);
          PyTuple_SET_ITEM(__pyx_t_10, 8+__pyx_t_9, __pyx_v_hx_man);
          __Pyx_INCREF(__pyx_v_hy_man);
          __Pyx_GIVEREF(__pyx_v_hy_man);
          PyTuple_SET_ITEM(__pyx_t_10, 9+__pyx_t_9, __pyx_v_hy_man);
          __Pyx_INCREF(__pyx_v_reparm);
          __Pyx_GIVEREF(__pyx_v_reparm);
          PyTuple_SET_ITEM(__pyx_t_10, 10+__pyx_t_9, __pyx_v_reparm);
          __Pyx_INCREF(__pyx_v_mindist_constraint);
          __Pyx_GIVEREF(__pyx_v_mindist_constraint);
          PyTuple_SET_ITEM(__pyx_t_10, 11+__pyx_t_9, __pyx_v_mindist_constraint);
          __Pyx_INCREF(__pyx_v_mindist);
          __Pyx_GIVEREF(__pyx_v_mindist);
          PyTuple_SET_ITEM(__pyx_t_10, 12+__pyx_t_9, __pyx_v_mindist);
          __Pyx_INCREF(__pyx_v_accelerated);
          __Pyx_GIVEREF(__pyx_v_accelerated);
          PyTuple_SET_ITEM(__pyx_t_10, 13+__pyx_t_9, __pyx_v_accelerated);
          __Pyx_INCREF(__pyx_v_corr_method);
          __Pyx_GIVEREF(__pyx_v_corr_method);
          PyTuple_SET_ITEM(__pyx_t_10, 14+__pyx_t_9, __pyx_v_corr_method);
          __Pyx_INCREF(__pyx_v_save);
          __Pyx_GIVEREF(__pyx_v_save);
          PyTuple_SET_ITEM(__pyx_t_10, 15+__pyx_t_9, __pyx_v_save);
          __pyx_t_3 = 0;
          __pyx_t_4 = 0;
          __pyx_t_5 = 0;
          __pyx_t_6 = 0;
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_10, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1576, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        }
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_type_dict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }

  /* "vcstring.pyx":1606
 *         cdef np.ndarray[DTYPE_t, ndim=1] b, g_0, g_tau, zinit
 * 
 *         N = len(traj)             # <<<<<<<<<<<<<<
 *         print('\n=================================')
 *         print('MONTE CARLO SAMPLING - SYMMETRIC')
 */
  if (unlikely(__pyx_v_traj == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
    __PYX_ERR(0, 1606, __pyx_L1_error)
  }
  __pyx_t_11 = PyList_GET_SIZE(__pyx_v_traj); if (unlikely(__pyx_t_11 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1606, __pyx_L1_error)
  __pyx_v_N = __pyx_t_11;

  /* "vcstring.pyx":1607
 * 
 *         N = len(traj)
 *         print('\n=================================')             # <<<<<<<<<<<<<<
 *         print('MONTE CARLO SAMPLING - SYMMETRIC')
 *         print('=================================')
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__36, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1607, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1608
 *         N = len(traj)
 *         print('\n=================================')
 *         print('MONTE CARLO SAMPLING - SYMMETRIC')             # <<<<<<<<<<<<<<
 *         print('=================================')
 *         print('\nMONTE CARLO PARAMETERS')
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__76, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1608, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1609
 *         print('\n=================================')
 *         print('MONTE CARLO SAMPLING - SYMMETRIC')
 *         print('=================================')             # <<<<<<<<<<<<<<
 *         print('\nMONTE CARLO PARAMETERS')
 *         print('-------------------------')
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__39, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1609, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1610
 *         print('MONTE CARLO SAMPLING - SYMMETRIC')
 *         print('=================================')
 *         print('\nMONTE CARLO PARAMETERS')             # <<<<<<<<<<<<<<
 *         print('-------------------------')
 *         print('Target for accept/reject:', target)
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__54, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1610, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1611
 *         print('=================================')
 *         print('\nMONTE CARLO PARAMETERS')
 *         print('-------------------------')             # <<<<<<<<<<<<<<
 *         print('Target for accept/reject:', target)
 *         print('Step change in position:', delta)
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__56, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1611, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1612
 *         print('\nMONTE CARLO PARAMETERS')
 *         print('-------------------------')
 *         print('Target for accept/reject:', target)             # <<<<<<<<<<<<<<
 *         print('Step change in position:', delta)
 *         print('Number of MC steps per image:', n)
 */
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_target); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1612, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1612, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_Target_for_accept_reject);
  __Pyx_GIVEREF(__pyx_kp_u_Target_for_accept_reject);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_Target_for_accept_reject);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1612, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1613
 *         print('-------------------------')
 *         print('Target for accept/reject:', target)
 *         print('Step change in position:', delta)             # <<<<<<<<<<<<<<
 *         print('Number of MC steps per image:', n)
 *         print('lag time:', tau)
 */
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_delta); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1613, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1613, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_Step_change_in_position_2);
  __Pyx_GIVEREF(__pyx_kp_u_Step_change_in_position_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_Step_change_in_position_2);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1613, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1614
 *         print('Target for accept/reject:', target)
 *         print('Step change in position:', delta)
 *         print('Number of MC steps per image:', n)             # <<<<<<<<<<<<<<
 *         print('lag time:', tau)
 *         print('Input positions:\n', z)
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1614, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1614, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_Number_of_MC_steps_per_image);
  __Pyx_GIVEREF(__pyx_kp_u_Number_of_MC_steps_per_image);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_Number_of_MC_steps_per_image);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1614, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1615
 *         print('Step change in position:', delta)
 *         print('Number of MC steps per image:', n)
 *         print('lag time:', tau)             # <<<<<<<<<<<<<<
 *         print('Input positions:\n', z)
 *         print('\nStarting Monte Carlo calculations')
 */
  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_tau); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1615, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1615, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_kp_u_lag_time_2);
  __Pyx_GIVEREF(__pyx_kp_u_lag_time_2);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_lag_time_2);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1615, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1616
 *         print('Number of MC steps per image:', n)
 *         print('lag time:', tau)
 *         print('Input positions:\n', z)             # <<<<<<<<<<<<<<
 *         print('\nStarting Monte Carlo calculations')
 *         sys.stdout.flush()
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1616, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_Input_positions);
  __Pyx_GIVEREF(__pyx_kp_u_Input_positions);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Input_positions);
  __Pyx_INCREF(((PyObject *)__pyx_v_z));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_z));
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1616, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":1617
 *         print('lag time:', tau)
 *         print('Input positions:\n', z)
 *         print('\nStarting Monte Carlo calculations')             # <<<<<<<<<<<<<<
 *         sys.stdout.flush()
 * 
 */
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__57, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1617, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":1618
 *         print('Input positions:\n', z)
 *         print('\nStarting Monte Carlo calculations')
 *         sys.stdout.flush()             # <<<<<<<<<<<<<<
 * 
 *         for i in images:  # Move the i-th bead(s) on the string
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sys); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1618, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_stdout); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1618, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_flush); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1618, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_2 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1618, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":1620
 *         sys.stdout.flush()
 * 
 *         for i in images:  # Move the i-th bead(s) on the string             # <<<<<<<<<<<<<<
 *             z_init = deepcopy(z[i])
 *             ii = int(self.num_basis - 1 - i)  # Index of bead on the opposite end of string
 */
  if (unlikely(__pyx_v_images == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
    __PYX_ERR(0, 1620, __pyx_L1_error)
  }
  __pyx_t_2 = __pyx_v_images; __Pyx_INCREF(__pyx_t_2); __pyx_t_11 = 0;
  for (;;) {
    if (__pyx_t_11 >= PyList_GET_SIZE(__pyx_t_2)) break;
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_11); __Pyx_INCREF(__pyx_t_1); __pyx_t_11++; if (unlikely(0 < 0)) __PYX_ERR(0, 1620, __pyx_L1_error)
    #else
    __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1620, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    #endif
    __pyx_t_9 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1620, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_i = __pyx_t_9;

    /* "vcstring.pyx":1621
 * 
 *         for i in images:  # Move the i-th bead(s) on the string
 *             z_init = deepcopy(z[i])             # <<<<<<<<<<<<<<
 *             ii = int(self.num_basis - 1 - i)  # Index of bead on the opposite end of string
 *             z_init_opp = deepcopy(z[ii])
 */
    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_deepcopy); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_6, __pyx_t_10) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_10);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_XDECREF_SET(__pyx_v_z_init, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "vcstring.pyx":1622
 *         for i in images:  # Move the i-th bead(s) on the string
 *             z_init = deepcopy(z[i])
 *             ii = int(self.num_basis - 1 - i)  # Index of bead on the opposite end of string             # <<<<<<<<<<<<<<
 *             z_init_opp = deepcopy(z[ii])
 *             print('\nIMAGE {0} and {1}'.format(i, ii))
 */
    __pyx_v_ii = ((int)((__pyx_v_self->num_basis - 1) - __pyx_v_i));

    /* "vcstring.pyx":1623
 *             z_init = deepcopy(z[i])
 *             ii = int(self.num_basis - 1 - i)  # Index of bead on the opposite end of string
 *             z_init_opp = deepcopy(z[ii])             # <<<<<<<<<<<<<<
 *             print('\nIMAGE {0} and {1}'.format(i, ii))
 *             print('--------------------')
 */
    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_deepcopy); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1623, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1623, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
      }
    }
    __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_6, __pyx_t_10) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_10);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1623, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_XDECREF_SET(__pyx_v_z_init_opp, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "vcstring.pyx":1624
 *             ii = int(self.num_basis - 1 - i)  # Index of bead on the opposite end of string
 *             z_init_opp = deepcopy(z[ii])
 *             print('\nIMAGE {0} and {1}'.format(i, ii))             # <<<<<<<<<<<<<<
 *             print('--------------------')
 *             print('Initial position:', z_init, z_init_opp)
 */
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_IMAGE_0_and_1, __pyx_n_s_format); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1624, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_10 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1624, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_ii); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1624, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_5 = NULL;
    __pyx_t_9 = 0;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
        __pyx_t_9 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_7)) {
      PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_10, __pyx_t_6};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1624, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
      PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_10, __pyx_t_6};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1624, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    } else
    #endif
    {
      __pyx_t_4 = PyTuple_New(2+__pyx_t_9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1624, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      if (__pyx_t_5) {
        __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5); __pyx_t_5 = NULL;
      }
      __Pyx_GIVEREF(__pyx_t_10);
      PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_9, __pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_6);
      PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_9, __pyx_t_6);
      __pyx_t_10 = 0;
      __pyx_t_6 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1624, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1624, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

    /* "vcstring.pyx":1625
 *             z_init_opp = deepcopy(z[ii])
 *             print('\nIMAGE {0} and {1}'.format(i, ii))
 *             print('--------------------')             # <<<<<<<<<<<<<<
 *             print('Initial position:', z_init, z_init_opp)
 * 
 */
    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__59, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1625, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

    /* "vcstring.pyx":1626
 *             print('\nIMAGE {0} and {1}'.format(i, ii))
 *             print('--------------------')
 *             print('Initial position:', z_init, z_init_opp)             # <<<<<<<<<<<<<<
 * 
 *             MC_list = []
 */
    __pyx_t_7 = PyTuple_New(3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1626, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_INCREF(__pyx_kp_u_Initial_position);
    __Pyx_GIVEREF(__pyx_kp_u_Initial_position);
    PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_kp_u_Initial_position);
    __Pyx_INCREF(__pyx_v_z_init);
    __Pyx_GIVEREF(__pyx_v_z_init);
    PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_v_z_init);
    __Pyx_INCREF(__pyx_v_z_init_opp);
    __Pyx_GIVEREF(__pyx_v_z_init_opp);
    PyTuple_SET_ITEM(__pyx_t_7, 2, __pyx_v_z_init_opp);
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1626, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "vcstring.pyx":1628
 *             print('Initial position:', z_init, z_init_opp)
 * 
 *             MC_list = []             # <<<<<<<<<<<<<<
 *             for it in range(n): # Run n numbers of MC steps
 *                 print('\nCALCULATING MONTE CARLO STEP', it)
 */
    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1628, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_XDECREF_SET(__pyx_v_MC_list, ((PyObject*)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "vcstring.pyx":1629
 * 
 *             MC_list = []
 *             for it in range(n): # Run n numbers of MC steps             # <<<<<<<<<<<<<<
 *                 print('\nCALCULATING MONTE CARLO STEP', it)
 *                 print('-------------------------------')
 */
    __pyx_t_9 = __pyx_v_n;
    __pyx_t_12 = __pyx_t_9;
    for (__pyx_t_13 = 0; __pyx_t_13 < __pyx_t_12; __pyx_t_13+=1) {
      __pyx_v_it = __pyx_t_13;

      /* "vcstring.pyx":1630
 *             MC_list = []
 *             for it in range(n): # Run n numbers of MC steps
 *                 print('\nCALCULATING MONTE CARLO STEP', it)             # <<<<<<<<<<<<<<
 *                 print('-------------------------------')
 *                 sys.stdout.flush()
 */
      __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_it); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1630, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1630, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_INCREF(__pyx_kp_u_CALCULATING_MONTE_CARLO_STEP);
      __Pyx_GIVEREF(__pyx_kp_u_CALCULATING_MONTE_CARLO_STEP);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_kp_u_CALCULATING_MONTE_CARLO_STEP);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_1);
      __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1630, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":1631
 *             for it in range(n): # Run n numbers of MC steps
 *                 print('\nCALCULATING MONTE CARLO STEP', it)
 *                 print('-------------------------------')             # <<<<<<<<<<<<<<
 *                 sys.stdout.flush()
 *                 if manual == False:
 */
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__61, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1631, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":1632
 *                 print('\nCALCULATING MONTE CARLO STEP', it)
 *                 print('-------------------------------')
 *                 sys.stdout.flush()             # <<<<<<<<<<<<<<
 *                 if manual == False:
 *                     hx = random.uniform(-delta, delta) # get random value to move z
 */
      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_sys); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1632, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_stdout); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1632, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_flush); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1632, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = NULL;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_7);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_7, function);
        }
      }
      __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1632, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":1633
 *                 print('-------------------------------')
 *                 sys.stdout.flush()
 *                 if manual == False:             # <<<<<<<<<<<<<<
 *                     hx = random.uniform(-delta, delta) # get random value to move z
 *                     hy = random.uniform(-delta, delta)
 */
      __pyx_t_1 = PyObject_RichCompare(__pyx_v_manual, Py_False, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1633, __pyx_L1_error)
      __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1633, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_14) {

        /* "vcstring.pyx":1634
 *                 sys.stdout.flush()
 *                 if manual == False:
 *                     hx = random.uniform(-delta, delta) # get random value to move z             # <<<<<<<<<<<<<<
 *                     hy = random.uniform(-delta, delta)
 *                 else:
 */
        __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_random); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1634, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_uniform); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1634, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_7 = PyFloat_FromDouble((-__pyx_v_delta)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1634, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_6 = PyFloat_FromDouble(__pyx_v_delta); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1634, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_10 = NULL;
        __pyx_t_15 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
          __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_4);
          if (likely(__pyx_t_10)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
            __Pyx_INCREF(__pyx_t_10);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_4, function);
            __pyx_t_15 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_7, __pyx_t_6};
          __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1634, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
          PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_7, __pyx_t_6};
          __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1634, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        {
          __pyx_t_5 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1634, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          if (__pyx_t_10) {
            __Pyx_GIVEREF(__pyx_t_10); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_10); __pyx_t_10 = NULL;
          }
          __Pyx_GIVEREF(__pyx_t_7);
          PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_15, __pyx_t_7);
          __Pyx_GIVEREF(__pyx_t_6);
          PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_15, __pyx_t_6);
          __pyx_t_7 = 0;
          __pyx_t_6 = 0;
          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1634, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        }
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1634, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_v_hx = __pyx_t_16;

        /* "vcstring.pyx":1635
 *                 if manual == False:
 *                     hx = random.uniform(-delta, delta) # get random value to move z
 *                     hy = random.uniform(-delta, delta)             # <<<<<<<<<<<<<<
 *                 else:
 *                     hx = hx_man  # MC with manually selected move
 */
        __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_random); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1635, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uniform); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1635, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_4 = PyFloat_FromDouble((-__pyx_v_delta)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1635, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_6 = PyFloat_FromDouble(__pyx_v_delta); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1635, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_7 = NULL;
        __pyx_t_15 = 0;
        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
          __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
          if (likely(__pyx_t_7)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
            __Pyx_INCREF(__pyx_t_7);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_5, function);
            __pyx_t_15 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_4, __pyx_t_6};
          __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1635, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
          PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_4, __pyx_t_6};
          __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1635, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        } else
        #endif
        {
          __pyx_t_10 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1635, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          if (__pyx_t_7) {
            __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_7); __pyx_t_7 = NULL;
          }
          __Pyx_GIVEREF(__pyx_t_4);
          PyTuple_SET_ITEM(__pyx_t_10, 0+__pyx_t_15, __pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_6);
          PyTuple_SET_ITEM(__pyx_t_10, 1+__pyx_t_15, __pyx_t_6);
          __pyx_t_4 = 0;
          __pyx_t_6 = 0;
          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_10, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1635, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        }
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1635, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_v_hy = __pyx_t_16;

        /* "vcstring.pyx":1633
 *                 print('-------------------------------')
 *                 sys.stdout.flush()
 *                 if manual == False:             # <<<<<<<<<<<<<<
 *                     hx = random.uniform(-delta, delta) # get random value to move z
 *                     hy = random.uniform(-delta, delta)
 */
        goto __pyx_L7;
      }

      /* "vcstring.pyx":1637
 *                     hy = random.uniform(-delta, delta)
 *                 else:
 *                     hx = hx_man  # MC with manually selected move             # <<<<<<<<<<<<<<
 *                     hy = hy_man
 *                     # hx = -0.026412443087807838  # testing
 */
      /*else*/ {
        __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_v_hx_man); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1637, __pyx_L1_error)
        __pyx_v_hx = __pyx_t_16;

        /* "vcstring.pyx":1638
 *                 else:
 *                     hx = hx_man  # MC with manually selected move
 *                     hy = hy_man             # <<<<<<<<<<<<<<
 *                     # hx = -0.026412443087807838  # testing
 *                     # hy = -0.004352538461786369  # testing
 */
        __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_v_hy_man); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1638, __pyx_L1_error)
        __pyx_v_hy = __pyx_t_16;
      }
      __pyx_L7:;

      /* "vcstring.pyx":1641
 *                     # hx = -0.026412443087807838  # testing
 *                     # hy = -0.004352538461786369  # testing
 *                 z[i][0] = z[i][0] + hx  # Update z             # <<<<<<<<<<<<<<
 *                 z[i][1] = z[i][1] + hy
 *                 z[ii][0] = z[ii][0] - hx
 */
      __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1641, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1641, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_hx); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1641, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_10 = PyNumber_Add(__pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1641, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1641, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (unlikely(__Pyx_SetItemInt(__pyx_t_1, 0, __pyx_t_10, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 1641, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

      /* "vcstring.pyx":1642
 *                     # hy = -0.004352538461786369  # testing
 *                 z[i][0] = z[i][0] + hx  # Update z
 *                 z[i][1] = z[i][1] + hy             # <<<<<<<<<<<<<<
 *                 z[ii][0] = z[ii][0] - hx
 *                 z[ii][1] = z[ii][1] - hy
 */
      __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1642, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1642, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = PyFloat_FromDouble(__pyx_v_hy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1642, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_5 = PyNumber_Add(__pyx_t_1, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1642, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1642, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      if (unlikely(__Pyx_SetItemInt(__pyx_t_10, 1, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 1642, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "vcstring.pyx":1643
 *                 z[i][0] = z[i][0] + hx  # Update z
 *                 z[i][1] = z[i][1] + hy
 *                 z[ii][0] = z[ii][0] - hx             # <<<<<<<<<<<<<<
 *                 z[ii][1] = z[ii][1] - hy
 *                 print('Image {0}: Moving position by {1} , {2}'.format(i, hx, hy))
 */
      __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1643, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_10 = __Pyx_GetItemInt(__pyx_t_5, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1643, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_hx); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1643, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_1 = PyNumber_Subtract(__pyx_t_10, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1643, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1643, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      if (unlikely(__Pyx_SetItemInt(__pyx_t_5, 0, __pyx_t_1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 1643, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":1644
 *                 z[i][1] = z[i][1] + hy
 *                 z[ii][0] = z[ii][0] - hx
 *                 z[ii][1] = z[ii][1] - hy             # <<<<<<<<<<<<<<
 *                 print('Image {0}: Moving position by {1} , {2}'.format(i, hx, hy))
 *                 print('New position for image {0}: {1} , {2}'.format(i, z[i][0], z[i][1]))
 */
      __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1644, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1644, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_hy); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1644, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_10 = PyNumber_Subtract(__pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1644, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1644, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (unlikely(__Pyx_SetItemInt(__pyx_t_1, 1, __pyx_t_10, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 1644, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

      /* "vcstring.pyx":1645
 *                 z[ii][0] = z[ii][0] - hx
 *                 z[ii][1] = z[ii][1] - hy
 *                 print('Image {0}: Moving position by {1} , {2}'.format(i, hx, hy))             # <<<<<<<<<<<<<<
 *                 print('New position for image {0}: {1} , {2}'.format(i, z[i][0], z[i][1]))
 *                 print('Image {0}: Moving position by {1} , {2}'.format(ii, -hx, -hy))
 */
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_Image_0_Moving_position_by_1_2, __pyx_n_s_format); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1645, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1645, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = PyFloat_FromDouble(__pyx_v_hx); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1645, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_4 = PyFloat_FromDouble(__pyx_v_hy); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1645, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_7 = NULL;
      __pyx_t_15 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_15 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[4] = {__pyx_t_7, __pyx_t_5, __pyx_t_6, __pyx_t_4};
        __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1645, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[4] = {__pyx_t_7, __pyx_t_5, __pyx_t_6, __pyx_t_4};
        __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1645, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      } else
      #endif
      {
        __pyx_t_3 = PyTuple_New(3+__pyx_t_15); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1645, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        if (__pyx_t_7) {
          __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_7); __pyx_t_7 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_15, __pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_15, __pyx_t_6);
        __Pyx_GIVEREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_3, 2+__pyx_t_15, __pyx_t_4);
        __pyx_t_5 = 0;
        __pyx_t_6 = 0;
        __pyx_t_4 = 0;
        __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1645, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1645, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":1646
 *                 z[ii][1] = z[ii][1] - hy
 *                 print('Image {0}: Moving position by {1} , {2}'.format(i, hx, hy))
 *                 print('New position for image {0}: {1} , {2}'.format(i, z[i][0], z[i][1]))             # <<<<<<<<<<<<<<
 *                 print('Image {0}: Moving position by {1} , {2}'.format(ii, -hx, -hy))
 *                 print('New position for image {0}: {1} , {2}'.format(ii, z[ii][0], z[ii][1]))
 */
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_New_position_for_image_0_1_2, __pyx_n_s_format); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1646, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1646, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1646, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_4, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1646, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1646, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_4, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1646, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = NULL;
      __pyx_t_15 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_10))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_10);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_10, function);
          __pyx_t_15 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_10)) {
        PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_t_3, __pyx_t_6, __pyx_t_5};
        __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1646, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
        PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_t_3, __pyx_t_6, __pyx_t_5};
        __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1646, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      } else
      #endif
      {
        __pyx_t_7 = PyTuple_New(3+__pyx_t_15); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1646, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        if (__pyx_t_4) {
          __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_4); __pyx_t_4 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_3);
        PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_15, __pyx_t_3);
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_15, __pyx_t_6);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_15, __pyx_t_5);
        __pyx_t_3 = 0;
        __pyx_t_6 = 0;
        __pyx_t_5 = 0;
        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1646, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      }
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1646, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

      /* "vcstring.pyx":1647
 *                 print('Image {0}: Moving position by {1} , {2}'.format(i, hx, hy))
 *                 print('New position for image {0}: {1} , {2}'.format(i, z[i][0], z[i][1]))
 *                 print('Image {0}: Moving position by {1} , {2}'.format(ii, -hx, -hy))             # <<<<<<<<<<<<<<
 *                 print('New position for image {0}: {1} , {2}'.format(ii, z[ii][0], z[ii][1]))
 *                 print('New string =\n', z)
 */
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_Image_0_Moving_position_by_1_2, __pyx_n_s_format); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1647, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_ii); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1647, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_5 = PyFloat_FromDouble((-__pyx_v_hx)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1647, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = PyFloat_FromDouble((-__pyx_v_hy)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1647, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_3 = NULL;
      __pyx_t_15 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_3)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_15 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_t_7, __pyx_t_5, __pyx_t_6};
        __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1647, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
        PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_t_7, __pyx_t_5, __pyx_t_6};
        __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1647, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      } else
      #endif
      {
        __pyx_t_4 = PyTuple_New(3+__pyx_t_15); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1647, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        if (__pyx_t_3) {
          __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3); __pyx_t_3 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_7);
        PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_15, __pyx_t_7);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_15, __pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_6);
        PyTuple_SET_ITEM(__pyx_t_4, 2+__pyx_t_15, __pyx_t_6);
        __pyx_t_7 = 0;
        __pyx_t_5 = 0;
        __pyx_t_6 = 0;
        __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1647, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1647, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":1648
 *                 print('New position for image {0}: {1} , {2}'.format(i, z[i][0], z[i][1]))
 *                 print('Image {0}: Moving position by {1} , {2}'.format(ii, -hx, -hy))
 *                 print('New position for image {0}: {1} , {2}'.format(ii, z[ii][0], z[ii][1]))             # <<<<<<<<<<<<<<
 *                 print('New string =\n', z)
 * 
 */
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_New_position_for_image_0_1_2, __pyx_n_s_format); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1648, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_ii); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1648, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_6 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1648, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1648, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1648, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1648, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = NULL;
      __pyx_t_15 = 0;
      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_10))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_10);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_10, function);
          __pyx_t_15 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (PyFunction_Check(__pyx_t_10)) {
        PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_t_4, __pyx_t_5, __pyx_t_7};
        __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1648, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
        PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_t_4, __pyx_t_5, __pyx_t_7};
        __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1648, __pyx_L1_error)
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      } else
      #endif
      {
        __pyx_t_3 = PyTuple_New(3+__pyx_t_15); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1648, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        if (__pyx_t_6) {
          __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_6); __pyx_t_6 = NULL;
        }
        __Pyx_GIVEREF(__pyx_t_4);
        PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_15, __pyx_t_4);
        __Pyx_GIVEREF(__pyx_t_5);
        PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_15, __pyx_t_5);
        __Pyx_GIVEREF(__pyx_t_7);
        PyTuple_SET_ITEM(__pyx_t_3, 2+__pyx_t_15, __pyx_t_7);
        __pyx_t_4 = 0;
        __pyx_t_5 = 0;
        __pyx_t_7 = 0;
        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1648, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      }
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1648, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

      /* "vcstring.pyx":1649
 *                 print('Image {0}: Moving position by {1} , {2}'.format(ii, -hx, -hy))
 *                 print('New position for image {0}: {1} , {2}'.format(ii, z[ii][0], z[ii][1]))
 *                 print('New string =\n', z)             # <<<<<<<<<<<<<<
 * 
 *                 # Reparametrization of string: images are equidistance from one another
 */
      __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1649, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_INCREF(__pyx_kp_u_New_string);
      __Pyx_GIVEREF(__pyx_kp_u_New_string);
      PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_kp_u_New_string);
      __Pyx_INCREF(((PyObject *)__pyx_v_z));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
      PyTuple_SET_ITEM(__pyx_t_10, 1, ((PyObject *)__pyx_v_z));
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_10, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1649, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "vcstring.pyx":1652
 * 
 *                 # Reparametrization of string: images are equidistance from one another
 *                 if reparm == True:             # <<<<<<<<<<<<<<
 *                     z = reparm_string(z)
 * 
 */
      __pyx_t_1 = PyObject_RichCompare(__pyx_v_reparm, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1652, __pyx_L1_error)
      __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1652, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_14) {

        /* "vcstring.pyx":1653
 *                 # Reparametrization of string: images are equidistance from one another
 *                 if reparm == True:
 *                     z = reparm_string(z)             # <<<<<<<<<<<<<<
 * 
 *                 # Check distance between neighboring beads
 */
        __pyx_t_1 = __pyx_f_8vcstring_reparm_string(((PyArrayObject *)__pyx_v_z), 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1653, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1653, __pyx_L1_error)
        __pyx_t_17 = ((PyArrayObject *)__pyx_t_1);
        {
          __Pyx_BufFmt_StackElem __pyx_stack[1];
          __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
          __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_t_17, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
          if (unlikely(__pyx_t_15 < 0)) {
            PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
            if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
              Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
              __Pyx_RaiseBufferFallbackError();
            } else {
              PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
            }
            __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
          }
          __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
          if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1653, __pyx_L1_error)
        }
        __pyx_t_17 = 0;
        __Pyx_DECREF_SET(__pyx_v_z, ((PyArrayObject *)__pyx_t_1));
        __pyx_t_1 = 0;

        /* "vcstring.pyx":1652
 * 
 *                 # Reparametrization of string: images are equidistance from one another
 *                 if reparm == True:             # <<<<<<<<<<<<<<
 *                     z = reparm_string(z)
 * 
 */
      }

      /* "vcstring.pyx":1656
 * 
 *                 # Check distance between neighboring beads
 *                 if mindist_constraint == True:             # <<<<<<<<<<<<<<
 *                     if i != 0 or i != len(z)-1:  # If not first or last image on the string
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 */
      __pyx_t_1 = PyObject_RichCompare(__pyx_v_mindist_constraint, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1656, __pyx_L1_error)
      __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1656, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_14) {

        /* "vcstring.pyx":1657
 *                 # Check distance between neighboring beads
 *                 if mindist_constraint == True:
 *                     if i != 0 or i != len(z)-1:  # If not first or last image on the string             # <<<<<<<<<<<<<<
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 *                         d2 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 */
        __pyx_t_21 = ((__pyx_v_i != 0) != 0);
        if (!__pyx_t_21) {
        } else {
          __pyx_t_14 = __pyx_t_21;
          goto __pyx_L11_bool_binop_done;
        }
        __pyx_t_22 = PyObject_Length(((PyObject *)__pyx_v_z)); if (unlikely(__pyx_t_22 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1657, __pyx_L1_error)
        __pyx_t_21 = ((__pyx_v_i != (__pyx_t_22 - 1)) != 0);
        __pyx_t_14 = __pyx_t_21;
        __pyx_L11_bool_binop_done:;
        if (__pyx_t_14) {

          /* "vcstring.pyx":1658
 *                 if mindist_constraint == True:
 *                     if i != 0 or i != len(z)-1:  # If not first or last image on the string
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)             # <<<<<<<<<<<<<<
 *                         d2 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 *                     elif i == 0:  # If first image on string
 */
          __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_math); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1658, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1658, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1658, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_10, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1658, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_23 = (__pyx_v_i - 1);
          __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_t_23, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1658, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_10, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1658, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = PyNumber_Subtract(__pyx_t_7, __pyx_t_5); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1658, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = PyNumber_Power(__pyx_t_10, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1658, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1658, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1658, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_23 = (__pyx_v_i - 1);
          __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_t_23, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1658, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1658, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = PyNumber_Subtract(__pyx_t_7, __pyx_t_4); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1658, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = PyNumber_Power(__pyx_t_10, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1658, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = PyNumber_Add(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1658, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
            __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
            if (likely(__pyx_t_4)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
              __Pyx_INCREF(__pyx_t_4);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_3, function);
            }
          }
          __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_10) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_10);
          __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1658, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1658, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_v_d1 = __pyx_t_16;

          /* "vcstring.pyx":1659
 *                     if i != 0 or i != len(z)-1:  # If not first or last image on the string
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 *                         d2 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)             # <<<<<<<<<<<<<<
 *                     elif i == 0:  # If first image on string
 *                         d1 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 */
          __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_math); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1659, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1659, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1659, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1659, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_23 = (__pyx_v_i + 1);
          __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_t_23, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1659, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1659, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = PyNumber_Subtract(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1659, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = PyNumber_Power(__pyx_t_3, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1659, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1659, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_3, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1659, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_23 = (__pyx_v_i + 1);
          __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_t_23, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1659, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_3, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1659, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = PyNumber_Subtract(__pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1659, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_7 = PyNumber_Power(__pyx_t_3, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1659, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = PyNumber_Add(__pyx_t_5, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1659, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_7 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
            __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_10);
            if (likely(__pyx_t_7)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
              __Pyx_INCREF(__pyx_t_7);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_10, function);
            }
          }
          __pyx_t_1 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_10, __pyx_t_7, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_t_3);
          __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1659, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1659, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_v_d2 = __pyx_t_16;

          /* "vcstring.pyx":1657
 *                 # Check distance between neighboring beads
 *                 if mindist_constraint == True:
 *                     if i != 0 or i != len(z)-1:  # If not first or last image on the string             # <<<<<<<<<<<<<<
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 *                         d2 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 */
          goto __pyx_L10;
        }

        /* "vcstring.pyx":1660
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 *                         d2 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 *                     elif i == 0:  # If first image on string             # <<<<<<<<<<<<<<
 *                         d1 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 *                         d2 = mindist
 */
        __pyx_t_14 = ((__pyx_v_i == 0) != 0);
        if (__pyx_t_14) {

          /* "vcstring.pyx":1661
 *                         d2 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 *                     elif i == 0:  # If first image on string
 *                         d1 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)             # <<<<<<<<<<<<<<
 *                         d2 = mindist
 *                     elif i == len(z)-1:  # If last image on string
 */
          __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_math); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1661, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1661, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1661, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_10, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1661, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_23 = (__pyx_v_i + 1);
          __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_t_23, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1661, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_10, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1661, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = PyNumber_Subtract(__pyx_t_7, __pyx_t_5); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1661, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = PyNumber_Power(__pyx_t_10, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1661, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1661, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1661, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_23 = (__pyx_v_i + 1);
          __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_t_23, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1661, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1661, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = PyNumber_Subtract(__pyx_t_7, __pyx_t_4); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1661, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = PyNumber_Power(__pyx_t_10, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1661, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = PyNumber_Add(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1661, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
            __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
            if (likely(__pyx_t_4)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
              __Pyx_INCREF(__pyx_t_4);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_3, function);
            }
          }
          __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_10) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_10);
          __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1661, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1661, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_v_d1 = __pyx_t_16;

          /* "vcstring.pyx":1662
 *                     elif i == 0:  # If first image on string
 *                         d1 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 *                         d2 = mindist             # <<<<<<<<<<<<<<
 *                     elif i == len(z)-1:  # If last image on string
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 */
          __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_v_mindist); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1662, __pyx_L1_error)
          __pyx_v_d2 = __pyx_t_16;

          /* "vcstring.pyx":1660
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 *                         d2 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 *                     elif i == 0:  # If first image on string             # <<<<<<<<<<<<<<
 *                         d1 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 *                         d2 = mindist
 */
          goto __pyx_L10;
        }

        /* "vcstring.pyx":1663
 *                         d1 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 *                         d2 = mindist
 *                     elif i == len(z)-1:  # If last image on string             # <<<<<<<<<<<<<<
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 *                         d2 = mindist
 */
        __pyx_t_22 = PyObject_Length(((PyObject *)__pyx_v_z)); if (unlikely(__pyx_t_22 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1663, __pyx_L1_error)
        __pyx_t_14 = ((__pyx_v_i == (__pyx_t_22 - 1)) != 0);
        if (__pyx_t_14) {

          /* "vcstring.pyx":1664
 *                         d2 = mindist
 *                     elif i == len(z)-1:  # If last image on string
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)             # <<<<<<<<<<<<<<
 *                         d2 = mindist
 *                     print('\nEnforcing minimum distance constraint')
 */
          __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_math); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1664, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1664, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1664, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1664, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_23 = (__pyx_v_i - 1);
          __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_t_23, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1664, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1664, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = PyNumber_Subtract(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1664, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = PyNumber_Power(__pyx_t_3, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1664, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1664, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_3, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1664, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_23 = (__pyx_v_i - 1);
          __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_t_23, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1664, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_3, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1664, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = PyNumber_Subtract(__pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1664, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_7 = PyNumber_Power(__pyx_t_3, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1664, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = PyNumber_Add(__pyx_t_5, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1664, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_7 = NULL;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
            __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_10);
            if (likely(__pyx_t_7)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
              __Pyx_INCREF(__pyx_t_7);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_10, function);
            }
          }
          __pyx_t_1 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_10, __pyx_t_7, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_t_3);
          __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1664, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1664, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_v_d1 = __pyx_t_16;

          /* "vcstring.pyx":1665
 *                     elif i == len(z)-1:  # If last image on string
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 *                         d2 = mindist             # <<<<<<<<<<<<<<
 *                     print('\nEnforcing minimum distance constraint')
 *                     print('Minimum distance allowed between images:', mindist)
 */
          __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_v_mindist); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1665, __pyx_L1_error)
          __pyx_v_d2 = __pyx_t_16;

          /* "vcstring.pyx":1663
 *                         d1 = math.sqrt((z[i][0] - z[i+1][0]) ** 2 + (z[i][1] - z[i+1][1]) ** 2)
 *                         d2 = mindist
 *                     elif i == len(z)-1:  # If last image on string             # <<<<<<<<<<<<<<
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 *                         d2 = mindist
 */
        }
        __pyx_L10:;

        /* "vcstring.pyx":1666
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 *                         d2 = mindist
 *                     print('\nEnforcing minimum distance constraint')             # <<<<<<<<<<<<<<
 *                     print('Minimum distance allowed between images:', mindist)
 *                     print('Distance to neighbhoring images:', d1, d2)
 */
        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__62, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1666, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

        /* "vcstring.pyx":1667
 *                         d2 = mindist
 *                     print('\nEnforcing minimum distance constraint')
 *                     print('Minimum distance allowed between images:', mindist)             # <<<<<<<<<<<<<<
 *                     print('Distance to neighbhoring images:', d1, d2)
 *                     if d1 < mindist or d2 < mindist:  # If smaller than the minimum distance allowed
 */
        __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1667, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_INCREF(__pyx_kp_u_Minimum_distance_allowed_between);
        __Pyx_GIVEREF(__pyx_kp_u_Minimum_distance_allowed_between);
        PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Minimum_distance_allowed_between);
        __Pyx_INCREF(__pyx_v_mindist);
        __Pyx_GIVEREF(__pyx_v_mindist);
        PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_mindist);
        __pyx_t_10 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1667, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

        /* "vcstring.pyx":1668
 *                     print('\nEnforcing minimum distance constraint')
 *                     print('Minimum distance allowed between images:', mindist)
 *                     print('Distance to neighbhoring images:', d1, d2)             # <<<<<<<<<<<<<<
 *                     if d1 < mindist or d2 < mindist:  # If smaller than the minimum distance allowed
 *                         z[i][0] = z[i][0] - hx  # Move back to original position
 */
        __pyx_t_10 = PyFloat_FromDouble(__pyx_v_d1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1668, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_1 = PyFloat_FromDouble(__pyx_v_d2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1668, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1668, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_kp_u_Distance_to_neighbhoring_images);
        __Pyx_GIVEREF(__pyx_kp_u_Distance_to_neighbhoring_images);
        PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_u_Distance_to_neighbhoring_images);
        __Pyx_GIVEREF(__pyx_t_10);
        PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_10);
        __Pyx_GIVEREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_t_1);
        __pyx_t_10 = 0;
        __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1668, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

        /* "vcstring.pyx":1669
 *                     print('Minimum distance allowed between images:', mindist)
 *                     print('Distance to neighbhoring images:', d1, d2)
 *                     if d1 < mindist or d2 < mindist:  # If smaller than the minimum distance allowed             # <<<<<<<<<<<<<<
 *                         z[i][0] = z[i][0] - hx  # Move back to original position
 *                         z[i][1] = z[i][1] - hy
 */
        __pyx_t_1 = PyFloat_FromDouble(__pyx_v_d1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1669, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_v_mindist, Py_LT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1669, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 1669, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        if (!__pyx_t_21) {
        } else {
          __pyx_t_14 = __pyx_t_21;
          goto __pyx_L14_bool_binop_done;
        }
        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_d2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1669, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_v_mindist, Py_LT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1669, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 1669, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_14 = __pyx_t_21;
        __pyx_L14_bool_binop_done:;
        if (__pyx_t_14) {

          /* "vcstring.pyx":1670
 *                     print('Distance to neighbhoring images:', d1, d2)
 *                     if d1 < mindist or d2 < mindist:  # If smaller than the minimum distance allowed
 *                         z[i][0] = z[i][0] - hx  # Move back to original position             # <<<<<<<<<<<<<<
 *                         z[i][1] = z[i][1] - hy
 *                         z[ii][0] = z[ii][0] + hx
 */
          __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1670, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1670, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = PyFloat_FromDouble(__pyx_v_hx); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1670, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_10 = PyNumber_Subtract(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1670, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1670, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          if (unlikely(__Pyx_SetItemInt(__pyx_t_1, 0, __pyx_t_10, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 1670, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

          /* "vcstring.pyx":1671
 *                     if d1 < mindist or d2 < mindist:  # If smaller than the minimum distance allowed
 *                         z[i][0] = z[i][0] - hx  # Move back to original position
 *                         z[i][1] = z[i][1] - hy             # <<<<<<<<<<<<<<
 *                         z[ii][0] = z[ii][0] + hx
 *                         z[ii][1] = z[ii][1] + hy
 */
          __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1671, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1671, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = PyFloat_FromDouble(__pyx_v_hy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1671, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_3 = PyNumber_Subtract(__pyx_t_1, __pyx_t_10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1671, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1671, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          if (unlikely(__Pyx_SetItemInt(__pyx_t_10, 1, __pyx_t_3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 1671, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

          /* "vcstring.pyx":1672
 *                         z[i][0] = z[i][0] - hx  # Move back to original position
 *                         z[i][1] = z[i][1] - hy
 *                         z[ii][0] = z[ii][0] + hx             # <<<<<<<<<<<<<<
 *                         z[ii][1] = z[ii][1] + hy
 *                         print('Rejected: Moved position by {0} , {1}. Too close to neighboring images.'.format(hx, hy))
 */
          __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1672, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_10 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1672, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = PyFloat_FromDouble(__pyx_v_hx); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1672, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_1 = PyNumber_Add(__pyx_t_10, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1672, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1672, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          if (unlikely(__Pyx_SetItemInt(__pyx_t_3, 0, __pyx_t_1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 1672, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

          /* "vcstring.pyx":1673
 *                         z[i][1] = z[i][1] - hy
 *                         z[ii][0] = z[ii][0] + hx
 *                         z[ii][1] = z[ii][1] + hy             # <<<<<<<<<<<<<<
 *                         print('Rejected: Moved position by {0} , {1}. Too close to neighboring images.'.format(hx, hy))
 *                         continue
 */
          __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1673, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1673, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = PyFloat_FromDouble(__pyx_v_hy); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1673, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_10 = PyNumber_Add(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1673, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1673, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          if (unlikely(__Pyx_SetItemInt(__pyx_t_1, 1, __pyx_t_10, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 1673, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

          /* "vcstring.pyx":1674
 *                         z[ii][0] = z[ii][0] + hx
 *                         z[ii][1] = z[ii][1] + hy
 *                         print('Rejected: Moved position by {0} , {1}. Too close to neighboring images.'.format(hx, hy))             # <<<<<<<<<<<<<<
 *                         continue
 * 
 */
          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_Rejected_Moved_position_by_0_1_T, __pyx_n_s_format); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1674, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_3 = PyFloat_FromDouble(__pyx_v_hx); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1674, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_7 = PyFloat_FromDouble(__pyx_v_hy); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1674, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_5 = NULL;
          __pyx_t_15 = 0;
          if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
            __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
            if (likely(__pyx_t_5)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
              __Pyx_INCREF(__pyx_t_5);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_1, function);
              __pyx_t_15 = 1;
            }
          }
          #if CYTHON_FAST_PYCALL
          if (PyFunction_Check(__pyx_t_1)) {
            PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_3, __pyx_t_7};
            __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1674, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
            __Pyx_GOTREF(__pyx_t_10);
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
            PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_3, __pyx_t_7};
            __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1674, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
            __Pyx_GOTREF(__pyx_t_10);
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          } else
          #endif
          {
            __pyx_t_4 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1674, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_4);
            if (__pyx_t_5) {
              __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5); __pyx_t_5 = NULL;
            }
            __Pyx_GIVEREF(__pyx_t_3);
            PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_15, __pyx_t_3);
            __Pyx_GIVEREF(__pyx_t_7);
            PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_15, __pyx_t_7);
            __pyx_t_3 = 0;
            __pyx_t_7 = 0;
            __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1674, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_10);
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          }
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1674, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

          /* "vcstring.pyx":1675
 *                         z[ii][1] = z[ii][1] + hy
 *                         print('Rejected: Moved position by {0} , {1}. Too close to neighboring images.'.format(hx, hy))
 *                         continue             # <<<<<<<<<<<<<<
 * 
 *                 # Solve linear equation and correlation function
 */
          goto __pyx_L5_continue;

          /* "vcstring.pyx":1669
 *                     print('Minimum distance allowed between images:', mindist)
 *                     print('Distance to neighbhoring images:', d1, d2)
 *                     if d1 < mindist or d2 < mindist:  # If smaller than the minimum distance allowed             # <<<<<<<<<<<<<<
 *                         z[i][0] = z[i][0] - hx  # Move back to original position
 *                         z[i][1] = z[i][1] - hy
 */
        }

        /* "vcstring.pyx":1656
 * 
 *                 # Check distance between neighboring beads
 *                 if mindist_constraint == True:             # <<<<<<<<<<<<<<
 *                     if i != 0 or i != len(z)-1:  # If not first or last image on the string
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 */
      }

      /* "vcstring.pyx":1678
 * 
 *                 # Solve linear equation and correlation function
 *                 if accelerated == True:             # <<<<<<<<<<<<<<
 *                     if (i != 0) and (it != 1): # If not the 1st image of the 1st iteration
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs_accelerated(i, traj, tau, z)
 */
      __pyx_t_1 = PyObject_RichCompare(__pyx_v_accelerated, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1678, __pyx_L1_error)
      __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1678, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_14) {

        /* "vcstring.pyx":1679
 *                 # Solve linear equation and correlation function
 *                 if accelerated == True:
 *                     if (i != 0) and (it != 1): # If not the 1st image of the 1st iteration             # <<<<<<<<<<<<<<
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs_accelerated(i, traj, tau, z)
 *                 else:
 */
        __pyx_t_21 = ((__pyx_v_i != 0) != 0);
        if (__pyx_t_21) {
        } else {
          __pyx_t_14 = __pyx_t_21;
          goto __pyx_L18_bool_binop_done;
        }
        __pyx_t_21 = ((__pyx_v_it != 1) != 0);
        __pyx_t_14 = __pyx_t_21;
        __pyx_L18_bool_binop_done:;
        if (__pyx_t_14) {

          /* "vcstring.pyx":1680
 *                 if accelerated == True:
 *                     if (i != 0) and (it != 1): # If not the 1st image of the 1st iteration
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs_accelerated(i, traj, tau, z)             # <<<<<<<<<<<<<<
 *                 else:
 *                     # print('State assignment:', self.state_assignment)
 */
          __pyx_t_1 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->calc_coeffs_accelerated(__pyx_v_self, __pyx_v_i, __pyx_v_traj, __pyx_v_tau, ((PyArrayObject *)__pyx_v_z), 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1680, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
            PyObject* sequence = __pyx_t_1;
            Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
            if (unlikely(size != 5)) {
              if (size > 5) __Pyx_RaiseTooManyValuesError(5);
              else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
              __PYX_ERR(0, 1680, __pyx_L1_error)
            }
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            if (likely(PyTuple_CheckExact(sequence))) {
              __pyx_t_10 = PyTuple_GET_ITEM(sequence, 0); 
              __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
              __pyx_t_7 = PyTuple_GET_ITEM(sequence, 2); 
              __pyx_t_3 = PyTuple_GET_ITEM(sequence, 3); 
              __pyx_t_5 = PyTuple_GET_ITEM(sequence, 4); 
            } else {
              __pyx_t_10 = PyList_GET_ITEM(sequence, 0); 
              __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
              __pyx_t_7 = PyList_GET_ITEM(sequence, 2); 
              __pyx_t_3 = PyList_GET_ITEM(sequence, 3); 
              __pyx_t_5 = PyList_GET_ITEM(sequence, 4); 
            }
            __Pyx_INCREF(__pyx_t_10);
            __Pyx_INCREF(__pyx_t_4);
            __Pyx_INCREF(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_3);
            __Pyx_INCREF(__pyx_t_5);
            #else
            {
              Py_ssize_t i;
              PyObject** temps[5] = {&__pyx_t_10,&__pyx_t_4,&__pyx_t_7,&__pyx_t_3,&__pyx_t_5};
              for (i=0; i < 5; i++) {
                PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) __PYX_ERR(0, 1680, __pyx_L1_error)
                __Pyx_GOTREF(item);
                *(temps[i]) = item;
              }
            }
            #endif
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          } else {
            Py_ssize_t index = -1;
            PyObject** temps[5] = {&__pyx_t_10,&__pyx_t_4,&__pyx_t_7,&__pyx_t_3,&__pyx_t_5};
            __pyx_t_6 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1680, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_6);
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
            __pyx_t_24 = Py_TYPE(__pyx_t_6)->tp_iternext;
            for (index=0; index < 5; index++) {
              PyObject* item = __pyx_t_24(__pyx_t_6); if (unlikely(!item)) goto __pyx_L20_unpacking_failed;
              __Pyx_GOTREF(item);
              *(temps[index]) = item;
            }
            if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_6), 5) < 0) __PYX_ERR(0, 1680, __pyx_L1_error)
            __pyx_t_24 = NULL;
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
            goto __pyx_L21_unpacking_done;
            __pyx_L20_unpacking_failed:;
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
            __pyx_t_24 = NULL;
            if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
            __PYX_ERR(0, 1680, __pyx_L1_error)
            __pyx_L21_unpacking_done:;
          }
          if (!(likely(((__pyx_t_10) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_10, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1680, __pyx_L1_error)
          if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1680, __pyx_L1_error)
          if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1680, __pyx_L1_error)
          if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1680, __pyx_L1_error)
          if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1680, __pyx_L1_error)
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_10);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1680, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_XDECREF_SET(__pyx_v_b, ((PyArrayObject *)__pyx_t_10));
          __pyx_t_10 = 0;
          __pyx_t_26 = ((PyArrayObject *)__pyx_t_4);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
              }
              __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
            }
            __pyx_pybuffernd_D_0.diminfo[0].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0.diminfo[0].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0.diminfo[1].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0.diminfo[1].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[1];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1680, __pyx_L1_error)
          }
          __pyx_t_26 = 0;
          __Pyx_XDECREF_SET(__pyx_v_D_0, ((PyArrayObject *)__pyx_t_4));
          __pyx_t_4 = 0;
          __pyx_t_26 = ((PyArrayObject *)__pyx_t_7);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_D_tau.diminfo[0].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau.diminfo[0].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau.diminfo[1].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau.diminfo[1].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[1];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1680, __pyx_L1_error)
          }
          __pyx_t_26 = 0;
          __Pyx_XDECREF_SET(__pyx_v_D_tau, ((PyArrayObject *)__pyx_t_7));
          __pyx_t_7 = 0;
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_3);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
              }
              __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
            }
            __pyx_pybuffernd_g_0.diminfo[0].strides = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_0.diminfo[0].shape = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1680, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_XDECREF_SET(__pyx_v_g_0, ((PyArrayObject *)__pyx_t_3));
          __pyx_t_3 = 0;
          __pyx_t_25 = ((PyArrayObject *)__pyx_t_5);
          {
            __Pyx_BufFmt_StackElem __pyx_stack[1];
            __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
            __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
            if (unlikely(__pyx_t_15 < 0)) {
              PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
              if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
                Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
                __Pyx_RaiseBufferFallbackError();
              } else {
                PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
              }
              __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
            }
            __pyx_pybuffernd_g_tau.diminfo[0].strides = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_tau.diminfo[0].shape = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.shape[0];
            if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1680, __pyx_L1_error)
          }
          __pyx_t_25 = 0;
          __Pyx_XDECREF_SET(__pyx_v_g_tau, ((PyArrayObject *)__pyx_t_5));
          __pyx_t_5 = 0;

          /* "vcstring.pyx":1679
 *                 # Solve linear equation and correlation function
 *                 if accelerated == True:
 *                     if (i != 0) and (it != 1): # If not the 1st image of the 1st iteration             # <<<<<<<<<<<<<<
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs_accelerated(i, traj, tau, z)
 *                 else:
 */
        }

        /* "vcstring.pyx":1678
 * 
 *                 # Solve linear equation and correlation function
 *                 if accelerated == True:             # <<<<<<<<<<<<<<
 *                     if (i != 0) and (it != 1): # If not the 1st image of the 1st iteration
 *                         b, D_0, D_tau, g_0, g_tau = self.calc_coeffs_accelerated(i, traj, tau, z)
 */
        goto __pyx_L16;
      }

      /* "vcstring.pyx":1683
 *                 else:
 *                     # print('State assignment:', self.state_assignment)
 *                     ids = self.assign_states(traj, tau, z)  # Reassign states since z is changed             # <<<<<<<<<<<<<<
 *                     b, D_0, D_tau, g_0, g_tau = self.calc_coeffs(N, tau, z, ids, symmetric=True)
 * 
 */
      /*else*/ {
        __pyx_t_1 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->assign_states(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, ((PyArrayObject *)__pyx_v_z), 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1683, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1683, __pyx_L1_error)
        __pyx_t_26 = ((PyArrayObject *)__pyx_t_1);
        {
          __Pyx_BufFmt_StackElem __pyx_stack[1];
          __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
          __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
          if (unlikely(__pyx_t_15 < 0)) {
            PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
            if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ids.rcbuffer->pybuffer, (PyObject*)__pyx_v_ids, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
              Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
              __Pyx_RaiseBufferFallbackError();
            } else {
              PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
            }
            __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
          }
          __pyx_pybuffernd_ids.diminfo[0].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ids.diminfo[0].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_ids.diminfo[1].strides = __pyx_pybuffernd_ids.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_ids.diminfo[1].shape = __pyx_pybuffernd_ids.rcbuffer->pybuffer.shape[1];
          if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1683, __pyx_L1_error)
        }
        __pyx_t_26 = 0;
        __Pyx_XDECREF_SET(__pyx_v_ids, ((PyArrayObject *)__pyx_t_1));
        __pyx_t_1 = 0;

        /* "vcstring.pyx":1684
 *                     # print('State assignment:', self.state_assignment)
 *                     ids = self.assign_states(traj, tau, z)  # Reassign states since z is changed
 *                     b, D_0, D_tau, g_0, g_tau = self.calc_coeffs(N, tau, z, ids, symmetric=True)             # <<<<<<<<<<<<<<
 * 
 *                 # Calculate correlation function
 */
        __pyx_t_27.__pyx_n = 1;
        __pyx_t_27.symmetric = Py_True;
        __pyx_t_1 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->calc_coeffs(__pyx_v_self, __pyx_v_N, __pyx_v_tau, ((PyArrayObject *)__pyx_v_z), ((PyArrayObject *)__pyx_v_ids), 0, &__pyx_t_27); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1684, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
          PyObject* sequence = __pyx_t_1;
          Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
          if (unlikely(size != 5)) {
            if (size > 5) __Pyx_RaiseTooManyValuesError(5);
            else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
            __PYX_ERR(0, 1684, __pyx_L1_error)
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          if (likely(PyTuple_CheckExact(sequence))) {
            __pyx_t_5 = PyTuple_GET_ITEM(sequence, 0); 
            __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
            __pyx_t_7 = PyTuple_GET_ITEM(sequence, 2); 
            __pyx_t_4 = PyTuple_GET_ITEM(sequence, 3); 
            __pyx_t_10 = PyTuple_GET_ITEM(sequence, 4); 
          } else {
            __pyx_t_5 = PyList_GET_ITEM(sequence, 0); 
            __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
            __pyx_t_7 = PyList_GET_ITEM(sequence, 2); 
            __pyx_t_4 = PyList_GET_ITEM(sequence, 3); 
            __pyx_t_10 = PyList_GET_ITEM(sequence, 4); 
          }
          __Pyx_INCREF(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_10);
          #else
          {
            Py_ssize_t i;
            PyObject** temps[5] = {&__pyx_t_5,&__pyx_t_3,&__pyx_t_7,&__pyx_t_4,&__pyx_t_10};
            for (i=0; i < 5; i++) {
              PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) __PYX_ERR(0, 1684, __pyx_L1_error)
              __Pyx_GOTREF(item);
              *(temps[i]) = item;
            }
          }
          #endif
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        } else {
          Py_ssize_t index = -1;
          PyObject** temps[5] = {&__pyx_t_5,&__pyx_t_3,&__pyx_t_7,&__pyx_t_4,&__pyx_t_10};
          __pyx_t_6 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1684, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_24 = Py_TYPE(__pyx_t_6)->tp_iternext;
          for (index=0; index < 5; index++) {
            PyObject* item = __pyx_t_24(__pyx_t_6); if (unlikely(!item)) goto __pyx_L22_unpacking_failed;
            __Pyx_GOTREF(item);
            *(temps[index]) = item;
          }
          if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_6), 5) < 0) __PYX_ERR(0, 1684, __pyx_L1_error)
          __pyx_t_24 = NULL;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          goto __pyx_L23_unpacking_done;
          __pyx_L22_unpacking_failed:;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          __pyx_t_24 = NULL;
          if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
          __PYX_ERR(0, 1684, __pyx_L1_error)
          __pyx_L23_unpacking_done:;
        }
        if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1684, __pyx_L1_error)
        if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1684, __pyx_L1_error)
        if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1684, __pyx_L1_error)
        if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1684, __pyx_L1_error)
        if (!(likely(((__pyx_t_10) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_10, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1684, __pyx_L1_error)
        __pyx_t_25 = ((PyArrayObject *)__pyx_t_5);
        {
          __Pyx_BufFmt_StackElem __pyx_stack[1];
          __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
          __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
          if (unlikely(__pyx_t_15 < 0)) {
            PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
            if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
              Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
              __Pyx_RaiseBufferFallbackError();
            } else {
              PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
            }
            __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
          }
          __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];
          if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1684, __pyx_L1_error)
        }
        __pyx_t_25 = 0;
        __Pyx_XDECREF_SET(__pyx_v_b, ((PyArrayObject *)__pyx_t_5));
        __pyx_t_5 = 0;
        __pyx_t_26 = ((PyArrayObject *)__pyx_t_3);
        {
          __Pyx_BufFmt_StackElem __pyx_stack[1];
          __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
          __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
          if (unlikely(__pyx_t_15 < 0)) {
            PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
            if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
              Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
              __Pyx_RaiseBufferFallbackError();
            } else {
              PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
            }
            __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
          }
          __pyx_pybuffernd_D_0.diminfo[0].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_0.diminfo[0].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_0.diminfo[1].strides = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_0.diminfo[1].shape = __pyx_pybuffernd_D_0.rcbuffer->pybuffer.shape[1];
          if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1684, __pyx_L1_error)
        }
        __pyx_t_26 = 0;
        __Pyx_XDECREF_SET(__pyx_v_D_0, ((PyArrayObject *)__pyx_t_3));
        __pyx_t_3 = 0;
        __pyx_t_26 = ((PyArrayObject *)__pyx_t_7);
        {
          __Pyx_BufFmt_StackElem __pyx_stack[1];
          __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
          __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_26, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
          if (unlikely(__pyx_t_15 < 0)) {
            PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
            if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_D_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
              Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
              __Pyx_RaiseBufferFallbackError();
            } else {
              PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
            }
            __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
          }
          __pyx_pybuffernd_D_tau.diminfo[0].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_D_tau.diminfo[0].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_D_tau.diminfo[1].strides = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_D_tau.diminfo[1].shape = __pyx_pybuffernd_D_tau.rcbuffer->pybuffer.shape[1];
          if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1684, __pyx_L1_error)
        }
        __pyx_t_26 = 0;
        __Pyx_XDECREF_SET(__pyx_v_D_tau, ((PyArrayObject *)__pyx_t_7));
        __pyx_t_7 = 0;
        __pyx_t_25 = ((PyArrayObject *)__pyx_t_4);
        {
          __Pyx_BufFmt_StackElem __pyx_stack[1];
          __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
          __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
          if (unlikely(__pyx_t_15 < 0)) {
            PyErr_Fetch(&__pyx_t_18, &__pyx_t_19, &__pyx_t_20);
            if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_0, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
              Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_20);
              __Pyx_RaiseBufferFallbackError();
            } else {
              PyErr_Restore(__pyx_t_18, __pyx_t_19, __pyx_t_20);
            }
            __pyx_t_18 = __pyx_t_19 = __pyx_t_20 = 0;
          }
          __pyx_pybuffernd_g_0.diminfo[0].strides = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_0.diminfo[0].shape = __pyx_pybuffernd_g_0.rcbuffer->pybuffer.shape[0];
          if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1684, __pyx_L1_error)
        }
        __pyx_t_25 = 0;
        __Pyx_XDECREF_SET(__pyx_v_g_0, ((PyArrayObject *)__pyx_t_4));
        __pyx_t_4 = 0;
        __pyx_t_25 = ((PyArrayObject *)__pyx_t_10);
        {
          __Pyx_BufFmt_StackElem __pyx_stack[1];
          __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
          __pyx_t_15 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_t_25, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
          if (unlikely(__pyx_t_15 < 0)) {
            PyErr_Fetch(&__pyx_t_20, &__pyx_t_19, &__pyx_t_18);
            if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer, (PyObject*)__pyx_v_g_tau, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
              Py_XDECREF(__pyx_t_20); Py_XDECREF(__pyx_t_19); Py_XDECREF(__pyx_t_18);
              __Pyx_RaiseBufferFallbackError();
            } else {
              PyErr_Restore(__pyx_t_20, __pyx_t_19, __pyx_t_18);
            }
            __pyx_t_20 = __pyx_t_19 = __pyx_t_18 = 0;
          }
          __pyx_pybuffernd_g_tau.diminfo[0].strides = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_g_tau.diminfo[0].shape = __pyx_pybuffernd_g_tau.rcbuffer->pybuffer.shape[0];
          if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 1684, __pyx_L1_error)
        }
        __pyx_t_25 = 0;
        __Pyx_XDECREF_SET(__pyx_v_g_tau, ((PyArrayObject *)__pyx_t_10));
        __pyx_t_10 = 0;
      }
      __pyx_L16:;

      /* "vcstring.pyx":1687
 * 
 *                 # Calculate correlation function
 *                 if corr_method == 'matrix_elements':             # <<<<<<<<<<<<<<
 *                     Cnew = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)
 *                 elif corr_method == 'q2':
 */
      __pyx_t_14 = (__Pyx_PyUnicode_Equals(__pyx_v_corr_method, __pyx_n_u_matrix_elements, Py_EQ)); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1687, __pyx_L1_error)
      if (__pyx_t_14) {

        /* "vcstring.pyx":1688
 *                 # Calculate correlation function
 *                 if corr_method == 'matrix_elements':
 *                     Cnew = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)             # <<<<<<<<<<<<<<
 *                 elif corr_method == 'q2':
 *                     Cnew = self.calc_corr_q2(traj, tau, b, ids)
 */
        __pyx_t_1 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->calc_corr(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, ((PyArrayObject *)__pyx_v_b), ((PyArrayObject *)__pyx_v_D_0), ((PyArrayObject *)__pyx_v_D_tau), ((PyArrayObject *)__pyx_v_g_0), ((PyArrayObject *)__pyx_v_g_tau), 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1688, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1688, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_v_Cnew = __pyx_t_16;

        /* "vcstring.pyx":1687
 * 
 *                 # Calculate correlation function
 *                 if corr_method == 'matrix_elements':             # <<<<<<<<<<<<<<
 *                     Cnew = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)
 *                 elif corr_method == 'q2':
 */
        goto __pyx_L24;
      }

      /* "vcstring.pyx":1689
 *                 if corr_method == 'matrix_elements':
 *                     Cnew = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)
 *                 elif corr_method == 'q2':             # <<<<<<<<<<<<<<
 *                     Cnew = self.calc_corr_q2(traj, tau, b, ids)
 *                 # Accept or reject the move
 */
      __pyx_t_14 = (__Pyx_PyUnicode_Equals(__pyx_v_corr_method, __pyx_n_u_q2, Py_EQ)); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1689, __pyx_L1_error)
      if (__pyx_t_14) {

        /* "vcstring.pyx":1690
 *                     Cnew = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)
 *                 elif corr_method == 'q2':
 *                     Cnew = self.calc_corr_q2(traj, tau, b, ids)             # <<<<<<<<<<<<<<
 *                 # Accept or reject the move
 *                 if Cnew < target:
 */
        __pyx_t_1 = ((struct __pyx_vtabstruct_8vcstring_vcstring *)__pyx_v_self->__pyx_vtab)->calc_corr_q2(__pyx_v_self, __pyx_v_traj, __pyx_v_tau, ((PyArrayObject *)__pyx_v_b), ((PyArrayObject *)__pyx_v_ids), 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1690, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_16 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_16 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1690, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_v_Cnew = __pyx_t_16;

        /* "vcstring.pyx":1689
 *                 if corr_method == 'matrix_elements':
 *                     Cnew = self.calc_corr(traj, tau, b, D_0, D_tau, g_0, g_tau)
 *                 elif corr_method == 'q2':             # <<<<<<<<<<<<<<
 *                     Cnew = self.calc_corr_q2(traj, tau, b, ids)
 *                 # Accept or reject the move
 */
      }
      __pyx_L24:;

      /* "vcstring.pyx":1692
 *                     Cnew = self.calc_corr_q2(traj, tau, b, ids)
 *                 # Accept or reject the move
 *                 if Cnew < target:             # <<<<<<<<<<<<<<
 *                     MC_list.extend([hx, hy, Cnew, z[i][0], z[i][1], z[ii][0], z[ii][1]])
 *                     if save == True:
 */
      __pyx_t_14 = ((__pyx_v_Cnew < __pyx_v_target) != 0);
      if (__pyx_t_14) {

        /* "vcstring.pyx":1693
 *                 # Accept or reject the move
 *                 if Cnew < target:
 *                     MC_list.extend([hx, hy, Cnew, z[i][0], z[i][1], z[ii][0], z[ii][1]])             # <<<<<<<<<<<<<<
 *                     if save == True:
 *                         np.savetxt('output/mc.txt', MC_list)
 */
        __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1693, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_10 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1693, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1693, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1693, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1693, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1693, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1693, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1693, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = PyFloat_FromDouble(__pyx_v_hx); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1693, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_28 = __Pyx_ListComp_Append(__pyx_v_MC_list, __pyx_t_1); if (unlikely(__pyx_t_28 == ((int)-1))) __PYX_ERR(0, 1693, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = PyFloat_FromDouble(__pyx_v_hy); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1693, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_29 = __Pyx_ListComp_Append(__pyx_v_MC_list, __pyx_t_1); if (unlikely(__pyx_t_29 == ((int)-1))) __PYX_ERR(0, 1693, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = PyFloat_FromDouble(__pyx_v_Cnew); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1693, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_30 = __Pyx_ListComp_Append(__pyx_v_MC_list, __pyx_t_1); if (unlikely(__pyx_t_30 == ((int)-1))) __PYX_ERR(0, 1693, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_31 = __Pyx_ListComp_Append(__pyx_v_MC_list, __pyx_t_10); if (unlikely(__pyx_t_31 == ((int)-1))) __PYX_ERR(0, 1693, __pyx_L1_error)
        __pyx_t_32 = __Pyx_ListComp_Append(__pyx_v_MC_list, __pyx_t_4); if (unlikely(__pyx_t_32 == ((int)-1))) __PYX_ERR(0, 1693, __pyx_L1_error)
        __pyx_t_33 = __Pyx_ListComp_Append(__pyx_v_MC_list, __pyx_t_7); if (unlikely(__pyx_t_33 == ((int)-1))) __PYX_ERR(0, 1693, __pyx_L1_error)
        __pyx_t_34 = __Pyx_PyList_Append(__pyx_v_MC_list, __pyx_t_3); if (unlikely(__pyx_t_34 == ((int)-1))) __PYX_ERR(0, 1693, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        (void)((__pyx_t_28 | (__pyx_t_29 | (__pyx_t_30 | (__pyx_t_31 | (__pyx_t_32 | (__pyx_t_33 | __pyx_t_34)))))));

        /* "vcstring.pyx":1694
 *                 if Cnew < target:
 *                     MC_list.extend([hx, hy, Cnew, z[i][0], z[i][1], z[ii][0], z[ii][1]])
 *                     if save == True:             # <<<<<<<<<<<<<<
 *                         np.savetxt('output/mc.txt', MC_list)
 *                         np.savetxt('output/z_new.txt', z)
 */
        __pyx_t_10 = PyObject_RichCompare(__pyx_v_save, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1694, __pyx_L1_error)
        __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_10); if (unlikely(__pyx_t_14 < 0)) __PYX_ERR(0, 1694, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        if (__pyx_t_14) {

          /* "vcstring.pyx":1695
 *                     MC_list.extend([hx, hy, Cnew, z[i][0], z[i][1], z[ii][0], z[ii][1]])
 *                     if save == True:
 *                         np.savetxt('output/mc.txt', MC_list)             # <<<<<<<<<<<<<<
 *                         np.savetxt('output/z_new.txt', z)
 *                         np.savetxt('output/C_new.txt', [Cnew])
 */
          __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1695, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_savetxt); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1695, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_4 = NULL;
          __pyx_t_15 = 0;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
            __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_7);
            if (likely(__pyx_t_4)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
              __Pyx_INCREF(__pyx_t_4);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_7, function);
              __pyx_t_15 = 1;
            }
          }
          #if CYTHON_FAST_PYCALL
          if (PyFunction_Check(__pyx_t_7)) {
            PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_kp_u_output_mc_txt, __pyx_v_MC_list};
            __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1695, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
            __Pyx_GOTREF(__pyx_t_10);
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
            PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_kp_u_output_mc_txt, __pyx_v_MC_list};
            __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1695, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
            __Pyx_GOTREF(__pyx_t_10);
          } else
          #endif
          {
            __pyx_t_3 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1695, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_3);
            if (__pyx_t_4) {
              __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4); __pyx_t_4 = NULL;
            }
            __Pyx_INCREF(__pyx_kp_u_output_mc_txt);
            __Pyx_GIVEREF(__pyx_kp_u_output_mc_txt);
            PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_15, __pyx_kp_u_output_mc_txt);
            __Pyx_INCREF(__pyx_v_MC_list);
            __Pyx_GIVEREF(__pyx_v_MC_list);
            PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_15, __pyx_v_MC_list);
            __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_3, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1695, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_10);
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          }
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

          /* "vcstring.pyx":1696
 *                     if save == True:
 *                         np.savetxt('output/mc.txt', MC_list)
 *                         np.savetxt('output/z_new.txt', z)             # <<<<<<<<<<<<<<
 *                         np.savetxt('output/C_new.txt', [Cnew])
 *                         np.savez('output/coeffs_new.npz',
 */
          __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1696, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_savetxt); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1696, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_7 = NULL;
          __pyx_t_15 = 0;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
            __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
            if (likely(__pyx_t_7)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
              __Pyx_INCREF(__pyx_t_7);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_3, function);
              __pyx_t_15 = 1;
            }
          }
          #if CYTHON_FAST_PYCALL
          if (PyFunction_Check(__pyx_t_3)) {
            PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_kp_u_output_z_new_txt, ((PyObject *)__pyx_v_z)};
            __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1696, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
            __Pyx_GOTREF(__pyx_t_10);
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
            PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_kp_u_output_z_new_txt, ((PyObject *)__pyx_v_z)};
            __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1696, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
            __Pyx_GOTREF(__pyx_t_10);
          } else
          #endif
          {
            __pyx_t_4 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1696, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_4);
            if (__pyx_t_7) {
              __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_7); __pyx_t_7 = NULL;
            }
            __Pyx_INCREF(__pyx_kp_u_output_z_new_txt);
            __Pyx_GIVEREF(__pyx_kp_u_output_z_new_txt);
            PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_15, __pyx_kp_u_output_z_new_txt);
            __Pyx_INCREF(((PyObject *)__pyx_v_z));
            __Pyx_GIVEREF(((PyObject *)__pyx_v_z));
            PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_15, ((PyObject *)__pyx_v_z));
            __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1696, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_10);
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          }
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

          /* "vcstring.pyx":1697
 *                         np.savetxt('output/mc.txt', MC_list)
 *                         np.savetxt('output/z_new.txt', z)
 *                         np.savetxt('output/C_new.txt', [Cnew])             # <<<<<<<<<<<<<<
 *                         np.savez('output/coeffs_new.npz',
 *                                  b=b,
 */
          __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1697, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_savetxt); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1697, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_3 = PyFloat_FromDouble(__pyx_v_Cnew); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1697, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __pyx_t_7 = PyList_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1697, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_GIVEREF(__pyx_t_3);
          PyList_SET_ITEM(__pyx_t_7, 0, __pyx_t_3);
          __pyx_t_3 = 0;
          __pyx_t_3 = NULL;
          __pyx_t_15 = 0;
          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
            __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
            if (likely(__pyx_t_3)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
              __Pyx_INCREF(__pyx_t_3);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_4, function);
              __pyx_t_15 = 1;
            }
          }
          #if CYTHON_FAST_PYCALL
          if (PyFunction_Check(__pyx_t_4)) {
            PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_kp_u_output_C_new_txt, __pyx_t_7};
            __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1697, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
            __Pyx_GOTREF(__pyx_t_10);
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
            PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_kp_u_output_C_new_txt, __pyx_t_7};
            __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1697, __pyx_L1_error)
            __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
            __Pyx_GOTREF(__pyx_t_10);
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          } else
          #endif
          {
            __pyx_t_1 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1697, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_1);
            if (__pyx_t_3) {
              __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3); __pyx_t_3 = NULL;
            }
            __Pyx_INCREF(__pyx_kp_u_output_C_new_txt);
            __Pyx_GIVEREF(__pyx_kp_u_output_C_new_txt);
            PyTuple_SET_ITEM(__pyx_t_1, 0+__pyx_t_15, __pyx_kp_u_output_C_new_txt);
            __Pyx_GIVEREF(__pyx_t_7);
            PyTuple_SET_ITEM(__pyx_t_1, 1+__pyx_t_15, __pyx_t_7);
            __pyx_t_7 = 0;
            __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_1, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1697, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_10);
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          }
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

          /* "vcstring.pyx":1698
 *                         np.savetxt('output/z_new.txt', z)
 *                         np.savetxt('output/C_new.txt', [Cnew])
 *                         np.savez('output/coeffs_new.npz',             # <<<<<<<<<<<<<<
 *                                  b=b,
 *                                  D_0=D_0,
 */
          __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1698, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_savez); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1698, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

          /* "vcstring.pyx":1699
 *                         np.savetxt('output/C_new.txt', [Cnew])
 *                         np.savez('output/coeffs_new.npz',
 *                                  b=b,             # <<<<<<<<<<<<<<
 *                                  D_0=D_0,
 *                                  D_tau=D_tau,
 */
          __pyx_t_10 = __Pyx_PyDict_NewPresized(5); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1699, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_b_2, ((PyObject *)__pyx_v_b)) < 0) __PYX_ERR(0, 1699, __pyx_L1_error)

          /* "vcstring.pyx":1700
 *                         np.savez('output/coeffs_new.npz',
 *                                  b=b,
 *                                  D_0=D_0,             # <<<<<<<<<<<<<<
 *                                  D_tau=D_tau,
 *                                  g_0=g_0,
 */
          if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_D_0_2, ((PyObject *)__pyx_v_D_0)) < 0) __PYX_ERR(0, 1699, __pyx_L1_error)

          /* "vcstring.pyx":1701
 *                                  b=b,
 *                                  D_0=D_0,
 *                                  D_tau=D_tau,             # <<<<<<<<<<<<<<
 *                                  g_0=g_0,
 *                                  g_tau=g_tau)
 */
          if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_D_tau_2, ((PyObject *)__pyx_v_D_tau)) < 0) __PYX_ERR(0, 1699, __pyx_L1_error)

          /* "vcstring.pyx":1702
 *                                  D_0=D_0,
 *                                  D_tau=D_tau,
 *                                  g_0=g_0,             # <<<<<<<<<<<<<<
 *                                  g_tau=g_tau)
 *                     print('Accepted: Moved position by {0} , {1}. Cnew {2} is less than Cmax {3}'.format(hx, hy, Cnew, target))
 */
          if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_g_0_2, ((PyObject *)__pyx_v_g_0)) < 0) __PYX_ERR(0, 1699, __pyx_L1_error)

          /* "vcstring.pyx":1703
 *                                  D_tau=D_tau,
 *                                  g_0=g_0,
 *                                  g_tau=g_tau)             # <<<<<<<<<<<<<<
 *                     print('Accepted: Moved position by {0} , {1}. Cnew {2} is less than Cmax {3}'.format(hx, hy, Cnew, target))
 *                     print('Old position:', z_init, z_init_opp)
 */
          if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_g_tau_2, ((PyObject *)__pyx_v_g_tau)) < 0) __PYX_ERR(0, 1699, __pyx_L1_error)

          /* "vcstring.pyx":1698
 *                         np.savetxt('output/z_new.txt', z)
 *                         np.savetxt('output/C_new.txt', [Cnew])
 *                         np.savez('output/coeffs_new.npz',             # <<<<<<<<<<<<<<
 *                                  b=b,
 *                                  D_0=D_0,
 */
          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_tuple__74, __pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1698, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

          /* "vcstring.pyx":1694
 *                 if Cnew < target:
 *                     MC_list.extend([hx, hy, Cnew, z[i][0], z[i][1], z[ii][0], z[ii][1]])
 *                     if save == True:             # <<<<<<<<<<<<<<
 *                         np.savetxt('output/mc.txt', MC_list)
 *                         np.savetxt('output/z_new.txt', z)
 */
        }

        /* "vcstring.pyx":1704
 *                                  g_0=g_0,
 *                                  g_tau=g_tau)
 *                     print('Accepted: Moved position by {0} , {1}. Cnew {2} is less than Cmax {3}'.format(hx, hy, Cnew, target))             # <<<<<<<<<<<<<<
 *                     print('Old position:', z_init, z_init_opp)
 *                     print('New position:', z[i], z[ii])
 */
        __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_Accepted_Moved_position_by_0_1_C, __pyx_n_s_format); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1704, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_hx); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1704, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_7 = PyFloat_FromDouble(__pyx_v_hy); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1704, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_Cnew); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1704, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_5 = PyFloat_FromDouble(__pyx_v_target); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1704, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_6 = NULL;
        __pyx_t_15 = 0;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_10))) {
          __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_10);
          if (likely(__pyx_t_6)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
            __Pyx_INCREF(__pyx_t_6);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_10, function);
            __pyx_t_15 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_10)) {
          PyObject *__pyx_temp[5] = {__pyx_t_6, __pyx_t_4, __pyx_t_7, __pyx_t_3, __pyx_t_5};
          __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_15, 4+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1704, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
          PyObject *__pyx_temp[5] = {__pyx_t_6, __pyx_t_4, __pyx_t_7, __pyx_t_3, __pyx_t_5};
          __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_15, 4+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1704, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        } else
        #endif
        {
          __pyx_t_8 = PyTuple_New(4+__pyx_t_15); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1704, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_8);
          if (__pyx_t_6) {
            __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
          }
          __Pyx_GIVEREF(__pyx_t_4);
          PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_15, __pyx_t_4);
          __Pyx_GIVEREF(__pyx_t_7);
          PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_15, __pyx_t_7);
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_8, 2+__pyx_t_15, __pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_5);
          PyTuple_SET_ITEM(__pyx_t_8, 3+__pyx_t_15, __pyx_t_5);
          __pyx_t_4 = 0;
          __pyx_t_7 = 0;
          __pyx_t_3 = 0;
          __pyx_t_5 = 0;
          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1704, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        }
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1704, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

        /* "vcstring.pyx":1705
 *                                  g_tau=g_tau)
 *                     print('Accepted: Moved position by {0} , {1}. Cnew {2} is less than Cmax {3}'.format(hx, hy, Cnew, target))
 *                     print('Old position:', z_init, z_init_opp)             # <<<<<<<<<<<<<<
 *                     print('New position:', z[i], z[ii])
 *                     return z
 */
        __pyx_t_10 = PyTuple_New(3); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1705, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_INCREF(__pyx_kp_u_Old_position);
        __Pyx_GIVEREF(__pyx_kp_u_Old_position);
        PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_kp_u_Old_position);
        __Pyx_INCREF(__pyx_v_z_init);
        __Pyx_GIVEREF(__pyx_v_z_init);
        PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_v_z_init);
        __Pyx_INCREF(__pyx_v_z_init_opp);
        __Pyx_GIVEREF(__pyx_v_z_init_opp);
        PyTuple_SET_ITEM(__pyx_t_10, 2, __pyx_v_z_init_opp);
        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_10, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1705, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

        /* "vcstring.pyx":1706
 *                     print('Accepted: Moved position by {0} , {1}. Cnew {2} is less than Cmax {3}'.format(hx, hy, Cnew, target))
 *                     print('Old position:', z_init, z_init_opp)
 *                     print('New position:', z[i], z[ii])             # <<<<<<<<<<<<<<
 *                     return z
 *                 else:
 */
        __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1706, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1706, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1706, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_INCREF(__pyx_kp_u_New_position);
        __Pyx_GIVEREF(__pyx_kp_u_New_position);
        PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_kp_u_New_position);
        __Pyx_GIVEREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_1);
        __Pyx_GIVEREF(__pyx_t_10);
        PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_t_10);
        __pyx_t_1 = 0;
        __pyx_t_10 = 0;
        __pyx_t_10 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_8, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1706, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

        /* "vcstring.pyx":1707
 *                     print('Old position:', z_init, z_init_opp)
 *                     print('New position:', z[i], z[ii])
 *                     return z             # <<<<<<<<<<<<<<
 *                 else:
 *                     z[i][0] = z[i][0] - hx  # Move back to original position
 */
        __Pyx_XDECREF(__pyx_r);
        __Pyx_INCREF(((PyObject *)__pyx_v_z));
        __pyx_r = ((PyObject *)__pyx_v_z);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L0;

        /* "vcstring.pyx":1692
 *                     Cnew = self.calc_corr_q2(traj, tau, b, ids)
 *                 # Accept or reject the move
 *                 if Cnew < target:             # <<<<<<<<<<<<<<
 *                     MC_list.extend([hx, hy, Cnew, z[i][0], z[i][1], z[ii][0], z[ii][1]])
 *                     if save == True:
 */
      }

      /* "vcstring.pyx":1709
 *                     return z
 *                 else:
 *                     z[i][0] = z[i][0] - hx  # Move back to original position             # <<<<<<<<<<<<<<
 *                     z[i][1] = z[i][1] - hy
 *                     z[ii][0] = z[ii][0] + hx
 */
      /*else*/ {
        __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1709, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_8 = __Pyx_GetItemInt(__pyx_t_10, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1709, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = PyFloat_FromDouble(__pyx_v_hx); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1709, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_1 = PyNumber_Subtract(__pyx_t_8, __pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1709, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1709, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        if (unlikely(__Pyx_SetItemInt(__pyx_t_10, 0, __pyx_t_1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 1709, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

        /* "vcstring.pyx":1710
 *                 else:
 *                     z[i][0] = z[i][0] - hx  # Move back to original position
 *                     z[i][1] = z[i][1] - hy             # <<<<<<<<<<<<<<
 *                     z[ii][0] = z[ii][0] + hx
 *                     z[ii][1] = z[ii][1] + hy
 */
        __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1710, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_10 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1710, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = PyFloat_FromDouble(__pyx_v_hy); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1710, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_8 = PyNumber_Subtract(__pyx_t_10, __pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1710, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1710, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        if (unlikely(__Pyx_SetItemInt(__pyx_t_1, 1, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 1710, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

        /* "vcstring.pyx":1711
 *                     z[i][0] = z[i][0] - hx  # Move back to original position
 *                     z[i][1] = z[i][1] - hy
 *                     z[ii][0] = z[ii][0] + hx             # <<<<<<<<<<<<<<
 *                     z[ii][1] = z[ii][1] + hy
 *                     print('Rejected: Moved position by {0} , {1}. Cnew {2} is greater than Cmax {3}'.format(hx, hy, Cnew, target))
 */
        __pyx_t_8 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1711, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_8, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1711, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_t_8 = PyFloat_FromDouble(__pyx_v_hx); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1711, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_10 = PyNumber_Add(__pyx_t_1, __pyx_t_8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1711, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_t_8 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1711, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        if (unlikely(__Pyx_SetItemInt(__pyx_t_8, 0, __pyx_t_10, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 1711, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

        /* "vcstring.pyx":1712
 *                     z[i][1] = z[i][1] - hy
 *                     z[ii][0] = z[ii][0] + hx
 *                     z[ii][1] = z[ii][1] + hy             # <<<<<<<<<<<<<<
 *                     print('Rejected: Moved position by {0} , {1}. Cnew {2} is greater than Cmax {3}'.format(hx, hy, Cnew, target))
 *                     continue
 */
        __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1712, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_8 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1712, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = PyFloat_FromDouble(__pyx_v_hy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1712, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_1 = PyNumber_Add(__pyx_t_8, __pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1712, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1712, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        if (unlikely(__Pyx_SetItemInt(__pyx_t_10, 1, __pyx_t_1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 1712, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

        /* "vcstring.pyx":1713
 *                     z[ii][0] = z[ii][0] + hx
 *                     z[ii][1] = z[ii][1] + hy
 *                     print('Rejected: Moved position by {0} , {1}. Cnew {2} is greater than Cmax {3}'.format(hx, hy, Cnew, target))             # <<<<<<<<<<<<<<
 *                     continue
 * 
 */
        __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_Rejected_Moved_position_by_0_1_C, __pyx_n_s_format); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1713, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_8 = PyFloat_FromDouble(__pyx_v_hx); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1713, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_5 = PyFloat_FromDouble(__pyx_v_hy); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1713, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_Cnew); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1713, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_7 = PyFloat_FromDouble(__pyx_v_target); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1713, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_4 = NULL;
        __pyx_t_15 = 0;
        if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_10))) {
          __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_10);
          if (likely(__pyx_t_4)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
            __Pyx_INCREF(__pyx_t_4);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_10, function);
            __pyx_t_15 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (PyFunction_Check(__pyx_t_10)) {
          PyObject *__pyx_temp[5] = {__pyx_t_4, __pyx_t_8, __pyx_t_5, __pyx_t_3, __pyx_t_7};
          __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_15, 4+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1713, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
          PyObject *__pyx_temp[5] = {__pyx_t_4, __pyx_t_8, __pyx_t_5, __pyx_t_3, __pyx_t_7};
          __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_15, 4+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1713, __pyx_L1_error)
          __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        } else
        #endif
        {
          __pyx_t_6 = PyTuple_New(4+__pyx_t_15); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1713, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          if (__pyx_t_4) {
            __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
          }
          __Pyx_GIVEREF(__pyx_t_8);
          PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_15, __pyx_t_8);
          __Pyx_GIVEREF(__pyx_t_5);
          PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_15, __pyx_t_5);
          __Pyx_GIVEREF(__pyx_t_3);
          PyTuple_SET_ITEM(__pyx_t_6, 2+__pyx_t_15, __pyx_t_3);
          __Pyx_GIVEREF(__pyx_t_7);
          PyTuple_SET_ITEM(__pyx_t_6, 3+__pyx_t_15, __pyx_t_7);
          __pyx_t_8 = 0;
          __pyx_t_5 = 0;
          __pyx_t_3 = 0;
          __pyx_t_7 = 0;
          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1713, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        }
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1713, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

        /* "vcstring.pyx":1714
 *                     z[ii][1] = z[ii][1] + hy
 *                     print('Rejected: Moved position by {0} , {1}. Cnew {2} is greater than Cmax {3}'.format(hx, hy, Cnew, target))
 *                     continue             # <<<<<<<<<<<<<<
 * 
 *             # In the case when all values were rejected
 */
        goto __pyx_L5_continue;
      }
      __pyx_L5_continue:;
    }

    /* "vcstring.pyx":1717
 * 
 *             # In the case when all values were rejected
 *             print('\nWARNING: No values were accepted. Try increasing the number of MC steps.')             # <<<<<<<<<<<<<<
 *             print('Old position:', z_init, z_init_opp)
 * 
 */
    __pyx_t_10 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__75, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1717, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

    /* "vcstring.pyx":1718
 *             # In the case when all values were rejected
 *             print('\nWARNING: No values were accepted. Try increasing the number of MC steps.')
 *             print('Old position:', z_init, z_init_opp)             # <<<<<<<<<<<<<<
 * 
 *         return
 */
    __pyx_t_10 = PyTuple_New(3); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1718, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_INCREF(__pyx_kp_u_Old_position);
    __Pyx_GIVEREF(__pyx_kp_u_Old_position);
    PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_kp_u_Old_position);
    __Pyx_INCREF(__pyx_v_z_init);
    __Pyx_GIVEREF(__pyx_v_z_init);
    PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_v_z_init);
    __Pyx_INCREF(__pyx_v_z_init_opp);
    __Pyx_GIVEREF(__pyx_v_z_init_opp);
    PyTuple_SET_ITEM(__pyx_t_10, 2, __pyx_v_z_init_opp);
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_10, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1718, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "vcstring.pyx":1620
 *         sys.stdout.flush()
 * 
 *         for i in images:  # Move the i-th bead(s) on the string             # <<<<<<<<<<<<<<
 *             z_init = deepcopy(z[i])
 *             ii = int(self.num_basis - 1 - i)  # Index of bead on the opposite end of string
 */
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":1720
 *             print('Old position:', z_init, z_init_opp)
 * 
 *         return             # <<<<<<<<<<<<<<
 * 
 * cpdef reparm_string(np.ndarray[DTYPE_t, ndim=2] z):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;

  /* "vcstring.pyx":1576
 *         return
 * 
 *     cpdef montecarlo_symmetric(self, list images, list traj, int tau, np.ndarray[DTYPE_t, ndim=2] z, double target, double delta=0.01, int n=100, manual=False, hx_man=None, hy_man=None, reparm=True, mindist_constraint=False, mindist=0.25, accelerated=False, corr_method='matrix_elements', save=True):             # <<<<<<<<<<<<<<
 *         """
 *         For systems that are symmetric about some axis of rotation.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_10);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.montecarlo_symmetric", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_0.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_D_tau.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_0.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_g_tau.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ids.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XDECREF(__pyx_v_MC_list);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_0);
  __Pyx_XDECREF((PyObject *)__pyx_v_D_tau);
  __Pyx_XDECREF((PyObject *)__pyx_v_ids);
  __Pyx_XDECREF((PyObject *)__pyx_v_b);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_0);
  __Pyx_XDECREF((PyObject *)__pyx_v_g_tau);
  __Pyx_XDECREF(__pyx_v_z_init);
  __Pyx_XDECREF(__pyx_v_z_init_opp);
  __Pyx_XDECREF((PyObject *)__pyx_v_z);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_39montecarlo_symmetric(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8vcstring_8vcstring_38montecarlo_symmetric[] = "\n        For systems that are symmetric about some axis of rotation. \n        Monte Carlo accept/reject of correlation given a target value. \n        For each image position updated, the image on the opposite side will also be updated \n        by -hx, -hy.\n\n        Parameters:\n        -----------\n        images : List of indices of the images on the Voronoi string\n        traj   : trajectory\n        z      : Voronoi centroid positions\n        target : Value to compare for acceptance or rejection\n        delta  : Step change in the Voronoi centroid position, default = 0.01\n        n      : How many MC steps to perform to find an accepted value. Should be divisible\n                 by self.num_basis to include all images on the string in each MC iteration.\n                 Default = 100.\n        accelerated  :  Specifies which method to solve the linear equations for b, D, g.\n        save   : Specifies whether to save results as numpy file. Default = True.\n\n        Return:\n        -------\n        Returns the updated position of z upon acceptance\n        ";
static PyObject *__pyx_pw_8vcstring_8vcstring_39montecarlo_symmetric(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_images = 0;
  PyObject *__pyx_v_traj = 0;
  int __pyx_v_tau;
  PyArrayObject *__pyx_v_z = 0;
  double __pyx_v_target;
  double __pyx_v_delta;
  int __pyx_v_n;
  PyObject *__pyx_v_manual = 0;
  PyObject *__pyx_v_hx_man = 0;
  PyObject *__pyx_v_hy_man = 0;
  PyObject *__pyx_v_reparm = 0;
  PyObject *__pyx_v_mindist_constraint = 0;
  PyObject *__pyx_v_mindist = 0;
  PyObject *__pyx_v_accelerated = 0;
  PyObject *__pyx_v_corr_method = 0;
  PyObject *__pyx_v_save = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("montecarlo_symmetric (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_images,&__pyx_n_s_traj,&__pyx_n_s_tau,&__pyx_n_s_z,&__pyx_n_s_target,&__pyx_n_s_delta,&__pyx_n_s_n,&__pyx_n_s_manual,&__pyx_n_s_hx_man,&__pyx_n_s_hy_man,&__pyx_n_s_reparm,&__pyx_n_s_mindist_constraint,&__pyx_n_s_mindist,&__pyx_n_s_accelerated,&__pyx_n_s_corr_method,&__pyx_n_s_save,0};
    PyObject* values[16] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    values[7] = ((PyObject *)Py_False);
    values[8] = ((PyObject *)Py_None);
    values[9] = ((PyObject *)Py_None);
    values[10] = ((PyObject *)Py_True);
    values[11] = ((PyObject *)Py_False);
    values[12] = ((PyObject *)__pyx_float_0_25);
    values[13] = ((PyObject *)Py_False);
    values[14] = ((PyObject *)__pyx_n_u_matrix_elements);
    values[15] = ((PyObject *)Py_True);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case 16: values[15] = PyTuple_GET_ITEM(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = PyTuple_GET_ITEM(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = PyTuple_GET_ITEM(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = PyTuple_GET_ITEM(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = PyTuple_GET_ITEM(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = PyTuple_GET_ITEM(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = PyTuple_GET_ITEM(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_images)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_traj)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("montecarlo_symmetric", 0, 5, 16, 1); __PYX_ERR(0, 1576, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tau)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("montecarlo_symmetric", 0, 5, 16, 2); __PYX_ERR(0, 1576, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_z)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("montecarlo_symmetric", 0, 5, 16, 3); __PYX_ERR(0, 1576, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_target)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("montecarlo_symmetric", 0, 5, 16, 4); __PYX_ERR(0, 1576, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_delta);
          if (value) { values[5] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_n);
          if (value) { values[6] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_manual);
          if (value) { values[7] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_hx_man);
          if (value) { values[8] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_hy_man);
          if (value) { values[9] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_reparm);
          if (value) { values[10] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_mindist_constraint);
          if (value) { values[11] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_mindist);
          if (value) { values[12] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_accelerated);
          if (value) { values[13] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_corr_method);
          if (value) { values[14] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_save);
          if (value) { values[15] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "montecarlo_symmetric") < 0)) __PYX_ERR(0, 1576, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case 16: values[15] = PyTuple_GET_ITEM(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = PyTuple_GET_ITEM(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = PyTuple_GET_ITEM(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = PyTuple_GET_ITEM(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = PyTuple_GET_ITEM(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = PyTuple_GET_ITEM(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = PyTuple_GET_ITEM(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_images = ((PyObject*)values[0]);
    __pyx_v_traj = ((PyObject*)values[1]);
    __pyx_v_tau = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_tau == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1576, __pyx_L3_error)
    __pyx_v_z = ((PyArrayObject *)values[3]);
    __pyx_v_target = __pyx_PyFloat_AsDouble(values[4]); if (unlikely((__pyx_v_target == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1576, __pyx_L3_error)
    if (values[5]) {
      __pyx_v_delta = __pyx_PyFloat_AsDouble(values[5]); if (unlikely((__pyx_v_delta == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1576, __pyx_L3_error)
    } else {
      __pyx_v_delta = ((double)0.01);
    }
    if (values[6]) {
      __pyx_v_n = __Pyx_PyInt_As_int(values[6]); if (unlikely((__pyx_v_n == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1576, __pyx_L3_error)
    } else {
      __pyx_v_n = ((int)0x64);
    }
    __pyx_v_manual = values[7];
    __pyx_v_hx_man = values[8];
    __pyx_v_hy_man = values[9];
    __pyx_v_reparm = values[10];
    __pyx_v_mindist_constraint = values[11];
    __pyx_v_mindist = values[12];
    __pyx_v_accelerated = values[13];
    __pyx_v_corr_method = values[14];
    __pyx_v_save = values[15];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("montecarlo_symmetric", 0, 5, 16, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1576, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.vcstring.montecarlo_symmetric", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_images), (&PyList_Type), 1, "images", 1))) __PYX_ERR(0, 1576, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_traj), (&PyList_Type), 1, "traj", 1))) __PYX_ERR(0, 1576, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_z), __pyx_ptype_5numpy_ndarray, 1, "z", 0))) __PYX_ERR(0, 1576, __pyx_L1_error)
  __pyx_r = __pyx_pf_8vcstring_8vcstring_38montecarlo_symmetric(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self), __pyx_v_images, __pyx_v_traj, __pyx_v_tau, __pyx_v_z, __pyx_v_target, __pyx_v_delta, __pyx_v_n, __pyx_v_manual, __pyx_v_hx_man, __pyx_v_hy_man, __pyx_v_reparm, __pyx_v_mindist_constraint, __pyx_v_mindist, __pyx_v_accelerated, __pyx_v_corr_method, __pyx_v_save);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_38montecarlo_symmetric(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v_images, PyObject *__pyx_v_traj, int __pyx_v_tau, PyArrayObject *__pyx_v_z, double __pyx_v_target, double __pyx_v_delta, int __pyx_v_n, PyObject *__pyx_v_manual, PyObject *__pyx_v_hx_man, PyObject *__pyx_v_hy_man, PyObject *__pyx_v_reparm, PyObject *__pyx_v_mindist_constraint, PyObject *__pyx_v_mindist, PyObject *__pyx_v_accelerated, PyObject *__pyx_v_corr_method, PyObject *__pyx_v_save) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  struct __pyx_opt_args_8vcstring_8vcstring_montecarlo_symmetric __pyx_t_2;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("montecarlo_symmetric", 0);
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1576, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2.__pyx_n = 11;
  __pyx_t_2.delta = __pyx_v_delta;
  __pyx_t_2.n = __pyx_v_n;
  __pyx_t_2.manual = __pyx_v_manual;
  __pyx_t_2.hx_man = __pyx_v_hx_man;
  __pyx_t_2.hy_man = __pyx_v_hy_man;
  __pyx_t_2.reparm = __pyx_v_reparm;
  __pyx_t_2.mindist_constraint = __pyx_v_mindist_constraint;
  __pyx_t_2.mindist = __pyx_v_mindist;
  __pyx_t_2.accelerated = __pyx_v_accelerated;
  __pyx_t_2.corr_method = __pyx_v_corr_method;
  __pyx_t_2.save = __pyx_v_save;
  __pyx_t_1 = __pyx_vtabptr_8vcstring_vcstring->montecarlo_symmetric(__pyx_v_self, __pyx_v_images, __pyx_v_traj, __pyx_v_tau, __pyx_v_z, __pyx_v_target, 1, &__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1576, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.vcstring.montecarlo_symmetric", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":1
 * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
 *     cdef tuple state
 *     cdef object _dict
 */

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_41__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyObject *__pyx_pw_8vcstring_8vcstring_41__reduce_cython__(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__reduce_cython__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8vcstring_8vcstring_40__reduce_cython__(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_40__reduce_cython__(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self) {
  PyObject *__pyx_v_state = 0;
  PyObject *__pyx_v__dict = 0;
  int __pyx_v_use_setstate;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  PyObject *__pyx_t_14 = NULL;
  PyObject *__pyx_t_15 = NULL;
  PyObject *__pyx_t_16 = NULL;
  PyObject *__pyx_t_17 = NULL;
  PyObject *__pyx_t_18 = NULL;
  PyObject *__pyx_t_19 = NULL;
  int __pyx_t_20;
  int __pyx_t_21;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__reduce_cython__", 0);

  /* "(tree fragment)":5
 *     cdef object _dict
 *     cdef bint use_setstate
 *     state = (self.alpha_A, self.alpha_B, self.alpha_deg_A, self.alpha_deg_B, self.cut, self.cut_A, self.cut_B, self.num_basis, self.ra_A, self.ra_B, self.rb_A, self.rb_B, self.state_assignment, self.theta, self.theta_deg, self.x0_A, self.x0_B, self.y0_A, self.y0_B)             # <<<<<<<<<<<<<<
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:
 */
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_self->alpha_A); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_self->alpha_B); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_self->alpha_deg_A); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_self->alpha_deg_B); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = PyFloat_FromDouble(__pyx_v_self->cut); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = PyFloat_FromDouble(__pyx_v_self->cut_A); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_7 = PyFloat_FromDouble(__pyx_v_self->cut_B); if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_self->num_basis); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_9 = PyFloat_FromDouble(__pyx_v_self->ra_A); if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_10 = PyFloat_FromDouble(__pyx_v_self->ra_B); if (unlikely(!__pyx_t_10)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __pyx_t_11 = PyFloat_FromDouble(__pyx_v_self->rb_A); if (unlikely(!__pyx_t_11)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_12 = PyFloat_FromDouble(__pyx_v_self->rb_B); if (unlikely(!__pyx_t_12)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_12);
  __pyx_t_13 = PyFloat_FromDouble(__pyx_v_self->theta); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_13);
  __pyx_t_14 = PyFloat_FromDouble(__pyx_v_self->theta_deg); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_14);
  __pyx_t_15 = PyFloat_FromDouble(__pyx_v_self->x0_A); if (unlikely(!__pyx_t_15)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_15);
  __pyx_t_16 = PyFloat_FromDouble(__pyx_v_self->x0_B); if (unlikely(!__pyx_t_16)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_16);
  __pyx_t_17 = PyFloat_FromDouble(__pyx_v_self->y0_A); if (unlikely(!__pyx_t_17)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_17);
  __pyx_t_18 = PyFloat_FromDouble(__pyx_v_self->y0_B); if (unlikely(!__pyx_t_18)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_18);
  __pyx_t_19 = PyTuple_New(19); if (unlikely(!__pyx_t_19)) __PYX_ERR(1, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_19);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_19, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_19, 1, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_19, 2, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_19, 3, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_19, 4, __pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_6);
  PyTuple_SET_ITEM(__pyx_t_19, 5, __pyx_t_6);
  __Pyx_GIVEREF(__pyx_t_7);
  PyTuple_SET_ITEM(__pyx_t_19, 6, __pyx_t_7);
  __Pyx_GIVEREF(__pyx_t_8);
  PyTuple_SET_ITEM(__pyx_t_19, 7, __pyx_t_8);
  __Pyx_GIVEREF(__pyx_t_9);
  PyTuple_SET_ITEM(__pyx_t_19, 8, __pyx_t_9);
  __Pyx_GIVEREF(__pyx_t_10);
  PyTuple_SET_ITEM(__pyx_t_19, 9, __pyx_t_10);
  __Pyx_GIVEREF(__pyx_t_11);
  PyTuple_SET_ITEM(__pyx_t_19, 10, __pyx_t_11);
  __Pyx_GIVEREF(__pyx_t_12);
  PyTuple_SET_ITEM(__pyx_t_19, 11, __pyx_t_12);
  __Pyx_INCREF(__pyx_v_self->state_assignment);
  __Pyx_GIVEREF(__pyx_v_self->state_assignment);
  PyTuple_SET_ITEM(__pyx_t_19, 12, __pyx_v_self->state_assignment);
  __Pyx_GIVEREF(__pyx_t_13);
  PyTuple_SET_ITEM(__pyx_t_19, 13, __pyx_t_13);
  __Pyx_GIVEREF(__pyx_t_14);
  PyTuple_SET_ITEM(__pyx_t_19, 14, __pyx_t_14);
  __Pyx_GIVEREF(__pyx_t_15);
  PyTuple_SET_ITEM(__pyx_t_19, 15, __pyx_t_15);
  __Pyx_GIVEREF(__pyx_t_16);
  PyTuple_SET_ITEM(__pyx_t_19, 16, __pyx_t_16);
  __Pyx_GIVEREF(__pyx_t_17);
  PyTuple_SET_ITEM(__pyx_t_19, 17, __pyx_t_17);
  __Pyx_GIVEREF(__pyx_t_18);
  PyTuple_SET_ITEM(__pyx_t_19, 18, __pyx_t_18);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_6 = 0;
  __pyx_t_7 = 0;
  __pyx_t_8 = 0;
  __pyx_t_9 = 0;
  __pyx_t_10 = 0;
  __pyx_t_11 = 0;
  __pyx_t_12 = 0;
  __pyx_t_13 = 0;
  __pyx_t_14 = 0;
  __pyx_t_15 = 0;
  __pyx_t_16 = 0;
  __pyx_t_17 = 0;
  __pyx_t_18 = 0;
  __pyx_v_state = ((PyObject*)__pyx_t_19);
  __pyx_t_19 = 0;

  /* "(tree fragment)":6
 *     cdef bint use_setstate
 *     state = (self.alpha_A, self.alpha_B, self.alpha_deg_A, self.alpha_deg_B, self.cut, self.cut_A, self.cut_B, self.num_basis, self.ra_A, self.ra_B, self.rb_A, self.rb_B, self.state_assignment, self.theta, self.theta_deg, self.x0_A, self.x0_B, self.y0_A, self.y0_B)
 *     _dict = getattr(self, '__dict__', None)             # <<<<<<<<<<<<<<
 *     if _dict is not None:
 *         state += (_dict,)
 */
  __pyx_t_19 = __Pyx_GetAttr3(((PyObject *)__pyx_v_self), __pyx_n_s_dict, Py_None); if (unlikely(!__pyx_t_19)) __PYX_ERR(1, 6, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_19);
  __pyx_v__dict = __pyx_t_19;
  __pyx_t_19 = 0;

  /* "(tree fragment)":7
 *     state = (self.alpha_A, self.alpha_B, self.alpha_deg_A, self.alpha_deg_B, self.cut, self.cut_A, self.cut_B, self.num_basis, self.ra_A, self.ra_B, self.rb_A, self.rb_B, self.state_assignment, self.theta, self.theta_deg, self.x0_A, self.x0_B, self.y0_A, self.y0_B)
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:             # <<<<<<<<<<<<<<
 *         state += (_dict,)
 *         use_setstate = True
 */
  __pyx_t_20 = (__pyx_v__dict != Py_None);
  __pyx_t_21 = (__pyx_t_20 != 0);
  if (__pyx_t_21) {

    /* "(tree fragment)":8
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:
 *         state += (_dict,)             # <<<<<<<<<<<<<<
 *         use_setstate = True
 *     else:
 */
    __pyx_t_19 = PyTuple_New(1); if (unlikely(!__pyx_t_19)) __PYX_ERR(1, 8, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_19);
    __Pyx_INCREF(__pyx_v__dict);
    __Pyx_GIVEREF(__pyx_v__dict);
    PyTuple_SET_ITEM(__pyx_t_19, 0, __pyx_v__dict);
    __pyx_t_18 = PyNumber_InPlaceAdd(__pyx_v_state, __pyx_t_19); if (unlikely(!__pyx_t_18)) __PYX_ERR(1, 8, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_18);
    __Pyx_DECREF(__pyx_t_19); __pyx_t_19 = 0;
    __Pyx_DECREF_SET(__pyx_v_state, ((PyObject*)__pyx_t_18));
    __pyx_t_18 = 0;

    /* "(tree fragment)":9
 *     if _dict is not None:
 *         state += (_dict,)
 *         use_setstate = True             # <<<<<<<<<<<<<<
 *     else:
 *         use_setstate = self.state_assignment is not None
 */
    __pyx_v_use_setstate = 1;

    /* "(tree fragment)":7
 *     state = (self.alpha_A, self.alpha_B, self.alpha_deg_A, self.alpha_deg_B, self.cut, self.cut_A, self.cut_B, self.num_basis, self.ra_A, self.ra_B, self.rb_A, self.rb_B, self.state_assignment, self.theta, self.theta_deg, self.x0_A, self.x0_B, self.y0_A, self.y0_B)
 *     _dict = getattr(self, '__dict__', None)
 *     if _dict is not None:             # <<<<<<<<<<<<<<
 *         state += (_dict,)
 *         use_setstate = True
 */
    goto __pyx_L3;
  }

  /* "(tree fragment)":11
 *         use_setstate = True
 *     else:
 *         use_setstate = self.state_assignment is not None             # <<<<<<<<<<<<<<
 *     if use_setstate:
 *         return __pyx_unpickle_vcstring, (type(self), 0xf65be29, None), state
 */
  /*else*/ {
    __pyx_t_21 = (__pyx_v_self->state_assignment != ((PyObject*)Py_None));
    __pyx_v_use_setstate = __pyx_t_21;
  }
  __pyx_L3:;

  /* "(tree fragment)":12
 *     else:
 *         use_setstate = self.state_assignment is not None
 *     if use_setstate:             # <<<<<<<<<<<<<<
 *         return __pyx_unpickle_vcstring, (type(self), 0xf65be29, None), state
 *     else:
 */
  __pyx_t_21 = (__pyx_v_use_setstate != 0);
  if (__pyx_t_21) {

    /* "(tree fragment)":13
 *         use_setstate = self.state_assignment is not None
 *     if use_setstate:
 *         return __pyx_unpickle_vcstring, (type(self), 0xf65be29, None), state             # <<<<<<<<<<<<<<
 *     else:
 *         return __pyx_unpickle_vcstring, (type(self), 0xf65be29, state)
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_18, __pyx_n_s_pyx_unpickle_vcstring); if (unlikely(!__pyx_t_18)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_18);
    __pyx_t_19 = PyTuple_New(3); if (unlikely(!__pyx_t_19)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_19);
    __Pyx_INCREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_GIVEREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    PyTuple_SET_ITEM(__pyx_t_19, 0, ((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_INCREF(__pyx_int_258326057);
    __Pyx_GIVEREF(__pyx_int_258326057);
    PyTuple_SET_ITEM(__pyx_t_19, 1, __pyx_int_258326057);
    __Pyx_INCREF(Py_None);
    __Pyx_GIVEREF(Py_None);
    PyTuple_SET_ITEM(__pyx_t_19, 2, Py_None);
    __pyx_t_17 = PyTuple_New(3); if (unlikely(!__pyx_t_17)) __PYX_ERR(1, 13, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_17);
    __Pyx_GIVEREF(__pyx_t_18);
    PyTuple_SET_ITEM(__pyx_t_17, 0, __pyx_t_18);
    __Pyx_GIVEREF(__pyx_t_19);
    PyTuple_SET_ITEM(__pyx_t_17, 1, __pyx_t_19);
    __Pyx_INCREF(__pyx_v_state);
    __Pyx_GIVEREF(__pyx_v_state);
    PyTuple_SET_ITEM(__pyx_t_17, 2, __pyx_v_state);
    __pyx_t_18 = 0;
    __pyx_t_19 = 0;
    __pyx_r = __pyx_t_17;
    __pyx_t_17 = 0;
    goto __pyx_L0;

    /* "(tree fragment)":12
 *     else:
 *         use_setstate = self.state_assignment is not None
 *     if use_setstate:             # <<<<<<<<<<<<<<
 *         return __pyx_unpickle_vcstring, (type(self), 0xf65be29, None), state
 *     else:
 */
  }

  /* "(tree fragment)":15
 *         return __pyx_unpickle_vcstring, (type(self), 0xf65be29, None), state
 *     else:
 *         return __pyx_unpickle_vcstring, (type(self), 0xf65be29, state)             # <<<<<<<<<<<<<<
 * def __setstate_cython__(self, __pyx_state):
 *     __pyx_unpickle_vcstring__set_state(self, __pyx_state)
 */
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_17, __pyx_n_s_pyx_unpickle_vcstring); if (unlikely(!__pyx_t_17)) __PYX_ERR(1, 15, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_17);
    __pyx_t_19 = PyTuple_New(3); if (unlikely(!__pyx_t_19)) __PYX_ERR(1, 15, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_19);
    __Pyx_INCREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_GIVEREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    PyTuple_SET_ITEM(__pyx_t_19, 0, ((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
    __Pyx_INCREF(__pyx_int_258326057);
    __Pyx_GIVEREF(__pyx_int_258326057);
    PyTuple_SET_ITEM(__pyx_t_19, 1, __pyx_int_258326057);
    __Pyx_INCREF(__pyx_v_state);
    __Pyx_GIVEREF(__pyx_v_state);
    PyTuple_SET_ITEM(__pyx_t_19, 2, __pyx_v_state);
    __pyx_t_18 = PyTuple_New(2); if (unlikely(!__pyx_t_18)) __PYX_ERR(1, 15, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_18);
    __Pyx_GIVEREF(__pyx_t_17);
    PyTuple_SET_ITEM(__pyx_t_18, 0, __pyx_t_17);
    __Pyx_GIVEREF(__pyx_t_19);
    PyTuple_SET_ITEM(__pyx_t_18, 1, __pyx_t_19);
    __pyx_t_17 = 0;
    __pyx_t_19 = 0;
    __pyx_r = __pyx_t_18;
    __pyx_t_18 = 0;
    goto __pyx_L0;
  }

  /* "(tree fragment)":1
 * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
 *     cdef tuple state
 *     cdef object _dict
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_XDECREF(__pyx_t_15);
  __Pyx_XDECREF(__pyx_t_16);
  __Pyx_XDECREF(__pyx_t_17);
  __Pyx_XDECREF(__pyx_t_18);
  __Pyx_XDECREF(__pyx_t_19);
  __Pyx_AddTraceback("vcstring.vcstring.__reduce_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_state);
  __Pyx_XDECREF(__pyx_v__dict);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":16
 *     else:
 *         return __pyx_unpickle_vcstring, (type(self), 0xf65be29, state)
 * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_unpickle_vcstring__set_state(self, __pyx_state)
 */

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_8vcstring_43__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state); /*proto*/
static PyObject *__pyx_pw_8vcstring_8vcstring_43__setstate_cython__(PyObject *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__setstate_cython__ (wrapper)", 0);
  __pyx_r = __pyx_pf_8vcstring_8vcstring_42__setstate_cython__(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v_self), ((PyObject *)__pyx_v___pyx_state));

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8vcstring_42__setstate_cython__(struct __pyx_obj_8vcstring_vcstring *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__setstate_cython__", 0);

  /* "(tree fragment)":17
 *         return __pyx_unpickle_vcstring, (type(self), 0xf65be29, state)
 * def __setstate_cython__(self, __pyx_state):
 *     __pyx_unpickle_vcstring__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
 */
  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
  __pyx_t_1 = __pyx_f_8vcstring___pyx_unpickle_vcstring__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "(tree fragment)":16
 *     else:
 *         return __pyx_unpickle_vcstring, (type(self), 0xf65be29, state)
 * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_unpickle_vcstring__set_state(self, __pyx_state)
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("vcstring.vcstring.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":1722
 *         return
 * 
 * cpdef reparm_string(np.ndarray[DTYPE_t, ndim=2] z):             # <<<<<<<<<<<<<<
 *     cdef np.ndarray[DTYPE_t, ndim=1] x, y, dist_im, pos
 *     cdef np.ndarray[long, ndim=1] where
 */

static PyObject *__pyx_pw_8vcstring_1reparm_string(PyObject *__pyx_self, PyObject *__pyx_v_z); /*proto*/
static PyObject *__pyx_f_8vcstring_reparm_string(PyArrayObject *__pyx_v_z, CYTHON_UNUSED int __pyx_skip_dispatch) {
  PyArrayObject *__pyx_v_x = 0;
  PyArrayObject *__pyx_v_y = 0;
  PyArrayObject *__pyx_v_dist_im = 0;
  PyArrayObject *__pyx_v_pos = 0;
  PyArrayObject *__pyx_v_where = 0;
  PyArrayObject *__pyx_v_grad = 0;
  PyArrayObject *__pyx_v_M = 0;
  CYTHON_UNUSED int __pyx_v_i;
  int __pyx_v_j;
  double __pyx_v_dist_tot;
  double __pyx_v_equidist;
  double __pyx_v_d;
  double __pyx_v_diff;
  PyObject *__pyx_v_z_new = 0;
  PyObject *__pyx_v_z_new_arr = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_M;
  __Pyx_Buffer __pyx_pybuffer_M;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_dist_im;
  __Pyx_Buffer __pyx_pybuffer_dist_im;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_grad;
  __Pyx_Buffer __pyx_pybuffer_grad;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_pos;
  __Pyx_Buffer __pyx_pybuffer_pos;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_where;
  __Pyx_Buffer __pyx_pybuffer_where;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_x;
  __Pyx_Buffer __pyx_pybuffer_x;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_y;
  __Pyx_Buffer __pyx_pybuffer_y;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyArrayObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  double __pyx_t_12;
  Py_ssize_t __pyx_t_13;
  PyArrayObject *__pyx_t_14 = NULL;
  Py_ssize_t __pyx_t_15;
  int __pyx_t_16;
  Py_ssize_t __pyx_t_17;
  Py_ssize_t __pyx_t_18;
  Py_ssize_t __pyx_t_19;
  int __pyx_t_20;
  int __pyx_t_21;
  int __pyx_t_22;
  __pyx_t_8vcstring_DTYPE_t __pyx_t_23;
  PyArrayObject *__pyx_t_24 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("reparm_string", 0);
  __pyx_pybuffer_x.pybuffer.buf = NULL;
  __pyx_pybuffer_x.refcount = 0;
  __pyx_pybuffernd_x.data = NULL;
  __pyx_pybuffernd_x.rcbuffer = &__pyx_pybuffer_x;
  __pyx_pybuffer_y.pybuffer.buf = NULL;
  __pyx_pybuffer_y.refcount = 0;
  __pyx_pybuffernd_y.data = NULL;
  __pyx_pybuffernd_y.rcbuffer = &__pyx_pybuffer_y;
  __pyx_pybuffer_dist_im.pybuffer.buf = NULL;
  __pyx_pybuffer_dist_im.refcount = 0;
  __pyx_pybuffernd_dist_im.data = NULL;
  __pyx_pybuffernd_dist_im.rcbuffer = &__pyx_pybuffer_dist_im;
  __pyx_pybuffer_pos.pybuffer.buf = NULL;
  __pyx_pybuffer_pos.refcount = 0;
  __pyx_pybuffernd_pos.data = NULL;
  __pyx_pybuffernd_pos.rcbuffer = &__pyx_pybuffer_pos;
  __pyx_pybuffer_where.pybuffer.buf = NULL;
  __pyx_pybuffer_where.refcount = 0;
  __pyx_pybuffernd_where.data = NULL;
  __pyx_pybuffernd_where.rcbuffer = &__pyx_pybuffer_where;
  __pyx_pybuffer_grad.pybuffer.buf = NULL;
  __pyx_pybuffer_grad.refcount = 0;
  __pyx_pybuffernd_grad.data = NULL;
  __pyx_pybuffernd_grad.rcbuffer = &__pyx_pybuffer_grad;
  __pyx_pybuffer_M.pybuffer.buf = NULL;
  __pyx_pybuffer_M.refcount = 0;
  __pyx_pybuffernd_M.data = NULL;
  __pyx_pybuffernd_M.rcbuffer = &__pyx_pybuffer_M;
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1722, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];

  /* "vcstring.pyx":1730
 *     cdef list z_new
 * 
 *     print('\n=========================')             # <<<<<<<<<<<<<<
 *     print('REPARAMETRIZE THE STRING')
 *     print('=========================')
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1730, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1731
 * 
 *     print('\n=========================')
 *     print('REPARAMETRIZE THE STRING')             # <<<<<<<<<<<<<<
 *     print('=========================')
 *     x = z[:, 0]
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__77, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1731, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1732
 *     print('\n=========================')
 *     print('REPARAMETRIZE THE STRING')
 *     print('=========================')             # <<<<<<<<<<<<<<
 *     x = z[:, 0]
 *     y = z[:, 1]
 */
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1732, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1733
 *     print('REPARAMETRIZE THE STRING')
 *     print('=========================')
 *     x = z[:, 0]             # <<<<<<<<<<<<<<
 *     y = z[:, 1]
 *     dist_im = sqrt((x[1:] - x[0:-1]) ** 2 + (y[1:] - y[0:-1]) ** 2)  # distance between images
 */
  __pyx_t_1 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_z), __pyx_tuple__9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1733, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1733, __pyx_L1_error)
  __pyx_t_2 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_x.rcbuffer->pybuffer);
    __pyx_t_3 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_x.rcbuffer->pybuffer, (PyObject*)__pyx_t_2, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_3 < 0)) {
      PyErr_Fetch(&__pyx_t_4, &__pyx_t_5, &__pyx_t_6);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_x.rcbuffer->pybuffer, (PyObject*)__pyx_v_x, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_4); Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_4, __pyx_t_5, __pyx_t_6);
      }
      __pyx_t_4 = __pyx_t_5 = __pyx_t_6 = 0;
    }
    __pyx_pybuffernd_x.diminfo[0].strides = __pyx_pybuffernd_x.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_x.diminfo[0].shape = __pyx_pybuffernd_x.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1733, __pyx_L1_error)
  }
  __pyx_t_2 = 0;
  __pyx_v_x = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":1734
 *     print('=========================')
 *     x = z[:, 0]
 *     y = z[:, 1]             # <<<<<<<<<<<<<<
 *     dist_im = sqrt((x[1:] - x[0:-1]) ** 2 + (y[1:] - y[0:-1]) ** 2)  # distance between images
 *     dist_tot = sum(dist_im)  # Total distance of string
 */
  __pyx_t_1 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_z), __pyx_tuple__10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1734, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1734, __pyx_L1_error)
  __pyx_t_2 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_y.rcbuffer->pybuffer);
    __pyx_t_3 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_y.rcbuffer->pybuffer, (PyObject*)__pyx_t_2, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_3 < 0)) {
      PyErr_Fetch(&__pyx_t_6, &__pyx_t_5, &__pyx_t_4);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_y.rcbuffer->pybuffer, (PyObject*)__pyx_v_y, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_4);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_6, __pyx_t_5, __pyx_t_4);
      }
      __pyx_t_6 = __pyx_t_5 = __pyx_t_4 = 0;
    }
    __pyx_pybuffernd_y.diminfo[0].strides = __pyx_pybuffernd_y.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_y.diminfo[0].shape = __pyx_pybuffernd_y.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1734, __pyx_L1_error)
  }
  __pyx_t_2 = 0;
  __pyx_v_y = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":1735
 *     x = z[:, 0]
 *     y = z[:, 1]
 *     dist_im = sqrt((x[1:] - x[0:-1]) ** 2 + (y[1:] - y[0:-1]) ** 2)  # distance between images             # <<<<<<<<<<<<<<
 *     dist_tot = sum(dist_im)  # Total distance of string
 *     equidist = dist_tot / len(dist_im)  # Equidistance length between images
 */
  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1735, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_8 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_x), __pyx_slice__2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1735, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_9 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_x), __pyx_slice__78); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1735, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_10 = PyNumber_Subtract(__pyx_t_8, __pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1735, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = PyNumber_Power(__pyx_t_10, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1735, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_y), __pyx_slice__2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1735, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __pyx_t_8 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_y), __pyx_slice__78); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1735, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_11 = PyNumber_Subtract(__pyx_t_10, __pyx_t_8); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1735, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = PyNumber_Power(__pyx_t_11, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1735, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = PyNumber_Add(__pyx_t_9, __pyx_t_8); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1735, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
    }
  }
  __pyx_t_1 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_8, __pyx_t_11) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_11);
  __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1735, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1735, __pyx_L1_error)
  __pyx_t_2 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_im.rcbuffer->pybuffer);
    __pyx_t_3 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist_im.rcbuffer->pybuffer, (PyObject*)__pyx_t_2, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_3 < 0)) {
      PyErr_Fetch(&__pyx_t_4, &__pyx_t_5, &__pyx_t_6);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist_im.rcbuffer->pybuffer, (PyObject*)__pyx_v_dist_im, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_4); Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_4, __pyx_t_5, __pyx_t_6);
      }
      __pyx_t_4 = __pyx_t_5 = __pyx_t_6 = 0;
    }
    __pyx_pybuffernd_dist_im.diminfo[0].strides = __pyx_pybuffernd_dist_im.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_dist_im.diminfo[0].shape = __pyx_pybuffernd_dist_im.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1735, __pyx_L1_error)
  }
  __pyx_t_2 = 0;
  __pyx_v_dist_im = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":1736
 *     y = z[:, 1]
 *     dist_im = sqrt((x[1:] - x[0:-1]) ** 2 + (y[1:] - y[0:-1]) ** 2)  # distance between images
 *     dist_tot = sum(dist_im)  # Total distance of string             # <<<<<<<<<<<<<<
 *     equidist = dist_tot / len(dist_im)  # Equidistance length between images
 *     print('Distance between images:', dist_im)
 */
  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_sum, ((PyObject *)__pyx_v_dist_im)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1736, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1736, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_dist_tot = __pyx_t_12;

  /* "vcstring.pyx":1737
 *     dist_im = sqrt((x[1:] - x[0:-1]) ** 2 + (y[1:] - y[0:-1]) ** 2)  # distance between images
 *     dist_tot = sum(dist_im)  # Total distance of string
 *     equidist = dist_tot / len(dist_im)  # Equidistance length between images             # <<<<<<<<<<<<<<
 *     print('Distance between images:', dist_im)
 *     print('Total length of string:', dist_tot)
 */
  __pyx_t_13 = PyObject_Length(((PyObject *)__pyx_v_dist_im)); if (unlikely(__pyx_t_13 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1737, __pyx_L1_error)
  if (unlikely(__pyx_t_13 == 0)) {
    PyErr_SetString(PyExc_ZeroDivisionError, "float division");
    __PYX_ERR(0, 1737, __pyx_L1_error)
  }
  __pyx_v_equidist = (__pyx_v_dist_tot / ((double)__pyx_t_13));

  /* "vcstring.pyx":1738
 *     dist_tot = sum(dist_im)  # Total distance of string
 *     equidist = dist_tot / len(dist_im)  # Equidistance length between images
 *     print('Distance between images:', dist_im)             # <<<<<<<<<<<<<<
 *     print('Total length of string:', dist_tot)
 *     print('Equidistance:', equidist)
 */
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1738, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_Distance_between_images);
  __Pyx_GIVEREF(__pyx_kp_u_Distance_between_images);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Distance_between_images);
  __Pyx_INCREF(((PyObject *)__pyx_v_dist_im));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_dist_im));
  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_dist_im));
  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1738, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "vcstring.pyx":1739
 *     equidist = dist_tot / len(dist_im)  # Equidistance length between images
 *     print('Distance between images:', dist_im)
 *     print('Total length of string:', dist_tot)             # <<<<<<<<<<<<<<
 *     print('Equidistance:', equidist)
 *     print()
 */
  __pyx_t_7 = PyFloat_FromDouble(__pyx_v_dist_tot); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1739, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1739, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_Total_length_of_string);
  __Pyx_GIVEREF(__pyx_kp_u_Total_length_of_string);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Total_length_of_string);
  __Pyx_GIVEREF(__pyx_t_7);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_7);
  __pyx_t_7 = 0;
  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1739, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "vcstring.pyx":1740
 *     print('Distance between images:', dist_im)
 *     print('Total length of string:', dist_tot)
 *     print('Equidistance:', equidist)             # <<<<<<<<<<<<<<
 *     print()
 * 
 */
  __pyx_t_7 = PyFloat_FromDouble(__pyx_v_equidist); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1740, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1740, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_kp_u_Equidistance);
  __Pyx_GIVEREF(__pyx_kp_u_Equidistance);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Equidistance);
  __Pyx_GIVEREF(__pyx_t_7);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_7);
  __pyx_t_7 = 0;
  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_1, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1740, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "vcstring.pyx":1741
 *     print('Total length of string:', dist_tot)
 *     print('Equidistance:', equidist)
 *     print()             # <<<<<<<<<<<<<<
 * 
 *     grad = z[1:] - z[0:-1]  # unit gradient in x, y direction
 */
  __pyx_t_7 = __Pyx_PyObject_CallNoArg(__pyx_builtin_print); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1741, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "vcstring.pyx":1743
 *     print()
 * 
 *     grad = z[1:] - z[0:-1]  # unit gradient in x, y direction             # <<<<<<<<<<<<<<
 *     M = sqrt(grad[:, 0] ** 2 + grad[:, 1] ** 2).reshape(-1, 1)  # Magnitude of gradient
 *     grad = grad / M  # Unit vector pointing from one image to the next on string
 */
  __pyx_t_7 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_z), __pyx_slice__2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1743, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_1 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_z), __pyx_slice__78); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1743, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_11 = PyNumber_Subtract(__pyx_t_7, __pyx_t_1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1743, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_11) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_11, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1743, __pyx_L1_error)
  __pyx_t_14 = ((PyArrayObject *)__pyx_t_11);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_grad.rcbuffer->pybuffer);
    __pyx_t_3 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_grad.rcbuffer->pybuffer, (PyObject*)__pyx_t_14, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_3 < 0)) {
      PyErr_Fetch(&__pyx_t_6, &__pyx_t_5, &__pyx_t_4);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_grad.rcbuffer->pybuffer, (PyObject*)__pyx_v_grad, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_4);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_6, __pyx_t_5, __pyx_t_4);
      }
      __pyx_t_6 = __pyx_t_5 = __pyx_t_4 = 0;
    }
    __pyx_pybuffernd_grad.diminfo[0].strides = __pyx_pybuffernd_grad.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_grad.diminfo[0].shape = __pyx_pybuffernd_grad.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_grad.diminfo[1].strides = __pyx_pybuffernd_grad.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_grad.diminfo[1].shape = __pyx_pybuffernd_grad.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1743, __pyx_L1_error)
  }
  __pyx_t_14 = 0;
  __pyx_v_grad = ((PyArrayObject *)__pyx_t_11);
  __pyx_t_11 = 0;

  /* "vcstring.pyx":1744
 * 
 *     grad = z[1:] - z[0:-1]  # unit gradient in x, y direction
 *     M = sqrt(grad[:, 0] ** 2 + grad[:, 1] ** 2).reshape(-1, 1)  # Magnitude of gradient             # <<<<<<<<<<<<<<
 *     grad = grad / M  # Unit vector pointing from one image to the next on string
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1744, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_7 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_grad), __pyx_tuple__9); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1744, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_8 = PyNumber_Power(__pyx_t_7, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1744, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_grad), __pyx_tuple__10); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1744, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_9 = PyNumber_Power(__pyx_t_7, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1744, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = PyNumber_Add(__pyx_t_8, __pyx_t_9); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1744, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_9)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_9);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_11 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_9, __pyx_t_7) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_7);
  __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1744, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_reshape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1744, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_tuple__79, NULL); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1744, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_11) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_11, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1744, __pyx_L1_error)
  __pyx_t_14 = ((PyArrayObject *)__pyx_t_11);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_M.rcbuffer->pybuffer);
    __pyx_t_3 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_M.rcbuffer->pybuffer, (PyObject*)__pyx_t_14, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_3 < 0)) {
      PyErr_Fetch(&__pyx_t_4, &__pyx_t_5, &__pyx_t_6);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_M.rcbuffer->pybuffer, (PyObject*)__pyx_v_M, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_4); Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_4, __pyx_t_5, __pyx_t_6);
      }
      __pyx_t_4 = __pyx_t_5 = __pyx_t_6 = 0;
    }
    __pyx_pybuffernd_M.diminfo[0].strides = __pyx_pybuffernd_M.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_M.diminfo[0].shape = __pyx_pybuffernd_M.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_M.diminfo[1].strides = __pyx_pybuffernd_M.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_M.diminfo[1].shape = __pyx_pybuffernd_M.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1744, __pyx_L1_error)
  }
  __pyx_t_14 = 0;
  __pyx_v_M = ((PyArrayObject *)__pyx_t_11);
  __pyx_t_11 = 0;

  /* "vcstring.pyx":1745
 *     grad = z[1:] - z[0:-1]  # unit gradient in x, y direction
 *     M = sqrt(grad[:, 0] ** 2 + grad[:, 1] ** 2).reshape(-1, 1)  # Magnitude of gradient
 *     grad = grad / M  # Unit vector pointing from one image to the next on string             # <<<<<<<<<<<<<<
 * 
 *     z_new = []
 */
  __pyx_t_11 = __Pyx_PyNumber_Divide(((PyObject *)__pyx_v_grad), ((PyObject *)__pyx_v_M)); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1745, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  if (!(likely(((__pyx_t_11) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_11, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1745, __pyx_L1_error)
  __pyx_t_14 = ((PyArrayObject *)__pyx_t_11);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_grad.rcbuffer->pybuffer);
    __pyx_t_3 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_grad.rcbuffer->pybuffer, (PyObject*)__pyx_t_14, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_3 < 0)) {
      PyErr_Fetch(&__pyx_t_6, &__pyx_t_5, &__pyx_t_4);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_grad.rcbuffer->pybuffer, (PyObject*)__pyx_v_grad, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_4);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_6, __pyx_t_5, __pyx_t_4);
      }
      __pyx_t_6 = __pyx_t_5 = __pyx_t_4 = 0;
    }
    __pyx_pybuffernd_grad.diminfo[0].strides = __pyx_pybuffernd_grad.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_grad.diminfo[0].shape = __pyx_pybuffernd_grad.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_grad.diminfo[1].strides = __pyx_pybuffernd_grad.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_grad.diminfo[1].shape = __pyx_pybuffernd_grad.rcbuffer->pybuffer.shape[1];
    if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1745, __pyx_L1_error)
  }
  __pyx_t_14 = 0;
  __Pyx_DECREF_SET(__pyx_v_grad, ((PyArrayObject *)__pyx_t_11));
  __pyx_t_11 = 0;

  /* "vcstring.pyx":1747
 *     grad = grad / M  # Unit vector pointing from one image to the next on string
 * 
 *     z_new = []             # <<<<<<<<<<<<<<
 *     pos = deepcopy(z[0])
 *     z_new.append([pos[0], pos[1]])
 */
  __pyx_t_11 = PyList_New(0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1747, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_v_z_new = ((PyObject*)__pyx_t_11);
  __pyx_t_11 = 0;

  /* "vcstring.pyx":1748
 * 
 *     z_new = []
 *     pos = deepcopy(z[0])             # <<<<<<<<<<<<<<
 *     z_new.append([pos[0], pos[1]])
 *     for i in range(len(z)):
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_deepcopy); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1748, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_7 = __Pyx_GetItemInt(((PyObject *)__pyx_v_z), 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1748, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_9 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_9)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_9);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_11 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_9, __pyx_t_7) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_7);
  __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1748, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_11) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_11, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1748, __pyx_L1_error)
  __pyx_t_2 = ((PyArrayObject *)__pyx_t_11);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_pos.rcbuffer->pybuffer);
    __pyx_t_3 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_pos.rcbuffer->pybuffer, (PyObject*)__pyx_t_2, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_3 < 0)) {
      PyErr_Fetch(&__pyx_t_4, &__pyx_t_5, &__pyx_t_6);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_pos.rcbuffer->pybuffer, (PyObject*)__pyx_v_pos, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_4); Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_4, __pyx_t_5, __pyx_t_6);
      }
      __pyx_t_4 = __pyx_t_5 = __pyx_t_6 = 0;
    }
    __pyx_pybuffernd_pos.diminfo[0].strides = __pyx_pybuffernd_pos.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_pos.diminfo[0].shape = __pyx_pybuffernd_pos.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1748, __pyx_L1_error)
  }
  __pyx_t_2 = 0;
  __pyx_v_pos = ((PyArrayObject *)__pyx_t_11);
  __pyx_t_11 = 0;

  /* "vcstring.pyx":1749
 *     z_new = []
 *     pos = deepcopy(z[0])
 *     z_new.append([pos[0], pos[1]])             # <<<<<<<<<<<<<<
 *     for i in range(len(z)):
 *         d = 0.0  # Length of string between current image and previous image
 */
  __pyx_t_15 = 0;
  __pyx_t_3 = -1;
  if (__pyx_t_15 < 0) {
    __pyx_t_15 += __pyx_pybuffernd_pos.diminfo[0].shape;
    if (unlikely(__pyx_t_15 < 0)) __pyx_t_3 = 0;
  } else if (unlikely(__pyx_t_15 >= __pyx_pybuffernd_pos.diminfo[0].shape)) __pyx_t_3 = 0;
  if (unlikely(__pyx_t_3 != -1)) {
    __Pyx_RaiseBufferIndexError(__pyx_t_3);
    __PYX_ERR(0, 1749, __pyx_L1_error)
  }
  __pyx_t_11 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_pos.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_pos.diminfo[0].strides))); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1749, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_15 = 1;
  __pyx_t_3 = -1;
  if (__pyx_t_15 < 0) {
    __pyx_t_15 += __pyx_pybuffernd_pos.diminfo[0].shape;
    if (unlikely(__pyx_t_15 < 0)) __pyx_t_3 = 0;
  } else if (unlikely(__pyx_t_15 >= __pyx_pybuffernd_pos.diminfo[0].shape)) __pyx_t_3 = 0;
  if (unlikely(__pyx_t_3 != -1)) {
    __Pyx_RaiseBufferIndexError(__pyx_t_3);
    __PYX_ERR(0, 1749, __pyx_L1_error)
  }
  __pyx_t_1 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_pos.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_pos.diminfo[0].strides))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1749, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_7 = PyList_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1749, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_GIVEREF(__pyx_t_11);
  PyList_SET_ITEM(__pyx_t_7, 0, __pyx_t_11);
  __Pyx_GIVEREF(__pyx_t_1);
  PyList_SET_ITEM(__pyx_t_7, 1, __pyx_t_1);
  __pyx_t_11 = 0;
  __pyx_t_1 = 0;
  __pyx_t_16 = __Pyx_PyList_Append(__pyx_v_z_new, __pyx_t_7); if (unlikely(__pyx_t_16 == ((int)-1))) __PYX_ERR(0, 1749, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "vcstring.pyx":1750
 *     pos = deepcopy(z[0])
 *     z_new.append([pos[0], pos[1]])
 *     for i in range(len(z)):             # <<<<<<<<<<<<<<
 *         d = 0.0  # Length of string between current image and previous image
 *         # print(i)
 */
  __pyx_t_13 = PyObject_Length(((PyObject *)__pyx_v_z)); if (unlikely(__pyx_t_13 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1750, __pyx_L1_error)
  __pyx_t_17 = __pyx_t_13;
  for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_17; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;

    /* "vcstring.pyx":1751
 *     z_new.append([pos[0], pos[1]])
 *     for i in range(len(z)):
 *         d = 0.0  # Length of string between current image and previous image             # <<<<<<<<<<<<<<
 *         # print(i)
 *         # print('equidist:', equidist)
 */
    __pyx_v_d = 0.0;

    /* "vcstring.pyx":1755
 *         # print('equidist:', equidist)
 *         # print('initial pos:', pos)
 *         for j in range(len(dist_im)):             # <<<<<<<<<<<<<<
 *             # print(i, j)
 *             if d < equidist:
 */
    __pyx_t_18 = PyObject_Length(((PyObject *)__pyx_v_dist_im)); if (unlikely(__pyx_t_18 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1755, __pyx_L1_error)
    __pyx_t_19 = __pyx_t_18;
    for (__pyx_t_20 = 0; __pyx_t_20 < __pyx_t_19; __pyx_t_20+=1) {
      __pyx_v_j = __pyx_t_20;

      /* "vcstring.pyx":1757
 *         for j in range(len(dist_im)):
 *             # print(i, j)
 *             if d < equidist:             # <<<<<<<<<<<<<<
 *                 diff = equidist - d
 *                 # print('d, diff:', d, diff)
 */
      __pyx_t_21 = ((__pyx_v_d < __pyx_v_equidist) != 0);
      if (__pyx_t_21) {

        /* "vcstring.pyx":1758
 *             # print(i, j)
 *             if d < equidist:
 *                 diff = equidist - d             # <<<<<<<<<<<<<<
 *                 # print('d, diff:', d, diff)
 *                 # print('dist_im:', dist_im)
 */
        __pyx_v_diff = (__pyx_v_equidist - __pyx_v_d);

        /* "vcstring.pyx":1761
 *                 # print('d, diff:', d, diff)
 *                 # print('dist_im:', dist_im)
 *                 if dist_im[j] <= diff:             # <<<<<<<<<<<<<<
 *                     d += dist_im[j]
 *                     pos[0] += grad[j][0] * dist_im[j]
 */
        __pyx_t_15 = __pyx_v_j;
        __pyx_t_22 = -1;
        if (__pyx_t_15 < 0) {
          __pyx_t_15 += __pyx_pybuffernd_dist_im.diminfo[0].shape;
          if (unlikely(__pyx_t_15 < 0)) __pyx_t_22 = 0;
        } else if (unlikely(__pyx_t_15 >= __pyx_pybuffernd_dist_im.diminfo[0].shape)) __pyx_t_22 = 0;
        if (unlikely(__pyx_t_22 != -1)) {
          __Pyx_RaiseBufferIndexError(__pyx_t_22);
          __PYX_ERR(0, 1761, __pyx_L1_error)
        }
        __pyx_t_21 = (((*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_dist_im.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dist_im.diminfo[0].strides)) <= __pyx_v_diff) != 0);
        if (__pyx_t_21) {

          /* "vcstring.pyx":1762
 *                 # print('dist_im:', dist_im)
 *                 if dist_im[j] <= diff:
 *                     d += dist_im[j]             # <<<<<<<<<<<<<<
 *                     pos[0] += grad[j][0] * dist_im[j]
 *                     pos[1] += grad[j][1] * dist_im[j]
 */
          __pyx_t_15 = __pyx_v_j;
          __pyx_t_22 = -1;
          if (__pyx_t_15 < 0) {
            __pyx_t_15 += __pyx_pybuffernd_dist_im.diminfo[0].shape;
            if (unlikely(__pyx_t_15 < 0)) __pyx_t_22 = 0;
          } else if (unlikely(__pyx_t_15 >= __pyx_pybuffernd_dist_im.diminfo[0].shape)) __pyx_t_22 = 0;
          if (unlikely(__pyx_t_22 != -1)) {
            __Pyx_RaiseBufferIndexError(__pyx_t_22);
            __PYX_ERR(0, 1762, __pyx_L1_error)
          }
          __pyx_v_d = (__pyx_v_d + (*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_dist_im.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dist_im.diminfo[0].strides)));

          /* "vcstring.pyx":1763
 *                 if dist_im[j] <= diff:
 *                     d += dist_im[j]
 *                     pos[0] += grad[j][0] * dist_im[j]             # <<<<<<<<<<<<<<
 *                     pos[1] += grad[j][1] * dist_im[j]
 *                     dist_im[j] = 0.0
 */
          __pyx_t_7 = __Pyx_GetItemInt(((PyObject *)__pyx_v_grad), __pyx_v_j, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1763, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1763, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_15 = __pyx_v_j;
          __pyx_t_22 = -1;
          if (__pyx_t_15 < 0) {
            __pyx_t_15 += __pyx_pybuffernd_dist_im.diminfo[0].shape;
            if (unlikely(__pyx_t_15 < 0)) __pyx_t_22 = 0;
          } else if (unlikely(__pyx_t_15 >= __pyx_pybuffernd_dist_im.diminfo[0].shape)) __pyx_t_22 = 0;
          if (unlikely(__pyx_t_22 != -1)) {
            __Pyx_RaiseBufferIndexError(__pyx_t_22);
            __PYX_ERR(0, 1763, __pyx_L1_error)
          }
          __pyx_t_7 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_dist_im.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dist_im.diminfo[0].strides))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1763, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_11 = PyNumber_Multiply(__pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1763, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_11);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_23 = __pyx_PyFloat_AsDouble(__pyx_t_11); if (unlikely((__pyx_t_23 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1763, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
          __pyx_t_15 = 0;
          __pyx_t_22 = -1;
          if (__pyx_t_15 < 0) {
            __pyx_t_15 += __pyx_pybuffernd_pos.diminfo[0].shape;
            if (unlikely(__pyx_t_15 < 0)) __pyx_t_22 = 0;
          } else if (unlikely(__pyx_t_15 >= __pyx_pybuffernd_pos.diminfo[0].shape)) __pyx_t_22 = 0;
          if (unlikely(__pyx_t_22 != -1)) {
            __Pyx_RaiseBufferIndexError(__pyx_t_22);
            __PYX_ERR(0, 1763, __pyx_L1_error)
          }
          *__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_pos.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_pos.diminfo[0].strides) += __pyx_t_23;

          /* "vcstring.pyx":1764
 *                     d += dist_im[j]
 *                     pos[0] += grad[j][0] * dist_im[j]
 *                     pos[1] += grad[j][1] * dist_im[j]             # <<<<<<<<<<<<<<
 *                     dist_im[j] = 0.0
 *                 elif dist_im[j] >= diff:
 */
          __pyx_t_11 = __Pyx_GetItemInt(((PyObject *)__pyx_v_grad), __pyx_v_j, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1764, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_11);
          __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_11, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1764, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
          __pyx_t_15 = __pyx_v_j;
          __pyx_t_22 = -1;
          if (__pyx_t_15 < 0) {
            __pyx_t_15 += __pyx_pybuffernd_dist_im.diminfo[0].shape;
            if (unlikely(__pyx_t_15 < 0)) __pyx_t_22 = 0;
          } else if (unlikely(__pyx_t_15 >= __pyx_pybuffernd_dist_im.diminfo[0].shape)) __pyx_t_22 = 0;
          if (unlikely(__pyx_t_22 != -1)) {
            __Pyx_RaiseBufferIndexError(__pyx_t_22);
            __PYX_ERR(0, 1764, __pyx_L1_error)
          }
          __pyx_t_11 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_dist_im.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dist_im.diminfo[0].strides))); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1764, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_11);
          __pyx_t_1 = PyNumber_Multiply(__pyx_t_7, __pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1764, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
          __pyx_t_23 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_23 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1764, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_15 = 1;
          __pyx_t_22 = -1;
          if (__pyx_t_15 < 0) {
            __pyx_t_15 += __pyx_pybuffernd_pos.diminfo[0].shape;
            if (unlikely(__pyx_t_15 < 0)) __pyx_t_22 = 0;
          } else if (unlikely(__pyx_t_15 >= __pyx_pybuffernd_pos.diminfo[0].shape)) __pyx_t_22 = 0;
          if (unlikely(__pyx_t_22 != -1)) {
            __Pyx_RaiseBufferIndexError(__pyx_t_22);
            __PYX_ERR(0, 1764, __pyx_L1_error)
          }
          *__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_pos.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_pos.diminfo[0].strides) += __pyx_t_23;

          /* "vcstring.pyx":1765
 *                     pos[0] += grad[j][0] * dist_im[j]
 *                     pos[1] += grad[j][1] * dist_im[j]
 *                     dist_im[j] = 0.0             # <<<<<<<<<<<<<<
 *                 elif dist_im[j] >= diff:
 *                     d += diff
 */
          __pyx_t_15 = __pyx_v_j;
          __pyx_t_22 = -1;
          if (__pyx_t_15 < 0) {
            __pyx_t_15 += __pyx_pybuffernd_dist_im.diminfo[0].shape;
            if (unlikely(__pyx_t_15 < 0)) __pyx_t_22 = 0;
          } else if (unlikely(__pyx_t_15 >= __pyx_pybuffernd_dist_im.diminfo[0].shape)) __pyx_t_22 = 0;
          if (unlikely(__pyx_t_22 != -1)) {
            __Pyx_RaiseBufferIndexError(__pyx_t_22);
            __PYX_ERR(0, 1765, __pyx_L1_error)
          }
          *__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_dist_im.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dist_im.diminfo[0].strides) = 0.0;

          /* "vcstring.pyx":1761
 *                 # print('d, diff:', d, diff)
 *                 # print('dist_im:', dist_im)
 *                 if dist_im[j] <= diff:             # <<<<<<<<<<<<<<
 *                     d += dist_im[j]
 *                     pos[0] += grad[j][0] * dist_im[j]
 */
          goto __pyx_L8;
        }

        /* "vcstring.pyx":1766
 *                     pos[1] += grad[j][1] * dist_im[j]
 *                     dist_im[j] = 0.0
 *                 elif dist_im[j] >= diff:             # <<<<<<<<<<<<<<
 *                     d += diff
 *                     pos[0] += grad[j][0] * diff
 */
        __pyx_t_15 = __pyx_v_j;
        __pyx_t_22 = -1;
        if (__pyx_t_15 < 0) {
          __pyx_t_15 += __pyx_pybuffernd_dist_im.diminfo[0].shape;
          if (unlikely(__pyx_t_15 < 0)) __pyx_t_22 = 0;
        } else if (unlikely(__pyx_t_15 >= __pyx_pybuffernd_dist_im.diminfo[0].shape)) __pyx_t_22 = 0;
        if (unlikely(__pyx_t_22 != -1)) {
          __Pyx_RaiseBufferIndexError(__pyx_t_22);
          __PYX_ERR(0, 1766, __pyx_L1_error)
        }
        __pyx_t_21 = (((*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_dist_im.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dist_im.diminfo[0].strides)) >= __pyx_v_diff) != 0);
        if (__pyx_t_21) {

          /* "vcstring.pyx":1767
 *                     dist_im[j] = 0.0
 *                 elif dist_im[j] >= diff:
 *                     d += diff             # <<<<<<<<<<<<<<
 *                     pos[0] += grad[j][0] * diff
 *                     pos[1] += grad[j][1] * diff
 */
          __pyx_v_d = (__pyx_v_d + __pyx_v_diff);

          /* "vcstring.pyx":1768
 *                 elif dist_im[j] >= diff:
 *                     d += diff
 *                     pos[0] += grad[j][0] * diff             # <<<<<<<<<<<<<<
 *                     pos[1] += grad[j][1] * diff
 *                     dist_im[j] -= diff
 */
          __pyx_t_1 = __Pyx_GetItemInt(((PyObject *)__pyx_v_grad), __pyx_v_j, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1768, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_11 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1768, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_11);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = PyFloat_FromDouble(__pyx_v_diff); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1768, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_7 = PyNumber_Multiply(__pyx_t_11, __pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1768, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_23 = __pyx_PyFloat_AsDouble(__pyx_t_7); if (unlikely((__pyx_t_23 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1768, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_15 = 0;
          __pyx_t_22 = -1;
          if (__pyx_t_15 < 0) {
            __pyx_t_15 += __pyx_pybuffernd_pos.diminfo[0].shape;
            if (unlikely(__pyx_t_15 < 0)) __pyx_t_22 = 0;
          } else if (unlikely(__pyx_t_15 >= __pyx_pybuffernd_pos.diminfo[0].shape)) __pyx_t_22 = 0;
          if (unlikely(__pyx_t_22 != -1)) {
            __Pyx_RaiseBufferIndexError(__pyx_t_22);
            __PYX_ERR(0, 1768, __pyx_L1_error)
          }
          *__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_pos.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_pos.diminfo[0].strides) += __pyx_t_23;

          /* "vcstring.pyx":1769
 *                     d += diff
 *                     pos[0] += grad[j][0] * diff
 *                     pos[1] += grad[j][1] * diff             # <<<<<<<<<<<<<<
 *                     dist_im[j] -= diff
 *                 # print('new dist_im:', dist_im)
 */
          __pyx_t_7 = __Pyx_GetItemInt(((PyObject *)__pyx_v_grad), __pyx_v_j, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1769, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_7, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1769, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_7 = PyFloat_FromDouble(__pyx_v_diff); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1769, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_11 = PyNumber_Multiply(__pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1769, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_11);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_23 = __pyx_PyFloat_AsDouble(__pyx_t_11); if (unlikely((__pyx_t_23 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1769, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
          __pyx_t_15 = 1;
          __pyx_t_22 = -1;
          if (__pyx_t_15 < 0) {
            __pyx_t_15 += __pyx_pybuffernd_pos.diminfo[0].shape;
            if (unlikely(__pyx_t_15 < 0)) __pyx_t_22 = 0;
          } else if (unlikely(__pyx_t_15 >= __pyx_pybuffernd_pos.diminfo[0].shape)) __pyx_t_22 = 0;
          if (unlikely(__pyx_t_22 != -1)) {
            __Pyx_RaiseBufferIndexError(__pyx_t_22);
            __PYX_ERR(0, 1769, __pyx_L1_error)
          }
          *__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_pos.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_pos.diminfo[0].strides) += __pyx_t_23;

          /* "vcstring.pyx":1770
 *                     pos[0] += grad[j][0] * diff
 *                     pos[1] += grad[j][1] * diff
 *                     dist_im[j] -= diff             # <<<<<<<<<<<<<<
 *                 # print('new dist_im:', dist_im)
 *                 # print('new d:', d)
 */
          __pyx_t_15 = __pyx_v_j;
          __pyx_t_22 = -1;
          if (__pyx_t_15 < 0) {
            __pyx_t_15 += __pyx_pybuffernd_dist_im.diminfo[0].shape;
            if (unlikely(__pyx_t_15 < 0)) __pyx_t_22 = 0;
          } else if (unlikely(__pyx_t_15 >= __pyx_pybuffernd_dist_im.diminfo[0].shape)) __pyx_t_22 = 0;
          if (unlikely(__pyx_t_22 != -1)) {
            __Pyx_RaiseBufferIndexError(__pyx_t_22);
            __PYX_ERR(0, 1770, __pyx_L1_error)
          }
          *__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_dist_im.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dist_im.diminfo[0].strides) -= __pyx_v_diff;

          /* "vcstring.pyx":1766
 *                     pos[1] += grad[j][1] * dist_im[j]
 *                     dist_im[j] = 0.0
 *                 elif dist_im[j] >= diff:             # <<<<<<<<<<<<<<
 *                     d += diff
 *                     pos[0] += grad[j][0] * diff
 */
        }
        __pyx_L8:;

        /* "vcstring.pyx":1776
 *                 # print(d == equidist)
 * 
 *                 if round(d, 5) == round(equidist, 5):             # <<<<<<<<<<<<<<
 *                     # print(d == equidist)
 *                     z_new.append([pos[0], pos[1]])
 */
        __pyx_t_11 = PyFloat_FromDouble(__pyx_v_d); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1776, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_11);
        __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1776, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_GIVEREF(__pyx_t_11);
        PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_11);
        __Pyx_INCREF(__pyx_int_5);
        __Pyx_GIVEREF(__pyx_int_5);
        PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_int_5);
        __pyx_t_11 = 0;
        __pyx_t_11 = __Pyx_PyObject_Call(__pyx_builtin_round, __pyx_t_7, NULL); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1776, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_11);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_7 = PyFloat_FromDouble(__pyx_v_equidist); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1776, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1776, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_GIVEREF(__pyx_t_7);
        PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_7);
        __Pyx_INCREF(__pyx_int_5);
        __Pyx_GIVEREF(__pyx_int_5);
        PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_int_5);
        __pyx_t_7 = 0;
        __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_round, __pyx_t_1, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1776, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = PyObject_RichCompare(__pyx_t_11, __pyx_t_7, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1776, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 1776, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        if (__pyx_t_21) {

          /* "vcstring.pyx":1778
 *                 if round(d, 5) == round(equidist, 5):
 *                     # print(d == equidist)
 *                     z_new.append([pos[0], pos[1]])             # <<<<<<<<<<<<<<
 *                     break
 *         where = np.where(dist_im == 0)[0]
 */
          __pyx_t_15 = 0;
          __pyx_t_22 = -1;
          if (__pyx_t_15 < 0) {
            __pyx_t_15 += __pyx_pybuffernd_pos.diminfo[0].shape;
            if (unlikely(__pyx_t_15 < 0)) __pyx_t_22 = 0;
          } else if (unlikely(__pyx_t_15 >= __pyx_pybuffernd_pos.diminfo[0].shape)) __pyx_t_22 = 0;
          if (unlikely(__pyx_t_22 != -1)) {
            __Pyx_RaiseBufferIndexError(__pyx_t_22);
            __PYX_ERR(0, 1778, __pyx_L1_error)
          }
          __pyx_t_1 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_pos.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_pos.diminfo[0].strides))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1778, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_15 = 1;
          __pyx_t_22 = -1;
          if (__pyx_t_15 < 0) {
            __pyx_t_15 += __pyx_pybuffernd_pos.diminfo[0].shape;
            if (unlikely(__pyx_t_15 < 0)) __pyx_t_22 = 0;
          } else if (unlikely(__pyx_t_15 >= __pyx_pybuffernd_pos.diminfo[0].shape)) __pyx_t_22 = 0;
          if (unlikely(__pyx_t_22 != -1)) {
            __Pyx_RaiseBufferIndexError(__pyx_t_22);
            __PYX_ERR(0, 1778, __pyx_L1_error)
          }
          __pyx_t_7 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(__pyx_t_8vcstring_DTYPE_t *, __pyx_pybuffernd_pos.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_pos.diminfo[0].strides))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1778, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_11 = PyList_New(2); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1778, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_11);
          __Pyx_GIVEREF(__pyx_t_1);
          PyList_SET_ITEM(__pyx_t_11, 0, __pyx_t_1);
          __Pyx_GIVEREF(__pyx_t_7);
          PyList_SET_ITEM(__pyx_t_11, 1, __pyx_t_7);
          __pyx_t_1 = 0;
          __pyx_t_7 = 0;
          __pyx_t_16 = __Pyx_PyList_Append(__pyx_v_z_new, __pyx_t_11); if (unlikely(__pyx_t_16 == ((int)-1))) __PYX_ERR(0, 1778, __pyx_L1_error)
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;

          /* "vcstring.pyx":1779
 *                     # print(d == equidist)
 *                     z_new.append([pos[0], pos[1]])
 *                     break             # <<<<<<<<<<<<<<
 *         where = np.where(dist_im == 0)[0]
 *         dist_im = np.delete(dist_im, where)
 */
          goto __pyx_L6_break;

          /* "vcstring.pyx":1776
 *                 # print(d == equidist)
 * 
 *                 if round(d, 5) == round(equidist, 5):             # <<<<<<<<<<<<<<
 *                     # print(d == equidist)
 *                     z_new.append([pos[0], pos[1]])
 */
        }

        /* "vcstring.pyx":1757
 *         for j in range(len(dist_im)):
 *             # print(i, j)
 *             if d < equidist:             # <<<<<<<<<<<<<<
 *                 diff = equidist - d
 *                 # print('d, diff:', d, diff)
 */
      }
    }
    __pyx_L6_break:;

    /* "vcstring.pyx":1780
 *                     z_new.append([pos[0], pos[1]])
 *                     break
 *         where = np.where(dist_im == 0)[0]             # <<<<<<<<<<<<<<
 *         dist_im = np.delete(dist_im, where)
 *         grad = np.delete(grad, where, axis=0)
 */
    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1780, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_where); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1780, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = PyObject_RichCompare(((PyObject *)__pyx_v_dist_im), __pyx_int_0, Py_EQ); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1780, __pyx_L1_error)
    __pyx_t_9 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
      }
    }
    __pyx_t_11 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_9, __pyx_t_7) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_7);
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1780, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_11, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1780, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1780, __pyx_L1_error)
    __pyx_t_24 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_where.rcbuffer->pybuffer);
      __pyx_t_20 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_where.rcbuffer->pybuffer, (PyObject*)__pyx_t_24, &__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_20 < 0)) {
        PyErr_Fetch(&__pyx_t_6, &__pyx_t_5, &__pyx_t_4);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_where.rcbuffer->pybuffer, (PyObject*)__pyx_v_where, &__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_4);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_6, __pyx_t_5, __pyx_t_4);
        }
        __pyx_t_6 = __pyx_t_5 = __pyx_t_4 = 0;
      }
      __pyx_pybuffernd_where.diminfo[0].strides = __pyx_pybuffernd_where.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_where.diminfo[0].shape = __pyx_pybuffernd_where.rcbuffer->pybuffer.shape[0];
      if (unlikely(__pyx_t_20 < 0)) __PYX_ERR(0, 1780, __pyx_L1_error)
    }
    __pyx_t_24 = 0;
    __Pyx_XDECREF_SET(__pyx_v_where, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "vcstring.pyx":1781
 *                     break
 *         where = np.where(dist_im == 0)[0]
 *         dist_im = np.delete(dist_im, where)             # <<<<<<<<<<<<<<
 *         grad = np.delete(grad, where, axis=0)
 *         # print(z_new)
 */
    __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1781, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_delete); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1781, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_11 = NULL;
    __pyx_t_20 = 0;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_11)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_11);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
        __pyx_t_20 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(__pyx_t_7)) {
      PyObject *__pyx_temp[3] = {__pyx_t_11, ((PyObject *)__pyx_v_dist_im), ((PyObject *)__pyx_v_where)};
      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_20, 2+__pyx_t_20); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1781, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
      PyObject *__pyx_temp[3] = {__pyx_t_11, ((PyObject *)__pyx_v_dist_im), ((PyObject *)__pyx_v_where)};
      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_20, 2+__pyx_t_20); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1781, __pyx_L1_error)
      __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
      __Pyx_GOTREF(__pyx_t_1);
    } else
    #endif
    {
      __pyx_t_9 = PyTuple_New(2+__pyx_t_20); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1781, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      if (__pyx_t_11) {
        __Pyx_GIVEREF(__pyx_t_11); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_11); __pyx_t_11 = NULL;
      }
      __Pyx_INCREF(((PyObject *)__pyx_v_dist_im));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_dist_im));
      PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_20, ((PyObject *)__pyx_v_dist_im));
      __Pyx_INCREF(((PyObject *)__pyx_v_where));
      __Pyx_GIVEREF(((PyObject *)__pyx_v_where));
      PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_20, ((PyObject *)__pyx_v_where));
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_9, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1781, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1781, __pyx_L1_error)
    __pyx_t_2 = ((PyArrayObject *)__pyx_t_1);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_im.rcbuffer->pybuffer);
      __pyx_t_20 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist_im.rcbuffer->pybuffer, (PyObject*)__pyx_t_2, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_20 < 0)) {
        PyErr_Fetch(&__pyx_t_4, &__pyx_t_5, &__pyx_t_6);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist_im.rcbuffer->pybuffer, (PyObject*)__pyx_v_dist_im, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_4); Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_4, __pyx_t_5, __pyx_t_6);
        }
        __pyx_t_4 = __pyx_t_5 = __pyx_t_6 = 0;
      }
      __pyx_pybuffernd_dist_im.diminfo[0].strides = __pyx_pybuffernd_dist_im.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_dist_im.diminfo[0].shape = __pyx_pybuffernd_dist_im.rcbuffer->pybuffer.shape[0];
      if (unlikely(__pyx_t_20 < 0)) __PYX_ERR(0, 1781, __pyx_L1_error)
    }
    __pyx_t_2 = 0;
    __Pyx_DECREF_SET(__pyx_v_dist_im, ((PyArrayObject *)__pyx_t_1));
    __pyx_t_1 = 0;

    /* "vcstring.pyx":1782
 *         where = np.where(dist_im == 0)[0]
 *         dist_im = np.delete(dist_im, where)
 *         grad = np.delete(grad, where, axis=0)             # <<<<<<<<<<<<<<
 *         # print(z_new)
 *         # print()
 */
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1782, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_delete); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1782, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1782, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(((PyObject *)__pyx_v_grad));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_grad));
    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_grad));
    __Pyx_INCREF(((PyObject *)__pyx_v_where));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_where));
    PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_where));
    __pyx_t_9 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1782, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    if (PyDict_SetItem(__pyx_t_9, __pyx_n_s_axis, __pyx_int_0) < 0) __PYX_ERR(0, 1782, __pyx_L1_error)
    __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_1, __pyx_t_9); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1782, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (!(likely(((__pyx_t_11) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_11, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1782, __pyx_L1_error)
    __pyx_t_14 = ((PyArrayObject *)__pyx_t_11);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_grad.rcbuffer->pybuffer);
      __pyx_t_20 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_grad.rcbuffer->pybuffer, (PyObject*)__pyx_t_14, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
      if (unlikely(__pyx_t_20 < 0)) {
        PyErr_Fetch(&__pyx_t_6, &__pyx_t_5, &__pyx_t_4);
        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_grad.rcbuffer->pybuffer, (PyObject*)__pyx_v_grad, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_4);
          __Pyx_RaiseBufferFallbackError();
        } else {
          PyErr_Restore(__pyx_t_6, __pyx_t_5, __pyx_t_4);
        }
        __pyx_t_6 = __pyx_t_5 = __pyx_t_4 = 0;
      }
      __pyx_pybuffernd_grad.diminfo[0].strides = __pyx_pybuffernd_grad.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_grad.diminfo[0].shape = __pyx_pybuffernd_grad.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_grad.diminfo[1].strides = __pyx_pybuffernd_grad.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_grad.diminfo[1].shape = __pyx_pybuffernd_grad.rcbuffer->pybuffer.shape[1];
      if (unlikely(__pyx_t_20 < 0)) __PYX_ERR(0, 1782, __pyx_L1_error)
    }
    __pyx_t_14 = 0;
    __Pyx_DECREF_SET(__pyx_v_grad, ((PyArrayObject *)__pyx_t_11));
    __pyx_t_11 = 0;
  }

  /* "vcstring.pyx":1785
 *         # print(z_new)
 *         # print()
 *     z_new_arr = np.asarray(z_new)             # <<<<<<<<<<<<<<
 *     print('\nReparametrized string =\n', z_new_arr)
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1785, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_asarray); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1785, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_9)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_9);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
    }
  }
  __pyx_t_11 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_9, __pyx_v_z_new) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_z_new);
  __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1785, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_z_new_arr = __pyx_t_11;
  __pyx_t_11 = 0;

  /* "vcstring.pyx":1786
 *         # print()
 *     z_new_arr = np.asarray(z_new)
 *     print('\nReparametrized string =\n', z_new_arr)             # <<<<<<<<<<<<<<
 * 
 *     # Check reparametrized string
 */
  __pyx_t_11 = PyTuple_New(2); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1786, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_INCREF(__pyx_kp_u_Reparametrized_string);
  __Pyx_GIVEREF(__pyx_kp_u_Reparametrized_string);
  PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_kp_u_Reparametrized_string);
  __Pyx_INCREF(__pyx_v_z_new_arr);
  __Pyx_GIVEREF(__pyx_v_z_new_arr);
  PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_v_z_new_arr);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_11, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1786, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1789
 * 
 *     # Check reparametrized string
 *     x = z_new_arr[:, 0]             # <<<<<<<<<<<<<<
 *     y = z_new_arr[:, 1]
 *     dist_im = sqrt((x[1:] - x[0:-1]) ** 2 + (y[1:] - y[0:-1]) ** 2)  # distance between images
 */
  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_z_new_arr, __pyx_tuple__9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1789, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1789, __pyx_L1_error)
  __pyx_t_2 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_x.rcbuffer->pybuffer);
    __pyx_t_3 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_x.rcbuffer->pybuffer, (PyObject*)__pyx_t_2, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_3 < 0)) {
      PyErr_Fetch(&__pyx_t_4, &__pyx_t_5, &__pyx_t_6);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_x.rcbuffer->pybuffer, (PyObject*)__pyx_v_x, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_4); Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_4, __pyx_t_5, __pyx_t_6);
      }
      __pyx_t_4 = __pyx_t_5 = __pyx_t_6 = 0;
    }
    __pyx_pybuffernd_x.diminfo[0].strides = __pyx_pybuffernd_x.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_x.diminfo[0].shape = __pyx_pybuffernd_x.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1789, __pyx_L1_error)
  }
  __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_x, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;

  /* "vcstring.pyx":1790
 *     # Check reparametrized string
 *     x = z_new_arr[:, 0]
 *     y = z_new_arr[:, 1]             # <<<<<<<<<<<<<<
 *     dist_im = sqrt((x[1:] - x[0:-1]) ** 2 + (y[1:] - y[0:-1]) ** 2)  # distance between images
 *     dist_tot = sum(dist_im)  # Total distance of string
 */
  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_z_new_arr, __pyx_tuple__10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1790, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1790, __pyx_L1_error)
  __pyx_t_2 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_y.rcbuffer->pybuffer);
    __pyx_t_3 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_y.rcbuffer->pybuffer, (PyObject*)__pyx_t_2, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_3 < 0)) {
      PyErr_Fetch(&__pyx_t_6, &__pyx_t_5, &__pyx_t_4);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_y.rcbuffer->pybuffer, (PyObject*)__pyx_v_y, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_4);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_6, __pyx_t_5, __pyx_t_4);
      }
      __pyx_t_6 = __pyx_t_5 = __pyx_t_4 = 0;
    }
    __pyx_pybuffernd_y.diminfo[0].strides = __pyx_pybuffernd_y.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_y.diminfo[0].shape = __pyx_pybuffernd_y.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1790, __pyx_L1_error)
  }
  __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_y, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;

  /* "vcstring.pyx":1791
 *     x = z_new_arr[:, 0]
 *     y = z_new_arr[:, 1]
 *     dist_im = sqrt((x[1:] - x[0:-1]) ** 2 + (y[1:] - y[0:-1]) ** 2)  # distance between images             # <<<<<<<<<<<<<<
 *     dist_tot = sum(dist_im)  # Total distance of string
 *     equidist = dist_tot / len(dist_im)  # Equidistance length between images
 */
  __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1791, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_9 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_x), __pyx_slice__2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1791, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_7 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_x), __pyx_slice__78); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1791, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_8 = PyNumber_Subtract(__pyx_t_9, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1791, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = PyNumber_Power(__pyx_t_8, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1791, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_y), __pyx_slice__2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1791, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_9 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_y), __pyx_slice__78); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1791, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_10 = PyNumber_Subtract(__pyx_t_8, __pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1791, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = PyNumber_Power(__pyx_t_10, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1791, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = PyNumber_Add(__pyx_t_7, __pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1791, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_11);
    if (likely(__pyx_t_9)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
      __Pyx_INCREF(__pyx_t_9);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_11, function);
    }
  }
  __pyx_t_1 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_9, __pyx_t_10) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_t_10);
  __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1791, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 1791, __pyx_L1_error)
  __pyx_t_2 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_im.rcbuffer->pybuffer);
    __pyx_t_3 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist_im.rcbuffer->pybuffer, (PyObject*)__pyx_t_2, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_3 < 0)) {
      PyErr_Fetch(&__pyx_t_4, &__pyx_t_5, &__pyx_t_6);
      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dist_im.rcbuffer->pybuffer, (PyObject*)__pyx_v_dist_im, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_4); Py_XDECREF(__pyx_t_5); Py_XDECREF(__pyx_t_6);
        __Pyx_RaiseBufferFallbackError();
      } else {
        PyErr_Restore(__pyx_t_4, __pyx_t_5, __pyx_t_6);
      }
      __pyx_t_4 = __pyx_t_5 = __pyx_t_6 = 0;
    }
    __pyx_pybuffernd_dist_im.diminfo[0].strides = __pyx_pybuffernd_dist_im.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_dist_im.diminfo[0].shape = __pyx_pybuffernd_dist_im.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1791, __pyx_L1_error)
  }
  __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_dist_im, ((PyArrayObject *)__pyx_t_1));
  __pyx_t_1 = 0;

  /* "vcstring.pyx":1792
 *     y = z_new_arr[:, 1]
 *     dist_im = sqrt((x[1:] - x[0:-1]) ** 2 + (y[1:] - y[0:-1]) ** 2)  # distance between images
 *     dist_tot = sum(dist_im)  # Total distance of string             # <<<<<<<<<<<<<<
 *     equidist = dist_tot / len(dist_im)  # Equidistance length between images
 *     print('\nLength input, output:', len(z), len(z_new_arr))
 */
  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_sum, ((PyObject *)__pyx_v_dist_im)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1792, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1792, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_dist_tot = __pyx_t_12;

  /* "vcstring.pyx":1793
 *     dist_im = sqrt((x[1:] - x[0:-1]) ** 2 + (y[1:] - y[0:-1]) ** 2)  # distance between images
 *     dist_tot = sum(dist_im)  # Total distance of string
 *     equidist = dist_tot / len(dist_im)  # Equidistance length between images             # <<<<<<<<<<<<<<
 *     print('\nLength input, output:', len(z), len(z_new_arr))
 *     print('Length input string = output string:', len(z) == len(z_new_arr))
 */
  __pyx_t_13 = PyObject_Length(((PyObject *)__pyx_v_dist_im)); if (unlikely(__pyx_t_13 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1793, __pyx_L1_error)
  if (unlikely(__pyx_t_13 == 0)) {
    PyErr_SetString(PyExc_ZeroDivisionError, "float division");
    __PYX_ERR(0, 1793, __pyx_L1_error)
  }
  __pyx_v_equidist = (__pyx_v_dist_tot / ((double)__pyx_t_13));

  /* "vcstring.pyx":1794
 *     dist_tot = sum(dist_im)  # Total distance of string
 *     equidist = dist_tot / len(dist_im)  # Equidistance length between images
 *     print('\nLength input, output:', len(z), len(z_new_arr))             # <<<<<<<<<<<<<<
 *     print('Length input string = output string:', len(z) == len(z_new_arr))
 *     print('Distance between images:', dist_im)
 */
  __pyx_t_13 = PyObject_Length(((PyObject *)__pyx_v_z)); if (unlikely(__pyx_t_13 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1794, __pyx_L1_error)
  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_13); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_13 = PyObject_Length(__pyx_v_z_new_arr); if (unlikely(__pyx_t_13 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1794, __pyx_L1_error)
  __pyx_t_11 = PyInt_FromSsize_t(__pyx_t_13); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_10 = PyTuple_New(3); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_INCREF(__pyx_kp_u_Length_input_output);
  __Pyx_GIVEREF(__pyx_kp_u_Length_input_output);
  PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_kp_u_Length_input_output);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_11);
  PyTuple_SET_ITEM(__pyx_t_10, 2, __pyx_t_11);
  __pyx_t_1 = 0;
  __pyx_t_11 = 0;
  __pyx_t_11 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_10, NULL); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;

  /* "vcstring.pyx":1795
 *     equidist = dist_tot / len(dist_im)  # Equidistance length between images
 *     print('\nLength input, output:', len(z), len(z_new_arr))
 *     print('Length input string = output string:', len(z) == len(z_new_arr))             # <<<<<<<<<<<<<<
 *     print('Distance between images:', dist_im)
 *     print('Total length of string:', dist_tot)
 */
  __pyx_t_13 = PyObject_Length(((PyObject *)__pyx_v_z)); if (unlikely(__pyx_t_13 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1795, __pyx_L1_error)
  __pyx_t_17 = PyObject_Length(__pyx_v_z_new_arr); if (unlikely(__pyx_t_17 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1795, __pyx_L1_error)
  __pyx_t_11 = __Pyx_PyBool_FromLong((__pyx_t_13 == __pyx_t_17)); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1795, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1795, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_INCREF(__pyx_kp_u_Length_input_string_output_strin);
  __Pyx_GIVEREF(__pyx_kp_u_Length_input_string_output_strin);
  PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_kp_u_Length_input_string_output_strin);
  __Pyx_GIVEREF(__pyx_t_11);
  PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_11);
  __pyx_t_11 = 0;
  __pyx_t_11 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_10, NULL); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1795, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;

  /* "vcstring.pyx":1796
 *     print('\nLength input, output:', len(z), len(z_new_arr))
 *     print('Length input string = output string:', len(z) == len(z_new_arr))
 *     print('Distance between images:', dist_im)             # <<<<<<<<<<<<<<
 *     print('Total length of string:', dist_tot)
 *     print('Equidistance:', equidist)
 */
  __pyx_t_11 = PyTuple_New(2); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1796, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_INCREF(__pyx_kp_u_Distance_between_images);
  __Pyx_GIVEREF(__pyx_kp_u_Distance_between_images);
  PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_kp_u_Distance_between_images);
  __Pyx_INCREF(((PyObject *)__pyx_v_dist_im));
  __Pyx_GIVEREF(((PyObject *)__pyx_v_dist_im));
  PyTuple_SET_ITEM(__pyx_t_11, 1, ((PyObject *)__pyx_v_dist_im));
  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_11, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1796, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "vcstring.pyx":1797
 *     print('Length input string = output string:', len(z) == len(z_new_arr))
 *     print('Distance between images:', dist_im)
 *     print('Total length of string:', dist_tot)             # <<<<<<<<<<<<<<
 *     print('Equidistance:', equidist)
 *     if len(z) != len(z_new_arr):
 */
  __pyx_t_10 = PyFloat_FromDouble(__pyx_v_dist_tot); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1797, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __pyx_t_11 = PyTuple_New(2); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1797, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_INCREF(__pyx_kp_u_Total_length_of_string);
  __Pyx_GIVEREF(__pyx_kp_u_Total_length_of_string);
  PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_kp_u_Total_length_of_string);
  __Pyx_GIVEREF(__pyx_t_10);
  PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_10);
  __pyx_t_10 = 0;
  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_11, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1797, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "vcstring.pyx":1798
 *     print('Distance between images:', dist_im)
 *     print('Total length of string:', dist_tot)
 *     print('Equidistance:', equidist)             # <<<<<<<<<<<<<<
 *     if len(z) != len(z_new_arr):
 *         print('ERROR, length of input string != output string')
 */
  __pyx_t_10 = PyFloat_FromDouble(__pyx_v_equidist); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1798, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __pyx_t_11 = PyTuple_New(2); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1798, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_INCREF(__pyx_kp_u_Equidistance);
  __Pyx_GIVEREF(__pyx_kp_u_Equidistance);
  PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_kp_u_Equidistance);
  __Pyx_GIVEREF(__pyx_t_10);
  PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_10);
  __pyx_t_10 = 0;
  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_t_11, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1798, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "vcstring.pyx":1799
 *     print('Total length of string:', dist_tot)
 *     print('Equidistance:', equidist)
 *     if len(z) != len(z_new_arr):             # <<<<<<<<<<<<<<
 *         print('ERROR, length of input string != output string')
 *         return
 */
  __pyx_t_17 = PyObject_Length(((PyObject *)__pyx_v_z)); if (unlikely(__pyx_t_17 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1799, __pyx_L1_error)
  __pyx_t_13 = PyObject_Length(__pyx_v_z_new_arr); if (unlikely(__pyx_t_13 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1799, __pyx_L1_error)
  __pyx_t_21 = ((__pyx_t_17 != __pyx_t_13) != 0);
  if (__pyx_t_21) {

    /* "vcstring.pyx":1800
 *     print('Equidistance:', equidist)
 *     if len(z) != len(z_new_arr):
 *         print('ERROR, length of input string != output string')             # <<<<<<<<<<<<<<
 *         return
 * 
 */
    __pyx_t_10 = __Pyx_PyObject_Call(__pyx_builtin_print, __pyx_tuple__80, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1800, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

    /* "vcstring.pyx":1801
 *     if len(z) != len(z_new_arr):
 *         print('ERROR, length of input string != output string')
 *         return             # <<<<<<<<<<<<<<
 * 
 *     return z_new_arr
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "vcstring.pyx":1799
 *     print('Total length of string:', dist_tot)
 *     print('Equidistance:', equidist)
 *     if len(z) != len(z_new_arr):             # <<<<<<<<<<<<<<
 *         print('ERROR, length of input string != output string')
 *         return
 */
  }

  /* "vcstring.pyx":1803
 *         return
 * 
 *     return z_new_arr             # <<<<<<<<<<<<<<
 * 
 * cpdef elliptical_bounds_params(double ra=1.0, double rb=0.4, double alpha=58.0, double x0_A=-2.2, double y0_A=-2.2, double x0_B=2.2, double y0_B=2.2):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_z_new_arr);
  __pyx_r = __pyx_v_z_new_arr;
  goto __pyx_L0;

  /* "vcstring.pyx":1722
 *         return
 * 
 * cpdef reparm_string(np.ndarray[DTYPE_t, ndim=2] z):             # <<<<<<<<<<<<<<
 *     cdef np.ndarray[DTYPE_t, ndim=1] x, y, dist_im, pos
 *     cdef np.ndarray[long, ndim=1] where
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_M.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_im.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_grad.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_pos.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_where.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_x.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_y.rcbuffer->pybuffer);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.reparm_string", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_M.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_dist_im.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_grad.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_pos.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_where.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_x.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_y.rcbuffer->pybuffer);
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XDECREF((PyObject *)__pyx_v_x);
  __Pyx_XDECREF((PyObject *)__pyx_v_y);
  __Pyx_XDECREF((PyObject *)__pyx_v_dist_im);
  __Pyx_XDECREF((PyObject *)__pyx_v_pos);
  __Pyx_XDECREF((PyObject *)__pyx_v_where);
  __Pyx_XDECREF((PyObject *)__pyx_v_grad);
  __Pyx_XDECREF((PyObject *)__pyx_v_M);
  __Pyx_XDECREF(__pyx_v_z_new);
  __Pyx_XDECREF(__pyx_v_z_new_arr);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_1reparm_string(PyObject *__pyx_self, PyObject *__pyx_v_z); /*proto*/
static PyObject *__pyx_pw_8vcstring_1reparm_string(PyObject *__pyx_self, PyObject *__pyx_v_z) {
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("reparm_string (wrapper)", 0);
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_z), __pyx_ptype_5numpy_ndarray, 1, "z", 0))) __PYX_ERR(0, 1722, __pyx_L1_error)
  __pyx_r = __pyx_pf_8vcstring_reparm_string(__pyx_self, ((PyArrayObject *)__pyx_v_z));

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_reparm_string(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_z) {
  __Pyx_LocalBuf_ND __pyx_pybuffernd_z;
  __Pyx_Buffer __pyx_pybuffer_z;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("reparm_string", 0);
  __pyx_pybuffer_z.pybuffer.buf = NULL;
  __pyx_pybuffer_z.refcount = 0;
  __pyx_pybuffernd_z.data = NULL;
  __pyx_pybuffernd_z.rcbuffer = &__pyx_pybuffer_z;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_z.rcbuffer->pybuffer, (PyObject*)__pyx_v_z, &__Pyx_TypeInfo_nn___pyx_t_8vcstring_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 1722, __pyx_L1_error)
  }
  __pyx_pybuffernd_z.diminfo[0].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_z.diminfo[0].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_z.diminfo[1].strides = __pyx_pybuffernd_z.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_z.diminfo[1].shape = __pyx_pybuffernd_z.rcbuffer->pybuffer.shape[1];
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __pyx_f_8vcstring_reparm_string(__pyx_v_z, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1722, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
  __Pyx_AddTraceback("vcstring.reparm_string", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_z.rcbuffer->pybuffer);
  __pyx_L2:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":1805
 *     return z_new_arr
 * 
 * cpdef elliptical_bounds_params(double ra=1.0, double rb=0.4, double alpha=58.0, double x0_A=-2.2, double y0_A=-2.2, double x0_B=2.2, double y0_B=2.2):             # <<<<<<<<<<<<<<
 *     """
 *     Parameters for defining the  elliptical boundaries at the well minima where the
 */

static PyObject *__pyx_pw_8vcstring_3elliptical_bounds_params(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_8vcstring_elliptical_bounds_params(CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_elliptical_bounds_params *__pyx_optional_args) {
  double __pyx_v_ra = ((double)1.0);
  double __pyx_v_rb = ((double)0.4);
  double __pyx_v_alpha = ((double)58.0);
  double __pyx_v_x0_A = __pyx_k__81;
  double __pyx_v_y0_A = __pyx_k__82;
  double __pyx_v_x0_B = ((double)2.2);
  double __pyx_v_y0_B = ((double)2.2);
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("elliptical_bounds_params", 0);
  if (__pyx_optional_args) {
    if (__pyx_optional_args->__pyx_n > 0) {
      __pyx_v_ra = __pyx_optional_args->ra;
      if (__pyx_optional_args->__pyx_n > 1) {
        __pyx_v_rb = __pyx_optional_args->rb;
        if (__pyx_optional_args->__pyx_n > 2) {
          __pyx_v_alpha = __pyx_optional_args->alpha;
          if (__pyx_optional_args->__pyx_n > 3) {
            __pyx_v_x0_A = __pyx_optional_args->x0_A;
            if (__pyx_optional_args->__pyx_n > 4) {
              __pyx_v_y0_A = __pyx_optional_args->y0_A;
              if (__pyx_optional_args->__pyx_n > 5) {
                __pyx_v_x0_B = __pyx_optional_args->x0_B;
                if (__pyx_optional_args->__pyx_n > 6) {
                  __pyx_v_y0_B = __pyx_optional_args->y0_B;
                }
              }
            }
          }
        }
      }
    }
  }

  /* "vcstring.pyx":1818
 *     y0_B = 2.2
 *     """
 *     return ra, rb, alpha*pi/180.0, x0_A, y0_A, x0_B, y0_B             # <<<<<<<<<<<<<<
 * 
 * def elliptical(double a, double b, double alpha, double x0, double y0, xp, yp):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_ra); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1818, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_rb); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1818, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_alpha); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1818, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_pi); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1818, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = PyNumber_Multiply(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1818, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyFloat_TrueDivideObjC(__pyx_t_5, __pyx_float_180_0, 180.0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1818, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = PyFloat_FromDouble(__pyx_v_x0_A); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1818, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_y0_A); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1818, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_6 = PyFloat_FromDouble(__pyx_v_x0_B); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1818, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_7 = PyFloat_FromDouble(__pyx_v_y0_B); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1818, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_8 = PyTuple_New(7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1818, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_GIVEREF(__pyx_t_1);
  PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_5);
  PyTuple_SET_ITEM(__pyx_t_8, 3, __pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_3);
  PyTuple_SET_ITEM(__pyx_t_8, 4, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_6);
  PyTuple_SET_ITEM(__pyx_t_8, 5, __pyx_t_6);
  __Pyx_GIVEREF(__pyx_t_7);
  PyTuple_SET_ITEM(__pyx_t_8, 6, __pyx_t_7);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_3 = 0;
  __pyx_t_6 = 0;
  __pyx_t_7 = 0;
  __pyx_r = __pyx_t_8;
  __pyx_t_8 = 0;
  goto __pyx_L0;

  /* "vcstring.pyx":1805
 *     return z_new_arr
 * 
 * cpdef elliptical_bounds_params(double ra=1.0, double rb=0.4, double alpha=58.0, double x0_A=-2.2, double y0_A=-2.2, double x0_B=2.2, double y0_B=2.2):             # <<<<<<<<<<<<<<
 *     """
 *     Parameters for defining the  elliptical boundaries at the well minima where the
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("vcstring.elliptical_bounds_params", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_3elliptical_bounds_params(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_8vcstring_2elliptical_bounds_params[] = "\n    Parameters for defining the  elliptical boundaries at the well minima where the\n    committor q = 0 or q = 1, respectively.\n    Defaults:\n    ra = 2.05 # Major radius along x-axis, ra > rb\n    rb = 0.8  # Minor radius along y-axis\n    alpha = 58 * pi / 180.0  # Rotation of ellipse\n    x0_A = -2.2  # Center of ellipse for state A\n    y0_A = -2.2\n    x0_B = 2.2   # Center of ellipse for state B\n    y0_B = 2.2\n    ";
static PyObject *__pyx_pw_8vcstring_3elliptical_bounds_params(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_ra;
  double __pyx_v_rb;
  double __pyx_v_alpha;
  double __pyx_v_x0_A;
  double __pyx_v_y0_A;
  double __pyx_v_x0_B;
  double __pyx_v_y0_B;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("elliptical_bounds_params (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_ra,&__pyx_n_s_rb,&__pyx_n_s_alpha,&__pyx_n_s_x0_A,&__pyx_n_s_y0_A,&__pyx_n_s_x0_B,&__pyx_n_s_y0_B,0};
    PyObject* values[7] = {0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ra);
          if (value) { values[0] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rb);
          if (value) { values[1] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_alpha);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_x0_A);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_y0_A);
          if (value) { values[4] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_x0_B);
          if (value) { values[5] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_y0_B);
          if (value) { values[6] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "elliptical_bounds_params") < 0)) __PYX_ERR(0, 1805, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    if (values[0]) {
      __pyx_v_ra = __pyx_PyFloat_AsDouble(values[0]); if (unlikely((__pyx_v_ra == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1805, __pyx_L3_error)
    } else {
      __pyx_v_ra = ((double)1.0);
    }
    if (values[1]) {
      __pyx_v_rb = __pyx_PyFloat_AsDouble(values[1]); if (unlikely((__pyx_v_rb == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1805, __pyx_L3_error)
    } else {
      __pyx_v_rb = ((double)0.4);
    }
    if (values[2]) {
      __pyx_v_alpha = __pyx_PyFloat_AsDouble(values[2]); if (unlikely((__pyx_v_alpha == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1805, __pyx_L3_error)
    } else {
      __pyx_v_alpha = ((double)58.0);
    }
    if (values[3]) {
      __pyx_v_x0_A = __pyx_PyFloat_AsDouble(values[3]); if (unlikely((__pyx_v_x0_A == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1805, __pyx_L3_error)
    } else {
      __pyx_v_x0_A = __pyx_k__81;
    }
    if (values[4]) {
      __pyx_v_y0_A = __pyx_PyFloat_AsDouble(values[4]); if (unlikely((__pyx_v_y0_A == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1805, __pyx_L3_error)
    } else {
      __pyx_v_y0_A = __pyx_k__82;
    }
    if (values[5]) {
      __pyx_v_x0_B = __pyx_PyFloat_AsDouble(values[5]); if (unlikely((__pyx_v_x0_B == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1805, __pyx_L3_error)
    } else {
      __pyx_v_x0_B = ((double)2.2);
    }
    if (values[6]) {
      __pyx_v_y0_B = __pyx_PyFloat_AsDouble(values[6]); if (unlikely((__pyx_v_y0_B == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1805, __pyx_L3_error)
    } else {
      __pyx_v_y0_B = ((double)2.2);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("elliptical_bounds_params", 0, 0, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1805, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.elliptical_bounds_params", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8vcstring_2elliptical_bounds_params(__pyx_self, __pyx_v_ra, __pyx_v_rb, __pyx_v_alpha, __pyx_v_x0_A, __pyx_v_y0_A, __pyx_v_x0_B, __pyx_v_y0_B);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_2elliptical_bounds_params(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_ra, double __pyx_v_rb, double __pyx_v_alpha, double __pyx_v_x0_A, double __pyx_v_y0_A, double __pyx_v_x0_B, double __pyx_v_y0_B) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  struct __pyx_opt_args_8vcstring_elliptical_bounds_params __pyx_t_2;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("elliptical_bounds_params", 0);
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2.__pyx_n = 7;
  __pyx_t_2.ra = __pyx_v_ra;
  __pyx_t_2.rb = __pyx_v_rb;
  __pyx_t_2.alpha = __pyx_v_alpha;
  __pyx_t_2.x0_A = __pyx_v_x0_A;
  __pyx_t_2.y0_A = __pyx_v_y0_A;
  __pyx_t_2.x0_B = __pyx_v_x0_B;
  __pyx_t_2.y0_B = __pyx_v_y0_B;
  __pyx_t_1 = __pyx_f_8vcstring_elliptical_bounds_params(0, &__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1805, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("vcstring.elliptical_bounds_params", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":1820
 *     return ra, rb, alpha*pi/180.0, x0_A, y0_A, x0_B, y0_B
 * 
 * def elliptical(double a, double b, double alpha, double x0, double y0, xp, yp):             # <<<<<<<<<<<<<<
 *     ell_x = ((math.cos(alpha) * (xp - x0) + math.sin(alpha) * (yp - y0)) ** 2) / (a ** 2)
 *     ell_y = ((math.sin(alpha) * (xp - x0) - math.cos(alpha) * (yp - y0)) ** 2) / (b ** 2)
 */

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_5elliptical(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_8vcstring_5elliptical = {"elliptical", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_5elliptical, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_8vcstring_5elliptical(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_a;
  double __pyx_v_b;
  double __pyx_v_alpha;
  double __pyx_v_x0;
  double __pyx_v_y0;
  PyObject *__pyx_v_xp = 0;
  PyObject *__pyx_v_yp = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("elliptical (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_a,&__pyx_n_s_b_2,&__pyx_n_s_alpha,&__pyx_n_s_x0,&__pyx_n_s_y0,&__pyx_n_s_xp,&__pyx_n_s_yp,0};
    PyObject* values[7] = {0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_b_2)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("elliptical", 1, 7, 7, 1); __PYX_ERR(0, 1820, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_alpha)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("elliptical", 1, 7, 7, 2); __PYX_ERR(0, 1820, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_x0)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("elliptical", 1, 7, 7, 3); __PYX_ERR(0, 1820, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_y0)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("elliptical", 1, 7, 7, 4); __PYX_ERR(0, 1820, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_xp)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("elliptical", 1, 7, 7, 5); __PYX_ERR(0, 1820, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_yp)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("elliptical", 1, 7, 7, 6); __PYX_ERR(0, 1820, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "elliptical") < 0)) __PYX_ERR(0, 1820, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 7) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
      values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
      values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
      values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
    }
    __pyx_v_a = __pyx_PyFloat_AsDouble(values[0]); if (unlikely((__pyx_v_a == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1820, __pyx_L3_error)
    __pyx_v_b = __pyx_PyFloat_AsDouble(values[1]); if (unlikely((__pyx_v_b == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1820, __pyx_L3_error)
    __pyx_v_alpha = __pyx_PyFloat_AsDouble(values[2]); if (unlikely((__pyx_v_alpha == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1820, __pyx_L3_error)
    __pyx_v_x0 = __pyx_PyFloat_AsDouble(values[3]); if (unlikely((__pyx_v_x0 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1820, __pyx_L3_error)
    __pyx_v_y0 = __pyx_PyFloat_AsDouble(values[4]); if (unlikely((__pyx_v_y0 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1820, __pyx_L3_error)
    __pyx_v_xp = values[5];
    __pyx_v_yp = values[6];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("elliptical", 1, 7, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1820, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.elliptical", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8vcstring_4elliptical(__pyx_self, __pyx_v_a, __pyx_v_b, __pyx_v_alpha, __pyx_v_x0, __pyx_v_y0, __pyx_v_xp, __pyx_v_yp);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_4elliptical(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_a, double __pyx_v_b, double __pyx_v_alpha, double __pyx_v_x0, double __pyx_v_y0, PyObject *__pyx_v_xp, PyObject *__pyx_v_yp) {
  PyObject *__pyx_v_ell_x = NULL;
  PyObject *__pyx_v_ell_y = NULL;
  PyObject *__pyx_v_ell = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("elliptical", 0);

  /* "vcstring.pyx":1821
 * 
 * def elliptical(double a, double b, double alpha, double x0, double y0, xp, yp):
 *     ell_x = ((math.cos(alpha) * (xp - x0) + math.sin(alpha) * (yp - y0)) ** 2) / (a ** 2)             # <<<<<<<<<<<<<<
 *     ell_y = ((math.sin(alpha) * (xp - x0) - math.cos(alpha) * (yp - y0)) ** 2) / (b ** 2)
 *     ell = ell_x + ell_y
 */
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_math); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1821, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_cos); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1821, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_alpha); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1821, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1821, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_x0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1821, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyNumber_Subtract(__pyx_v_xp, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1821, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_Multiply(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1821, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_math); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1821, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_sin); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1821, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_alpha); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1821, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_1);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1821, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_y0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1821, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = PyNumber_Subtract(__pyx_v_yp, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1821, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyNumber_Multiply(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1821, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Add(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1821, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyNumber_Power(__pyx_t_1, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1821, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyFloat_FromDouble(pow(__pyx_v_a, 2.0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1821, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyNumber_Divide(__pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1821, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_ell_x = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "vcstring.pyx":1822
 * def elliptical(double a, double b, double alpha, double x0, double y0, xp, yp):
 *     ell_x = ((math.cos(alpha) * (xp - x0) + math.sin(alpha) * (yp - y0)) ** 2) / (a ** 2)
 *     ell_y = ((math.sin(alpha) * (xp - x0) - math.cos(alpha) * (yp - y0)) ** 2) / (b ** 2)             # <<<<<<<<<<<<<<
 *     ell = ell_x + ell_y
 *     return ell
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_math); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_sin); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_alpha); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_x0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = PyNumber_Subtract(__pyx_v_xp, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyNumber_Multiply(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_math); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_cos); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_alpha); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_y0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Subtract(__pyx_v_yp, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Multiply(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_Subtract(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Power(__pyx_t_3, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyFloat_FromDouble(pow(__pyx_v_b, 2.0)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyNumber_Divide(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1822, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_ell_y = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "vcstring.pyx":1823
 *     ell_x = ((math.cos(alpha) * (xp - x0) + math.sin(alpha) * (yp - y0)) ** 2) / (a ** 2)
 *     ell_y = ((math.sin(alpha) * (xp - x0) - math.cos(alpha) * (yp - y0)) ** 2) / (b ** 2)
 *     ell = ell_x + ell_y             # <<<<<<<<<<<<<<
 *     return ell
 * 
 */
  __pyx_t_4 = PyNumber_Add(__pyx_v_ell_x, __pyx_v_ell_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1823, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_v_ell = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "vcstring.pyx":1824
 *     ell_y = ((math.sin(alpha) * (xp - x0) - math.cos(alpha) * (yp - y0)) ** 2) / (b ** 2)
 *     ell = ell_x + ell_y
 *     return ell             # <<<<<<<<<<<<<<
 * 
 * def smoothing(C_list, q_list, lags, first=10, last=10, cut=0):
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_ell);
  __pyx_r = __pyx_v_ell;
  goto __pyx_L0;

  /* "vcstring.pyx":1820
 *     return ra, rb, alpha*pi/180.0, x0_A, y0_A, x0_B, y0_B
 * 
 * def elliptical(double a, double b, double alpha, double x0, double y0, xp, yp):             # <<<<<<<<<<<<<<
 *     ell_x = ((math.cos(alpha) * (xp - x0) + math.sin(alpha) * (yp - y0)) ** 2) / (a ** 2)
 *     ell_y = ((math.sin(alpha) * (xp - x0) - math.cos(alpha) * (yp - y0)) ** 2) / (b ** 2)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("vcstring.elliptical", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_ell_x);
  __Pyx_XDECREF(__pyx_v_ell_y);
  __Pyx_XDECREF(__pyx_v_ell);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "vcstring.pyx":1826
 *     return ell
 * 
 * def smoothing(C_list, q_list, lags, first=10, last=10, cut=0):             # <<<<<<<<<<<<<<
 *     C_avg = []
 *     q_avg = []
 */

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_7smoothing(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_8vcstring_7smoothing = {"smoothing", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_7smoothing, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_8vcstring_7smoothing(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_C_list = 0;
  PyObject *__pyx_v_q_list = 0;
  PyObject *__pyx_v_lags = 0;
  PyObject *__pyx_v_first = 0;
  PyObject *__pyx_v_last = 0;
  PyObject *__pyx_v_cut = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("smoothing (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_C_list,&__pyx_n_s_q_list,&__pyx_n_s_lags,&__pyx_n_s_first,&__pyx_n_s_last,&__pyx_n_s_cut,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    values[3] = ((PyObject *)__pyx_int_10);
    values[4] = ((PyObject *)__pyx_int_10);
    values[5] = ((PyObject *)__pyx_int_0);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_C_list)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_q_list)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("smoothing", 0, 3, 6, 1); __PYX_ERR(0, 1826, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lags)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("smoothing", 0, 3, 6, 2); __PYX_ERR(0, 1826, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_first);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_last);
          if (value) { values[4] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args > 0) {
          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cut);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "smoothing") < 0)) __PYX_ERR(0, 1826, __pyx_L3_error)
      }
    } else {
      switch (PyTuple_GET_SIZE(__pyx_args)) {
        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_C_list = values[0];
    __pyx_v_q_list = values[1];
    __pyx_v_lags = values[2];
    __pyx_v_first = values[3];
    __pyx_v_last = values[4];
    __pyx_v_cut = values[5];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("smoothing", 0, 3, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1826, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.smoothing", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8vcstring_6smoothing(__pyx_self, __pyx_v_C_list, __pyx_v_q_list, __pyx_v_lags, __pyx_v_first, __pyx_v_last, __pyx_v_cut);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_6smoothing(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_C_list, PyObject *__pyx_v_q_list, PyObject *__pyx_v_lags, PyObject *__pyx_v_first, PyObject *__pyx_v_last, PyObject *__pyx_v_cut) {
  PyObject *__pyx_v_C_avg = NULL;
  PyObject *__pyx_v_q_avg = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_C = NULL;
  PyObject *__pyx_v_q = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *(*__pyx_t_4)(PyObject *);
  int __pyx_t_5;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  Py_ssize_t __pyx_t_11;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("smoothing", 0);

  /* "vcstring.pyx":1827
 * 
 * def smoothing(C_list, q_list, lags, first=10, last=10, cut=0):
 *     C_avg = []             # <<<<<<<<<<<<<<
 *     q_avg = []
 *     for i in range(len(lags)):
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1827, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_C_avg = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "vcstring.pyx":1828
 * def smoothing(C_list, q_list, lags, first=10, last=10, cut=0):
 *     C_avg = []
 *     q_avg = []             # <<<<<<<<<<<<<<
 *     for i in range(len(lags)):
 *         if i < cut:
 */
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1828, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_q_avg = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "vcstring.pyx":1829
 *     C_avg = []
 *     q_avg = []
 *     for i in range(len(lags)):             # <<<<<<<<<<<<<<
 *         if i < cut:
 *             C = C_list[i]
 */
  __pyx_t_2 = PyObject_Length(__pyx_v_lags); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1829, __pyx_L1_error)
  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1829, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1829, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (likely(PyList_CheckExact(__pyx_t_3)) || PyTuple_CheckExact(__pyx_t_3)) {
    __pyx_t_1 = __pyx_t_3; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1829, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1829, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (likely(!__pyx_t_4)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 1829, __pyx_L1_error)
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1829, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      } else {
        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 1829, __pyx_L1_error)
        #else
        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1829, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_4(__pyx_t_1);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 1829, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "vcstring.pyx":1830
 *     q_avg = []
 *     for i in range(len(lags)):
 *         if i < cut:             # <<<<<<<<<<<<<<
 *             C = C_list[i]
 *             C_avg.append(C)
 */
    __pyx_t_3 = PyObject_RichCompare(__pyx_v_i, __pyx_v_cut, Py_LT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1830, __pyx_L1_error)
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1830, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_5) {

      /* "vcstring.pyx":1831
 *     for i in range(len(lags)):
 *         if i < cut:
 *             C = C_list[i]             # <<<<<<<<<<<<<<
 *             C_avg.append(C)
 *             q = q_list[i]
 */
      __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_C_list, __pyx_v_i); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1831, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_XDECREF_SET(__pyx_v_C, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "vcstring.pyx":1832
 *         if i < cut:
 *             C = C_list[i]
 *             C_avg.append(C)             # <<<<<<<<<<<<<<
 *             q = q_list[i]
 *             q_avg.append(q)
 */
      __pyx_t_6 = __Pyx_PyObject_Append(__pyx_v_C_avg, __pyx_v_C); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 1832, __pyx_L1_error)

      /* "vcstring.pyx":1833
 *             C = C_list[i]
 *             C_avg.append(C)
 *             q = q_list[i]             # <<<<<<<<<<<<<<
 *             q_avg.append(q)
 *         elif i >= cut:
 */
      __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_q_list, __pyx_v_i); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1833, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_XDECREF_SET(__pyx_v_q, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "vcstring.pyx":1834
 *             C_avg.append(C)
 *             q = q_list[i]
 *             q_avg.append(q)             # <<<<<<<<<<<<<<
 *         elif i >= cut:
 *             C = np.sum(C_list[i-first:i+last]) / len(C_list[i-first:i+last])
 */
      __pyx_t_6 = __Pyx_PyObject_Append(__pyx_v_q_avg, __pyx_v_q); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 1834, __pyx_L1_error)

      /* "vcstring.pyx":1830
 *     q_avg = []
 *     for i in range(len(lags)):
 *         if i < cut:             # <<<<<<<<<<<<<<
 *             C = C_list[i]
 *             C_avg.append(C)
 */
      goto __pyx_L5;
    }

    /* "vcstring.pyx":1835
 *             q = q_list[i]
 *             q_avg.append(q)
 *         elif i >= cut:             # <<<<<<<<<<<<<<
 *             C = np.sum(C_list[i-first:i+last]) / len(C_list[i-first:i+last])
 *             C_avg.append(C)
 */
    __pyx_t_3 = PyObject_RichCompare(__pyx_v_i, __pyx_v_cut, Py_GE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1835, __pyx_L1_error)
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1835, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_5) {

      /* "vcstring.pyx":1836
 *             q_avg.append(q)
 *         elif i >= cut:
 *             C = np.sum(C_list[i-first:i+last]) / len(C_list[i-first:i+last])             # <<<<<<<<<<<<<<
 *             C_avg.append(C)
 *             q = np.sum(q_list[i-first:i+last], axis=0) / len(q_list[i-first:i+last])
 */
      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1836, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_sum); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1836, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = PyNumber_Subtract(__pyx_v_i, __pyx_v_first); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1836, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_9 = PyNumber_Add(__pyx_v_i, __pyx_v_last); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1836, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_10 = __Pyx_PyObject_GetSlice(__pyx_v_C_list, 0, 0, &__pyx_t_7, &__pyx_t_9, NULL, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1836, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_t_9 = NULL;
      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
        __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_8);
        if (likely(__pyx_t_9)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
          __Pyx_INCREF(__pyx_t_9);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_8, function);
        }
      }
      __pyx_t_3 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_9, __pyx_t_10) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_10);
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1836, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = PyNumber_Subtract(__pyx_v_i, __pyx_v_first); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1836, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_10 = PyNumber_Add(__pyx_v_i, __pyx_v_last); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1836, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_9 = __Pyx_PyObject_GetSlice(__pyx_v_C_list, 0, 0, &__pyx_t_8, &__pyx_t_10, NULL, 0, 0, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1836, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_11 = PyObject_Length(__pyx_t_9); if (unlikely(__pyx_t_11 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1836, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_t_9 = PyInt_FromSsize_t(__pyx_t_11); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1836, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_10 = __Pyx_PyNumber_Divide(__pyx_t_3, __pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1836, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_XDECREF_SET(__pyx_v_C, __pyx_t_10);
      __pyx_t_10 = 0;

      /* "vcstring.pyx":1837
 *         elif i >= cut:
 *             C = np.sum(C_list[i-first:i+last]) / len(C_list[i-first:i+last])
 *             C_avg.append(C)             # <<<<<<<<<<<<<<
 *             q = np.sum(q_list[i-first:i+last], axis=0) / len(q_list[i-first:i+last])
 *             q_avg.append(q)
 */
      __pyx_t_6 = __Pyx_PyObject_Append(__pyx_v_C_avg, __pyx_v_C); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 1837, __pyx_L1_error)

      /* "vcstring.pyx":1838
 *             C = np.sum(C_list[i-first:i+last]) / len(C_list[i-first:i+last])
 *             C_avg.append(C)
 *             q = np.sum(q_list[i-first:i+last], axis=0) / len(q_list[i-first:i+last])             # <<<<<<<<<<<<<<
 *             q_avg.append(q)
 *     C_avg = np.asarray(C_avg)
 */
      __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1838, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_sum); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1838, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = PyNumber_Subtract(__pyx_v_i, __pyx_v_first); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1838, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_3 = PyNumber_Add(__pyx_v_i, __pyx_v_last); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1838, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_8 = __Pyx_PyObject_GetSlice(__pyx_v_q_list, 0, 0, &__pyx_t_10, &__pyx_t_3, NULL, 0, 0, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1838, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1838, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_8);
      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_8);
      __pyx_t_8 = 0;
      __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1838, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_axis, __pyx_int_0) < 0) __PYX_ERR(0, 1838, __pyx_L1_error)
      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_3, __pyx_t_8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1838, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = PyNumber_Subtract(__pyx_v_i, __pyx_v_first); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1838, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_3 = PyNumber_Add(__pyx_v_i, __pyx_v_last); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1838, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_9 = __Pyx_PyObject_GetSlice(__pyx_v_q_list, 0, 0, &__pyx_t_8, &__pyx_t_3, NULL, 0, 0, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1838, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_11 = PyObject_Length(__pyx_t_9); if (unlikely(__pyx_t_11 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1838, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_t_9 = PyInt_FromSsize_t(__pyx_t_11); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1838, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_3 = __Pyx_PyNumber_Divide(__pyx_t_10, __pyx_t_9); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1838, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_XDECREF_SET(__pyx_v_q, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "vcstring.pyx":1839
 *             C_avg.append(C)
 *             q = np.sum(q_list[i-first:i+last], axis=0) / len(q_list[i-first:i+last])
 *             q_avg.append(q)             # <<<<<<<<<<<<<<
 *     C_avg = np.asarray(C_avg)
 *     q_avg = np.asarray(q_avg)
 */
      __pyx_t_6 = __Pyx_PyObject_Append(__pyx_v_q_avg, __pyx_v_q); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 1839, __pyx_L1_error)

      /* "vcstring.pyx":1835
 *             q = q_list[i]
 *             q_avg.append(q)
 *         elif i >= cut:             # <<<<<<<<<<<<<<
 *             C = np.sum(C_list[i-first:i+last]) / len(C_list[i-first:i+last])
 *             C_avg.append(C)
 */
    }
    __pyx_L5:;

    /* "vcstring.pyx":1829
 *     C_avg = []
 *     q_avg = []
 *     for i in range(len(lags)):             # <<<<<<<<<<<<<<
 *         if i < cut:
 *             C = C_list[i]
 */
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":1840
 *             q = np.sum(q_list[i-first:i+last], axis=0) / len(q_list[i-first:i+last])
 *             q_avg.append(q)
 *     C_avg = np.asarray(C_avg)             # <<<<<<<<<<<<<<
 *     q_avg = np.asarray(q_avg)
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1840, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_asarray); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1840, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_9);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_9, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_3, __pyx_v_C_avg) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_v_C_avg);
  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1840, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF_SET(__pyx_v_C_avg, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":1841
 *             q_avg.append(q)
 *     C_avg = np.asarray(C_avg)
 *     q_avg = np.asarray(q_avg)             # <<<<<<<<<<<<<<
 * 
 *     return C_avg, q_avg
 */
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1841, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_asarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1841, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = NULL;
  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_9)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_9);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_9, __pyx_v_q_avg) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_q_avg);
  __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1841, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_q_avg, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "vcstring.pyx":1843
 *     q_avg = np.asarray(q_avg)
 * 
 *     return C_avg, q_avg             # <<<<<<<<<<<<<<
 * 
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1843, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_C_avg);
  __Pyx_GIVEREF(__pyx_v_C_avg);
  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_C_avg);
  __Pyx_INCREF(__pyx_v_q_avg);
  __Pyx_GIVEREF(__pyx_v_q_avg);
  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_q_avg);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "vcstring.pyx":1826
 *     return ell
 * 
 * def smoothing(C_list, q_list, lags, first=10, last=10, cut=0):             # <<<<<<<<<<<<<<
 *     C_avg = []
 *     q_avg = []
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("vcstring.smoothing", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_C_avg);
  __Pyx_XDECREF(__pyx_v_q_avg);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_C);
  __Pyx_XDECREF(__pyx_v_q);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":1
 * def __pyx_unpickle_vcstring(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 */

/* Python wrapper */
static PyObject *__pyx_pw_8vcstring_9__pyx_unpickle_vcstring(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_8vcstring_9__pyx_unpickle_vcstring = {"__pyx_unpickle_vcstring", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_9__pyx_unpickle_vcstring, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_8vcstring_9__pyx_unpickle_vcstring(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v___pyx_type = 0;
  long __pyx_v___pyx_checksum;
  PyObject *__pyx_v___pyx_state = 0;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__pyx_unpickle_vcstring (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_pyx_type,&__pyx_n_s_pyx_checksum,&__pyx_n_s_pyx_state,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = PyDict_Size(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_type)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_checksum)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_vcstring", 1, 3, 3, 1); __PYX_ERR(1, 1, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_state)) != 0)) kw_args--;
        else {
          __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_vcstring", 1, 3, 3, 2); __PYX_ERR(1, 1, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_unpickle_vcstring") < 0)) __PYX_ERR(1, 1, __pyx_L3_error)
      }
    } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
    }
    __pyx_v___pyx_type = values[0];
    __pyx_v___pyx_checksum = __Pyx_PyInt_As_long(values[1]); if (unlikely((__pyx_v___pyx_checksum == (long)-1) && PyErr_Occurred())) __PYX_ERR(1, 1, __pyx_L3_error)
    __pyx_v___pyx_state = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_vcstring", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(1, 1, __pyx_L3_error)
  __pyx_L3_error:;
  __Pyx_AddTraceback("vcstring.__pyx_unpickle_vcstring", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_8vcstring_8__pyx_unpickle_vcstring(__pyx_self, __pyx_v___pyx_type, __pyx_v___pyx_checksum, __pyx_v___pyx_state);

  /* function exit code */
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_8vcstring_8__pyx_unpickle_vcstring(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_v___pyx_PickleError = 0;
  PyObject *__pyx_v___pyx_result = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__pyx_unpickle_vcstring", 0);

  /* "(tree fragment)":4
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 *     if __pyx_checksum != 0xf65be29:             # <<<<<<<<<<<<<<
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xf65be29 = (alpha_A, alpha_B, alpha_deg_A, alpha_deg_B, cut, cut_A, cut_B, num_basis, ra_A, ra_B, rb_A, rb_B, state_assignment, theta, theta_deg, x0_A, x0_B, y0_A, y0_B))" % __pyx_checksum)
 */
  __pyx_t_1 = ((__pyx_v___pyx_checksum != 0xf65be29) != 0);
  if (__pyx_t_1) {

    /* "(tree fragment)":5
 *     cdef object __pyx_result
 *     if __pyx_checksum != 0xf65be29:
 *         from pickle import PickleError as __pyx_PickleError             # <<<<<<<<<<<<<<
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xf65be29 = (alpha_A, alpha_B, alpha_deg_A, alpha_deg_B, cut, cut_A, cut_B, num_basis, ra_A, ra_B, rb_A, rb_B, state_assignment, theta, theta_deg, x0_A, x0_B, y0_A, y0_B))" % __pyx_checksum)
 *     __pyx_result = vcstring.__new__(__pyx_type)
 */
    __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 5, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_n_s_PickleError);
    __Pyx_GIVEREF(__pyx_n_s_PickleError);
    PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_PickleError);
    __pyx_t_3 = __Pyx_Import(__pyx_n_s_pickle, __pyx_t_2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 5, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_PickleError); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 5, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_t_2);
    __pyx_v___pyx_PickleError = __pyx_t_2;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "(tree fragment)":6
 *     if __pyx_checksum != 0xf65be29:
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xf65be29 = (alpha_A, alpha_B, alpha_deg_A, alpha_deg_B, cut, cut_A, cut_B, num_basis, ra_A, ra_B, rb_A, rb_B, state_assignment, theta, theta_deg, x0_A, x0_B, y0_A, y0_B))" % __pyx_checksum)             # <<<<<<<<<<<<<<
 *     __pyx_result = vcstring.__new__(__pyx_type)
 *     if __pyx_state is not None:
 */
    __pyx_t_2 = __Pyx_PyInt_From_long(__pyx_v___pyx_checksum); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 6, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_Incompatible_checksums_s_vs_0xf6, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 6, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_INCREF(__pyx_v___pyx_PickleError);
    __pyx_t_2 = __pyx_v___pyx_PickleError; __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
      }
    }
    __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 6, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __PYX_ERR(1, 6, __pyx_L1_error)

    /* "(tree fragment)":4
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 *     if __pyx_checksum != 0xf65be29:             # <<<<<<<<<<<<<<
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xf65be29 = (alpha_A, alpha_B, alpha_deg_A, alpha_deg_B, cut, cut_A, cut_B, num_basis, ra_A, ra_B, rb_A, rb_B, state_assignment, theta, theta_deg, x0_A, x0_B, y0_A, y0_B))" % __pyx_checksum)
 */
  }

  /* "(tree fragment)":7
 *         from pickle import PickleError as __pyx_PickleError
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xf65be29 = (alpha_A, alpha_B, alpha_deg_A, alpha_deg_B, cut, cut_A, cut_B, num_basis, ra_A, ra_B, rb_A, rb_B, state_assignment, theta, theta_deg, x0_A, x0_B, y0_A, y0_B))" % __pyx_checksum)
 *     __pyx_result = vcstring.__new__(__pyx_type)             # <<<<<<<<<<<<<<
 *     if __pyx_state is not None:
 *         __pyx_unpickle_vcstring__set_state(<vcstring> __pyx_result, __pyx_state)
 */
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype_8vcstring_vcstring), __pyx_n_s_new); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 7, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
    }
  }
  __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_v___pyx_type) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v___pyx_type);
  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 7, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v___pyx_result = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "(tree fragment)":8
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xf65be29 = (alpha_A, alpha_B, alpha_deg_A, alpha_deg_B, cut, cut_A, cut_B, num_basis, ra_A, ra_B, rb_A, rb_B, state_assignment, theta, theta_deg, x0_A, x0_B, y0_A, y0_B))" % __pyx_checksum)
 *     __pyx_result = vcstring.__new__(__pyx_type)
 *     if __pyx_state is not None:             # <<<<<<<<<<<<<<
 *         __pyx_unpickle_vcstring__set_state(<vcstring> __pyx_result, __pyx_state)
 *     return __pyx_result
 */
  __pyx_t_1 = (__pyx_v___pyx_state != Py_None);
  __pyx_t_6 = (__pyx_t_1 != 0);
  if (__pyx_t_6) {

    /* "(tree fragment)":9
 *     __pyx_result = vcstring.__new__(__pyx_type)
 *     if __pyx_state is not None:
 *         __pyx_unpickle_vcstring__set_state(<vcstring> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
 *     return __pyx_result
 * cdef __pyx_unpickle_vcstring__set_state(vcstring __pyx_result, tuple __pyx_state):
 */
    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
    __pyx_t_3 = __pyx_f_8vcstring___pyx_unpickle_vcstring__set_state(((struct __pyx_obj_8vcstring_vcstring *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 9, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "(tree fragment)":8
 *         raise __pyx_PickleError("Incompatible checksums (%s vs 0xf65be29 = (alpha_A, alpha_B, alpha_deg_A, alpha_deg_B, cut, cut_A, cut_B, num_basis, ra_A, ra_B, rb_A, rb_B, state_assignment, theta, theta_deg, x0_A, x0_B, y0_A, y0_B))" % __pyx_checksum)
 *     __pyx_result = vcstring.__new__(__pyx_type)
 *     if __pyx_state is not None:             # <<<<<<<<<<<<<<
 *         __pyx_unpickle_vcstring__set_state(<vcstring> __pyx_result, __pyx_state)
 *     return __pyx_result
 */
  }

  /* "(tree fragment)":10
 *     if __pyx_state is not None:
 *         __pyx_unpickle_vcstring__set_state(<vcstring> __pyx_result, __pyx_state)
 *     return __pyx_result             # <<<<<<<<<<<<<<
 * cdef __pyx_unpickle_vcstring__set_state(vcstring __pyx_result, tuple __pyx_state):
 *     __pyx_result.alpha_A = __pyx_state[0]; __pyx_result.alpha_B = __pyx_state[1]; __pyx_result.alpha_deg_A = __pyx_state[2]; __pyx_result.alpha_deg_B = __pyx_state[3]; __pyx_result.cut = __pyx_state[4]; __pyx_result.cut_A = __pyx_state[5]; __pyx_result.cut_B = __pyx_state[6]; __pyx_result.num_basis = __pyx_state[7]; __pyx_result.ra_A = __pyx_state[8]; __pyx_result.ra_B = __pyx_state[9]; __pyx_result.rb_A = __pyx_state[10]; __pyx_result.rb_B = __pyx_state[11]; __pyx_result.state_assignment = __pyx_state[12]; __pyx_result.theta = __pyx_state[13]; __pyx_result.theta_deg = __pyx_state[14]; __pyx_result.x0_A = __pyx_state[15]; __pyx_result.x0_B = __pyx_state[16]; __pyx_result.y0_A = __pyx_state[17]; __pyx_result.y0_B = __pyx_state[18]
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v___pyx_result);
  __pyx_r = __pyx_v___pyx_result;
  goto __pyx_L0;

  /* "(tree fragment)":1
 * def __pyx_unpickle_vcstring(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("vcstring.__pyx_unpickle_vcstring", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v___pyx_PickleError);
  __Pyx_XDECREF(__pyx_v___pyx_result);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "(tree fragment)":11
 *         __pyx_unpickle_vcstring__set_state(<vcstring> __pyx_result, __pyx_state)
 *     return __pyx_result
 * cdef __pyx_unpickle_vcstring__set_state(vcstring __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_result.alpha_A = __pyx_state[0]; __pyx_result.alpha_B = __pyx_state[1]; __pyx_result.alpha_deg_A = __pyx_state[2]; __pyx_result.alpha_deg_B = __pyx_state[3]; __pyx_result.cut = __pyx_state[4]; __pyx_result.cut_A = __pyx_state[5]; __pyx_result.cut_B = __pyx_state[6]; __pyx_result.num_basis = __pyx_state[7]; __pyx_result.ra_A = __pyx_state[8]; __pyx_result.ra_B = __pyx_state[9]; __pyx_result.rb_A = __pyx_state[10]; __pyx_result.rb_B = __pyx_state[11]; __pyx_result.state_assignment = __pyx_state[12]; __pyx_result.theta = __pyx_state[13]; __pyx_result.theta_deg = __pyx_state[14]; __pyx_result.x0_A = __pyx_state[15]; __pyx_result.x0_B = __pyx_state[16]; __pyx_result.y0_A = __pyx_state[17]; __pyx_result.y0_B = __pyx_state[18]
 *     if len(__pyx_state) > 19 and hasattr(__pyx_result, '__dict__'):
 */

static PyObject *__pyx_f_8vcstring___pyx_unpickle_vcstring__set_state(struct __pyx_obj_8vcstring_vcstring *__pyx_v___pyx_result, PyObject *__pyx_v___pyx_state) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  double __pyx_t_2;
  int __pyx_t_3;
  int __pyx_t_4;
  Py_ssize_t __pyx_t_5;
  int __pyx_t_6;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__pyx_unpickle_vcstring__set_state", 0);

  /* "(tree fragment)":12
 *     return __pyx_result
 * cdef __pyx_unpickle_vcstring__set_state(vcstring __pyx_result, tuple __pyx_state):
 *     __pyx_result.alpha_A = __pyx_state[0]; __pyx_result.alpha_B = __pyx_state[1]; __pyx_result.alpha_deg_A = __pyx_state[2]; __pyx_result.alpha_deg_B = __pyx_state[3]; __pyx_result.cut = __pyx_state[4]; __pyx_result.cut_A = __pyx_state[5]; __pyx_result.cut_B = __pyx_state[6]; __pyx_result.num_basis = __pyx_state[7]; __pyx_result.ra_A = __pyx_state[8]; __pyx_result.ra_B = __pyx_state[9]; __pyx_result.rb_A = __pyx_state[10]; __pyx_result.rb_B = __pyx_state[11]; __pyx_result.state_assignment = __pyx_state[12]; __pyx_result.theta = __pyx_state[13]; __pyx_result.theta_deg = __pyx_state[14]; __pyx_result.x0_A = __pyx_state[15]; __pyx_result.x0_B = __pyx_state[16]; __pyx_result.y0_A = __pyx_state[17]; __pyx_result.y0_B = __pyx_state[18]             # <<<<<<<<<<<<<<
 *     if len(__pyx_state) > 19 and hasattr(__pyx_result, '__dict__'):
 *         __pyx_result.__dict__.update(__pyx_state[19])
 */
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->alpha_A = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->alpha_B = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->alpha_deg_A = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->alpha_deg_B = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->cut = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->cut_A = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 6, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->cut_B = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 7, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_3 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->num_basis = __pyx_t_3;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 8, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->ra_A = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 9, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->ra_B = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 10, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->rb_A = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 11, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->rb_B = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 12, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (!(likely(PyUnicode_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_1)->tp_name), 0))) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GIVEREF(__pyx_t_1);
  __Pyx_GOTREF(__pyx_v___pyx_result->state_assignment);
  __Pyx_DECREF(__pyx_v___pyx_result->state_assignment);
  __pyx_v___pyx_result->state_assignment = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 13, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->theta = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 14, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->theta_deg = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 15, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->x0_A = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 16, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->x0_B = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 17, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->y0_A = __pyx_t_2;
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
    __PYX_ERR(1, 12, __pyx_L1_error)
  }
  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 18, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v___pyx_result->y0_B = __pyx_t_2;

  /* "(tree fragment)":13
 * cdef __pyx_unpickle_vcstring__set_state(vcstring __pyx_result, tuple __pyx_state):
 *     __pyx_result.alpha_A = __pyx_state[0]; __pyx_result.alpha_B = __pyx_state[1]; __pyx_result.alpha_deg_A = __pyx_state[2]; __pyx_result.alpha_deg_B = __pyx_state[3]; __pyx_result.cut = __pyx_state[4]; __pyx_result.cut_A = __pyx_state[5]; __pyx_result.cut_B = __pyx_state[6]; __pyx_result.num_basis = __pyx_state[7]; __pyx_result.ra_A = __pyx_state[8]; __pyx_result.ra_B = __pyx_state[9]; __pyx_result.rb_A = __pyx_state[10]; __pyx_result.rb_B = __pyx_state[11]; __pyx_result.state_assignment = __pyx_state[12]; __pyx_result.theta = __pyx_state[13]; __pyx_result.theta_deg = __pyx_state[14]; __pyx_result.x0_A = __pyx_state[15]; __pyx_result.x0_B = __pyx_state[16]; __pyx_result.y0_A = __pyx_state[17]; __pyx_result.y0_B = __pyx_state[18]
 *     if len(__pyx_state) > 19 and hasattr(__pyx_result, '__dict__'):             # <<<<<<<<<<<<<<
 *         __pyx_result.__dict__.update(__pyx_state[19])
 */
  if (unlikely(__pyx_v___pyx_state == Py_None)) {
    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
    __PYX_ERR(1, 13, __pyx_L1_error)
  }
  __pyx_t_5 = PyTuple_GET_SIZE(__pyx_v___pyx_state); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(1, 13, __pyx_L1_error)
  __pyx_t_6 = ((__pyx_t_5 > 19) != 0);
  if (__pyx_t_6) {
  } else {
    __pyx_t_4 = __pyx_t_6;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_6 = __Pyx_HasAttr(((PyObject *)__pyx_v___pyx_result), __pyx_n_s_dict); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(1, 13, __pyx_L1_error)
  __pyx_t_7 = (__pyx_t_6 != 0);
  __pyx_t_4 = __pyx_t_7;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_4) {

    /* "(tree fragment)":14
 *     __pyx_result.alpha_A = __pyx_state[0]; __pyx_result.alpha_B = __pyx_state[1]; __pyx_result.alpha_deg_A = __pyx_state[2]; __pyx_result.alpha_deg_B = __pyx_state[3]; __pyx_result.cut = __pyx_state[4]; __pyx_result.cut_A = __pyx_state[5]; __pyx_result.cut_B = __pyx_state[6]; __pyx_result.num_basis = __pyx_state[7]; __pyx_result.ra_A = __pyx_state[8]; __pyx_result.ra_B = __pyx_state[9]; __pyx_result.rb_A = __pyx_state[10]; __pyx_result.rb_B = __pyx_state[11]; __pyx_result.state_assignment = __pyx_state[12]; __pyx_result.theta = __pyx_state[13]; __pyx_result.theta_deg = __pyx_state[14]; __pyx_result.x0_A = __pyx_state[15]; __pyx_result.x0_B = __pyx_state[16]; __pyx_result.y0_A = __pyx_state[17]; __pyx_result.y0_B = __pyx_state[18]
 *     if len(__pyx_state) > 19 and hasattr(__pyx_result, '__dict__'):
 *         __pyx_result.__dict__.update(__pyx_state[19])             # <<<<<<<<<<<<<<
 */
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v___pyx_result), __pyx_n_s_dict); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 14, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_update); if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 14, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(__pyx_v___pyx_state == Py_None)) {
      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
      __PYX_ERR(1, 14, __pyx_L1_error)
    }
    __pyx_t_8 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 19, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 14, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_10 = NULL;
    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_10)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
      }
    }
    __pyx_t_1 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_10, __pyx_t_8) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_8);
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 14, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "(tree fragment)":13
 * cdef __pyx_unpickle_vcstring__set_state(vcstring __pyx_result, tuple __pyx_state):
 *     __pyx_result.alpha_A = __pyx_state[0]; __pyx_result.alpha_B = __pyx_state[1]; __pyx_result.alpha_deg_A = __pyx_state[2]; __pyx_result.alpha_deg_B = __pyx_state[3]; __pyx_result.cut = __pyx_state[4]; __pyx_result.cut_A = __pyx_state[5]; __pyx_result.cut_B = __pyx_state[6]; __pyx_result.num_basis = __pyx_state[7]; __pyx_result.ra_A = __pyx_state[8]; __pyx_result.ra_B = __pyx_state[9]; __pyx_result.rb_A = __pyx_state[10]; __pyx_result.rb_B = __pyx_state[11]; __pyx_result.state_assignment = __pyx_state[12]; __pyx_result.theta = __pyx_state[13]; __pyx_result.theta_deg = __pyx_state[14]; __pyx_result.x0_A = __pyx_state[15]; __pyx_result.x0_B = __pyx_state[16]; __pyx_result.y0_A = __pyx_state[17]; __pyx_result.y0_B = __pyx_state[18]
 *     if len(__pyx_state) > 19 and hasattr(__pyx_result, '__dict__'):             # <<<<<<<<<<<<<<
 *         __pyx_result.__dict__.update(__pyx_state[19])
 */
  }

  /* "(tree fragment)":11
 *         __pyx_unpickle_vcstring__set_state(<vcstring> __pyx_result, __pyx_state)
 *     return __pyx_result
 * cdef __pyx_unpickle_vcstring__set_state(vcstring __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
 *     __pyx_result.alpha_A = __pyx_state[0]; __pyx_result.alpha_B = __pyx_state[1]; __pyx_result.alpha_deg_A = __pyx_state[2]; __pyx_result.alpha_deg_B = __pyx_state[3]; __pyx_result.cut = __pyx_state[4]; __pyx_result.cut_A = __pyx_state[5]; __pyx_result.cut_B = __pyx_state[6]; __pyx_result.num_basis = __pyx_state[7]; __pyx_result.ra_A = __pyx_state[8]; __pyx_result.ra_B = __pyx_state[9]; __pyx_result.rb_A = __pyx_state[10]; __pyx_result.rb_B = __pyx_state[11]; __pyx_result.state_assignment = __pyx_state[12]; __pyx_result.theta = __pyx_state[13]; __pyx_result.theta_deg = __pyx_state[14]; __pyx_result.x0_A = __pyx_state[15]; __pyx_result.x0_B = __pyx_state[16]; __pyx_result.y0_A = __pyx_state[17]; __pyx_result.y0_B = __pyx_state[18]
 *     if len(__pyx_state) > 19 and hasattr(__pyx_result, '__dict__'):
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("vcstring.__pyx_unpickle_vcstring__set_state", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":735
 * ctypedef npy_cdouble     complex_t
 * 
 * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
 *     return PyArray_MultiIterNew(1, <void*>a)
 * 
 */

static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew1(PyObject *__pyx_v_a) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("PyArray_MultiIterNew1", 0);

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":736
 * 
 * cdef inline object PyArray_MultiIterNew1(a):
 *     return PyArray_MultiIterNew(1, <void*>a)             # <<<<<<<<<<<<<<
 * 
 * cdef inline object PyArray_MultiIterNew2(a, b):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyArray_MultiIterNew(1, ((void *)__pyx_v_a)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 736, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":735
 * ctypedef npy_cdouble     complex_t
 * 
 * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
 *     return PyArray_MultiIterNew(1, <void*>a)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew1", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":738
 *     return PyArray_MultiIterNew(1, <void*>a)
 * 
 * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
 *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
 * 
 */

static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew2(PyObject *__pyx_v_a, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("PyArray_MultiIterNew2", 0);

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":739
 * 
 * cdef inline object PyArray_MultiIterNew2(a, b):
 *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)             # <<<<<<<<<<<<<<
 * 
 * cdef inline object PyArray_MultiIterNew3(a, b, c):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyArray_MultiIterNew(2, ((void *)__pyx_v_a), ((void *)__pyx_v_b)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 739, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":738
 *     return PyArray_MultiIterNew(1, <void*>a)
 * 
 * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
 *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":741
 *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
 * 
 * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
 *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
 * 
 */

static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew3(PyObject *__pyx_v_a, PyObject *__pyx_v_b, PyObject *__pyx_v_c) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("PyArray_MultiIterNew3", 0);

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":742
 * 
 * cdef inline object PyArray_MultiIterNew3(a, b, c):
 *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)             # <<<<<<<<<<<<<<
 * 
 * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyArray_MultiIterNew(3, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 742, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":741
 *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
 * 
 * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
 *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew3", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":744
 *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
 * 
 * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
 *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
 * 
 */

static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew4(PyObject *__pyx_v_a, PyObject *__pyx_v_b, PyObject *__pyx_v_c, PyObject *__pyx_v_d) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("PyArray_MultiIterNew4", 0);

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":745
 * 
 * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
 *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)             # <<<<<<<<<<<<<<
 * 
 * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyArray_MultiIterNew(4, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 745, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":744
 *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
 * 
 * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
 *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew4", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":747
 *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
 * 
 * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
 *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
 * 
 */

static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew5(PyObject *__pyx_v_a, PyObject *__pyx_v_b, PyObject *__pyx_v_c, PyObject *__pyx_v_d, PyObject *__pyx_v_e) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("PyArray_MultiIterNew5", 0);

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":748
 * 
 * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
 *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)             # <<<<<<<<<<<<<<
 * 
 * cdef inline tuple PyDataType_SHAPE(dtype d):
 */
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyArray_MultiIterNew(5, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d), ((void *)__pyx_v_e)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 748, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":747
 *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
 * 
 * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
 *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew5", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":750
 *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
 * 
 * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
 *     if PyDataType_HASSUBARRAY(d):
 *         return <tuple>d.subarray.shape
 */

static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyDataType_SHAPE(PyArray_Descr *__pyx_v_d) {
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("PyDataType_SHAPE", 0);

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":751
 * 
 * cdef inline tuple PyDataType_SHAPE(dtype d):
 *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
 *         return <tuple>d.subarray.shape
 *     else:
 */
  __pyx_t_1 = (PyDataType_HASSUBARRAY(__pyx_v_d) != 0);
  if (__pyx_t_1) {

    /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":752
 * cdef inline tuple PyDataType_SHAPE(dtype d):
 *     if PyDataType_HASSUBARRAY(d):
 *         return <tuple>d.subarray.shape             # <<<<<<<<<<<<<<
 *     else:
 *         return ()
 */
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(((PyObject*)__pyx_v_d->subarray->shape));
    __pyx_r = ((PyObject*)__pyx_v_d->subarray->shape);
    goto __pyx_L0;

    /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":751
 * 
 * cdef inline tuple PyDataType_SHAPE(dtype d):
 *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
 *         return <tuple>d.subarray.shape
 *     else:
 */
  }

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":754
 *         return <tuple>d.subarray.shape
 *     else:
 *         return ()             # <<<<<<<<<<<<<<
 * 
 * 
 */
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_empty_tuple);
    __pyx_r = __pyx_empty_tuple;
    goto __pyx_L0;
  }

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":750
 *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
 * 
 * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
 *     if PyDataType_HASSUBARRAY(d):
 *         return <tuple>d.subarray.shape
 */

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":931
 *     int _import_umath() except -1
 * 
 * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
 *     Py_INCREF(base) # important to do this before stealing the reference below!
 *     PyArray_SetBaseObject(arr, base)
 */

static CYTHON_INLINE void __pyx_f_5numpy_set_array_base(PyArrayObject *__pyx_v_arr, PyObject *__pyx_v_base) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("set_array_base", 0);

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":932
 * 
 * cdef inline void set_array_base(ndarray arr, object base):
 *     Py_INCREF(base) # important to do this before stealing the reference below!             # <<<<<<<<<<<<<<
 *     PyArray_SetBaseObject(arr, base)
 * 
 */
  Py_INCREF(__pyx_v_base);

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":933
 * cdef inline void set_array_base(ndarray arr, object base):
 *     Py_INCREF(base) # important to do this before stealing the reference below!
 *     PyArray_SetBaseObject(arr, base)             # <<<<<<<<<<<<<<
 * 
 * cdef inline object get_array_base(ndarray arr):
 */
  (void)(PyArray_SetBaseObject(__pyx_v_arr, __pyx_v_base));

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":931
 *     int _import_umath() except -1
 * 
 * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
 *     Py_INCREF(base) # important to do this before stealing the reference below!
 *     PyArray_SetBaseObject(arr, base)
 */

  /* function exit code */
  __Pyx_RefNannyFinishContext();
}

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":935
 *     PyArray_SetBaseObject(arr, base)
 * 
 * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
 *     base = PyArray_BASE(arr)
 *     if base is NULL:
 */

static CYTHON_INLINE PyObject *__pyx_f_5numpy_get_array_base(PyArrayObject *__pyx_v_arr) {
  PyObject *__pyx_v_base;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  __Pyx_RefNannySetupContext("get_array_base", 0);

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":936
 * 
 * cdef inline object get_array_base(ndarray arr):
 *     base = PyArray_BASE(arr)             # <<<<<<<<<<<<<<
 *     if base is NULL:
 *         return None
 */
  __pyx_v_base = PyArray_BASE(__pyx_v_arr);

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":937
 * cdef inline object get_array_base(ndarray arr):
 *     base = PyArray_BASE(arr)
 *     if base is NULL:             # <<<<<<<<<<<<<<
 *         return None
 *     return <object>base
 */
  __pyx_t_1 = ((__pyx_v_base == NULL) != 0);
  if (__pyx_t_1) {

    /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":938
 *     base = PyArray_BASE(arr)
 *     if base is NULL:
 *         return None             # <<<<<<<<<<<<<<
 *     return <object>base
 * 
 */
    __Pyx_XDECREF(__pyx_r);
    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
    goto __pyx_L0;

    /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":937
 * cdef inline object get_array_base(ndarray arr):
 *     base = PyArray_BASE(arr)
 *     if base is NULL:             # <<<<<<<<<<<<<<
 *         return None
 *     return <object>base
 */
  }

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":939
 *     if base is NULL:
 *         return None
 *     return <object>base             # <<<<<<<<<<<<<<
 * 
 * # Versions of the import_* functions which are more suitable for
 */
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(((PyObject *)__pyx_v_base));
  __pyx_r = ((PyObject *)__pyx_v_base);
  goto __pyx_L0;

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":935
 *     PyArray_SetBaseObject(arr, base)
 * 
 * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
 *     base = PyArray_BASE(arr)
 *     if base is NULL:
 */

  /* function exit code */
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":943
 * # Versions of the import_* functions which are more suitable for
 * # Cython code.
 * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
 *     try:
 *         __pyx_import_array()
 */

static CYTHON_INLINE int __pyx_f_5numpy_import_array(void) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("import_array", 0);

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":944
 * # Cython code.
 * cdef inline int import_array() except -1:
 *     try:             # <<<<<<<<<<<<<<
 *         __pyx_import_array()
 *     except Exception:
 */
  {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
    __Pyx_XGOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_t_2);
    __Pyx_XGOTREF(__pyx_t_3);
    /*try:*/ {

      /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":945
 * cdef inline int import_array() except -1:
 *     try:
 *         __pyx_import_array()             # <<<<<<<<<<<<<<
 *     except Exception:
 *         raise ImportError("numpy.core.multiarray failed to import")
 */
      __pyx_t_4 = _import_array(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(2, 945, __pyx_L3_error)

      /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":944
 * # Cython code.
 * cdef inline int import_array() except -1:
 *     try:             # <<<<<<<<<<<<<<
 *         __pyx_import_array()
 *     except Exception:
 */
    }
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L8_try_end;
    __pyx_L3_error:;

    /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":946
 *     try:
 *         __pyx_import_array()
 *     except Exception:             # <<<<<<<<<<<<<<
 *         raise ImportError("numpy.core.multiarray failed to import")
 * 
 */
    __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
    if (__pyx_t_4) {
      __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(2, 946, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_GOTREF(__pyx_t_7);

      /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":947
 *         __pyx_import_array()
 *     except Exception:
 *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
 * 
 * cdef inline int import_umath() except -1:
 */
      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__83, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(2, 947, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_Raise(__pyx_t_8, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __PYX_ERR(2, 947, __pyx_L5_except_error)
    }
    goto __pyx_L5_except_error;
    __pyx_L5_except_error:;

    /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":944
 * # Cython code.
 * cdef inline int import_array() except -1:
 *     try:             # <<<<<<<<<<<<<<
 *         __pyx_import_array()
 *     except Exception:
 */
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L1_error;
    __pyx_L8_try_end:;
  }

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":943
 * # Versions of the import_* functions which are more suitable for
 * # Cython code.
 * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
 *     try:
 *         __pyx_import_array()
 */

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":949
 *         raise ImportError("numpy.core.multiarray failed to import")
 * 
 * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
 *     try:
 *         _import_umath()
 */

static CYTHON_INLINE int __pyx_f_5numpy_import_umath(void) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("import_umath", 0);

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":950
 * 
 * cdef inline int import_umath() except -1:
 *     try:             # <<<<<<<<<<<<<<
 *         _import_umath()
 *     except Exception:
 */
  {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
    __Pyx_XGOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_t_2);
    __Pyx_XGOTREF(__pyx_t_3);
    /*try:*/ {

      /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":951
 * cdef inline int import_umath() except -1:
 *     try:
 *         _import_umath()             # <<<<<<<<<<<<<<
 *     except Exception:
 *         raise ImportError("numpy.core.umath failed to import")
 */
      __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(2, 951, __pyx_L3_error)

      /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":950
 * 
 * cdef inline int import_umath() except -1:
 *     try:             # <<<<<<<<<<<<<<
 *         _import_umath()
 *     except Exception:
 */
    }
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L8_try_end;
    __pyx_L3_error:;

    /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":952
 *     try:
 *         _import_umath()
 *     except Exception:             # <<<<<<<<<<<<<<
 *         raise ImportError("numpy.core.umath failed to import")
 * 
 */
    __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
    if (__pyx_t_4) {
      __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(2, 952, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_GOTREF(__pyx_t_7);

      /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":953
 *         _import_umath()
 *     except Exception:
 *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
 * 
 * cdef inline int import_ufunc() except -1:
 */
      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__84, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(2, 953, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_Raise(__pyx_t_8, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __PYX_ERR(2, 953, __pyx_L5_except_error)
    }
    goto __pyx_L5_except_error;
    __pyx_L5_except_error:;

    /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":950
 * 
 * cdef inline int import_umath() except -1:
 *     try:             # <<<<<<<<<<<<<<
 *         _import_umath()
 *     except Exception:
 */
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L1_error;
    __pyx_L8_try_end:;
  }

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":949
 *         raise ImportError("numpy.core.multiarray failed to import")
 * 
 * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
 *     try:
 *         _import_umath()
 */

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":955
 *         raise ImportError("numpy.core.umath failed to import")
 * 
 * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
 *     try:
 *         _import_umath()
 */

static CYTHON_INLINE int __pyx_f_5numpy_import_ufunc(void) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("import_ufunc", 0);

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":956
 * 
 * cdef inline int import_ufunc() except -1:
 *     try:             # <<<<<<<<<<<<<<
 *         _import_umath()
 *     except Exception:
 */
  {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
    __Pyx_XGOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_t_2);
    __Pyx_XGOTREF(__pyx_t_3);
    /*try:*/ {

      /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":957
 * cdef inline int import_ufunc() except -1:
 *     try:
 *         _import_umath()             # <<<<<<<<<<<<<<
 *     except Exception:
 *         raise ImportError("numpy.core.umath failed to import")
 */
      __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(2, 957, __pyx_L3_error)

      /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":956
 * 
 * cdef inline int import_ufunc() except -1:
 *     try:             # <<<<<<<<<<<<<<
 *         _import_umath()
 *     except Exception:
 */
    }
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L8_try_end;
    __pyx_L3_error:;

    /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":958
 *     try:
 *         _import_umath()
 *     except Exception:             # <<<<<<<<<<<<<<
 *         raise ImportError("numpy.core.umath failed to import")
 * 
 */
    __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
    if (__pyx_t_4) {
      __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(2, 958, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_GOTREF(__pyx_t_7);

      /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":959
 *         _import_umath()
 *     except Exception:
 *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
 * 
 * cdef extern from *:
 */
      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__84, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(2, 959, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_Raise(__pyx_t_8, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __PYX_ERR(2, 959, __pyx_L5_except_error)
    }
    goto __pyx_L5_except_error;
    __pyx_L5_except_error:;

    /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":956
 * 
 * cdef inline int import_ufunc() except -1:
 *     try:             # <<<<<<<<<<<<<<
 *         _import_umath()
 *     except Exception:
 */
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L1_error;
    __pyx_L8_try_end:;
  }

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":955
 *         raise ImportError("numpy.core.umath failed to import")
 * 
 * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
 *     try:
 *         _import_umath()
 */

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":969
 * 
 * 
 * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
 *     """
 *     Cython equivalent of `isinstance(obj, np.timedelta64)`
 */

static CYTHON_INLINE int __pyx_f_5numpy_is_timedelta64_object(PyObject *__pyx_v_obj) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_timedelta64_object", 0);

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":981
 *     bool
 *     """
 *     return PyObject_TypeCheck(obj, &PyTimedeltaArrType_Type)             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyTimedeltaArrType_Type));
  goto __pyx_L0;

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":969
 * 
 * 
 * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
 *     """
 *     Cython equivalent of `isinstance(obj, np.timedelta64)`
 */

  /* function exit code */
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":984
 * 
 * 
 * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
 *     """
 *     Cython equivalent of `isinstance(obj, np.datetime64)`
 */

static CYTHON_INLINE int __pyx_f_5numpy_is_datetime64_object(PyObject *__pyx_v_obj) {
  int __pyx_r;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("is_datetime64_object", 0);

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":996
 *     bool
 *     """
 *     return PyObject_TypeCheck(obj, &PyDatetimeArrType_Type)             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyDatetimeArrType_Type));
  goto __pyx_L0;

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":984
 * 
 * 
 * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
 *     """
 *     Cython equivalent of `isinstance(obj, np.datetime64)`
 */

  /* function exit code */
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":999
 * 
 * 
 * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
 *     """
 *     returns the int64 value underlying scalar numpy datetime64 object
 */

static CYTHON_INLINE npy_datetime __pyx_f_5numpy_get_datetime64_value(PyObject *__pyx_v_obj) {
  npy_datetime __pyx_r;

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":1006
 *     also needed.  That can be found using `get_datetime64_unit`.
 *     """
 *     return (<PyDatetimeScalarObject*>obj).obval             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_r = ((PyDatetimeScalarObject *)__pyx_v_obj)->obval;
  goto __pyx_L0;

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":999
 * 
 * 
 * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
 *     """
 *     returns the int64 value underlying scalar numpy datetime64 object
 */

  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":1009
 * 
 * 
 * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
 *     """
 *     returns the int64 value underlying scalar numpy timedelta64 object
 */

static CYTHON_INLINE npy_timedelta __pyx_f_5numpy_get_timedelta64_value(PyObject *__pyx_v_obj) {
  npy_timedelta __pyx_r;

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":1013
 *     returns the int64 value underlying scalar numpy timedelta64 object
 *     """
 *     return (<PyTimedeltaScalarObject*>obj).obval             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_r = ((PyTimedeltaScalarObject *)__pyx_v_obj)->obval;
  goto __pyx_L0;

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":1009
 * 
 * 
 * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
 *     """
 *     returns the int64 value underlying scalar numpy timedelta64 object
 */

  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}

/* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":1016
 * 
 * 
 * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
 *     """
 *     returns the unit part of the dtype for a numpy datetime64 object.
 */

static CYTHON_INLINE NPY_DATETIMEUNIT __pyx_f_5numpy_get_datetime64_unit(PyObject *__pyx_v_obj) {
  NPY_DATETIMEUNIT __pyx_r;

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":1020
 *     returns the unit part of the dtype for a numpy datetime64 object.
 *     """
 *     return <NPY_DATETIMEUNIT>(<PyDatetimeScalarObject*>obj).obmeta.base             # <<<<<<<<<<<<<<
 */
  __pyx_r = ((NPY_DATETIMEUNIT)((PyDatetimeScalarObject *)__pyx_v_obj)->obmeta.base);
  goto __pyx_L0;

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":1016
 * 
 * 
 * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
 *     """
 *     returns the unit part of the dtype for a numpy datetime64 object.
 */

  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
static struct __pyx_vtabstruct_8vcstring_vcstring __pyx_vtable_8vcstring_vcstring;

static PyObject *__pyx_tp_new_8vcstring_vcstring(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  struct __pyx_obj_8vcstring_vcstring *p;
  PyObject *o;
  if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
    o = (*t->tp_alloc)(t, 0);
  } else {
    o = (PyObject *) PyBaseObject_Type.tp_new(t, __pyx_empty_tuple, 0);
  }
  if (unlikely(!o)) return 0;
  p = ((struct __pyx_obj_8vcstring_vcstring *)o);
  p->__pyx_vtab = __pyx_vtabptr_8vcstring_vcstring;
  p->state_assignment = ((PyObject*)Py_None); Py_INCREF(Py_None);
  return o;
}

static void __pyx_tp_dealloc_8vcstring_vcstring(PyObject *o) {
  struct __pyx_obj_8vcstring_vcstring *p = (struct __pyx_obj_8vcstring_vcstring *)o;
  #if CYTHON_USE_TP_FINALIZE
  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && (!PyType_IS_GC(Py_TYPE(o)) || !_PyGC_FINALIZED(o))) {
    if (PyObject_CallFinalizerFromDealloc(o)) return;
  }
  #endif
  Py_CLEAR(p->state_assignment);
  (*Py_TYPE(o)->tp_free)(o);
}

static PyMethodDef __pyx_methods_8vcstring_vcstring[] = {
  {"intermediate_region", (PyCFunction)__pyx_pw_8vcstring_8vcstring_3intermediate_region, METH_NOARGS, __pyx_doc_8vcstring_8vcstring_2intermediate_region},
  {"centroids", (PyCFunction)__pyx_pw_8vcstring_8vcstring_5centroids, METH_NOARGS, __pyx_doc_8vcstring_8vcstring_4centroids},
  {"assign_states", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_8vcstring_7assign_states, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8vcstring_8vcstring_6assign_states},
  {"assign_states_ensemble", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_8vcstring_9assign_states_ensemble, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8vcstring_8vcstring_8assign_states_ensemble},
  {"calc_coeffs", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_8vcstring_11calc_coeffs, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8vcstring_8vcstring_10calc_coeffs},
  {"calc_coeffs_accelerated", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_8vcstring_13calc_coeffs_accelerated, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8vcstring_8vcstring_12calc_coeffs_accelerated},
  {"calc_coeffs_ensemble", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_8vcstring_15calc_coeffs_ensemble, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8vcstring_8vcstring_14calc_coeffs_ensemble},
  {"calc_coeffs_ensemble_timeavg", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_8vcstring_17calc_coeffs_ensemble_timeavg, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8vcstring_8vcstring_16calc_coeffs_ensemble_timeavg},
  {"calc_coeffs_ensemble_timeavg_fast", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_8vcstring_19calc_coeffs_ensemble_timeavg_fast, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8vcstring_8vcstring_18calc_coeffs_ensemble_timeavg_fast},
  {"calc_coeffs_ensemble_timeavg_fast_v2", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_8vcstring_21calc_coeffs_ensemble_timeavg_fast_v2, METH_VARARGS|METH_KEYWORDS, 0},
  {"calc_corr", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_8vcstring_23calc_corr, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8vcstring_8vcstring_22calc_corr},
  {"calc_corr_q2", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_8vcstring_25calc_corr_q2, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8vcstring_8vcstring_24calc_corr_q2},
  {"calc_corr_q2_ensemble", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_8vcstring_27calc_corr_q2_ensemble, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8vcstring_8vcstring_26calc_corr_q2_ensemble},
  {"calc_corr_q2_ensemble_timeavg", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_8vcstring_29calc_corr_q2_ensemble_timeavg, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8vcstring_8vcstring_28calc_corr_q2_ensemble_timeavg},
  {"calc_corr_q2_ensemble_timeavg_fast", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_8vcstring_31calc_corr_q2_ensemble_timeavg_fast, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8vcstring_8vcstring_30calc_corr_q2_ensemble_timeavg_fast},
  {"finite_diff_corr", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_8vcstring_33finite_diff_corr, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8vcstring_8vcstring_32finite_diff_corr},
  {"finite_diff_committor", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_8vcstring_35finite_diff_committor, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8vcstring_8vcstring_34finite_diff_committor},
  {"montecarlo", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_8vcstring_37montecarlo, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8vcstring_8vcstring_36montecarlo},
  {"montecarlo_symmetric", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_8vcstring_39montecarlo_symmetric, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8vcstring_8vcstring_38montecarlo_symmetric},
  {"__reduce_cython__", (PyCFunction)__pyx_pw_8vcstring_8vcstring_41__reduce_cython__, METH_NOARGS, 0},
  {"__setstate_cython__", (PyCFunction)__pyx_pw_8vcstring_8vcstring_43__setstate_cython__, METH_O, 0},
  {0, 0, 0, 0}
};

static PyTypeObject __pyx_type_8vcstring_vcstring = {
  PyVarObject_HEAD_INIT(0, 0)
  "vcstring.vcstring", /*tp_name*/
  sizeof(struct __pyx_obj_8vcstring_vcstring), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_8vcstring_vcstring, /*tp_dealloc*/
  #if PY_VERSION_HEX < 0x030800b4
  0, /*tp_print*/
  #endif
  #if PY_VERSION_HEX >= 0x030800b4
  0, /*tp_vectorcall_offset*/
  #endif
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE, /*tp_flags*/
  0, /*tp_doc*/
  0, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_8vcstring_vcstring, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pw_8vcstring_8vcstring_1__init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_8vcstring_vcstring, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  0, /*tp_finalize*/
  #endif
  #if PY_VERSION_HEX >= 0x030800b1
  0, /*tp_vectorcall*/
  #endif
  #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
  0, /*tp_print*/
  #endif
};

static PyMethodDef __pyx_methods[] = {
  {"reparm_string", (PyCFunction)__pyx_pw_8vcstring_1reparm_string, METH_O, 0},
  {"elliptical_bounds_params", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8vcstring_3elliptical_bounds_params, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8vcstring_2elliptical_bounds_params},
  {0, 0, 0, 0}
};

#if PY_MAJOR_VERSION >= 3
#if CYTHON_PEP489_MULTI_PHASE_INIT
static PyObject* __pyx_pymod_create(PyObject *spec, PyModuleDef *def); /*proto*/
static int __pyx_pymod_exec_vcstring(PyObject* module); /*proto*/
static PyModuleDef_Slot __pyx_moduledef_slots[] = {
  {Py_mod_create, (void*)__pyx_pymod_create},
  {Py_mod_exec, (void*)__pyx_pymod_exec_vcstring},
  {0, NULL}
};
#endif

static struct PyModuleDef __pyx_moduledef = {
    PyModuleDef_HEAD_INIT,
    "vcstring",
    0, /* m_doc */
  #if CYTHON_PEP489_MULTI_PHASE_INIT
    0, /* m_size */
  #else
    -1, /* m_size */
  #endif
    __pyx_methods /* m_methods */,
  #if CYTHON_PEP489_MULTI_PHASE_INIT
    __pyx_moduledef_slots, /* m_slots */
  #else
    NULL, /* m_reload */
  #endif
    NULL, /* m_traverse */
    NULL, /* m_clear */
    NULL /* m_free */
};
#endif
#ifndef CYTHON_SMALL_CODE
#if defined(__clang__)
    #define CYTHON_SMALL_CODE
#elif defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 3))
    #define CYTHON_SMALL_CODE __attribute__((cold))
#else
    #define CYTHON_SMALL_CODE
#endif
#endif

static __Pyx_StringTabEntry __pyx_string_tab[] = {
  {&__pyx_kp_u_1d, __pyx_k_1d, sizeof(__pyx_k_1d), 0, 1, 0, 0},
  {&__pyx_kp_u_Accepted_Moved_position_by_0_1_C, __pyx_k_Accepted_Moved_position_by_0_1_C, sizeof(__pyx_k_Accepted_Moved_position_by_0_1_C), 0, 1, 0, 0},
  {&__pyx_kp_u_Affected_images, __pyx_k_Affected_images, sizeof(__pyx_k_Affected_images), 0, 1, 0, 0},
  {&__pyx_n_s_C, __pyx_k_C, sizeof(__pyx_k_C), 0, 0, 1, 1},
  {&__pyx_kp_u_CALCULATING_CORRELATION_FUNCTION, __pyx_k_CALCULATING_CORRELATION_FUNCTION, sizeof(__pyx_k_CALCULATING_CORRELATION_FUNCTION), 0, 1, 0, 0},
  {&__pyx_kp_u_CALCULATING_FINITE_DIFFERENCE_GR, __pyx_k_CALCULATING_FINITE_DIFFERENCE_GR, sizeof(__pyx_k_CALCULATING_FINITE_DIFFERENCE_GR), 0, 1, 0, 0},
  {&__pyx_kp_u_CALCULATING_MONTE_CARLO_STEP, __pyx_k_CALCULATING_MONTE_CARLO_STEP, sizeof(__pyx_k_CALCULATING_MONTE_CARLO_STEP), 0, 1, 0, 0},
  {&__pyx_n_s_C_avg, __pyx_k_C_avg, sizeof(__pyx_k_C_avg), 0, 0, 1, 1},
  {&__pyx_n_s_C_list, __pyx_k_C_list, sizeof(__pyx_k_C_list), 0, 0, 1, 1},
  {&__pyx_n_s_Cm, __pyx_k_Cm, sizeof(__pyx_k_Cm), 0, 0, 1, 1},
  {&__pyx_kp_u_Cm_2, __pyx_k_Cm_2, sizeof(__pyx_k_Cm_2), 0, 1, 0, 0},
  {&__pyx_kp_u_Corr, __pyx_k_Corr, sizeof(__pyx_k_Corr), 0, 1, 0, 0},
  {&__pyx_kp_u_Corr_2, __pyx_k_Corr_2, sizeof(__pyx_k_Corr_2), 0, 1, 0, 0},
  {&__pyx_kp_u_Corr_3, __pyx_k_Corr_3, sizeof(__pyx_k_Corr_3), 0, 1, 0, 0},
  {&__pyx_kp_u_Corr_from_ensemble_time_average, __pyx_k_Corr_from_ensemble_time_average, sizeof(__pyx_k_Corr_from_ensemble_time_average), 0, 1, 0, 0},
  {&__pyx_n_s_Cp, __pyx_k_Cp, sizeof(__pyx_k_Cp), 0, 0, 1, 1},
  {&__pyx_kp_u_Cp_2, __pyx_k_Cp_2, sizeof(__pyx_k_Cp_2), 0, 1, 0, 0},
  {&__pyx_n_s_DTYPE, __pyx_k_DTYPE, sizeof(__pyx_k_DTYPE), 0, 0, 1, 1},
  {&__pyx_kp_u_D_0, __pyx_k_D_0, sizeof(__pyx_k_D_0), 0, 1, 0, 0},
  {&__pyx_n_s_D_0_2, __pyx_k_D_0_2, sizeof(__pyx_k_D_0_2), 0, 0, 1, 1},
  {&__pyx_n_u_D_0_2, __pyx_k_D_0_2, sizeof(__pyx_k_D_0_2), 0, 1, 0, 1},
  {&__pyx_kp_u_D_tau, __pyx_k_D_tau, sizeof(__pyx_k_D_tau), 0, 1, 0, 0},
  {&__pyx_n_s_D_tau_2, __pyx_k_D_tau_2, sizeof(__pyx_k_D_tau_2), 0, 0, 1, 1},
  {&__pyx_n_u_D_tau_2, __pyx_k_D_tau_2, sizeof(__pyx_k_D_tau_2), 0, 1, 0, 1},
  {&__pyx_kp_u_Distance_between_images, __pyx_k_Distance_between_images, sizeof(__pyx_k_Distance_between_images), 0, 1, 0, 0},
  {&__pyx_kp_u_Distance_to_neighbhoring_images, __pyx_k_Distance_to_neighbhoring_images, sizeof(__pyx_k_Distance_to_neighbhoring_images), 0, 1, 0, 0},
  {&__pyx_kp_u_Dividing_D_by_data_size, __pyx_k_Dividing_D_by_data_size, sizeof(__pyx_k_Dividing_D_by_data_size), 0, 1, 0, 0},
  {&__pyx_kp_u_Dividing_D_by_data_size_2, __pyx_k_Dividing_D_by_data_size_2, sizeof(__pyx_k_Dividing_D_by_data_size_2), 0, 1, 0, 0},
  {&__pyx_kp_u_ENSEMBLE_AVERAGE, __pyx_k_ENSEMBLE_AVERAGE, sizeof(__pyx_k_ENSEMBLE_AVERAGE), 0, 1, 0, 0},
  {&__pyx_kp_u_ENSEMBLE_TIME_AVERAGE_method_1, __pyx_k_ENSEMBLE_TIME_AVERAGE_method_1, sizeof(__pyx_k_ENSEMBLE_TIME_AVERAGE_method_1), 0, 1, 0, 0},
  {&__pyx_kp_u_ENSEMBLE_TIME_AVERAGE_method_2, __pyx_k_ENSEMBLE_TIME_AVERAGE_method_2, sizeof(__pyx_k_ENSEMBLE_TIME_AVERAGE_method_2), 0, 1, 0, 0},
  {&__pyx_kp_u_ERROR_length_of_input_string_out, __pyx_k_ERROR_length_of_input_string_out, sizeof(__pyx_k_ERROR_length_of_input_string_out), 0, 1, 0, 0},
  {&__pyx_kp_u_Enforcing_minimum_distance_cons, __pyx_k_Enforcing_minimum_distance_cons, sizeof(__pyx_k_Enforcing_minimum_distance_cons), 0, 1, 0, 0},
  {&__pyx_kp_u_Equidistance, __pyx_k_Equidistance, sizeof(__pyx_k_Equidistance), 0, 1, 0, 0},
  {&__pyx_kp_u_FINITE_DIFFERENCE_COMPLETED, __pyx_k_FINITE_DIFFERENCE_COMPLETED, sizeof(__pyx_k_FINITE_DIFFERENCE_COMPLETED), 0, 1, 0, 0},
  {&__pyx_kp_u_FINITE_DIFFERENCE_PARAMETERS, __pyx_k_FINITE_DIFFERENCE_PARAMETERS, sizeof(__pyx_k_FINITE_DIFFERENCE_PARAMETERS), 0, 1, 0, 0},
  {&__pyx_kp_u_IMAGE, __pyx_k_IMAGE, sizeof(__pyx_k_IMAGE), 0, 1, 0, 0},
  {&__pyx_kp_u_IMAGE_0_and_1, __pyx_k_IMAGE_0_and_1, sizeof(__pyx_k_IMAGE_0_and_1), 0, 1, 0, 0},
  {&__pyx_n_u_Image, __pyx_k_Image, sizeof(__pyx_k_Image), 0, 1, 0, 1},
  {&__pyx_kp_u_Image_0_Moving_position_by_1_2, __pyx_k_Image_0_Moving_position_by_1_2, sizeof(__pyx_k_Image_0_Moving_position_by_1_2), 0, 1, 0, 0},
  {&__pyx_n_s_ImportError, __pyx_k_ImportError, sizeof(__pyx_k_ImportError), 0, 0, 1, 1},
  {&__pyx_kp_s_Incompatible_checksums_s_vs_0xf6, __pyx_k_Incompatible_checksums_s_vs_0xf6, sizeof(__pyx_k_Incompatible_checksums_s_vs_0xf6), 0, 0, 1, 0},
  {&__pyx_kp_u_Incorrect_state_assignment_Chose, __pyx_k_Incorrect_state_assignment_Chose, sizeof(__pyx_k_Incorrect_state_assignment_Chose), 0, 1, 0, 0},
  {&__pyx_kp_u_Initial_position, __pyx_k_Initial_position, sizeof(__pyx_k_Initial_position), 0, 1, 0, 0},
  {&__pyx_kp_u_Initial_position_2, __pyx_k_Initial_position_2, sizeof(__pyx_k_Initial_position_2), 0, 1, 0, 0},
  {&__pyx_kp_u_Input_data, __pyx_k_Input_data, sizeof(__pyx_k_Input_data), 0, 1, 0, 0},
  {&__pyx_kp_u_Input_positions, __pyx_k_Input_positions, sizeof(__pyx_k_Input_positions), 0, 1, 0, 0},
  {&__pyx_kp_u_Invalid_lag_time_Use_a_smaller, __pyx_k_Invalid_lag_time_Use_a_smaller, sizeof(__pyx_k_Invalid_lag_time_Use_a_smaller), 0, 1, 0, 0},
  {&__pyx_kp_u_Length_input_output, __pyx_k_Length_input_output, sizeof(__pyx_k_Length_input_output), 0, 1, 0, 0},
  {&__pyx_kp_u_Length_input_string_output_strin, __pyx_k_Length_input_string_output_strin, sizeof(__pyx_k_Length_input_string_output_strin), 0, 1, 0, 0},
  {&__pyx_kp_u_MONTE_CARLO_PARAMETERS, __pyx_k_MONTE_CARLO_PARAMETERS, sizeof(__pyx_k_MONTE_CARLO_PARAMETERS), 0, 1, 0, 0},
  {&__pyx_kp_u_MONTE_CARLO_SAMPLING, __pyx_k_MONTE_CARLO_SAMPLING, sizeof(__pyx_k_MONTE_CARLO_SAMPLING), 0, 1, 0, 0},
  {&__pyx_kp_u_MONTE_CARLO_SAMPLING_SYMMETRIC, __pyx_k_MONTE_CARLO_SAMPLING_SYMMETRIC, sizeof(__pyx_k_MONTE_CARLO_SAMPLING_SYMMETRIC), 0, 1, 0, 0},
  {&__pyx_kp_u_Matrix_elements, __pyx_k_Matrix_elements, sizeof(__pyx_k_Matrix_elements), 0, 1, 0, 0},
  {&__pyx_kp_u_Matrix_elements_2, __pyx_k_Matrix_elements_2, sizeof(__pyx_k_Matrix_elements_2), 0, 1, 0, 0},
  {&__pyx_kp_u_Minimum_distance_allowed_between, __pyx_k_Minimum_distance_allowed_between, sizeof(__pyx_k_Minimum_distance_allowed_between), 0, 1, 0, 0},
  {&__pyx_kp_u_Moving_position_by_0_1, __pyx_k_Moving_position_by_0_1, sizeof(__pyx_k_Moving_position_by_0_1), 0, 1, 0, 0},
  {&__pyx_n_s_N, __pyx_k_N, sizeof(__pyx_k_N), 0, 0, 1, 1},
  {&__pyx_kp_u_N_2, __pyx_k_N_2, sizeof(__pyx_k_N_2), 0, 1, 0, 0},
  {&__pyx_kp_u_New_position, __pyx_k_New_position, sizeof(__pyx_k_New_position), 0, 1, 0, 0},
  {&__pyx_kp_u_New_position_for_image_0_1_2, __pyx_k_New_position_for_image_0_1_2, sizeof(__pyx_k_New_position_for_image_0_1_2), 0, 1, 0, 0},
  {&__pyx_kp_u_New_position_for_image_0_is_1_2, __pyx_k_New_position_for_image_0_is_1_2, sizeof(__pyx_k_New_position_for_image_0_is_1_2), 0, 1, 0, 0},
  {&__pyx_kp_u_New_string, __pyx_k_New_string, sizeof(__pyx_k_New_string), 0, 1, 0, 0},
  {&__pyx_kp_u_Number_of_MC_steps_per_image, __pyx_k_Number_of_MC_steps_per_image, sizeof(__pyx_k_Number_of_MC_steps_per_image), 0, 1, 0, 0},
  {&__pyx_kp_u_Number_of_trajectories, __pyx_k_Number_of_trajectories, sizeof(__pyx_k_Number_of_trajectories), 0, 1, 0, 0},
  {&__pyx_kp_u_Number_of_trajs, __pyx_k_Number_of_trajs, sizeof(__pyx_k_Number_of_trajs), 0, 1, 0, 0},
  {&__pyx_kp_u_Old_position, __pyx_k_Old_position, sizeof(__pyx_k_Old_position), 0, 1, 0, 0},
  {&__pyx_kp_u_Performing_Voronoi_tesselation, __pyx_k_Performing_Voronoi_tesselation, sizeof(__pyx_k_Performing_Voronoi_tesselation), 0, 1, 0, 0},
  {&__pyx_n_s_PickleError, __pyx_k_PickleError, sizeof(__pyx_k_PickleError), 0, 0, 1, 1},
  {&__pyx_kp_u_Plus_minus_delta, __pyx_k_Plus_minus_delta, sizeof(__pyx_k_Plus_minus_delta), 0, 1, 0, 0},
  {&__pyx_kp_u_REPARAMETRIZE_THE_STRING, __pyx_k_REPARAMETRIZE_THE_STRING, sizeof(__pyx_k_REPARAMETRIZE_THE_STRING), 0, 1, 0, 0},
  {&__pyx_kp_u_Rejected_Moved_position_by_0_1_C, __pyx_k_Rejected_Moved_position_by_0_1_C, sizeof(__pyx_k_Rejected_Moved_position_by_0_1_C), 0, 1, 0, 0},
  {&__pyx_kp_u_Rejected_Moved_position_by_0_1_T, __pyx_k_Rejected_Moved_position_by_0_1_T, sizeof(__pyx_k_Rejected_Moved_position_by_0_1_T), 0, 1, 0, 0},
  {&__pyx_kp_u_Reparametrized_string, __pyx_k_Reparametrized_string, sizeof(__pyx_k_Reparametrized_string), 0, 1, 0, 0},
  {&__pyx_n_s_RuntimeError, __pyx_k_RuntimeError, sizeof(__pyx_k_RuntimeError), 0, 0, 1, 1},
  {&__pyx_kp_u_SOLVING_LINEAR_BASIS_SET_COEFFI, __pyx_k_SOLVING_LINEAR_BASIS_SET_COEFFI, sizeof(__pyx_k_SOLVING_LINEAR_BASIS_SET_COEFFI), 0, 1, 0, 0},
  {&__pyx_kp_u_SOLVING_LINEAR_BASIS_SET_COEFFIC, __pyx_k_SOLVING_LINEAR_BASIS_SET_COEFFIC, sizeof(__pyx_k_SOLVING_LINEAR_BASIS_SET_COEFFIC), 0, 1, 0, 0},
  {&__pyx_kp_u_SUMMARY, __pyx_k_SUMMARY, sizeof(__pyx_k_SUMMARY), 0, 1, 0, 0},
  {&__pyx_kp_u_Starting_Monte_Carlo_calculatio, __pyx_k_Starting_Monte_Carlo_calculatio, sizeof(__pyx_k_Starting_Monte_Carlo_calculatio), 0, 1, 0, 0},
  {&__pyx_kp_u_State_assignment_type, __pyx_k_State_assignment_type, sizeof(__pyx_k_State_assignment_type), 0, 1, 0, 0},
  {&__pyx_kp_u_Step_change_in_position, __pyx_k_Step_change_in_position, sizeof(__pyx_k_Step_change_in_position), 0, 1, 0, 0},
  {&__pyx_kp_u_Step_change_in_position_2, __pyx_k_Step_change_in_position_2, sizeof(__pyx_k_Step_change_in_position_2), 0, 1, 0, 0},
  {&__pyx_kp_u_Symmetric_D_0, __pyx_k_Symmetric_D_0, sizeof(__pyx_k_Symmetric_D_0), 0, 1, 0, 0},
  {&__pyx_kp_u_Symmetric_D_tau, __pyx_k_Symmetric_D_tau, sizeof(__pyx_k_Symmetric_D_tau), 0, 1, 0, 0},
  {&__pyx_kp_u_Symmetrization_of_D_matrices, __pyx_k_Symmetrization_of_D_matrices, sizeof(__pyx_k_Symmetrization_of_D_matrices), 0, 1, 0, 0},
  {&__pyx_n_s_T, __pyx_k_T, sizeof(__pyx_k_T), 0, 0, 1, 1},
  {&__pyx_kp_u_Target_for_accept_reject, __pyx_k_Target_for_accept_reject, sizeof(__pyx_k_Target_for_accept_reject), 0, 1, 0, 0},
  {&__pyx_kp_u_Total_length_of_string, __pyx_k_Total_length_of_string, sizeof(__pyx_k_Total_length_of_string), 0, 1, 0, 0},
  {&__pyx_kp_u_Trajectory, __pyx_k_Trajectory, sizeof(__pyx_k_Trajectory), 0, 1, 0, 0},
  {&__pyx_n_s_TypeError, __pyx_k_TypeError, sizeof(__pyx_k_TypeError), 0, 0, 1, 1},
  {&__pyx_kp_u_Using_uniform_weights, __pyx_k_Using_uniform_weights, sizeof(__pyx_k_Using_uniform_weights), 0, 1, 0, 0},
  {&__pyx_kp_u_VORONOI_STATE_ASSIGNMENT, __pyx_k_VORONOI_STATE_ASSIGNMENT, sizeof(__pyx_k_VORONOI_STATE_ASSIGNMENT), 0, 1, 0, 0},
  {&__pyx_kp_u_VORONOI_STATE_ASSIGNMENT_ENSEMBL, __pyx_k_VORONOI_STATE_ASSIGNMENT_ENSEMBL, sizeof(__pyx_k_VORONOI_STATE_ASSIGNMENT_ENSEMBL), 0, 1, 0, 0},
  {&__pyx_kp_u_Voronoi_assignment_completed, __pyx_k_Voronoi_assignment_completed, sizeof(__pyx_k_Voronoi_assignment_completed), 0, 1, 0, 0},
  {&__pyx_kp_u_Voronoi_centroid_positions, __pyx_k_Voronoi_centroid_positions, sizeof(__pyx_k_Voronoi_centroid_positions), 0, 1, 0, 0},
  {&__pyx_kp_u_WARNING_No_values_were_accepted, __pyx_k_WARNING_No_values_were_accepted, sizeof(__pyx_k_WARNING_No_values_were_accepted), 0, 1, 0, 0},
  {&__pyx_kp_u_WARNING_THIS_METHOD_IS_NOT_RECOM, __pyx_k_WARNING_THIS_METHOD_IS_NOT_RECOM, sizeof(__pyx_k_WARNING_THIS_METHOD_IS_NOT_RECOM), 0, 1, 0, 0},
  {&__pyx_kp_u_Weights_shape, __pyx_k_Weights_shape, sizeof(__pyx_k_Weights_shape), 0, 1, 0, 0},
  {&__pyx_kp_u__15, __pyx_k__15, sizeof(__pyx_k__15), 0, 1, 0, 0},
  {&__pyx_kp_u__18, __pyx_k__18, sizeof(__pyx_k__18), 0, 1, 0, 0},
  {&__pyx_kp_u__20, __pyx_k__20, sizeof(__pyx_k__20), 0, 1, 0, 0},
  {&__pyx_kp_u__23, __pyx_k__23, sizeof(__pyx_k__23), 0, 1, 0, 0},
  {&__pyx_kp_u__27, __pyx_k__27, sizeof(__pyx_k__27), 0, 1, 0, 0},
  {&__pyx_kp_u__3, __pyx_k__3, sizeof(__pyx_k__3), 0, 1, 0, 0},
  {&__pyx_kp_u__34, __pyx_k__34, sizeof(__pyx_k__34), 0, 1, 0, 0},
  {&__pyx_kp_u__35, __pyx_k__35, sizeof(__pyx_k__35), 0, 1, 0, 0},
  {&__pyx_kp_u__38, __pyx_k__38, sizeof(__pyx_k__38), 0, 1, 0, 0},
  {&__pyx_kp_u__41, __pyx_k__41, sizeof(__pyx_k__41), 0, 1, 0, 0},
  {&__pyx_kp_u__43, __pyx_k__43, sizeof(__pyx_k__43), 0, 1, 0, 0},
  {&__pyx_kp_u__48, __pyx_k__48, sizeof(__pyx_k__48), 0, 1, 0, 0},
  {&__pyx_kp_u__51, __pyx_k__51, sizeof(__pyx_k__51), 0, 1, 0, 0},
  {&__pyx_kp_u__55, __pyx_k__55, sizeof(__pyx_k__55), 0, 1, 0, 0},
  {&__pyx_kp_u__58, __pyx_k__58, sizeof(__pyx_k__58), 0, 1, 0, 0},
  {&__pyx_kp_u__6, __pyx_k__6, sizeof(__pyx_k__6), 0, 1, 0, 0},
  {&__pyx_kp_u__60, __pyx_k__60, sizeof(__pyx_k__60), 0, 1, 0, 0},
  {&__pyx_kp_u__63, __pyx_k__63, sizeof(__pyx_k__63), 0, 1, 0, 0},
  {&__pyx_kp_u__66, __pyx_k__66, sizeof(__pyx_k__66), 0, 1, 0, 0},
  {&__pyx_kp_u__69, __pyx_k__69, sizeof(__pyx_k__69), 0, 1, 0, 0},
  {&__pyx_kp_u__72, __pyx_k__72, sizeof(__pyx_k__72), 0, 1, 0, 0},
  {&__pyx_n_s_a, __pyx_k_a, sizeof(__pyx_k_a), 0, 0, 1, 1},
  {&__pyx_n_s_accelerated, __pyx_k_accelerated, sizeof(__pyx_k_accelerated), 0, 0, 1, 1},
  {&__pyx_n_s_alpha, __pyx_k_alpha, sizeof(__pyx_k_alpha), 0, 0, 1, 1},
  {&__pyx_n_s_alpha_deg_A, __pyx_k_alpha_deg_A, sizeof(__pyx_k_alpha_deg_A), 0, 0, 1, 1},
  {&__pyx_n_s_alpha_deg_B, __pyx_k_alpha_deg_B, sizeof(__pyx_k_alpha_deg_B), 0, 0, 1, 1},
  {&__pyx_n_s_append, __pyx_k_append, sizeof(__pyx_k_append), 0, 0, 1, 1},
  {&__pyx_n_s_arange, __pyx_k_arange, sizeof(__pyx_k_arange), 0, 0, 1, 1},
  {&__pyx_n_s_argmin, __pyx_k_argmin, sizeof(__pyx_k_argmin), 0, 0, 1, 1},
  {&__pyx_n_s_asarray, __pyx_k_asarray, sizeof(__pyx_k_asarray), 0, 0, 1, 1},
  {&__pyx_n_s_assign_states, __pyx_k_assign_states, sizeof(__pyx_k_assign_states), 0, 0, 1, 1},
  {&__pyx_n_s_assign_states_ensemble, __pyx_k_assign_states_ensemble, sizeof(__pyx_k_assign_states_ensemble), 0, 0, 1, 1},
  {&__pyx_n_s_average, __pyx_k_average, sizeof(__pyx_k_average), 0, 0, 1, 1},
  {&__pyx_n_s_axis, __pyx_k_axis, sizeof(__pyx_k_axis), 0, 0, 1, 1},
  {&__pyx_kp_u_b, __pyx_k_b, sizeof(__pyx_k_b), 0, 1, 0, 0},
  {&__pyx_n_s_b_2, __pyx_k_b_2, sizeof(__pyx_k_b_2), 0, 0, 1, 1},
  {&__pyx_n_u_b_2, __pyx_k_b_2, sizeof(__pyx_k_b_2), 0, 1, 0, 1},
  {&__pyx_kp_u_b_from_ensemble_time_average, __pyx_k_b_from_ensemble_time_average, sizeof(__pyx_k_b_from_ensemble_time_average), 0, 1, 0, 0},
  {&__pyx_n_s_c, __pyx_k_c, sizeof(__pyx_k_c), 0, 0, 1, 1},
  {&__pyx_n_s_calc_coeffs, __pyx_k_calc_coeffs, sizeof(__pyx_k_calc_coeffs), 0, 0, 1, 1},
  {&__pyx_n_s_calc_coeffs_accelerated, __pyx_k_calc_coeffs_accelerated, sizeof(__pyx_k_calc_coeffs_accelerated), 0, 0, 1, 1},
  {&__pyx_n_s_calc_coeffs_ensemble, __pyx_k_calc_coeffs_ensemble, sizeof(__pyx_k_calc_coeffs_ensemble), 0, 0, 1, 1},
  {&__pyx_n_s_calc_coeffs_ensemble_timeavg, __pyx_k_calc_coeffs_ensemble_timeavg, sizeof(__pyx_k_calc_coeffs_ensemble_timeavg), 0, 0, 1, 1},
  {&__pyx_n_s_calc_coeffs_ensemble_timeavg_fas, __pyx_k_calc_coeffs_ensemble_timeavg_fas, sizeof(__pyx_k_calc_coeffs_ensemble_timeavg_fas), 0, 0, 1, 1},
  {&__pyx_n_s_calc_coeffs_ensemble_timeavg_fas_2, __pyx_k_calc_coeffs_ensemble_timeavg_fas_2, sizeof(__pyx_k_calc_coeffs_ensemble_timeavg_fas_2), 0, 0, 1, 1},
  {&__pyx_n_s_calc_corr, __pyx_k_calc_corr, sizeof(__pyx_k_calc_corr), 0, 0, 1, 1},
  {&__pyx_n_s_calc_corr_q2, __pyx_k_calc_corr_q2, sizeof(__pyx_k_calc_corr_q2), 0, 0, 1, 1},
  {&__pyx_n_s_calc_corr_q2_ensemble, __pyx_k_calc_corr_q2_ensemble, sizeof(__pyx_k_calc_corr_q2_ensemble), 0, 0, 1, 1},
  {&__pyx_n_s_calc_corr_q2_ensemble_timeavg, __pyx_k_calc_corr_q2_ensemble_timeavg, sizeof(__pyx_k_calc_corr_q2_ensemble_timeavg), 0, 0, 1, 1},
  {&__pyx_n_s_calc_corr_q2_ensemble_timeavg_fa, __pyx_k_calc_corr_q2_ensemble_timeavg_fa, sizeof(__pyx_k_calc_corr_q2_ensemble_timeavg_fa), 0, 0, 1, 1},
  {&__pyx_n_s_centroids, __pyx_k_centroids, sizeof(__pyx_k_centroids), 0, 0, 1, 1},
  {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
  {&__pyx_n_s_copy, __pyx_k_copy, sizeof(__pyx_k_copy), 0, 0, 1, 1},
  {&__pyx_n_s_corr_method, __pyx_k_corr_method, sizeof(__pyx_k_corr_method), 0, 0, 1, 1},
  {&__pyx_n_s_cos, __pyx_k_cos, sizeof(__pyx_k_cos), 0, 0, 1, 1},
  {&__pyx_kp_u_count, __pyx_k_count, sizeof(__pyx_k_count), 0, 1, 0, 0},
  {&__pyx_n_s_cut, __pyx_k_cut, sizeof(__pyx_k_cut), 0, 0, 1, 1},
  {&__pyx_n_s_cut_A, __pyx_k_cut_A, sizeof(__pyx_k_cut_A), 0, 0, 1, 1},
  {&__pyx_n_s_cut_B, __pyx_k_cut_B, sizeof(__pyx_k_cut_B), 0, 0, 1, 1},
  {&__pyx_n_s_deepcopy, __pyx_k_deepcopy, sizeof(__pyx_k_deepcopy), 0, 0, 1, 1},
  {&__pyx_n_s_delete, __pyx_k_delete, sizeof(__pyx_k_delete), 0, 0, 1, 1},
  {&__pyx_n_s_delta, __pyx_k_delta, sizeof(__pyx_k_delta), 0, 0, 1, 1},
  {&__pyx_n_s_dict, __pyx_k_dict, sizeof(__pyx_k_dict), 0, 0, 1, 1},
  {&__pyx_n_s_dim, __pyx_k_dim, sizeof(__pyx_k_dim), 0, 0, 1, 1},
  {&__pyx_n_s_dot, __pyx_k_dot, sizeof(__pyx_k_dot), 0, 0, 1, 1},
  {&__pyx_n_s_ell, __pyx_k_ell, sizeof(__pyx_k_ell), 0, 0, 1, 1},
  {&__pyx_n_s_ell_x, __pyx_k_ell_x, sizeof(__pyx_k_ell_x), 0, 0, 1, 1},
  {&__pyx_n_s_ell_y, __pyx_k_ell_y, sizeof(__pyx_k_ell_y), 0, 0, 1, 1},
  {&__pyx_n_u_ellipse, __pyx_k_ellipse, sizeof(__pyx_k_ellipse), 0, 1, 0, 1},
  {&__pyx_n_s_elliptical, __pyx_k_elliptical, sizeof(__pyx_k_elliptical), 0, 0, 1, 1},
  {&__pyx_n_s_ensemble_avg, __pyx_k_ensemble_avg, sizeof(__pyx_k_ensemble_avg), 0, 0, 1, 1},
  {&__pyx_n_s_ensemble_timeavg_v1, __pyx_k_ensemble_timeavg_v1, sizeof(__pyx_k_ensemble_timeavg_v1), 0, 0, 1, 1},
  {&__pyx_n_s_ensemble_timeavg_v2, __pyx_k_ensemble_timeavg_v2, sizeof(__pyx_k_ensemble_timeavg_v2), 0, 0, 1, 1},
  {&__pyx_n_s_epsilon, __pyx_k_epsilon, sizeof(__pyx_k_epsilon), 0, 0, 1, 1},
  {&__pyx_n_s_exp, __pyx_k_exp, sizeof(__pyx_k_exp), 0, 0, 1, 1},
  {&__pyx_n_s_finite_diff_committor, __pyx_k_finite_diff_committor, sizeof(__pyx_k_finite_diff_committor), 0, 0, 1, 1},
  {&__pyx_n_s_finite_diff_corr, __pyx_k_finite_diff_corr, sizeof(__pyx_k_finite_diff_corr), 0, 0, 1, 1},
  {&__pyx_n_s_first, __pyx_k_first, sizeof(__pyx_k_first), 0, 0, 1, 1},
  {&__pyx_n_s_float64, __pyx_k_float64, sizeof(__pyx_k_float64), 0, 0, 1, 1},
  {&__pyx_n_s_flush, __pyx_k_flush, sizeof(__pyx_k_flush), 0, 0, 1, 1},
  {&__pyx_n_s_format, __pyx_k_format, sizeof(__pyx_k_format), 0, 0, 1, 1},
  {&__pyx_kp_u_g_0, __pyx_k_g_0, sizeof(__pyx_k_g_0), 0, 1, 0, 0},
  {&__pyx_n_s_g_0_2, __pyx_k_g_0_2, sizeof(__pyx_k_g_0_2), 0, 0, 1, 1},
  {&__pyx_n_u_g_0_2, __pyx_k_g_0_2, sizeof(__pyx_k_g_0_2), 0, 1, 0, 1},
  {&__pyx_kp_u_g_tau, __pyx_k_g_tau, sizeof(__pyx_k_g_tau), 0, 1, 0, 0},
  {&__pyx_n_s_g_tau_2, __pyx_k_g_tau_2, sizeof(__pyx_k_g_tau_2), 0, 0, 1, 1},
  {&__pyx_n_u_g_tau_2, __pyx_k_g_tau_2, sizeof(__pyx_k_g_tau_2), 0, 1, 0, 1},
  {&__pyx_n_s_getstate, __pyx_k_getstate, sizeof(__pyx_k_getstate), 0, 0, 1, 1},
  {&__pyx_kp_u_gradC, __pyx_k_gradC, sizeof(__pyx_k_gradC), 0, 1, 0, 0},
  {&__pyx_n_s_gradC_2, __pyx_k_gradC_2, sizeof(__pyx_k_gradC_2), 0, 0, 1, 1},
  {&__pyx_n_u_gradC_2, __pyx_k_gradC_2, sizeof(__pyx_k_gradC_2), 0, 1, 0, 1},
  {&__pyx_n_s_hx_man, __pyx_k_hx_man, sizeof(__pyx_k_hx_man), 0, 0, 1, 1},
  {&__pyx_n_s_hy_man, __pyx_k_hy_man, sizeof(__pyx_k_hy_man), 0, 0, 1, 1},
  {&__pyx_n_s_i, __pyx_k_i, sizeof(__pyx_k_i), 0, 0, 1, 1},
  {&__pyx_n_s_ids, __pyx_k_ids, sizeof(__pyx_k_ids), 0, 0, 1, 1},
  {&__pyx_n_s_image, __pyx_k_image, sizeof(__pyx_k_image), 0, 0, 1, 1},
  {&__pyx_kp_u_image_dim, __pyx_k_image_dim, sizeof(__pyx_k_image_dim), 0, 1, 0, 0},
  {&__pyx_n_s_images, __pyx_k_images, sizeof(__pyx_k_images), 0, 0, 1, 1},
  {&__pyx_n_s_import, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
  {&__pyx_n_s_intermediate_region, __pyx_k_intermediate_region, sizeof(__pyx_k_intermediate_region), 0, 0, 1, 1},
  {&__pyx_n_s_inv, __pyx_k_inv, sizeof(__pyx_k_inv), 0, 0, 1, 1},
  {&__pyx_kp_u_lag_time, __pyx_k_lag_time, sizeof(__pyx_k_lag_time), 0, 1, 0, 0},
  {&__pyx_kp_u_lag_time_2, __pyx_k_lag_time_2, sizeof(__pyx_k_lag_time_2), 0, 1, 0, 0},
  {&__pyx_n_s_lags, __pyx_k_lags, sizeof(__pyx_k_lags), 0, 0, 1, 1},
  {&__pyx_n_s_last, __pyx_k_last, sizeof(__pyx_k_last), 0, 0, 1, 1},
  {&__pyx_n_s_last_frames, __pyx_k_last_frames, sizeof(__pyx_k_last_frames), 0, 0, 1, 1},
  {&__pyx_n_s_linalg, __pyx_k_linalg, sizeof(__pyx_k_linalg), 0, 0, 1, 1},
  {&__pyx_n_s_linspace, __pyx_k_linspace, sizeof(__pyx_k_linspace), 0, 0, 1, 1},
  {&__pyx_n_s_load, __pyx_k_load, sizeof(__pyx_k_load), 0, 0, 1, 1},
  {&__pyx_n_s_log, __pyx_k_log, sizeof(__pyx_k_log), 0, 0, 1, 1},
  {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
  {&__pyx_n_s_manual, __pyx_k_manual, sizeof(__pyx_k_manual), 0, 0, 1, 1},
  {&__pyx_n_s_math, __pyx_k_math, sizeof(__pyx_k_math), 0, 0, 1, 1},
  {&__pyx_n_u_matrix_elements, __pyx_k_matrix_elements, sizeof(__pyx_k_matrix_elements), 0, 1, 0, 1},
  {&__pyx_n_s_mean, __pyx_k_mean, sizeof(__pyx_k_mean), 0, 0, 1, 1},
  {&__pyx_n_s_mindist, __pyx_k_mindist, sizeof(__pyx_k_mindist), 0, 0, 1, 1},
  {&__pyx_n_s_mindist_constraint, __pyx_k_mindist_constraint, sizeof(__pyx_k_mindist_constraint), 0, 0, 1, 1},
  {&__pyx_n_s_montecarlo, __pyx_k_montecarlo, sizeof(__pyx_k_montecarlo), 0, 0, 1, 1},
  {&__pyx_n_s_montecarlo_symmetric, __pyx_k_montecarlo_symmetric, sizeof(__pyx_k_montecarlo_symmetric), 0, 0, 1, 1},
  {&__pyx_n_s_n, __pyx_k_n, sizeof(__pyx_k_n), 0, 0, 1, 1},
  {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
  {&__pyx_n_s_new, __pyx_k_new, sizeof(__pyx_k_new), 0, 0, 1, 1},
  {&__pyx_n_s_np, __pyx_k_np, sizeof(__pyx_k_np), 0, 0, 1, 1},
  {&__pyx_n_s_num_basis, __pyx_k_num_basis, sizeof(__pyx_k_num_basis), 0, 0, 1, 1},
  {&__pyx_n_s_numpy, __pyx_k_numpy, sizeof(__pyx_k_numpy), 0, 0, 1, 1},
  {&__pyx_kp_u_numpy_core_multiarray_failed_to, __pyx_k_numpy_core_multiarray_failed_to, sizeof(__pyx_k_numpy_core_multiarray_failed_to), 0, 1, 0, 0},
  {&__pyx_kp_u_numpy_core_umath_failed_to_impor, __pyx_k_numpy_core_umath_failed_to_impor, sizeof(__pyx_k_numpy_core_umath_failed_to_impor), 0, 1, 0, 0},
  {&__pyx_kp_u_orthogonal_proj_t_nc_tauection, __pyx_k_orthogonal_proj_t_nc_tauection, sizeof(__pyx_k_orthogonal_proj_t_nc_tauection), 0, 1, 0, 0},
  {&__pyx_n_u_orthogonal_projection, __pyx_k_orthogonal_projection, sizeof(__pyx_k_orthogonal_projection), 0, 1, 0, 1},
  {&__pyx_kp_u_out_of_index, __pyx_k_out_of_index, sizeof(__pyx_k_out_of_index), 0, 1, 0, 0},
  {&__pyx_kp_u_output_C_new_txt, __pyx_k_output_C_new_txt, sizeof(__pyx_k_output_C_new_txt), 0, 1, 0, 0},
  {&__pyx_kp_u_output_coeffs_input_npz, __pyx_k_output_coeffs_input_npz, sizeof(__pyx_k_output_coeffs_input_npz), 0, 1, 0, 0},
  {&__pyx_kp_u_output_coeffs_new_npz, __pyx_k_output_coeffs_new_npz, sizeof(__pyx_k_output_coeffs_new_npz), 0, 1, 0, 0},
  {&__pyx_kp_u_output_gradC_npz, __pyx_k_output_gradC_npz, sizeof(__pyx_k_output_gradC_npz), 0, 1, 0, 0},
  {&__pyx_kp_u_output_mc_txt, __pyx_k_output_mc_txt, sizeof(__pyx_k_output_mc_txt), 0, 1, 0, 0},
  {&__pyx_kp_u_output_q_new_txt, __pyx_k_output_q_new_txt, sizeof(__pyx_k_output_q_new_txt), 0, 1, 0, 0},
  {&__pyx_kp_u_output_z_new_txt, __pyx_k_output_z_new_txt, sizeof(__pyx_k_output_z_new_txt), 0, 1, 0, 0},
  {&__pyx_n_s_pi, __pyx_k_pi, sizeof(__pyx_k_pi), 0, 0, 1, 1},
  {&__pyx_n_s_pickle, __pyx_k_pickle, sizeof(__pyx_k_pickle), 0, 0, 1, 1},
  {&__pyx_n_s_print, __pyx_k_print, sizeof(__pyx_k_print), 0, 0, 1, 1},
  {&__pyx_n_s_pyx_PickleError, __pyx_k_pyx_PickleError, sizeof(__pyx_k_pyx_PickleError), 0, 0, 1, 1},
  {&__pyx_n_s_pyx_checksum, __pyx_k_pyx_checksum, sizeof(__pyx_k_pyx_checksum), 0, 0, 1, 1},
  {&__pyx_n_s_pyx_result, __pyx_k_pyx_result, sizeof(__pyx_k_pyx_result), 0, 0, 1, 1},
  {&__pyx_n_s_pyx_state, __pyx_k_pyx_state, sizeof(__pyx_k_pyx_state), 0, 0, 1, 1},
  {&__pyx_n_s_pyx_type, __pyx_k_pyx_type, sizeof(__pyx_k_pyx_type), 0, 0, 1, 1},
  {&__pyx_n_s_pyx_unpickle_vcstring, __pyx_k_pyx_unpickle_vcstring, sizeof(__pyx_k_pyx_unpickle_vcstring), 0, 0, 1, 1},
  {&__pyx_n_s_pyx_vtable, __pyx_k_pyx_vtable, sizeof(__pyx_k_pyx_vtable), 0, 0, 1, 1},
  {&__pyx_n_s_q, __pyx_k_q, sizeof(__pyx_k_q), 0, 0, 1, 1},
  {&__pyx_n_u_q2, __pyx_k_q2, sizeof(__pyx_k_q2), 0, 1, 0, 1},
  {&__pyx_n_s_q_avg, __pyx_k_q_avg, sizeof(__pyx_k_q_avg), 0, 0, 1, 1},
  {&__pyx_n_s_q_list, __pyx_k_q_list, sizeof(__pyx_k_q_list), 0, 0, 1, 1},
  {&__pyx_n_s_ra, __pyx_k_ra, sizeof(__pyx_k_ra), 0, 0, 1, 1},
  {&__pyx_n_s_ra_A, __pyx_k_ra_A, sizeof(__pyx_k_ra_A), 0, 0, 1, 1},
  {&__pyx_n_s_ra_B, __pyx_k_ra_B, sizeof(__pyx_k_ra_B), 0, 0, 1, 1},
  {&__pyx_n_s_random, __pyx_k_random, sizeof(__pyx_k_random), 0, 0, 1, 1},
  {&__pyx_n_s_range, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
  {&__pyx_n_s_rb, __pyx_k_rb, sizeof(__pyx_k_rb), 0, 0, 1, 1},
  {&__pyx_n_s_rb_A, __pyx_k_rb_A, sizeof(__pyx_k_rb_A), 0, 0, 1, 1},
  {&__pyx_n_s_rb_B, __pyx_k_rb_B, sizeof(__pyx_k_rb_B), 0, 0, 1, 1},
  {&__pyx_n_s_reduce, __pyx_k_reduce, sizeof(__pyx_k_reduce), 0, 0, 1, 1},
  {&__pyx_n_s_reduce_cython, __pyx_k_reduce_cython, sizeof(__pyx_k_reduce_cython), 0, 0, 1, 1},
  {&__pyx_n_s_reduce_ex, __pyx_k_reduce_ex, sizeof(__pyx_k_reduce_ex), 0, 0, 1, 1},
  {&__pyx_n_s_reparm, __pyx_k_reparm, sizeof(__pyx_k_reparm), 0, 0, 1, 1},
  {&__pyx_n_s_reshape, __pyx_k_reshape, sizeof(__pyx_k_reshape), 0, 0, 1, 1},
  {&__pyx_n_s_round, __pyx_k_round, sizeof(__pyx_k_round), 0, 0, 1, 1},
  {&__pyx_n_s_save, __pyx_k_save, sizeof(__pyx_k_save), 0, 0, 1, 1},
  {&__pyx_n_s_savetxt, __pyx_k_savetxt, sizeof(__pyx_k_savetxt), 0, 0, 1, 1},
  {&__pyx_n_s_savez, __pyx_k_savez, sizeof(__pyx_k_savez), 0, 0, 1, 1},
  {&__pyx_n_s_setstate, __pyx_k_setstate, sizeof(__pyx_k_setstate), 0, 0, 1, 1},
  {&__pyx_n_s_setstate_cython, __pyx_k_setstate_cython, sizeof(__pyx_k_setstate_cython), 0, 0, 1, 1},
  {&__pyx_n_s_shape, __pyx_k_shape, sizeof(__pyx_k_shape), 0, 0, 1, 1},
  {&__pyx_n_s_sin, __pyx_k_sin, sizeof(__pyx_k_sin), 0, 0, 1, 1},
  {&__pyx_n_s_smoothing, __pyx_k_smoothing, sizeof(__pyx_k_smoothing), 0, 0, 1, 1},
  {&__pyx_n_s_sqrt, __pyx_k_sqrt, sizeof(__pyx_k_sqrt), 0, 0, 1, 1},
  {&__pyx_n_s_square, __pyx_k_square, sizeof(__pyx_k_square), 0, 0, 1, 1},
  {&__pyx_n_s_start, __pyx_k_start, sizeof(__pyx_k_start), 0, 0, 1, 1},
  {&__pyx_n_s_state_assignment, __pyx_k_state_assignment, sizeof(__pyx_k_state_assignment), 0, 0, 1, 1},
  {&__pyx_n_s_stdout, __pyx_k_stdout, sizeof(__pyx_k_stdout), 0, 0, 1, 1},
  {&__pyx_n_s_stride, __pyx_k_stride, sizeof(__pyx_k_stride), 0, 0, 1, 1},
  {&__pyx_kp_s_stringsource, __pyx_k_stringsource, sizeof(__pyx_k_stringsource), 0, 0, 1, 0},
  {&__pyx_n_s_sum, __pyx_k_sum, sizeof(__pyx_k_sum), 0, 0, 1, 1},
  {&__pyx_n_s_symmetric, __pyx_k_symmetric, sizeof(__pyx_k_symmetric), 0, 0, 1, 1},
  {&__pyx_n_s_sys, __pyx_k_sys, sizeof(__pyx_k_sys), 0, 0, 1, 1},
  {&__pyx_n_s_t0, __pyx_k_t0, sizeof(__pyx_k_t0), 0, 0, 1, 1},
  {&__pyx_kp_u_t0_2, __pyx_k_t0_2, sizeof(__pyx_k_t0_2), 0, 1, 0, 0},
  {&__pyx_kp_u_t0_3, __pyx_k_t0_3, sizeof(__pyx_k_t0_3), 0, 1, 0, 0},
  {&__pyx_n_s_t_final, __pyx_k_t_final, sizeof(__pyx_k_t_final), 0, 0, 1, 1},
  {&__pyx_n_s_tan, __pyx_k_tan, sizeof(__pyx_k_tan), 0, 0, 1, 1},
  {&__pyx_n_s_target, __pyx_k_target, sizeof(__pyx_k_target), 0, 0, 1, 1},
  {&__pyx_n_s_tau, __pyx_k_tau, sizeof(__pyx_k_tau), 0, 0, 1, 1},
  {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
  {&__pyx_n_s_theta_deg, __pyx_k_theta_deg, sizeof(__pyx_k_theta_deg), 0, 0, 1, 1},
  {&__pyx_kp_u_theta_deg_2, __pyx_k_theta_deg_2, sizeof(__pyx_k_theta_deg_2), 0, 1, 0, 0},
  {&__pyx_kp_u_theta_rad, __pyx_k_theta_rad, sizeof(__pyx_k_theta_rad), 0, 1, 0, 0},
  {&__pyx_n_s_traj, __pyx_k_traj, sizeof(__pyx_k_traj), 0, 0, 1, 1},
  {&__pyx_kp_u_traj_shape, __pyx_k_traj_shape, sizeof(__pyx_k_traj_shape), 0, 1, 0, 0},
  {&__pyx_n_s_uniform, __pyx_k_uniform, sizeof(__pyx_k_uniform), 0, 0, 1, 1},
  {&__pyx_n_s_update, __pyx_k_update, sizeof(__pyx_k_update), 0, 0, 1, 1},
  {&__pyx_n_s_vcstring, __pyx_k_vcstring, sizeof(__pyx_k_vcstring), 0, 0, 1, 1},
  {&__pyx_kp_s_vcstring_pyx, __pyx_k_vcstring_pyx, sizeof(__pyx_k_vcstring_pyx), 0, 0, 1, 0},
  {&__pyx_n_s_weights, __pyx_k_weights, sizeof(__pyx_k_weights), 0, 0, 1, 1},
  {&__pyx_n_s_where, __pyx_k_where, sizeof(__pyx_k_where), 0, 0, 1, 1},
  {&__pyx_n_s_x0, __pyx_k_x0, sizeof(__pyx_k_x0), 0, 0, 1, 1},
  {&__pyx_n_s_x0_A, __pyx_k_x0_A, sizeof(__pyx_k_x0_A), 0, 0, 1, 1},
  {&__pyx_n_s_x0_B, __pyx_k_x0_B, sizeof(__pyx_k_x0_B), 0, 0, 1, 1},
  {&__pyx_n_s_xp, __pyx_k_xp, sizeof(__pyx_k_xp), 0, 0, 1, 1},
  {&__pyx_n_s_y0, __pyx_k_y0, sizeof(__pyx_k_y0), 0, 0, 1, 1},
  {&__pyx_n_s_y0_A, __pyx_k_y0_A, sizeof(__pyx_k_y0_A), 0, 0, 1, 1},
  {&__pyx_n_s_y0_B, __pyx_k_y0_B, sizeof(__pyx_k_y0_B), 0, 0, 1, 1},
  {&__pyx_n_s_yp, __pyx_k_yp, sizeof(__pyx_k_yp), 0, 0, 1, 1},
  {&__pyx_n_s_z, __pyx_k_z, sizeof(__pyx_k_z), 0, 0, 1, 1},
  {&__pyx_n_s_zeros, __pyx_k_zeros, sizeof(__pyx_k_zeros), 0, 0, 1, 1},
  {0, 0, 0, 0, 0, 0, 0}
};
static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
  __pyx_builtin_print = __Pyx_GetBuiltinName(__pyx_n_s_print); if (!__pyx_builtin_print) __PYX_ERR(0, 81, __pyx_L1_error)
  __pyx_builtin_RuntimeError = __Pyx_GetBuiltinName(__pyx_n_s_RuntimeError); if (!__pyx_builtin_RuntimeError) __PYX_ERR(0, 98, __pyx_L1_error)
  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 105, __pyx_L1_error)
  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(0, 155, __pyx_L1_error)
  __pyx_builtin_sum = __Pyx_GetBuiltinName(__pyx_n_s_sum); if (!__pyx_builtin_sum) __PYX_ERR(0, 1736, __pyx_L1_error)
  __pyx_builtin_round = __Pyx_GetBuiltinName(__pyx_n_s_round); if (!__pyx_builtin_round) __PYX_ERR(0, 1776, __pyx_L1_error)
  __pyx_builtin_ImportError = __Pyx_GetBuiltinName(__pyx_n_s_ImportError); if (!__pyx_builtin_ImportError) __PYX_ERR(2, 947, __pyx_L1_error)
  return 0;
  __pyx_L1_error:;
  return -1;
}

static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);

  /* "vcstring.pyx":59
 *         xa, xb = self.intermediate_region()
 *         xcenters = np.linspace(xa, xb, self.num_basis+1)
 *         xcenters = (xcenters[:-1] + xcenters[1:]) / 2             # <<<<<<<<<<<<<<
 *         ycenters = tan(self.theta) * xcenters
 *         z = np.c_[xcenters, ycenters]
 */
  __pyx_slice_ = PySlice_New(Py_None, __pyx_int_neg_1, Py_None); if (unlikely(!__pyx_slice_)) __PYX_ERR(0, 59, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_slice_);
  __Pyx_GIVEREF(__pyx_slice_);
  __pyx_slice__2 = PySlice_New(__pyx_int_1, Py_None, Py_None); if (unlikely(!__pyx_slice__2)) __PYX_ERR(0, 59, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_slice__2);
  __Pyx_GIVEREF(__pyx_slice__2);

  /* "vcstring.pyx":81
 *         cdef np.ndarray[DTYPE_t, ndim=1] g_0_arr, g_tau_arr, g, b
 * 
 *         print('\n=========================')             # <<<<<<<<<<<<<<
 *         print('VORONOI STATE ASSIGNMENT')
 *         print('=========================')
 */
  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_u__3); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 81, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__4);
  __Pyx_GIVEREF(__pyx_tuple__4);

  /* "vcstring.pyx":82
 * 
 *         print('\n=========================')
 *         print('VORONOI STATE ASSIGNMENT')             # <<<<<<<<<<<<<<
 *         print('=========================')
 *         print('State_assignment type:', self.state_assignment)
 */
  __pyx_tuple__5 = PyTuple_Pack(1, __pyx_kp_u_VORONOI_STATE_ASSIGNMENT); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(0, 82, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__5);
  __Pyx_GIVEREF(__pyx_tuple__5);

  /* "vcstring.pyx":83
 *         print('\n=========================')
 *         print('VORONOI STATE ASSIGNMENT')
 *         print('=========================')             # <<<<<<<<<<<<<<
 *         print('State_assignment type:', self.state_assignment)
 *         if self.state_assignment == 'orthogonal_projection':
 */
  __pyx_tuple__7 = PyTuple_Pack(1, __pyx_kp_u__6); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(0, 83, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__7);
  __Pyx_GIVEREF(__pyx_tuple__7);

  /* "vcstring.pyx":90
 *         N = len(traj)       # Length of trajectory
 *         x = [row[1] for row in traj]
 *         xcenters = z[:, 0]             # <<<<<<<<<<<<<<
 *         if self.state_assignment != '1d':
 *             ycenters = z[:, 1]  # y coordinates of centroids
 */
  __pyx_slice__8 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_slice__8)) __PYX_ERR(0, 90, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_slice__8);
  __Pyx_GIVEREF(__pyx_slice__8);
  __pyx_tuple__9 = PyTuple_Pack(2, __pyx_slice__8, __pyx_int_0); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 90, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__9);
  __Pyx_GIVEREF(__pyx_tuple__9);

  /* "vcstring.pyx":92
 *         xcenters = z[:, 0]
 *         if self.state_assignment != '1d':
 *             ycenters = z[:, 1]  # y coordinates of centroids             # <<<<<<<<<<<<<<
 *             y = [row[2] for row in traj]
 *         print('Voronoi centroid positions:\n', z)
 */
  __pyx_tuple__10 = PyTuple_Pack(2, __pyx_slice__8, __pyx_int_1); if (unlikely(!__pyx_tuple__10)) __PYX_ERR(0, 92, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__10);
  __Pyx_GIVEREF(__pyx_tuple__10);

  /* "vcstring.pyx":98
 *         # Check that lag time is smaller than data set size
 *         if tau > N:
 *             raise RuntimeError ("\nInvalid lag time. Use a smaller lag time.")             # <<<<<<<<<<<<<<
 *             exit()
 * 
 */
  __pyx_tuple__11 = PyTuple_Pack(1, __pyx_kp_u_Invalid_lag_time_Use_a_smaller); if (unlikely(!__pyx_tuple__11)) __PYX_ERR(0, 98, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__11);
  __Pyx_GIVEREF(__pyx_tuple__11);

  /* "vcstring.pyx":103
 *         # Assign to Voronoi cell
 *         ids = []
 *         print('Performing Voronoi tesselation')             # <<<<<<<<<<<<<<
 *         sys.stdout.flush()
 *         for t in range(N):
 */
  __pyx_tuple__12 = PyTuple_Pack(1, __pyx_kp_u_Performing_Voronoi_tesselation); if (unlikely(!__pyx_tuple__12)) __PYX_ERR(0, 103, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__12);
  __Pyx_GIVEREF(__pyx_tuple__12);

  /* "vcstring.pyx":155
 *                 ids.append([h_I, h_B, nc, x_t, y_t, ell_tA, ell_tB]) # state I, state B, Voronoi index, x pos, y pos
 *             else:
 *                 raise TypeError('Incorrect state assignment. Chosen state_assignment method is not available.')             # <<<<<<<<<<<<<<
 *         ids = np.asarray(ids)
 *         print('Voronoi assignment completed')
 */
  __pyx_tuple__13 = PyTuple_Pack(1, __pyx_kp_u_Incorrect_state_assignment_Chose); if (unlikely(!__pyx_tuple__13)) __PYX_ERR(0, 155, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__13);
  __Pyx_GIVEREF(__pyx_tuple__13);

  /* "vcstring.pyx":157
 *                 raise TypeError('Incorrect state assignment. Chosen state_assignment method is not available.')
 *         ids = np.asarray(ids)
 *         print('Voronoi assignment completed')             # <<<<<<<<<<<<<<
 *         return ids
 * 
 */
  __pyx_tuple__14 = PyTuple_Pack(1, __pyx_kp_u_Voronoi_assignment_completed); if (unlikely(!__pyx_tuple__14)) __PYX_ERR(0, 157, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__14);
  __Pyx_GIVEREF(__pyx_tuple__14);

  /* "vcstring.pyx":178
 *         cdef np.ndarray[DTYPE_t, ndim=1] g_0_arr, g_tau_arr, g, b
 * 
 *         print('\n===================================')             # <<<<<<<<<<<<<<
 *         print('VORONOI STATE ASSIGNMENT - ENSEMBLE')
 *         print('===================================')
 */
  __pyx_tuple__16 = PyTuple_Pack(1, __pyx_kp_u__15); if (unlikely(!__pyx_tuple__16)) __PYX_ERR(0, 178, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__16);
  __Pyx_GIVEREF(__pyx_tuple__16);

  /* "vcstring.pyx":179
 * 
 *         print('\n===================================')
 *         print('VORONOI STATE ASSIGNMENT - ENSEMBLE')             # <<<<<<<<<<<<<<
 *         print('===================================')
 *         print('Voronoi centroid positions:\n', z)
 */
  __pyx_tuple__17 = PyTuple_Pack(1, __pyx_kp_u_VORONOI_STATE_ASSIGNMENT_ENSEMBL); if (unlikely(!__pyx_tuple__17)) __PYX_ERR(0, 179, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__17);
  __Pyx_GIVEREF(__pyx_tuple__17);

  /* "vcstring.pyx":180
 *         print('\n===================================')
 *         print('VORONOI STATE ASSIGNMENT - ENSEMBLE')
 *         print('===================================')             # <<<<<<<<<<<<<<
 *         print('Voronoi centroid positions:\n', z)
 *         print('State_assignment type:', self.state_assignment)
 */
  __pyx_tuple__19 = PyTuple_Pack(1, __pyx_kp_u__18); if (unlikely(!__pyx_tuple__19)) __PYX_ERR(0, 180, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__19);
  __Pyx_GIVEREF(__pyx_tuple__19);

  /* "vcstring.pyx":314
 *         cdef np.ndarray[DTYPE_t, ndim=1] g_0_arr, g_tau_arr, g, b
 * 
 *         print('\n======================================')             # <<<<<<<<<<<<<<
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')
 *         print('======================================')
 */
  __pyx_tuple__21 = PyTuple_Pack(1, __pyx_kp_u__20); if (unlikely(!__pyx_tuple__21)) __PYX_ERR(0, 314, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__21);
  __Pyx_GIVEREF(__pyx_tuple__21);

  /* "vcstring.pyx":315
 * 
 *         print('\n======================================')
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')             # <<<<<<<<<<<<<<
 *         print('======================================')
 *         print('lag time =', tau)
 */
  __pyx_tuple__22 = PyTuple_Pack(1, __pyx_kp_u_SOLVING_LINEAR_BASIS_SET_COEFFIC); if (unlikely(!__pyx_tuple__22)) __PYX_ERR(0, 315, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__22);
  __Pyx_GIVEREF(__pyx_tuple__22);

  /* "vcstring.pyx":316
 *         print('\n======================================')
 *         print('SOLVING LINEAR BASIS SET COEFFICIENTS')
 *         print('======================================')             # <<<<<<<<<<<<<<
 *         print('lag time =', tau)
 *         print('Symmetrization of D matrices:', symmetric)
 */
  __pyx_tuple__24 = PyTuple_Pack(1, __pyx_kp_u__23); if (unlikely(!__pyx_tuple__24)) __PYX_ERR(0, 316, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__24);
  __Pyx_GIVEREF(__pyx_tuple__24);

  /* "vcstring.pyx":319
 *         print('lag time =', tau)
 *         print('Symmetrization of D matrices:', symmetric)
 *         centroid = ids[:, 2]  # Indices for Voronoi centroid assignment             # <<<<<<<<<<<<<<
 *         D_0 = []
 *         D_tau = []
 */
  __pyx_tuple__25 = PyTuple_Pack(2, __pyx_slice__8, __pyx_int_2); if (unlikely(!__pyx_tuple__25)) __PYX_ERR(0, 319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__25);
  __Pyx_GIVEREF(__pyx_tuple__25);

  /* "vcstring.pyx":421
 *         cdef np.ndarray[DTYPE_t, ndim=1] g_0_arr, g_tau_arr, g, b
 * 
 *         print('\nSOLVING LINEAR BASIS SET COEFFICIENTS, ACCELERATED METHOD')             # <<<<<<<<<<<<<<
 *         print('-----------------------------------------------------------')
 *         print("WARNING: THIS METHOD IS NOT RECOMMENDED FOR MOST CASES BECAUSE MOVING THE IMAGES MORE THAN A CERTAIN AMOUNT CAN AFFECT THE VORONOI TESSELATION IN FARTHER OUT IMAGES OTHER THAN THE NEAREST NEIGHBORS.")
 */
  __pyx_tuple__26 = PyTuple_Pack(1, __pyx_kp_u_SOLVING_LINEAR_BASIS_SET_COEFFI); if (unlikely(!__pyx_tuple__26)) __PYX_ERR(0, 421, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__26);
  __Pyx_GIVEREF(__pyx_tuple__26);

  /* "vcstring.pyx":422
 * 
 *         print('\nSOLVING LINEAR BASIS SET COEFFICIENTS, ACCELERATED METHOD')
 *         print('-----------------------------------------------------------')             # <<<<<<<<<<<<<<
 *         print("WARNING: THIS METHOD IS NOT RECOMMENDED FOR MOST CASES BECAUSE MOVING THE IMAGES MORE THAN A CERTAIN AMOUNT CAN AFFECT THE VORONOI TESSELATION IN FARTHER OUT IMAGES OTHER THAN THE NEAREST NEIGHBORS.")
 *         xa, xb = self.intermediate_region()
 */
  __pyx_tuple__28 = PyTuple_Pack(1, __pyx_kp_u__27); if (unlikely(!__pyx_tuple__28)) __PYX_ERR(0, 422, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__28);
  __Pyx_GIVEREF(__pyx_tuple__28);

  /* "vcstring.pyx":423
 *         print('\nSOLVING LINEAR BASIS SET COEFFICIENTS, ACCELERATED METHOD')
 *         print('-----------------------------------------------------------')
 *         print("WARNING: THIS METHOD IS NOT RECOMMENDED FOR MOST CASES BECAUSE MOVING THE IMAGES MORE THAN A CERTAIN AMOUNT CAN AFFECT THE VORONOI TESSELATION IN FARTHER OUT IMAGES OTHER THAN THE NEAREST NEIGHBORS.")             # <<<<<<<<<<<<<<
 *         xa, xb = self.intermediate_region()
 *         xcenters = z[:, 0]  # x coordinates of centroids
 */
  __pyx_tuple__29 = PyTuple_Pack(1, __pyx_kp_u_WARNING_THIS_METHOD_IS_NOT_RECOM); if (unlikely(!__pyx_tuple__29)) __PYX_ERR(0, 423, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__29);
  __Pyx_GIVEREF(__pyx_tuple__29);

  /* "vcstring.pyx":448
 *         g_tau = dat['g_tau']
 *         b = dat['b']
 *         print('\nInput data')             # <<<<<<<<<<<<<<
 *         print('D_0 =', D_0)
 *         print('D_tau =', D_tau)
 */
  __pyx_tuple__30 = PyTuple_Pack(1, __pyx_kp_u_Input_data); if (unlikely(!__pyx_tuple__30)) __PYX_ERR(0, 448, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__30);
  __Pyx_GIVEREF(__pyx_tuple__30);

  /* "vcstring.pyx":698
 *                     if t_final == None:
 *                         if t0 + tau >= len(traj[0]):
 *                             print('out of index')             # <<<<<<<<<<<<<<
 *                             break
 *                     else:
 */
  __pyx_tuple__31 = PyTuple_Pack(1, __pyx_kp_u_out_of_index); if (unlikely(!__pyx_tuple__31)) __PYX_ERR(0, 698, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__31);
  __Pyx_GIVEREF(__pyx_tuple__31);

  /* "vcstring.pyx":732
 * 
 *                 # Divide by data size
 *                 print('Dividing D by data size\n')             # <<<<<<<<<<<<<<
 *                 D_0.append(val_D_0 / count)
 *                 D_tau.append(val_D_tau / count)
 */
  __pyx_tuple__32 = PyTuple_Pack(1, __pyx_kp_u_Dividing_D_by_data_size); if (unlikely(!__pyx_tuple__32)) __PYX_ERR(0, 732, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__32);
  __Pyx_GIVEREF(__pyx_tuple__32);

  /* "vcstring.pyx":798
 *         N = len(traj)
 *         if weights == None:
 *             print('Using uniform weights')             # <<<<<<<<<<<<<<
 *             weights = [1.] * N
 * 
 */
  __pyx_tuple__33 = PyTuple_Pack(1, __pyx_kp_u_Using_uniform_weights); if (unlikely(!__pyx_tuple__33)) __PYX_ERR(0, 798, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__33);
  __Pyx_GIVEREF(__pyx_tuple__33);

  /* "vcstring.pyx":978
 * 
 *         # Calculate correlation function
 *         print('\n=================================')             # <<<<<<<<<<<<<<
 *         print('CALCULATING CORRELATION FUNCTION')
 *         print('=================================')
 */
  __pyx_tuple__36 = PyTuple_Pack(1, __pyx_kp_u__35); if (unlikely(!__pyx_tuple__36)) __PYX_ERR(0, 978, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__36);
  __Pyx_GIVEREF(__pyx_tuple__36);

  /* "vcstring.pyx":979
 *         # Calculate correlation function
 *         print('\n=================================')
 *         print('CALCULATING CORRELATION FUNCTION')             # <<<<<<<<<<<<<<
 *         print('=================================')
 *         sys.stdout.flush()
 */
  __pyx_tuple__37 = PyTuple_Pack(1, __pyx_kp_u_CALCULATING_CORRELATION_FUNCTION); if (unlikely(!__pyx_tuple__37)) __PYX_ERR(0, 979, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__37);
  __Pyx_GIVEREF(__pyx_tuple__37);

  /* "vcstring.pyx":980
 *         print('\n=================================')
 *         print('CALCULATING CORRELATION FUNCTION')
 *         print('=================================')             # <<<<<<<<<<<<<<
 *         sys.stdout.flush()
 *         C_00, C_tau0 = 0.0, 0.0
 */
  __pyx_tuple__39 = PyTuple_Pack(1, __pyx_kp_u__38); if (unlikely(!__pyx_tuple__39)) __PYX_ERR(0, 980, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__39);
  __Pyx_GIVEREF(__pyx_tuple__39);

  /* "vcstring.pyx":1275
 *         cdef double Cp, Cm, dC
 *         N = len(traj)
 *         print('\nFINITE DIFFERENCE PARAMETERS')             # <<<<<<<<<<<<<<
 *         print('----------------------------')
 *         print('Step change in position =', delta)
 */
  __pyx_tuple__40 = PyTuple_Pack(1, __pyx_kp_u_FINITE_DIFFERENCE_PARAMETERS); if (unlikely(!__pyx_tuple__40)) __PYX_ERR(0, 1275, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__40);
  __Pyx_GIVEREF(__pyx_tuple__40);

  /* "vcstring.pyx":1276
 *         N = len(traj)
 *         print('\nFINITE DIFFERENCE PARAMETERS')
 *         print('----------------------------')             # <<<<<<<<<<<<<<
 *         print('Step change in position =', delta)
 *         print(z)
 */
  __pyx_tuple__42 = PyTuple_Pack(1, __pyx_kp_u__41); if (unlikely(!__pyx_tuple__42)) __PYX_ERR(0, 1276, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__42);
  __Pyx_GIVEREF(__pyx_tuple__42);

  /* "vcstring.pyx":1285
 *         for i in [image]:
 *             for j in [dim]:
 *                 print('\n\n======================================')             # <<<<<<<<<<<<<<
 *                 print('CALCULATING FINITE DIFFERENCE GRADIENT')
 *                 print('======================================')
 */
  __pyx_tuple__44 = PyTuple_Pack(1, __pyx_kp_u__43); if (unlikely(!__pyx_tuple__44)) __PYX_ERR(0, 1285, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__44);
  __Pyx_GIVEREF(__pyx_tuple__44);

  /* "vcstring.pyx":1286
 *             for j in [dim]:
 *                 print('\n\n======================================')
 *                 print('CALCULATING FINITE DIFFERENCE GRADIENT')             # <<<<<<<<<<<<<<
 *                 print('======================================')
 *                 print('image, dim:', i, j)
 */
  __pyx_tuple__45 = PyTuple_Pack(1, __pyx_kp_u_CALCULATING_FINITE_DIFFERENCE_GR); if (unlikely(!__pyx_tuple__45)) __PYX_ERR(0, 1286, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__45);
  __Pyx_GIVEREF(__pyx_tuple__45);

  /* "vcstring.pyx":1314
 *                 # else:
 *                 #     print('\nWARNING: No finite difference computed')
 *         np.savez('output/gradC.npz',             # <<<<<<<<<<<<<<
 *                  Cp=Cp_list,
 *                  Cm=Cm_list,
 */
  __pyx_tuple__46 = PyTuple_Pack(1, __pyx_kp_u_output_gradC_npz); if (unlikely(!__pyx_tuple__46)) __PYX_ERR(0, 1314, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__46);
  __Pyx_GIVEREF(__pyx_tuple__46);

  /* "vcstring.pyx":1318
 *                  Cm=Cm_list,
 *                  gradC=gradC_list,)
 *         print('\nFINITE DIFFERENCE COMPLETED')             # <<<<<<<<<<<<<<
 *         print('\n\n===============')
 *         print('    SUMMARY    ')
 */
  __pyx_tuple__47 = PyTuple_Pack(1, __pyx_kp_u_FINITE_DIFFERENCE_COMPLETED); if (unlikely(!__pyx_tuple__47)) __PYX_ERR(0, 1318, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__47);
  __Pyx_GIVEREF(__pyx_tuple__47);

  /* "vcstring.pyx":1319
 *                  gradC=gradC_list,)
 *         print('\nFINITE DIFFERENCE COMPLETED')
 *         print('\n\n===============')             # <<<<<<<<<<<<<<
 *         print('    SUMMARY    ')
 *         print('===============')
 */
  __pyx_tuple__49 = PyTuple_Pack(1, __pyx_kp_u__48); if (unlikely(!__pyx_tuple__49)) __PYX_ERR(0, 1319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__49);
  __Pyx_GIVEREF(__pyx_tuple__49);

  /* "vcstring.pyx":1320
 *         print('\nFINITE DIFFERENCE COMPLETED')
 *         print('\n\n===============')
 *         print('    SUMMARY    ')             # <<<<<<<<<<<<<<
 *         print('===============')
 *         print('\nCp =', Cp_list)
 */
  __pyx_tuple__50 = PyTuple_Pack(1, __pyx_kp_u_SUMMARY); if (unlikely(!__pyx_tuple__50)) __PYX_ERR(0, 1320, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__50);
  __Pyx_GIVEREF(__pyx_tuple__50);

  /* "vcstring.pyx":1321
 *         print('\n\n===============')
 *         print('    SUMMARY    ')
 *         print('===============')             # <<<<<<<<<<<<<<
 *         print('\nCp =', Cp_list)
 *         print('Cm =', Cm_list)
 */
  __pyx_tuple__52 = PyTuple_Pack(1, __pyx_kp_u__51); if (unlikely(!__pyx_tuple__52)) __PYX_ERR(0, 1321, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__52);
  __Pyx_GIVEREF(__pyx_tuple__52);

  /* "vcstring.pyx":1398
 *         N = len(traj)
 *         print('\n=================================')
 *         print('MONTE CARLO SAMPLING')             # <<<<<<<<<<<<<<
 *         print('=================================')
 *         print('\nMONTE CARLO PARAMETERS')
 */
  __pyx_tuple__53 = PyTuple_Pack(1, __pyx_kp_u_MONTE_CARLO_SAMPLING); if (unlikely(!__pyx_tuple__53)) __PYX_ERR(0, 1398, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__53);
  __Pyx_GIVEREF(__pyx_tuple__53);

  /* "vcstring.pyx":1400
 *         print('MONTE CARLO SAMPLING')
 *         print('=================================')
 *         print('\nMONTE CARLO PARAMETERS')             # <<<<<<<<<<<<<<
 *         print('-------------------------')
 *         print('Target for accept/reject:', target)
 */
  __pyx_tuple__54 = PyTuple_Pack(1, __pyx_kp_u_MONTE_CARLO_PARAMETERS); if (unlikely(!__pyx_tuple__54)) __PYX_ERR(0, 1400, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__54);
  __Pyx_GIVEREF(__pyx_tuple__54);

  /* "vcstring.pyx":1401
 *         print('=================================')
 *         print('\nMONTE CARLO PARAMETERS')
 *         print('-------------------------')             # <<<<<<<<<<<<<<
 *         print('Target for accept/reject:', target)
 *         print('Step change in position:', delta)
 */
  __pyx_tuple__56 = PyTuple_Pack(1, __pyx_kp_u__55); if (unlikely(!__pyx_tuple__56)) __PYX_ERR(0, 1401, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__56);
  __Pyx_GIVEREF(__pyx_tuple__56);

  /* "vcstring.pyx":1407
 *         print('lag time:', tau)
 *         print('Input positions:\n', z)
 *         print('\nStarting Monte Carlo calculations')             # <<<<<<<<<<<<<<
 *         sys.stdout.flush()
 * 
 */
  __pyx_tuple__57 = PyTuple_Pack(1, __pyx_kp_u_Starting_Monte_Carlo_calculatio); if (unlikely(!__pyx_tuple__57)) __PYX_ERR(0, 1407, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__57);
  __Pyx_GIVEREF(__pyx_tuple__57);

  /* "vcstring.pyx":1414
 *             z_init = deepcopy(z[i])
 *             print('\nIMAGE', i)
 *             print('--------------------')             # <<<<<<<<<<<<<<
 *             print('Initial position:', z_init)
 * 
 */
  __pyx_tuple__59 = PyTuple_Pack(1, __pyx_kp_u__58); if (unlikely(!__pyx_tuple__59)) __PYX_ERR(0, 1414, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__59);
  __Pyx_GIVEREF(__pyx_tuple__59);

  /* "vcstring.pyx":1420
 *             for it in range(n): # Run n numbers of MC steps
 *                 print('\nCALCULATING MONTE CARLO STEP', it)
 *                 print('-------------------------------')             # <<<<<<<<<<<<<<
 *                 sys.stdout.flush()
 *                 if manual == False:
 */
  __pyx_tuple__61 = PyTuple_Pack(1, __pyx_kp_u__60); if (unlikely(!__pyx_tuple__61)) __PYX_ERR(0, 1420, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__61);
  __Pyx_GIVEREF(__pyx_tuple__61);

  /* "vcstring.pyx":1448
 *                         d1 = math.sqrt((z[i][0] - z[i-1][0]) ** 2 + (z[i][1] - z[i-1][1]) ** 2)
 *                         d2 = mindist
 *                     print('\nEnforcing minimum distance constraint')             # <<<<<<<<<<<<<<
 *                     print('Minimum distance allowed between images:', mindist)
 *                     print('Distance to neighbhoring images:', d1, d2)
 */
  __pyx_tuple__62 = PyTuple_Pack(1, __pyx_kp_u_Enforcing_minimum_distance_cons); if (unlikely(!__pyx_tuple__62)) __PYX_ERR(0, 1448, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__62);
  __Pyx_GIVEREF(__pyx_tuple__62);

  /* "vcstring.pyx":1464
 *                     # Average of time averages (best for a few aggregate long trajectories)
 *                     if ensemble_timeavg_v1 == True:
 *                         print('\n================================')             # <<<<<<<<<<<<<<
 *                         print('ENSEMBLE TIME AVERAGE - method 1')
 *                         print('================================')
 */
  __pyx_tuple__64 = PyTuple_Pack(1, __pyx_kp_u__63); if (unlikely(!__pyx_tuple__64)) __PYX_ERR(0, 1464, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__64);
  __Pyx_GIVEREF(__pyx_tuple__64);

  /* "vcstring.pyx":1465
 *                     if ensemble_timeavg_v1 == True:
 *                         print('\n================================')
 *                         print('ENSEMBLE TIME AVERAGE - method 1')             # <<<<<<<<<<<<<<
 *                         print('================================')
 *                         print('Number of trajectories:', N)
 */
  __pyx_tuple__65 = PyTuple_Pack(1, __pyx_kp_u_ENSEMBLE_TIME_AVERAGE_method_1); if (unlikely(!__pyx_tuple__65)) __PYX_ERR(0, 1465, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__65);
  __Pyx_GIVEREF(__pyx_tuple__65);

  /* "vcstring.pyx":1466
 *                         print('\n================================')
 *                         print('ENSEMBLE TIME AVERAGE - method 1')
 *                         print('================================')             # <<<<<<<<<<<<<<
 *                         print('Number of trajectories:', N)
 *                         b = np.zeros(self.num_basis)
 */
  __pyx_tuple__67 = PyTuple_Pack(1, __pyx_kp_u__66); if (unlikely(!__pyx_tuple__67)) __PYX_ERR(0, 1466, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__67);
  __Pyx_GIVEREF(__pyx_tuple__67);

  /* "vcstring.pyx":1509
 *                     elif ensemble_timeavg_v2 == True:
 *                         print('\n================================')
 *                         print('ENSEMBLE TIME AVERAGE - method 2')             # <<<<<<<<<<<<<<
 *                         print('================================')
 *                         print('Number of trajectories:', N)
 */
  __pyx_tuple__68 = PyTuple_Pack(1, __pyx_kp_u_ENSEMBLE_TIME_AVERAGE_method_2); if (unlikely(!__pyx_tuple__68)) __PYX_ERR(0, 1509, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__68);
  __Pyx_GIVEREF(__pyx_tuple__68);

  /* "vcstring.pyx":1521
 *                     # Ensemble averaging (best with lots of aggregate trajectories)
 *                     elif ensemble_avg == True:
 *                         print('\n==============================')             # <<<<<<<<<<<<<<
 *                         print('ENSEMBLE AVERAGE')
 *                         print('==============================')
 */
  __pyx_tuple__70 = PyTuple_Pack(1, __pyx_kp_u__69); if (unlikely(!__pyx_tuple__70)) __PYX_ERR(0, 1521, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__70);
  __Pyx_GIVEREF(__pyx_tuple__70);

  /* "vcstring.pyx":1522
 *                     elif ensemble_avg == True:
 *                         print('\n==============================')
 *                         print('ENSEMBLE AVERAGE')             # <<<<<<<<<<<<<<
 *                         print('==============================')
 *                         print('Number of trajectories:', N)
 */
  __pyx_tuple__71 = PyTuple_Pack(1, __pyx_kp_u_ENSEMBLE_AVERAGE); if (unlikely(!__pyx_tuple__71)) __PYX_ERR(0, 1522, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__71);
  __Pyx_GIVEREF(__pyx_tuple__71);

  /* "vcstring.pyx":1523
 *                         print('\n==============================')
 *                         print('ENSEMBLE AVERAGE')
 *                         print('==============================')             # <<<<<<<<<<<<<<
 *                         print('Number of trajectories:', N)
 *                         if weights == None:
 */
  __pyx_tuple__73 = PyTuple_Pack(1, __pyx_kp_u__72); if (unlikely(!__pyx_tuple__73)) __PYX_ERR(0, 1523, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__73);
  __Pyx_GIVEREF(__pyx_tuple__73);

  /* "vcstring.pyx":1552
 *                         np.savetxt('output/C_new.txt', [Cnew])
 *                         np.savetxt('output/q_new.txt', b)
 *                         np.savez('output/coeffs_new.npz',             # <<<<<<<<<<<<<<
 *                                  b=b,
 *                                  D_0=D_0,
 */
  __pyx_tuple__74 = PyTuple_Pack(1, __pyx_kp_u_output_coeffs_new_npz); if (unlikely(!__pyx_tuple__74)) __PYX_ERR(0, 1552, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__74);
  __Pyx_GIVEREF(__pyx_tuple__74);

  /* "vcstring.pyx":1571
 * 
 *             # In the case when all values were rejected
 *             print('\nWARNING: No values were accepted. Try increasing the number of MC steps.')             # <<<<<<<<<<<<<<
 *             print('Old position:', z_init)
 * 
 */
  __pyx_tuple__75 = PyTuple_Pack(1, __pyx_kp_u_WARNING_No_values_were_accepted); if (unlikely(!__pyx_tuple__75)) __PYX_ERR(0, 1571, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__75);
  __Pyx_GIVEREF(__pyx_tuple__75);

  /* "vcstring.pyx":1608
 *         N = len(traj)
 *         print('\n=================================')
 *         print('MONTE CARLO SAMPLING - SYMMETRIC')             # <<<<<<<<<<<<<<
 *         print('=================================')
 *         print('\nMONTE CARLO PARAMETERS')
 */
  __pyx_tuple__76 = PyTuple_Pack(1, __pyx_kp_u_MONTE_CARLO_SAMPLING_SYMMETRIC); if (unlikely(!__pyx_tuple__76)) __PYX_ERR(0, 1608, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__76);
  __Pyx_GIVEREF(__pyx_tuple__76);

  /* "vcstring.pyx":1731
 * 
 *     print('\n=========================')
 *     print('REPARAMETRIZE THE STRING')             # <<<<<<<<<<<<<<
 *     print('=========================')
 *     x = z[:, 0]
 */
  __pyx_tuple__77 = PyTuple_Pack(1, __pyx_kp_u_REPARAMETRIZE_THE_STRING); if (unlikely(!__pyx_tuple__77)) __PYX_ERR(0, 1731, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__77);
  __Pyx_GIVEREF(__pyx_tuple__77);

  /* "vcstring.pyx":1735
 *     x = z[:, 0]
 *     y = z[:, 1]
 *     dist_im = sqrt((x[1:] - x[0:-1]) ** 2 + (y[1:] - y[0:-1]) ** 2)  # distance between images             # <<<<<<<<<<<<<<
 *     dist_tot = sum(dist_im)  # Total distance of string
 *     equidist = dist_tot / len(dist_im)  # Equidistance length between images
 */
  __pyx_slice__78 = PySlice_New(__pyx_int_0, __pyx_int_neg_1, Py_None); if (unlikely(!__pyx_slice__78)) __PYX_ERR(0, 1735, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_slice__78);
  __Pyx_GIVEREF(__pyx_slice__78);

  /* "vcstring.pyx":1744
 * 
 *     grad = z[1:] - z[0:-1]  # unit gradient in x, y direction
 *     M = sqrt(grad[:, 0] ** 2 + grad[:, 1] ** 2).reshape(-1, 1)  # Magnitude of gradient             # <<<<<<<<<<<<<<
 *     grad = grad / M  # Unit vector pointing from one image to the next on string
 * 
 */
  __pyx_tuple__79 = PyTuple_Pack(2, __pyx_int_neg_1, __pyx_int_1); if (unlikely(!__pyx_tuple__79)) __PYX_ERR(0, 1744, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__79);
  __Pyx_GIVEREF(__pyx_tuple__79);

  /* "vcstring.pyx":1800
 *     print('Equidistance:', equidist)
 *     if len(z) != len(z_new_arr):
 *         print('ERROR, length of input string != output string')             # <<<<<<<<<<<<<<
 *         return
 * 
 */
  __pyx_tuple__80 = PyTuple_Pack(1, __pyx_kp_u_ERROR_length_of_input_string_out); if (unlikely(!__pyx_tuple__80)) __PYX_ERR(0, 1800, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__80);
  __Pyx_GIVEREF(__pyx_tuple__80);

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":947
 *         __pyx_import_array()
 *     except Exception:
 *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
 * 
 * cdef inline int import_umath() except -1:
 */
  __pyx_tuple__83 = PyTuple_Pack(1, __pyx_kp_u_numpy_core_multiarray_failed_to); if (unlikely(!__pyx_tuple__83)) __PYX_ERR(2, 947, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__83);
  __Pyx_GIVEREF(__pyx_tuple__83);

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":953
 *         _import_umath()
 *     except Exception:
 *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
 * 
 * cdef inline int import_ufunc() except -1:
 */
  __pyx_tuple__84 = PyTuple_Pack(1, __pyx_kp_u_numpy_core_umath_failed_to_impor); if (unlikely(!__pyx_tuple__84)) __PYX_ERR(2, 953, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__84);
  __Pyx_GIVEREF(__pyx_tuple__84);

  /* "vcstring.pyx":1820
 *     return ra, rb, alpha*pi/180.0, x0_A, y0_A, x0_B, y0_B
 * 
 * def elliptical(double a, double b, double alpha, double x0, double y0, xp, yp):             # <<<<<<<<<<<<<<
 *     ell_x = ((math.cos(alpha) * (xp - x0) + math.sin(alpha) * (yp - y0)) ** 2) / (a ** 2)
 *     ell_y = ((math.sin(alpha) * (xp - x0) - math.cos(alpha) * (yp - y0)) ** 2) / (b ** 2)
 */
  __pyx_tuple__85 = PyTuple_Pack(10, __pyx_n_s_a, __pyx_n_s_b_2, __pyx_n_s_alpha, __pyx_n_s_x0, __pyx_n_s_y0, __pyx_n_s_xp, __pyx_n_s_yp, __pyx_n_s_ell_x, __pyx_n_s_ell_y, __pyx_n_s_ell); if (unlikely(!__pyx_tuple__85)) __PYX_ERR(0, 1820, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__85);
  __Pyx_GIVEREF(__pyx_tuple__85);
  __pyx_codeobj__86 = (PyObject*)__Pyx_PyCode_New(7, 0, 10, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__85, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_vcstring_pyx, __pyx_n_s_elliptical, 1820, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__86)) __PYX_ERR(0, 1820, __pyx_L1_error)

  /* "vcstring.pyx":1826
 *     return ell
 * 
 * def smoothing(C_list, q_list, lags, first=10, last=10, cut=0):             # <<<<<<<<<<<<<<
 *     C_avg = []
 *     q_avg = []
 */
  __pyx_tuple__87 = PyTuple_Pack(11, __pyx_n_s_C_list, __pyx_n_s_q_list, __pyx_n_s_lags, __pyx_n_s_first, __pyx_n_s_last, __pyx_n_s_cut, __pyx_n_s_C_avg, __pyx_n_s_q_avg, __pyx_n_s_i, __pyx_n_s_C, __pyx_n_s_q); if (unlikely(!__pyx_tuple__87)) __PYX_ERR(0, 1826, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__87);
  __Pyx_GIVEREF(__pyx_tuple__87);
  __pyx_codeobj__88 = (PyObject*)__Pyx_PyCode_New(6, 0, 11, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__87, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_vcstring_pyx, __pyx_n_s_smoothing, 1826, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__88)) __PYX_ERR(0, 1826, __pyx_L1_error)

  /* "(tree fragment)":1
 * def __pyx_unpickle_vcstring(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 */
  __pyx_tuple__89 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__89)) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__89);
  __Pyx_GIVEREF(__pyx_tuple__89);
  __pyx_codeobj__90 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__89, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle_vcstring, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__90)) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_RefNannyFinishContext();
  return 0;
  __pyx_L1_error:;
  __Pyx_RefNannyFinishContext();
  return -1;
}

static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
  __pyx_float_1_ = PyFloat_FromDouble(1.); if (unlikely(!__pyx_float_1_)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_0_0 = PyFloat_FromDouble(0.0); if (unlikely(!__pyx_float_0_0)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_0_5 = PyFloat_FromDouble(0.5); if (unlikely(!__pyx_float_0_5)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_1_0 = PyFloat_FromDouble(1.0); if (unlikely(!__pyx_float_1_0)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_0_25 = PyFloat_FromDouble(0.25); if (unlikely(!__pyx_float_0_25)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_180_0 = PyFloat_FromDouble(180.0); if (unlikely(!__pyx_float_180_0)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_2 = PyInt_FromLong(2); if (unlikely(!__pyx_int_2)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_5 = PyInt_FromLong(5); if (unlikely(!__pyx_int_5)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_10 = PyInt_FromLong(10); if (unlikely(!__pyx_int_10)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_258326057 = PyInt_FromLong(258326057L); if (unlikely(!__pyx_int_258326057)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_neg_1 = PyInt_FromLong(-1); if (unlikely(!__pyx_int_neg_1)) __PYX_ERR(0, 1, __pyx_L1_error)
  return 0;
  __pyx_L1_error:;
  return -1;
}

static CYTHON_SMALL_CODE int __Pyx_modinit_global_init_code(void); /*proto*/
static CYTHON_SMALL_CODE int __Pyx_modinit_variable_export_code(void); /*proto*/
static CYTHON_SMALL_CODE int __Pyx_modinit_function_export_code(void); /*proto*/
static CYTHON_SMALL_CODE int __Pyx_modinit_type_init_code(void); /*proto*/
static CYTHON_SMALL_CODE int __Pyx_modinit_type_import_code(void); /*proto*/
static CYTHON_SMALL_CODE int __Pyx_modinit_variable_import_code(void); /*proto*/
static CYTHON_SMALL_CODE int __Pyx_modinit_function_import_code(void); /*proto*/

static int __Pyx_modinit_global_init_code(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_modinit_global_init_code", 0);
  /*--- Global init code ---*/
  __Pyx_RefNannyFinishContext();
  return 0;
}

static int __Pyx_modinit_variable_export_code(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_modinit_variable_export_code", 0);
  /*--- Variable export code ---*/
  __Pyx_RefNannyFinishContext();
  return 0;
}

static int __Pyx_modinit_function_export_code(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_modinit_function_export_code", 0);
  /*--- Function export code ---*/
  __Pyx_RefNannyFinishContext();
  return 0;
}

static int __Pyx_modinit_type_init_code(void) {
  __Pyx_RefNannyDeclarations
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__Pyx_modinit_type_init_code", 0);
  /*--- Type init code ---*/
  __pyx_vtabptr_8vcstring_vcstring = &__pyx_vtable_8vcstring_vcstring;
  __pyx_vtable_8vcstring_vcstring.intermediate_region = (PyObject *(*)(struct __pyx_obj_8vcstring_vcstring *, int __pyx_skip_dispatch))__pyx_f_8vcstring_8vcstring_intermediate_region;
  __pyx_vtable_8vcstring_vcstring.centroids = (PyObject *(*)(struct __pyx_obj_8vcstring_vcstring *, int __pyx_skip_dispatch))__pyx_f_8vcstring_8vcstring_centroids;
  __pyx_vtable_8vcstring_vcstring.assign_states = (PyObject *(*)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, int, PyArrayObject *, int __pyx_skip_dispatch))__pyx_f_8vcstring_8vcstring_assign_states;
  __pyx_vtable_8vcstring_vcstring.assign_states_ensemble = (PyObject *(*)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, int, PyArrayObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_assign_states_ensemble *__pyx_optional_args))__pyx_f_8vcstring_8vcstring_assign_states_ensemble;
  __pyx_vtable_8vcstring_vcstring.calc_coeffs = (PyObject *(*)(struct __pyx_obj_8vcstring_vcstring *, int, int, PyArrayObject *, PyArrayObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs *__pyx_optional_args))__pyx_f_8vcstring_8vcstring_calc_coeffs;
  __pyx_vtable_8vcstring_vcstring.calc_coeffs_accelerated = (PyObject *(*)(struct __pyx_obj_8vcstring_vcstring *, int, PyObject *, int, PyArrayObject *, int __pyx_skip_dispatch))__pyx_f_8vcstring_8vcstring_calc_coeffs_accelerated;
  __pyx_vtable_8vcstring_vcstring.calc_coeffs_ensemble = (PyObject *(*)(struct __pyx_obj_8vcstring_vcstring *, int, int, PyArrayObject *, PyArrayObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble *__pyx_optional_args))__pyx_f_8vcstring_8vcstring_calc_coeffs_ensemble;
  __pyx_vtable_8vcstring_vcstring.calc_coeffs_ensemble_timeavg = (PyObject *(*)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, int, PyArrayObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg *__pyx_optional_args))__pyx_f_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg;
  __pyx_vtable_8vcstring_vcstring.calc_coeffs_ensemble_timeavg_fast = (PyObject *(*)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, int, PyArrayObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast *__pyx_optional_args))__pyx_f_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast;
  __pyx_vtable_8vcstring_vcstring.calc_coeffs_ensemble_timeavg_fast_v2 = (PyObject *(*)(struct __pyx_obj_8vcstring_vcstring *, int, PyObject *, int, PyArrayObject *, PyArrayObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast_v2 *__pyx_optional_args))__pyx_f_8vcstring_8vcstring_calc_coeffs_ensemble_timeavg_fast_v2;
  __pyx_vtable_8vcstring_vcstring.calc_corr = (PyObject *(*)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, int, PyArrayObject *, PyArrayObject *, PyArrayObject *, PyArrayObject *, PyArrayObject *, int __pyx_skip_dispatch))__pyx_f_8vcstring_8vcstring_calc_corr;
  __pyx_vtable_8vcstring_vcstring.calc_corr_q2 = (PyObject *(*)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, int, PyArrayObject *, PyArrayObject *, int __pyx_skip_dispatch))__pyx_f_8vcstring_8vcstring_calc_corr_q2;
  __pyx_vtable_8vcstring_vcstring.calc_corr_q2_ensemble = (PyObject *(*)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, int, PyArrayObject *, PyArrayObject *, int __pyx_skip_dispatch))__pyx_f_8vcstring_8vcstring_calc_corr_q2_ensemble;
  __pyx_vtable_8vcstring_vcstring.calc_corr_q2_ensemble_timeavg = (PyObject *(*)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, int, PyArrayObject *, PyArrayObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg *__pyx_optional_args))__pyx_f_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg;
  __pyx_vtable_8vcstring_vcstring.calc_corr_q2_ensemble_timeavg_fast = (PyObject *(*)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, int, PyArrayObject *, PyArrayObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg_fast *__pyx_optional_args))__pyx_f_8vcstring_8vcstring_calc_corr_q2_ensemble_timeavg_fast;
  __pyx_vtable_8vcstring_vcstring.finite_diff_corr = (PyObject *(*)(struct __pyx_obj_8vcstring_vcstring *, int, int, PyObject *, int, PyArrayObject *, PyArrayObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_finite_diff_corr *__pyx_optional_args))__pyx_f_8vcstring_8vcstring_finite_diff_corr;
  __pyx_vtable_8vcstring_vcstring.finite_diff_committor = (PyObject *(*)(struct __pyx_obj_8vcstring_vcstring *, PyArrayObject *, PyArrayObject *, PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_finite_diff_committor *__pyx_optional_args))__pyx_f_8vcstring_8vcstring_finite_diff_committor;
  __pyx_vtable_8vcstring_vcstring.montecarlo = (PyObject *(*)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, PyObject *, int, PyArrayObject *, double, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_montecarlo *__pyx_optional_args))__pyx_f_8vcstring_8vcstring_montecarlo;
  __pyx_vtable_8vcstring_vcstring.montecarlo_symmetric = (PyObject *(*)(struct __pyx_obj_8vcstring_vcstring *, PyObject *, PyObject *, int, PyArrayObject *, double, int __pyx_skip_dispatch, struct __pyx_opt_args_8vcstring_8vcstring_montecarlo_symmetric *__pyx_optional_args))__pyx_f_8vcstring_8vcstring_montecarlo_symmetric;
  if (PyType_Ready(&__pyx_type_8vcstring_vcstring) < 0) __PYX_ERR(0, 13, __pyx_L1_error)
  #if PY_VERSION_HEX < 0x030800B1
  __pyx_type_8vcstring_vcstring.tp_print = 0;
  #endif
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_8vcstring_vcstring.tp_dictoffset && __pyx_type_8vcstring_vcstring.tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_type_8vcstring_vcstring.tp_getattro = __Pyx_PyObject_GenericGetAttr;
  }
  #if CYTHON_COMPILING_IN_CPYTHON
  {
    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_8vcstring_vcstring, "__init__"); if (unlikely(!wrapper)) __PYX_ERR(0, 13, __pyx_L1_error)
    if (Py_TYPE(wrapper) == &PyWrapperDescr_Type) {
      __pyx_wrapperbase_8vcstring_8vcstring___init__ = *((PyWrapperDescrObject *)wrapper)->d_base;
      __pyx_wrapperbase_8vcstring_8vcstring___init__.doc = __pyx_doc_8vcstring_8vcstring___init__;
      ((PyWrapperDescrObject *)wrapper)->d_base = &__pyx_wrapperbase_8vcstring_8vcstring___init__;
    }
  }
  #endif
  if (__Pyx_SetVtable(__pyx_type_8vcstring_vcstring.tp_dict, __pyx_vtabptr_8vcstring_vcstring) < 0) __PYX_ERR(0, 13, __pyx_L1_error)
  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_vcstring, (PyObject *)&__pyx_type_8vcstring_vcstring) < 0) __PYX_ERR(0, 13, __pyx_L1_error)
  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_8vcstring_vcstring) < 0) __PYX_ERR(0, 13, __pyx_L1_error)
  __pyx_ptype_8vcstring_vcstring = &__pyx_type_8vcstring_vcstring;
  __Pyx_RefNannyFinishContext();
  return 0;
  __pyx_L1_error:;
  __Pyx_RefNannyFinishContext();
  return -1;
}

static int __Pyx_modinit_type_import_code(void) {
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
  /*--- Type import code ---*/
  __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 9, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
  #if defined(PYPY_VERSION_NUM) && PYPY_VERSION_NUM < 0x050B0000
  sizeof(PyTypeObject),
  #else
  sizeof(PyHeapTypeObject),
  #endif
  __Pyx_ImportType_CheckSize_Warn);
   if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(3, 9, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyImport_ImportModule("numpy"); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 200, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_ptype_5numpy_dtype = __Pyx_ImportType(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __Pyx_ImportType_CheckSize_Ignore);
   if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(2, 200, __pyx_L1_error)
  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __Pyx_ImportType_CheckSize_Ignore);
   if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(2, 223, __pyx_L1_error)
  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __Pyx_ImportType_CheckSize_Ignore);
   if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(2, 227, __pyx_L1_error)
  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __Pyx_ImportType_CheckSize_Ignore);
   if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(2, 239, __pyx_L1_error)
  __pyx_ptype_5numpy_generic = __Pyx_ImportType(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
   if (!__pyx_ptype_5numpy_generic) __PYX_ERR(2, 771, __pyx_L1_error)
  __pyx_ptype_5numpy_number = __Pyx_ImportType(__pyx_t_1, "numpy", "number", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
   if (!__pyx_ptype_5numpy_number) __PYX_ERR(2, 773, __pyx_L1_error)
  __pyx_ptype_5numpy_integer = __Pyx_ImportType(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
   if (!__pyx_ptype_5numpy_integer) __PYX_ERR(2, 775, __pyx_L1_error)
  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
   if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(2, 777, __pyx_L1_error)
  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
   if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(2, 779, __pyx_L1_error)
  __pyx_ptype_5numpy_inexact = __Pyx_ImportType(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
   if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(2, 781, __pyx_L1_error)
  __pyx_ptype_5numpy_floating = __Pyx_ImportType(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
   if (!__pyx_ptype_5numpy_floating) __PYX_ERR(2, 783, __pyx_L1_error)
  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
   if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(2, 785, __pyx_L1_error)
  __pyx_ptype_5numpy_flexible = __Pyx_ImportType(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
   if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(2, 787, __pyx_L1_error)
  __pyx_ptype_5numpy_character = __Pyx_ImportType(__pyx_t_1, "numpy", "character", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
   if (!__pyx_ptype_5numpy_character) __PYX_ERR(2, 789, __pyx_L1_error)
  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __Pyx_ImportType_CheckSize_Ignore);
   if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(2, 827, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_RefNannyFinishContext();
  return 0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_RefNannyFinishContext();
  return -1;
}

static int __Pyx_modinit_variable_import_code(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_modinit_variable_import_code", 0);
  /*--- Variable import code ---*/
  __Pyx_RefNannyFinishContext();
  return 0;
}

static int __Pyx_modinit_function_import_code(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_modinit_function_import_code", 0);
  /*--- Function import code ---*/
  __Pyx_RefNannyFinishContext();
  return 0;
}


#ifndef CYTHON_NO_PYINIT_EXPORT
#define __Pyx_PyMODINIT_FUNC PyMODINIT_FUNC
#elif PY_MAJOR_VERSION < 3
#ifdef __cplusplus
#define __Pyx_PyMODINIT_FUNC extern "C" void
#else
#define __Pyx_PyMODINIT_FUNC void
#endif
#else
#ifdef __cplusplus
#define __Pyx_PyMODINIT_FUNC extern "C" PyObject *
#else
#define __Pyx_PyMODINIT_FUNC PyObject *
#endif
#endif


#if PY_MAJOR_VERSION < 3
__Pyx_PyMODINIT_FUNC initvcstring(void) CYTHON_SMALL_CODE; /*proto*/
__Pyx_PyMODINIT_FUNC initvcstring(void)
#else
__Pyx_PyMODINIT_FUNC PyInit_vcstring(void) CYTHON_SMALL_CODE; /*proto*/
__Pyx_PyMODINIT_FUNC PyInit_vcstring(void)
#if CYTHON_PEP489_MULTI_PHASE_INIT
{
  return PyModuleDef_Init(&__pyx_moduledef);
}
static CYTHON_SMALL_CODE int __Pyx_check_single_interpreter(void) {
    #if PY_VERSION_HEX >= 0x030700A1
    static PY_INT64_T main_interpreter_id = -1;
    PY_INT64_T current_id = PyInterpreterState_GetID(PyThreadState_Get()->interp);
    if (main_interpreter_id == -1) {
        main_interpreter_id = current_id;
        return (unlikely(current_id == -1)) ? -1 : 0;
    } else if (unlikely(main_interpreter_id != current_id))
    #else
    static PyInterpreterState *main_interpreter = NULL;
    PyInterpreterState *current_interpreter = PyThreadState_Get()->interp;
    if (!main_interpreter) {
        main_interpreter = current_interpreter;
    } else if (unlikely(main_interpreter != current_interpreter))
    #endif
    {
        PyErr_SetString(
            PyExc_ImportError,
            "Interpreter change detected - this module can only be loaded into one interpreter per process.");
        return -1;
    }
    return 0;
}
static CYTHON_SMALL_CODE int __Pyx_copy_spec_to_module(PyObject *spec, PyObject *moddict, const char* from_name, const char* to_name, int allow_none) {
    PyObject *value = PyObject_GetAttrString(spec, from_name);
    int result = 0;
    if (likely(value)) {
        if (allow_none || value != Py_None) {
            result = PyDict_SetItemString(moddict, to_name, value);
        }
        Py_DECREF(value);
    } else if (PyErr_ExceptionMatches(PyExc_AttributeError)) {
        PyErr_Clear();
    } else {
        result = -1;
    }
    return result;
}
static CYTHON_SMALL_CODE PyObject* __pyx_pymod_create(PyObject *spec, CYTHON_UNUSED PyModuleDef *def) {
    PyObject *module = NULL, *moddict, *modname;
    if (__Pyx_check_single_interpreter())
        return NULL;
    if (__pyx_m)
        return __Pyx_NewRef(__pyx_m);
    modname = PyObject_GetAttrString(spec, "name");
    if (unlikely(!modname)) goto bad;
    module = PyModule_NewObject(modname);
    Py_DECREF(modname);
    if (unlikely(!module)) goto bad;
    moddict = PyModule_GetDict(module);
    if (unlikely(!moddict)) goto bad;
    if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "loader", "__loader__", 1) < 0)) goto bad;
    if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "origin", "__file__", 1) < 0)) goto bad;
    if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "parent", "__package__", 1) < 0)) goto bad;
    if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "submodule_search_locations", "__path__", 0) < 0)) goto bad;
    return module;
bad:
    Py_XDECREF(module);
    return NULL;
}


static CYTHON_SMALL_CODE int __pyx_pymod_exec_vcstring(PyObject *__pyx_pyinit_module)
#endif
#endif
{
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannyDeclarations
  #if CYTHON_PEP489_MULTI_PHASE_INIT
  if (__pyx_m) {
    if (__pyx_m == __pyx_pyinit_module) return 0;
    PyErr_SetString(PyExc_RuntimeError, "Module 'vcstring' has already been imported. Re-initialisation is not supported.");
    return -1;
  }
  #elif PY_MAJOR_VERSION >= 3
  if (__pyx_m) return __Pyx_NewRef(__pyx_m);
  #endif
  #if CYTHON_REFNANNY
__Pyx_RefNanny = __Pyx_RefNannyImportAPI("refnanny");
if (!__Pyx_RefNanny) {
  PyErr_Clear();
  __Pyx_RefNanny = __Pyx_RefNannyImportAPI("Cython.Runtime.refnanny");
  if (!__Pyx_RefNanny)
      Py_FatalError("failed to import 'refnanny' module");
}
#endif
  __Pyx_RefNannySetupContext("__Pyx_PyMODINIT_FUNC PyInit_vcstring(void)", 0);
  if (__Pyx_check_binary_version() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #ifdef __Pxy_PyFrame_Initialize_Offsets
  __Pxy_PyFrame_Initialize_Offsets();
  #endif
  __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_empty_bytes = PyBytes_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_bytes)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_empty_unicode = PyUnicode_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_unicode)) __PYX_ERR(0, 1, __pyx_L1_error)
  #ifdef __Pyx_CyFunction_USED
  if (__pyx_CyFunction_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #ifdef __Pyx_FusedFunction_USED
  if (__pyx_FusedFunction_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #ifdef __Pyx_Coroutine_USED
  if (__pyx_Coroutine_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #ifdef __Pyx_Generator_USED
  if (__pyx_Generator_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #ifdef __Pyx_AsyncGen_USED
  if (__pyx_AsyncGen_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #ifdef __Pyx_StopAsyncIteration_USED
  if (__pyx_StopAsyncIteration_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  /*--- Library function declarations ---*/
  /*--- Threads initialization code ---*/
  #if defined(WITH_THREAD) && PY_VERSION_HEX < 0x030700F0 && defined(__PYX_FORCE_INIT_THREADS) && __PYX_FORCE_INIT_THREADS
  PyEval_InitThreads();
  #endif
  /*--- Module creation code ---*/
  #if CYTHON_PEP489_MULTI_PHASE_INIT
  __pyx_m = __pyx_pyinit_module;
  Py_INCREF(__pyx_m);
  #else
  #if PY_MAJOR_VERSION < 3
  __pyx_m = Py_InitModule4("vcstring", __pyx_methods, 0, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
  #else
  __pyx_m = PyModule_Create(&__pyx_moduledef);
  #endif
  if (unlikely(!__pyx_m)) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) __PYX_ERR(0, 1, __pyx_L1_error)
  Py_INCREF(__pyx_d);
  __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_b)) __PYX_ERR(0, 1, __pyx_L1_error)
  Py_INCREF(__pyx_b);
  __pyx_cython_runtime = PyImport_AddModule((char *) "cython_runtime"); if (unlikely(!__pyx_cython_runtime)) __PYX_ERR(0, 1, __pyx_L1_error)
  Py_INCREF(__pyx_cython_runtime);
  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
  /*--- Initialize various global constants etc. ---*/
  if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
  if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  if (__pyx_module_is_main_vcstring) {
    if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  }
  #if PY_MAJOR_VERSION >= 3
  {
    PyObject *modules = PyImport_GetModuleDict(); if (unlikely(!modules)) __PYX_ERR(0, 1, __pyx_L1_error)
    if (!PyDict_GetItemString(modules, "vcstring")) {
      if (unlikely(PyDict_SetItemString(modules, "vcstring", __pyx_m) < 0)) __PYX_ERR(0, 1, __pyx_L1_error)
    }
  }
  #endif
  /*--- Builtin init code ---*/
  if (__Pyx_InitCachedBuiltins() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  /*--- Constants init code ---*/
  if (__Pyx_InitCachedConstants() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  /*--- Global type/function init code ---*/
  (void)__Pyx_modinit_global_init_code();
  (void)__Pyx_modinit_variable_export_code();
  (void)__Pyx_modinit_function_export_code();
  if (unlikely(__Pyx_modinit_type_init_code() < 0)) __PYX_ERR(0, 1, __pyx_L1_error)
  if (unlikely(__Pyx_modinit_type_import_code() < 0)) __PYX_ERR(0, 1, __pyx_L1_error)
  (void)__Pyx_modinit_variable_import_code();
  (void)__Pyx_modinit_function_import_code();
  /*--- Execution code ---*/
  #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
  if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif

  /* "vcstring.pyx":1
 * import sys             # <<<<<<<<<<<<<<
 * import math
 * import numpy as np
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_sys, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sys, __pyx_t_1) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":2
 * import sys
 * import math             # <<<<<<<<<<<<<<
 * import numpy as np
 * cimport numpy as np
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_math, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_math, __pyx_t_1) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":3
 * import sys
 * import math
 * import numpy as np             # <<<<<<<<<<<<<<
 * cimport numpy as np
 * from numpy import exp, zeros, sqrt, square, log, where, pi, mean, average, arange, sin, cos, tan
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_1) < 0) __PYX_ERR(0, 3, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":5
 * import numpy as np
 * cimport numpy as np
 * from numpy import exp, zeros, sqrt, square, log, where, pi, mean, average, arange, sin, cos, tan             # <<<<<<<<<<<<<<
 * from copy import copy, deepcopy
 * import random
 */
  __pyx_t_1 = PyList_New(13); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_n_s_exp);
  __Pyx_GIVEREF(__pyx_n_s_exp);
  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_s_exp);
  __Pyx_INCREF(__pyx_n_s_zeros);
  __Pyx_GIVEREF(__pyx_n_s_zeros);
  PyList_SET_ITEM(__pyx_t_1, 1, __pyx_n_s_zeros);
  __Pyx_INCREF(__pyx_n_s_sqrt);
  __Pyx_GIVEREF(__pyx_n_s_sqrt);
  PyList_SET_ITEM(__pyx_t_1, 2, __pyx_n_s_sqrt);
  __Pyx_INCREF(__pyx_n_s_square);
  __Pyx_GIVEREF(__pyx_n_s_square);
  PyList_SET_ITEM(__pyx_t_1, 3, __pyx_n_s_square);
  __Pyx_INCREF(__pyx_n_s_log);
  __Pyx_GIVEREF(__pyx_n_s_log);
  PyList_SET_ITEM(__pyx_t_1, 4, __pyx_n_s_log);
  __Pyx_INCREF(__pyx_n_s_where);
  __Pyx_GIVEREF(__pyx_n_s_where);
  PyList_SET_ITEM(__pyx_t_1, 5, __pyx_n_s_where);
  __Pyx_INCREF(__pyx_n_s_pi);
  __Pyx_GIVEREF(__pyx_n_s_pi);
  PyList_SET_ITEM(__pyx_t_1, 6, __pyx_n_s_pi);
  __Pyx_INCREF(__pyx_n_s_mean);
  __Pyx_GIVEREF(__pyx_n_s_mean);
  PyList_SET_ITEM(__pyx_t_1, 7, __pyx_n_s_mean);
  __Pyx_INCREF(__pyx_n_s_average);
  __Pyx_GIVEREF(__pyx_n_s_average);
  PyList_SET_ITEM(__pyx_t_1, 8, __pyx_n_s_average);
  __Pyx_INCREF(__pyx_n_s_arange);
  __Pyx_GIVEREF(__pyx_n_s_arange);
  PyList_SET_ITEM(__pyx_t_1, 9, __pyx_n_s_arange);
  __Pyx_INCREF(__pyx_n_s_sin);
  __Pyx_GIVEREF(__pyx_n_s_sin);
  PyList_SET_ITEM(__pyx_t_1, 10, __pyx_n_s_sin);
  __Pyx_INCREF(__pyx_n_s_cos);
  __Pyx_GIVEREF(__pyx_n_s_cos);
  PyList_SET_ITEM(__pyx_t_1, 11, __pyx_n_s_cos);
  __Pyx_INCREF(__pyx_n_s_tan);
  __Pyx_GIVEREF(__pyx_n_s_tan);
  PyList_SET_ITEM(__pyx_t_1, 12, __pyx_n_s_tan);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_numpy, __pyx_t_1, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_exp); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_exp, __pyx_t_1) < 0) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_zeros, __pyx_t_1) < 0) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sqrt, __pyx_t_1) < 0) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_square); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_square, __pyx_t_1) < 0) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_log); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_log, __pyx_t_1) < 0) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_where); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_where, __pyx_t_1) < 0) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_pi); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pi, __pyx_t_1) < 0) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_mean); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_mean, __pyx_t_1) < 0) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_average); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_average, __pyx_t_1) < 0) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_arange); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_arange, __pyx_t_1) < 0) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_sin); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sin, __pyx_t_1) < 0) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_cos); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_cos, __pyx_t_1) < 0) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_tan); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_tan, __pyx_t_1) < 0) __PYX_ERR(0, 5, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":6
 * cimport numpy as np
 * from numpy import exp, zeros, sqrt, square, log, where, pi, mean, average, arange, sin, cos, tan
 * from copy import copy, deepcopy             # <<<<<<<<<<<<<<
 * import random
 * 
 */
  __pyx_t_2 = PyList_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_copy);
  __Pyx_GIVEREF(__pyx_n_s_copy);
  PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_copy);
  __Pyx_INCREF(__pyx_n_s_deepcopy);
  __Pyx_GIVEREF(__pyx_n_s_deepcopy);
  PyList_SET_ITEM(__pyx_t_2, 1, __pyx_n_s_deepcopy);
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_copy, __pyx_t_2, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_1, __pyx_n_s_copy); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_copy, __pyx_t_2) < 0) __PYX_ERR(0, 6, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_1, __pyx_n_s_deepcopy); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_deepcopy, __pyx_t_2) < 0) __PYX_ERR(0, 6, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":7
 * from numpy import exp, zeros, sqrt, square, log, where, pi, mean, average, arange, sin, cos, tan
 * from copy import copy, deepcopy
 * import random             # <<<<<<<<<<<<<<
 * 
 * np.import_array()
 */
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_random, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 7, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_random, __pyx_t_1) < 0) __PYX_ERR(0, 7, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "vcstring.pyx":9
 * import random
 * 
 * np.import_array()             # <<<<<<<<<<<<<<
 * DTYPE = np.float64
 * ctypedef np.float64_t DTYPE_t
 */
  __pyx_t_3 = __pyx_f_5numpy_import_array(); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(0, 9, __pyx_L1_error)

  /* "vcstring.pyx":10
 * 
 * np.import_array()
 * DTYPE = np.float64             # <<<<<<<<<<<<<<
 * ctypedef np.float64_t DTYPE_t
 * 
 */
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 10, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_float64); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 10, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_DTYPE, __pyx_t_2) < 0) __PYX_ERR(0, 10, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":1805
 *     return z_new_arr
 * 
 * cpdef elliptical_bounds_params(double ra=1.0, double rb=0.4, double alpha=58.0, double x0_A=-2.2, double y0_A=-2.2, double x0_B=2.2, double y0_B=2.2):             # <<<<<<<<<<<<<<
 *     """
 *     Parameters for defining the  elliptical boundaries at the well minima where the
 */
  __pyx_k__81 = (-2.2);
  __pyx_k__82 = (-2.2);
  __pyx_k__81 = (-2.2);
  __pyx_k__82 = (-2.2);

  /* "vcstring.pyx":1820
 *     return ra, rb, alpha*pi/180.0, x0_A, y0_A, x0_B, y0_B
 * 
 * def elliptical(double a, double b, double alpha, double x0, double y0, xp, yp):             # <<<<<<<<<<<<<<
 *     ell_x = ((math.cos(alpha) * (xp - x0) + math.sin(alpha) * (yp - y0)) ** 2) / (a ** 2)
 *     ell_y = ((math.sin(alpha) * (xp - x0) - math.cos(alpha) * (yp - y0)) ** 2) / (b ** 2)
 */
  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_8vcstring_5elliptical, NULL, __pyx_n_s_vcstring); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1820, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_elliptical, __pyx_t_2) < 0) __PYX_ERR(0, 1820, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":1826
 *     return ell
 * 
 * def smoothing(C_list, q_list, lags, first=10, last=10, cut=0):             # <<<<<<<<<<<<<<
 *     C_avg = []
 *     q_avg = []
 */
  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_8vcstring_7smoothing, NULL, __pyx_n_s_vcstring); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1826, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_smoothing, __pyx_t_2) < 0) __PYX_ERR(0, 1826, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "(tree fragment)":1
 * def __pyx_unpickle_vcstring(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
 *     cdef object __pyx_PickleError
 *     cdef object __pyx_result
 */
  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_8vcstring_9__pyx_unpickle_vcstring, NULL, __pyx_n_s_vcstring); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pyx_unpickle_vcstring, __pyx_t_2) < 0) __PYX_ERR(1, 1, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "vcstring.pyx":1
 * import sys             # <<<<<<<<<<<<<<
 * import math
 * import numpy as np
 */
  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "../../../../../../home/ziweihe/anaconda2/envs/py3/lib/python3.7/site-packages/numpy/__init__.pxd":1016
 * 
 * 
 * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
 *     """
 *     returns the unit part of the dtype for a numpy datetime64 object.
 */

  /*--- Wrapped vars code ---*/

  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  if (__pyx_m) {
    if (__pyx_d) {
      __Pyx_AddTraceback("init vcstring", __pyx_clineno, __pyx_lineno, __pyx_filename);
    }
    Py_CLEAR(__pyx_m);
  } else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_ImportError, "init vcstring");
  }
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  #if CYTHON_PEP489_MULTI_PHASE_INIT
  return (__pyx_m != NULL) ? 0 : -1;
  #elif PY_MAJOR_VERSION >= 3
  return __pyx_m;
  #else
  return;
  #endif
}

/* --- Runtime support code --- */
/* Refnanny */
#if CYTHON_REFNANNY
static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname) {
    PyObject *m = NULL, *p = NULL;
    void *r = NULL;
    m = PyImport_ImportModule(modname);
    if (!m) goto end;
    p = PyObject_GetAttrString(m, "RefNannyAPI");
    if (!p) goto end;
    r = PyLong_AsVoidPtr(p);
end:
    Py_XDECREF(p);
    Py_XDECREF(m);
    return (__Pyx_RefNannyAPIStruct *)r;
}
#endif

/* PyObjectGetAttrStr */
#if CYTHON_USE_TYPE_SLOTS
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name) {
    PyTypeObject* tp = Py_TYPE(obj);
    if (likely(tp->tp_getattro))
        return tp->tp_getattro(obj, attr_name);
#if PY_MAJOR_VERSION < 3
    if (likely(tp->tp_getattr))
        return tp->tp_getattr(obj, PyString_AS_STRING(attr_name));
#endif
    return PyObject_GetAttr(obj, attr_name);
}
#endif

/* GetBuiltinName */
static PyObject *__Pyx_GetBuiltinName(PyObject *name) {
    PyObject* result = __Pyx_PyObject_GetAttrStr(__pyx_b, name);
    if (unlikely(!result)) {
        PyErr_Format(PyExc_NameError,
#if PY_MAJOR_VERSION >= 3
            "name '%U' is not defined", name);
#else
            "name '%.200s' is not defined", PyString_AS_STRING(name));
#endif
    }
    return result;
}

/* RaiseArgTupleInvalid */
static void __Pyx_RaiseArgtupleInvalid(
    const char* func_name,
    int exact,
    Py_ssize_t num_min,
    Py_ssize_t num_max,
    Py_ssize_t num_found)
{
    Py_ssize_t num_expected;
    const char *more_or_less;
    if (num_found < num_min) {
        num_expected = num_min;
        more_or_less = "at least";
    } else {
        num_expected = num_max;
        more_or_less = "at most";
    }
    if (exact) {
        more_or_less = "exactly";
    }
    PyErr_Format(PyExc_TypeError,
                 "%.200s() takes %.8s %" CYTHON_FORMAT_SSIZE_T "d positional argument%.1s (%" CYTHON_FORMAT_SSIZE_T "d given)",
                 func_name, more_or_less, num_expected,
                 (num_expected == 1) ? "" : "s", num_found);
}

/* RaiseDoubleKeywords */
static void __Pyx_RaiseDoubleKeywordsError(
    const char* func_name,
    PyObject* kw_name)
{
    PyErr_Format(PyExc_TypeError,
        #if PY_MAJOR_VERSION >= 3
        "%s() got multiple values for keyword argument '%U'", func_name, kw_name);
        #else
        "%s() got multiple values for keyword argument '%s'", func_name,
        PyString_AsString(kw_name));
        #endif
}

/* ParseKeywords */
static int __Pyx_ParseOptionalKeywords(
    PyObject *kwds,
    PyObject **argnames[],
    PyObject *kwds2,
    PyObject *values[],
    Py_ssize_t num_pos_args,
    const char* function_name)
{
    PyObject *key = 0, *value = 0;
    Py_ssize_t pos = 0;
    PyObject*** name;
    PyObject*** first_kw_arg = argnames + num_pos_args;
    while (PyDict_Next(kwds, &pos, &key, &value)) {
        name = first_kw_arg;
        while (*name && (**name != key)) name++;
        if (*name) {
            values[name-argnames] = value;
            continue;
        }
        name = first_kw_arg;
        #if PY_MAJOR_VERSION < 3
        if (likely(PyString_Check(key))) {
            while (*name) {
                if ((CYTHON_COMPILING_IN_PYPY || PyString_GET_SIZE(**name) == PyString_GET_SIZE(key))
                        && _PyString_Eq(**name, key)) {
                    values[name-argnames] = value;
                    break;
                }
                name++;
            }
            if (*name) continue;
            else {
                PyObject*** argname = argnames;
                while (argname != first_kw_arg) {
                    if ((**argname == key) || (
                            (CYTHON_COMPILING_IN_PYPY || PyString_GET_SIZE(**argname) == PyString_GET_SIZE(key))
                             && _PyString_Eq(**argname, key))) {
                        goto arg_passed_twice;
                    }
                    argname++;
                }
            }
        } else
        #endif
        if (likely(PyUnicode_Check(key))) {
            while (*name) {
                int cmp = (**name == key) ? 0 :
                #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
                    (__Pyx_PyUnicode_GET_LENGTH(**name) != __Pyx_PyUnicode_GET_LENGTH(key)) ? 1 :
                #endif
                    PyUnicode_Compare(**name, key);
                if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
                if (cmp == 0) {
                    values[name-argnames] = value;
                    break;
                }
                name++;
            }
            if (*name) continue;
            else {
                PyObject*** argname = argnames;
                while (argname != first_kw_arg) {
                    int cmp = (**argname == key) ? 0 :
                    #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
                        (__Pyx_PyUnicode_GET_LENGTH(**argname) != __Pyx_PyUnicode_GET_LENGTH(key)) ? 1 :
                    #endif
                        PyUnicode_Compare(**argname, key);
                    if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
                    if (cmp == 0) goto arg_passed_twice;
                    argname++;
                }
            }
        } else
            goto invalid_keyword_type;
        if (kwds2) {
            if (unlikely(PyDict_SetItem(kwds2, key, value))) goto bad;
        } else {
            goto invalid_keyword;
        }
    }
    return 0;
arg_passed_twice:
    __Pyx_RaiseDoubleKeywordsError(function_name, key);
    goto bad;
invalid_keyword_type:
    PyErr_Format(PyExc_TypeError,
        "%.200s() keywords must be strings", function_name);
    goto bad;
invalid_keyword:
    PyErr_Format(PyExc_TypeError,
    #if PY_MAJOR_VERSION < 3
        "%.200s() got an unexpected keyword argument '%.200s'",
        function_name, PyString_AsString(key));
    #else
        "%s() got an unexpected keyword argument '%U'",
        function_name, key);
    #endif
bad:
    return -1;
}

/* ArgTypeTest */
static int __Pyx__ArgTypeTest(PyObject *obj, PyTypeObject *type, const char *name, int exact)
{
    if (unlikely(!type)) {
        PyErr_SetString(PyExc_SystemError, "Missing type object");
        return 0;
    }
    else if (exact) {
        #if PY_MAJOR_VERSION == 2
        if ((type == &PyBaseString_Type) && likely(__Pyx_PyBaseString_CheckExact(obj))) return 1;
        #endif
    }
    else {
        if (likely(__Pyx_TypeCheck(obj, type))) return 1;
    }
    PyErr_Format(PyExc_TypeError,
        "Argument '%.200s' has incorrect type (expected %.200s, got %.200s)",
        name, type->tp_name, Py_TYPE(obj)->tp_name);
    return 0;
}

/* BytesEquals */
static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals) {
#if CYTHON_COMPILING_IN_PYPY
    return PyObject_RichCompareBool(s1, s2, equals);
#else
    if (s1 == s2) {
        return (equals == Py_EQ);
    } else if (PyBytes_CheckExact(s1) & PyBytes_CheckExact(s2)) {
        const char *ps1, *ps2;
        Py_ssize_t length = PyBytes_GET_SIZE(s1);
        if (length != PyBytes_GET_SIZE(s2))
            return (equals == Py_NE);
        ps1 = PyBytes_AS_STRING(s1);
        ps2 = PyBytes_AS_STRING(s2);
        if (ps1[0] != ps2[0]) {
            return (equals == Py_NE);
        } else if (length == 1) {
            return (equals == Py_EQ);
        } else {
            int result;
#if CYTHON_USE_UNICODE_INTERNALS
            Py_hash_t hash1, hash2;
            hash1 = ((PyBytesObject*)s1)->ob_shash;
            hash2 = ((PyBytesObject*)s2)->ob_shash;
            if (hash1 != hash2 && hash1 != -1 && hash2 != -1) {
                return (equals == Py_NE);
            }
#endif
            result = memcmp(ps1, ps2, (size_t)length);
            return (equals == Py_EQ) ? (result == 0) : (result != 0);
        }
    } else if ((s1 == Py_None) & PyBytes_CheckExact(s2)) {
        return (equals == Py_NE);
    } else if ((s2 == Py_None) & PyBytes_CheckExact(s1)) {
        return (equals == Py_NE);
    } else {
        int result;
        PyObject* py_result = PyObject_RichCompare(s1, s2, equals);
        if (!py_result)
            return -1;
        result = __Pyx_PyObject_IsTrue(py_result);
        Py_DECREF(py_result);
        return result;
    }
#endif
}

/* UnicodeEquals */
static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals) {
#if CYTHON_COMPILING_IN_PYPY
    return PyObject_RichCompareBool(s1, s2, equals);
#else
#if PY_MAJOR_VERSION < 3
    PyObject* owned_ref = NULL;
#endif
    int s1_is_unicode, s2_is_unicode;
    if (s1 == s2) {
        goto return_eq;
    }
    s1_is_unicode = PyUnicode_CheckExact(s1);
    s2_is_unicode = PyUnicode_CheckExact(s2);
#if PY_MAJOR_VERSION < 3
    if ((s1_is_unicode & (!s2_is_unicode)) && PyString_CheckExact(s2)) {
        owned_ref = PyUnicode_FromObject(s2);
        if (unlikely(!owned_ref))
            return -1;
        s2 = owned_ref;
        s2_is_unicode = 1;
    } else if ((s2_is_unicode & (!s1_is_unicode)) && PyString_CheckExact(s1)) {
        owned_ref = PyUnicode_FromObject(s1);
        if (unlikely(!owned_ref))
            return -1;
        s1 = owned_ref;
        s1_is_unicode = 1;
    } else if (((!s2_is_unicode) & (!s1_is_unicode))) {
        return __Pyx_PyBytes_Equals(s1, s2, equals);
    }
#endif
    if (s1_is_unicode & s2_is_unicode) {
        Py_ssize_t length;
        int kind;
        void *data1, *data2;
        if (unlikely(__Pyx_PyUnicode_READY(s1) < 0) || unlikely(__Pyx_PyUnicode_READY(s2) < 0))
            return -1;
        length = __Pyx_PyUnicode_GET_LENGTH(s1);
        if (length != __Pyx_PyUnicode_GET_LENGTH(s2)) {
            goto return_ne;
        }
#if CYTHON_USE_UNICODE_INTERNALS
        {
            Py_hash_t hash1, hash2;
        #if CYTHON_PEP393_ENABLED
            hash1 = ((PyASCIIObject*)s1)->hash;
            hash2 = ((PyASCIIObject*)s2)->hash;
        #else
            hash1 = ((PyUnicodeObject*)s1)->hash;
            hash2 = ((PyUnicodeObject*)s2)->hash;
        #endif
            if (hash1 != hash2 && hash1 != -1 && hash2 != -1) {
                goto return_ne;
            }
        }
#endif
        kind = __Pyx_PyUnicode_KIND(s1);
        if (kind != __Pyx_PyUnicode_KIND(s2)) {
            goto return_ne;
        }
        data1 = __Pyx_PyUnicode_DATA(s1);
        data2 = __Pyx_PyUnicode_DATA(s2);
        if (__Pyx_PyUnicode_READ(kind, data1, 0) != __Pyx_PyUnicode_READ(kind, data2, 0)) {
            goto return_ne;
        } else if (length == 1) {
            goto return_eq;
        } else {
            int result = memcmp(data1, data2, (size_t)(length * kind));
            #if PY_MAJOR_VERSION < 3
            Py_XDECREF(owned_ref);
            #endif
            return (equals == Py_EQ) ? (result == 0) : (result != 0);
        }
    } else if ((s1 == Py_None) & s2_is_unicode) {
        goto return_ne;
    } else if ((s2 == Py_None) & s1_is_unicode) {
        goto return_ne;
    } else {
        int result;
        PyObject* py_result = PyObject_RichCompare(s1, s2, equals);
        #if PY_MAJOR_VERSION < 3
        Py_XDECREF(owned_ref);
        #endif
        if (!py_result)
            return -1;
        result = __Pyx_PyObject_IsTrue(py_result);
        Py_DECREF(py_result);
        return result;
    }
return_eq:
    #if PY_MAJOR_VERSION < 3
    Py_XDECREF(owned_ref);
    #endif
    return (equals == Py_EQ);
return_ne:
    #if PY_MAJOR_VERSION < 3
    Py_XDECREF(owned_ref);
    #endif
    return (equals == Py_NE);
#endif
}

/* PyFloatBinop */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyFloat_TrueDivideObjC(PyObject *op1, PyObject *op2, double floatval, int inplace, int zerodivision_check) {
    const double b = floatval;
    double a, result;
    (void)inplace;
    (void)zerodivision_check;
    if (likely(PyFloat_CheckExact(op1))) {
        a = PyFloat_AS_DOUBLE(op1);
        
    } else
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        a = (double) PyInt_AS_LONG(op1);
        
    } else
    #endif
    if (likely(PyLong_CheckExact(op1))) {
        #if CYTHON_USE_PYLONG_INTERNALS
        const digit* digits = ((PyLongObject*)op1)->ob_digit;
        const Py_ssize_t size = Py_SIZE(op1);
        switch (size) {
            case  0: a = 0.0; break;
            case -1: a = -(double) digits[0]; break;
            case  1: a = (double) digits[0]; break;
            case -2:
            case 2:
                if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT && ((8 * sizeof(unsigned long) < 53) || (1 * PyLong_SHIFT < 53))) {
                    a = (double) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                    if ((8 * sizeof(unsigned long) < 53) || (2 * PyLong_SHIFT < 53) || (a < (double) ((PY_LONG_LONG)1 << 53))) {
                        if (size == -2)
                            a = -a;
                        break;
                    }
                }
                CYTHON_FALLTHROUGH;
            case -3:
            case 3:
                if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT && ((8 * sizeof(unsigned long) < 53) || (2 * PyLong_SHIFT < 53))) {
                    a = (double) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                    if ((8 * sizeof(unsigned long) < 53) || (3 * PyLong_SHIFT < 53) || (a < (double) ((PY_LONG_LONG)1 << 53))) {
                        if (size == -3)
                            a = -a;
                        break;
                    }
                }
                CYTHON_FALLTHROUGH;
            case -4:
            case 4:
                if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT && ((8 * sizeof(unsigned long) < 53) || (3 * PyLong_SHIFT < 53))) {
                    a = (double) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                    if ((8 * sizeof(unsigned long) < 53) || (4 * PyLong_SHIFT < 53) || (a < (double) ((PY_LONG_LONG)1 << 53))) {
                        if (size == -4)
                            a = -a;
                        break;
                    }
                }
                CYTHON_FALLTHROUGH;
            default:
        #else
        {
        #endif
            a = PyLong_AsDouble(op1);
            if (unlikely(a == -1.0 && PyErr_Occurred())) return NULL;
            
        }
    } else {
        return (inplace ? PyNumber_InPlaceTrueDivide : PyNumber_TrueDivide)(op1, op2);
    }
        
        PyFPE_START_PROTECT("divide", return NULL)
        result = a / b;
        PyFPE_END_PROTECT(result)
        return PyFloat_FromDouble(result);
}
#endif

/* PyDictVersioning */
  #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj) {
    PyObject *dict = Py_TYPE(obj)->tp_dict;
    return likely(dict) ? __PYX_GET_DICT_VERSION(dict) : 0;
}
static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj) {
    PyObject **dictptr = NULL;
    Py_ssize_t offset = Py_TYPE(obj)->tp_dictoffset;
    if (offset) {
#if CYTHON_COMPILING_IN_CPYTHON
        dictptr = (likely(offset > 0)) ? (PyObject **) ((char *)obj + offset) : _PyObject_GetDictPtr(obj);
#else
        dictptr = _PyObject_GetDictPtr(obj);
#endif
    }
    return (dictptr && *dictptr) ? __PYX_GET_DICT_VERSION(*dictptr) : 0;
}
static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version) {
    PyObject *dict = Py_TYPE(obj)->tp_dict;
    if (unlikely(!dict) || unlikely(tp_dict_version != __PYX_GET_DICT_VERSION(dict)))
        return 0;
    return obj_dict_version == __Pyx_get_object_dict_version(obj);
}
#endif

/* GetModuleGlobalName */
  #if CYTHON_USE_DICT_VERSIONS
static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value)
#else
static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name)
#endif
{
    PyObject *result;
#if !CYTHON_AVOID_BORROWED_REFS
#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1
    result = _PyDict_GetItem_KnownHash(__pyx_d, name, ((PyASCIIObject *) name)->hash);
    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
    if (likely(result)) {
        return __Pyx_NewRef(result);
    } else if (unlikely(PyErr_Occurred())) {
        return NULL;
    }
#else
    result = PyDict_GetItem(__pyx_d, name);
    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
    if (likely(result)) {
        return __Pyx_NewRef(result);
    }
#endif
#else
    result = PyObject_GetItem(__pyx_d, name);
    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
    if (likely(result)) {
        return __Pyx_NewRef(result);
    }
    PyErr_Clear();
#endif
    return __Pyx_GetBuiltinName(name);
}

/* PyFunctionFastCall */
  #if CYTHON_FAST_PYCALL
static PyObject* __Pyx_PyFunction_FastCallNoKw(PyCodeObject *co, PyObject **args, Py_ssize_t na,
                                               PyObject *globals) {
    PyFrameObject *f;
    PyThreadState *tstate = __Pyx_PyThreadState_Current;
    PyObject **fastlocals;
    Py_ssize_t i;
    PyObject *result;
    assert(globals != NULL);
    /* XXX Perhaps we should create a specialized
       PyFrame_New() that doesn't take locals, but does
       take builtins without sanity checking them.
       */
    assert(tstate != NULL);
    f = PyFrame_New(tstate, co, globals, NULL);
    if (f == NULL) {
        return NULL;
    }
    fastlocals = __Pyx_PyFrame_GetLocalsplus(f);
    for (i = 0; i < na; i++) {
        Py_INCREF(*args);
        fastlocals[i] = *args++;
    }
    result = PyEval_EvalFrameEx(f,0);
    ++tstate->recursion_depth;
    Py_DECREF(f);
    --tstate->recursion_depth;
    return result;
}
#if 1 || PY_VERSION_HEX < 0x030600B1
static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs) {
    PyCodeObject *co = (PyCodeObject *)PyFunction_GET_CODE(func);
    PyObject *globals = PyFunction_GET_GLOBALS(func);
    PyObject *argdefs = PyFunction_GET_DEFAULTS(func);
    PyObject *closure;
#if PY_MAJOR_VERSION >= 3
    PyObject *kwdefs;
#endif
    PyObject *kwtuple, **k;
    PyObject **d;
    Py_ssize_t nd;
    Py_ssize_t nk;
    PyObject *result;
    assert(kwargs == NULL || PyDict_Check(kwargs));
    nk = kwargs ? PyDict_Size(kwargs) : 0;
    if (Py_EnterRecursiveCall((char*)" while calling a Python object")) {
        return NULL;
    }
    if (
#if PY_MAJOR_VERSION >= 3
            co->co_kwonlyargcount == 0 &&
#endif
            likely(kwargs == NULL || nk == 0) &&
            co->co_flags == (CO_OPTIMIZED | CO_NEWLOCALS | CO_NOFREE)) {
        if (argdefs == NULL && co->co_argcount == nargs) {
            result = __Pyx_PyFunction_FastCallNoKw(co, args, nargs, globals);
            goto done;
        }
        else if (nargs == 0 && argdefs != NULL
                 && co->co_argcount == Py_SIZE(argdefs)) {
            /* function called with no arguments, but all parameters have
               a default value: use default values as arguments .*/
            args = &PyTuple_GET_ITEM(argdefs, 0);
            result =__Pyx_PyFunction_FastCallNoKw(co, args, Py_SIZE(argdefs), globals);
            goto done;
        }
    }
    if (kwargs != NULL) {
        Py_ssize_t pos, i;
        kwtuple = PyTuple_New(2 * nk);
        if (kwtuple == NULL) {
            result = NULL;
            goto done;
        }
        k = &PyTuple_GET_ITEM(kwtuple, 0);
        pos = i = 0;
        while (PyDict_Next(kwargs, &pos, &k[i], &k[i+1])) {
            Py_INCREF(k[i]);
            Py_INCREF(k[i+1]);
            i += 2;
        }
        nk = i / 2;
    }
    else {
        kwtuple = NULL;
        k = NULL;
    }
    closure = PyFunction_GET_CLOSURE(func);
#if PY_MAJOR_VERSION >= 3
    kwdefs = PyFunction_GET_KW_DEFAULTS(func);
#endif
    if (argdefs != NULL) {
        d = &PyTuple_GET_ITEM(argdefs, 0);
        nd = Py_SIZE(argdefs);
    }
    else {
        d = NULL;
        nd = 0;
    }
#if PY_MAJOR_VERSION >= 3
    result = PyEval_EvalCodeEx((PyObject*)co, globals, (PyObject *)NULL,
                               args, (int)nargs,
                               k, (int)nk,
                               d, (int)nd, kwdefs, closure);
#else
    result = PyEval_EvalCodeEx(co, globals, (PyObject *)NULL,
                               args, (int)nargs,
                               k, (int)nk,
                               d, (int)nd, closure);
#endif
    Py_XDECREF(kwtuple);
done:
    Py_LeaveRecursiveCall();
    return result;
}
#endif
#endif

/* PyObjectCall */
  #if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
    PyObject *result;
    ternaryfunc call = Py_TYPE(func)->tp_call;
    if (unlikely(!call))
        return PyObject_Call(func, arg, kw);
    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
        return NULL;
    result = (*call)(func, arg, kw);
    Py_LeaveRecursiveCall();
    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
        PyErr_SetString(
            PyExc_SystemError,
            "NULL result without error in PyObject_Call");
    }
    return result;
}
#endif

/* PyObjectCallMethO */
  #if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg) {
    PyObject *self, *result;
    PyCFunction cfunc;
    cfunc = PyCFunction_GET_FUNCTION(func);
    self = PyCFunction_GET_SELF(func);
    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
        return NULL;
    result = cfunc(self, arg);
    Py_LeaveRecursiveCall();
    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
        PyErr_SetString(
            PyExc_SystemError,
            "NULL result without error in PyObject_Call");
    }
    return result;
}
#endif

/* PyObjectCallNoArg */
  #if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func) {
#if CYTHON_FAST_PYCALL
    if (PyFunction_Check(func)) {
        return __Pyx_PyFunction_FastCall(func, NULL, 0);
    }
#endif
#ifdef __Pyx_CyFunction_USED
    if (likely(PyCFunction_Check(func) || __Pyx_CyFunction_Check(func)))
#else
    if (likely(PyCFunction_Check(func)))
#endif
    {
        if (likely(PyCFunction_GET_FLAGS(func) & METH_NOARGS)) {
            return __Pyx_PyObject_CallMethO(func, NULL);
        }
    }
    return __Pyx_PyObject_Call(func, __pyx_empty_tuple, NULL);
}
#endif

/* PyCFunctionFastCall */
  #if CYTHON_FAST_PYCCALL
static CYTHON_INLINE PyObject * __Pyx_PyCFunction_FastCall(PyObject *func_obj, PyObject **args, Py_ssize_t nargs) {
    PyCFunctionObject *func = (PyCFunctionObject*)func_obj;
    PyCFunction meth = PyCFunction_GET_FUNCTION(func);
    PyObject *self = PyCFunction_GET_SELF(func);
    int flags = PyCFunction_GET_FLAGS(func);
    assert(PyCFunction_Check(func));
    assert(METH_FASTCALL == (flags & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_KEYWORDS | METH_STACKLESS)));
    assert(nargs >= 0);
    assert(nargs == 0 || args != NULL);
    /* _PyCFunction_FastCallDict() must not be called with an exception set,
       because it may clear it (directly or indirectly) and so the
       caller loses its exception */
    assert(!PyErr_Occurred());
    if ((PY_VERSION_HEX < 0x030700A0) || unlikely(flags & METH_KEYWORDS)) {
        return (*((__Pyx_PyCFunctionFastWithKeywords)(void*)meth)) (self, args, nargs, NULL);
    } else {
        return (*((__Pyx_PyCFunctionFast)(void*)meth)) (self, args, nargs);
    }
}
#endif

/* PyObjectCallOneArg */
  #if CYTHON_COMPILING_IN_CPYTHON
static PyObject* __Pyx__PyObject_CallOneArg(PyObject *func, PyObject *arg) {
    PyObject *result;
    PyObject *args = PyTuple_New(1);
    if (unlikely(!args)) return NULL;
    Py_INCREF(arg);
    PyTuple_SET_ITEM(args, 0, arg);
    result = __Pyx_PyObject_Call(func, args, NULL);
    Py_DECREF(args);
    return result;
}
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
#if CYTHON_FAST_PYCALL
    if (PyFunction_Check(func)) {
        return __Pyx_PyFunction_FastCall(func, &arg, 1);
    }
#endif
    if (likely(PyCFunction_Check(func))) {
        if (likely(PyCFunction_GET_FLAGS(func) & METH_O)) {
            return __Pyx_PyObject_CallMethO(func, arg);
#if CYTHON_FAST_PYCCALL
        } else if (__Pyx_PyFastCFunction_Check(func)) {
            return __Pyx_PyCFunction_FastCall(func, &arg, 1);
#endif
        }
    }
    return __Pyx__PyObject_CallOneArg(func, arg);
}
#else
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
    PyObject *result;
    PyObject *args = PyTuple_Pack(1, arg);
    if (unlikely(!args)) return NULL;
    result = __Pyx_PyObject_Call(func, args, NULL);
    Py_DECREF(args);
    return result;
}
#endif

/* PyIntBinop */
  #if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_SubtractObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, int inplace, int zerodivision_check) {
    (void)inplace;
    (void)zerodivision_check;
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long x;
        long a = PyInt_AS_LONG(op1);
            x = (long)((unsigned long)a - b);
            if (likely((x^a) >= 0 || (x^~b) >= 0))
                return PyInt_FromLong(x);
            return PyLong_Type.tp_as_number->nb_subtract(op1, op2);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        const long b = intval;
        long a, x;
#ifdef HAVE_LONG_LONG
        const PY_LONG_LONG llb = intval;
        PY_LONG_LONG lla, llx;
#endif
        const digit* digits = ((PyLongObject*)op1)->ob_digit;
        const Py_ssize_t size = Py_SIZE(op1);
        if (likely(__Pyx_sst_abs(size) <= 1)) {
            a = likely(size) ? digits[0] : 0;
            if (size == -1) a = -a;
        } else {
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_subtract(op1, op2);
            }
        }
                x = a - b;
            return PyLong_FromLong(x);
#ifdef HAVE_LONG_LONG
        long_long:
                llx = lla - llb;
            return PyLong_FromLongLong(llx);
#endif
        
        
    }
    #endif
    if (PyFloat_CheckExact(op1)) {
        const long b = intval;
        double a = PyFloat_AS_DOUBLE(op1);
            double result;
            PyFPE_START_PROTECT("subtract", return NULL)
            result = ((double)a) - (double)b;
            PyFPE_END_PROTECT(result)
            return PyFloat_FromDouble(result);
    }
    return (inplace ? PyNumber_InPlaceSubtract : PyNumber_Subtract)(op1, op2);
}
#endif

/* PyIntBinop */
  #if !CYTHON_COMPILING_IN_PYPY
#if PY_MAJOR_VERSION < 3 || CYTHON_USE_PYLONG_INTERNALS
#define __Pyx_PyInt_TrueDivideObjC_ZeroDivisionError(operand)\
    if (unlikely(zerodivision_check && ((operand) == 0))) {\
        PyErr_SetString(PyExc_ZeroDivisionError, "integer division by zero");\
        return NULL;\
    }
#endif
static PyObject* __Pyx_PyInt_TrueDivideObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, int inplace, int zerodivision_check) {
    (void)inplace;
    (void)zerodivision_check;
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long a = PyInt_AS_LONG(op1);
            __Pyx_PyInt_TrueDivideObjC_ZeroDivisionError(b)
            if (8 * sizeof(long) <= 53 || likely(labs(a) <= ((PY_LONG_LONG)1 << 53))) {
                return PyFloat_FromDouble((double)a / (double)b);
            }
            return PyInt_Type.tp_as_number->nb_true_divide(op1, op2);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        const long b = intval;
        long a, x;
        const digit* digits = ((PyLongObject*)op1)->ob_digit;
        const Py_ssize_t size = Py_SIZE(op1);
        if (likely(__Pyx_sst_abs(size) <= 1)) {
            a = likely(size) ? digits[0] : 0;
            if (size == -1) a = -a;
        } else {
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT && 1 * PyLong_SHIFT < 53) {
                        a = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT && 1 * PyLong_SHIFT < 53) {
                        a = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT && 2 * PyLong_SHIFT < 53) {
                        a = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT && 2 * PyLong_SHIFT < 53) {
                        a = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT && 3 * PyLong_SHIFT < 53) {
                        a = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT && 3 * PyLong_SHIFT < 53) {
                        a = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_true_divide(op1, op2);
            }
        }
                __Pyx_PyInt_TrueDivideObjC_ZeroDivisionError(b)
                if ((8 * sizeof(long) <= 53 || likely(labs(a) <= ((PY_LONG_LONG)1 << 53)))
                        || __Pyx_sst_abs(size) <= 52 / PyLong_SHIFT) {
                    return PyFloat_FromDouble((double)a / (double)b);
                }
                return PyLong_Type.tp_as_number->nb_true_divide(op1, op2);
            return PyLong_FromLong(x);
        
    }
    #endif
    if (PyFloat_CheckExact(op1)) {
        const long b = intval;
        double a = PyFloat_AS_DOUBLE(op1);
            double result;
            if (unlikely(zerodivision_check && b == 0)) {
                PyErr_SetString(PyExc_ZeroDivisionError, "float division by zero");
                return NULL;
            }
            PyFPE_START_PROTECT("divide", return NULL)
            result = ((double)a) / (double)b;
            PyFPE_END_PROTECT(result)
            return PyFloat_FromDouble(result);
    }
    return (inplace ? PyNumber_InPlaceTrueDivide : PyNumber_TrueDivide)(op1, op2);
}
#endif

/* PyObjectCall2Args */
  static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2) {
    PyObject *args, *result = NULL;
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(function)) {
        PyObject *args[2] = {arg1, arg2};
        return __Pyx_PyFunction_FastCall(function, args, 2);
    }
    #endif
    #if CYTHON_FAST_PYCCALL
    if (__Pyx_PyFastCFunction_Check(function)) {
        PyObject *args[2] = {arg1, arg2};
        return __Pyx_PyCFunction_FastCall(function, args, 2);
    }
    #endif
    args = PyTuple_New(2);
    if (unlikely(!args)) goto done;
    Py_INCREF(arg1);
    PyTuple_SET_ITEM(args, 0, arg1);
    Py_INCREF(arg2);
    PyTuple_SET_ITEM(args, 1, arg2);
    Py_INCREF(function);
    result = __Pyx_PyObject_Call(function, args, NULL);
    Py_DECREF(args);
    Py_DECREF(function);
done:
    return result;
}

/* PyIntBinop */
  #if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_AddObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, int inplace, int zerodivision_check) {
    (void)inplace;
    (void)zerodivision_check;
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long x;
        long a = PyInt_AS_LONG(op1);
            x = (long)((unsigned long)a + b);
            if (likely((x^a) >= 0 || (x^b) >= 0))
                return PyInt_FromLong(x);
            return PyLong_Type.tp_as_number->nb_add(op1, op2);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        const long b = intval;
        long a, x;
#ifdef HAVE_LONG_LONG
        const PY_LONG_LONG llb = intval;
        PY_LONG_LONG lla, llx;
#endif
        const digit* digits = ((PyLongObject*)op1)->ob_digit;
        const Py_ssize_t size = Py_SIZE(op1);
        if (likely(__Pyx_sst_abs(size) <= 1)) {
            a = likely(size) ? digits[0] : 0;
            if (size == -1) a = -a;
        } else {
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
#ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
#endif
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_add(op1, op2);
            }
        }
                x = a + b;
            return PyLong_FromLong(x);
#ifdef HAVE_LONG_LONG
        long_long:
                llx = lla + llb;
            return PyLong_FromLongLong(llx);
#endif
        
        
    }
    #endif
    if (PyFloat_CheckExact(op1)) {
        const long b = intval;
        double a = PyFloat_AS_DOUBLE(op1);
            double result;
            PyFPE_START_PROTECT("add", return NULL)
            result = ((double)a) + (double)b;
            PyFPE_END_PROTECT(result)
            return PyFloat_FromDouble(result);
    }
    return (inplace ? PyNumber_InPlaceAdd : PyNumber_Add)(op1, op2);
}
#endif

/* RaiseTooManyValuesToUnpack */
  static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected) {
    PyErr_Format(PyExc_ValueError,
                 "too many values to unpack (expected %" CYTHON_FORMAT_SSIZE_T "d)", expected);
}

/* RaiseNeedMoreValuesToUnpack */
  static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index) {
    PyErr_Format(PyExc_ValueError,
                 "need more than %" CYTHON_FORMAT_SSIZE_T "d value%.1s to unpack",
                 index, (index == 1) ? "" : "s");
}

/* IterFinish */
  static CYTHON_INLINE int __Pyx_IterFinish(void) {
#if CYTHON_FAST_THREAD_STATE
    PyThreadState *tstate = __Pyx_PyThreadState_Current;
    PyObject* exc_type = tstate->curexc_type;
    if (unlikely(exc_type)) {
        if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) {
            PyObject *exc_value, *exc_tb;
            exc_value = tstate->curexc_value;
            exc_tb = tstate->curexc_traceback;
            tstate->curexc_type = 0;
            tstate->curexc_value = 0;
            tstate->curexc_traceback = 0;
            Py_DECREF(exc_type);
            Py_XDECREF(exc_value);
            Py_XDECREF(exc_tb);
            return 0;
        } else {
            return -1;
        }
    }
    return 0;
#else
    if (unlikely(PyErr_Occurred())) {
        if (likely(PyErr_ExceptionMatches(PyExc_StopIteration))) {
            PyErr_Clear();
            return 0;
        } else {
            return -1;
        }
    }
    return 0;
#endif
}

/* UnpackItemEndCheck */
  static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected) {
    if (unlikely(retval)) {
        Py_DECREF(retval);
        __Pyx_RaiseTooManyValuesError(expected);
        return -1;
    } else {
        return __Pyx_IterFinish();
    }
    return 0;
}

/* ExtTypeTest */
  static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
    if (unlikely(!type)) {
        PyErr_SetString(PyExc_SystemError, "Missing type object");
        return 0;
    }
    if (likely(__Pyx_TypeCheck(obj, type)))
        return 1;
    PyErr_Format(PyExc_TypeError, "Cannot convert %.200s to %.200s",
                 Py_TYPE(obj)->tp_name, type->tp_name);
    return 0;
}

/* IsLittleEndian */
  static CYTHON_INLINE int __Pyx_Is_Little_Endian(void)
{
  union {
    uint32_t u32;
    uint8_t u8[4];
  } S;
  S.u32 = 0x01020304;
  return S.u8[0] == 4;
}

/* BufferFormatCheck */
  static void __Pyx_BufFmt_Init(__Pyx_BufFmt_Context* ctx,
                              __Pyx_BufFmt_StackElem* stack,
                              __Pyx_TypeInfo* type) {
  stack[0].field = &ctx->root;
  stack[0].parent_offset = 0;
  ctx->root.type = type;
  ctx->root.name = "buffer dtype";
  ctx->root.offset = 0;
  ctx->head = stack;
  ctx->head->field = &ctx->root;
  ctx->fmt_offset = 0;
  ctx->head->parent_offset = 0;
  ctx->new_packmode = '@';
  ctx->enc_packmode = '@';
  ctx->new_count = 1;
  ctx->enc_count = 0;
  ctx->enc_type = 0;
  ctx->is_complex = 0;
  ctx->is_valid_array = 0;
  ctx->struct_alignment = 0;
  while (type->typegroup == 'S') {
    ++ctx->head;
    ctx->head->field = type->fields;
    ctx->head->parent_offset = 0;
    type = type->fields->type;
  }
}
static int __Pyx_BufFmt_ParseNumber(const char** ts) {
    int count;
    const char* t = *ts;
    if (*t < '0' || *t > '9') {
      return -1;
    } else {
        count = *t++ - '0';
        while (*t >= '0' && *t <= '9') {
            count *= 10;
            count += *t++ - '0';
        }
    }
    *ts = t;
    return count;
}
static int __Pyx_BufFmt_ExpectNumber(const char **ts) {
    int number = __Pyx_BufFmt_ParseNumber(ts);
    if (number == -1)
        PyErr_Format(PyExc_ValueError,\
                     "Does not understand character buffer dtype format string ('%c')", **ts);
    return number;
}
static void __Pyx_BufFmt_RaiseUnexpectedChar(char ch) {
  PyErr_Format(PyExc_ValueError,
               "Unexpected format string character: '%c'", ch);
}
static const char* __Pyx_BufFmt_DescribeTypeChar(char ch, int is_complex) {
  switch (ch) {
    case '?': return "'bool'";
    case 'c': return "'char'";
    case 'b': return "'signed char'";
    case 'B': return "'unsigned char'";
    case 'h': return "'short'";
    case 'H': return "'unsigned short'";
    case 'i': return "'int'";
    case 'I': return "'unsigned int'";
    case 'l': return "'long'";
    case 'L': return "'unsigned long'";
    case 'q': return "'long long'";
    case 'Q': return "'unsigned long long'";
    case 'f': return (is_complex ? "'complex float'" : "'float'");
    case 'd': return (is_complex ? "'complex double'" : "'double'");
    case 'g': return (is_complex ? "'complex long double'" : "'long double'");
    case 'T': return "a struct";
    case 'O': return "Python object";
    case 'P': return "a pointer";
    case 's': case 'p': return "a string";
    case 0: return "end";
    default: return "unparseable format string";
  }
}
static size_t __Pyx_BufFmt_TypeCharToStandardSize(char ch, int is_complex) {
  switch (ch) {
    case '?': case 'c': case 'b': case 'B': case 's': case 'p': return 1;
    case 'h': case 'H': return 2;
    case 'i': case 'I': case 'l': case 'L': return 4;
    case 'q': case 'Q': return 8;
    case 'f': return (is_complex ? 8 : 4);
    case 'd': return (is_complex ? 16 : 8);
    case 'g': {
      PyErr_SetString(PyExc_ValueError, "Python does not define a standard format string size for long double ('g')..");
      return 0;
    }
    case 'O': case 'P': return sizeof(void*);
    default:
      __Pyx_BufFmt_RaiseUnexpectedChar(ch);
      return 0;
    }
}
static size_t __Pyx_BufFmt_TypeCharToNativeSize(char ch, int is_complex) {
  switch (ch) {
    case '?': case 'c': case 'b': case 'B': case 's': case 'p': return 1;
    case 'h': case 'H': return sizeof(short);
    case 'i': case 'I': return sizeof(int);
    case 'l': case 'L': return sizeof(long);
    #ifdef HAVE_LONG_LONG
    case 'q': case 'Q': return sizeof(PY_LONG_LONG);
    #endif
    case 'f': return sizeof(float) * (is_complex ? 2 : 1);
    case 'd': return sizeof(double) * (is_complex ? 2 : 1);
    case 'g': return sizeof(long double) * (is_complex ? 2 : 1);
    case 'O': case 'P': return sizeof(void*);
    default: {
      __Pyx_BufFmt_RaiseUnexpectedChar(ch);
      return 0;
    }
  }
}
typedef struct { char c; short x; } __Pyx_st_short;
typedef struct { char c; int x; } __Pyx_st_int;
typedef struct { char c; long x; } __Pyx_st_long;
typedef struct { char c; float x; } __Pyx_st_float;
typedef struct { char c; double x; } __Pyx_st_double;
typedef struct { char c; long double x; } __Pyx_st_longdouble;
typedef struct { char c; void *x; } __Pyx_st_void_p;
#ifdef HAVE_LONG_LONG
typedef struct { char c; PY_LONG_LONG x; } __Pyx_st_longlong;
#endif
static size_t __Pyx_BufFmt_TypeCharToAlignment(char ch, CYTHON_UNUSED int is_complex) {
  switch (ch) {
    case '?': case 'c': case 'b': case 'B': case 's': case 'p': return 1;
    case 'h': case 'H': return sizeof(__Pyx_st_short) - sizeof(short);
    case 'i': case 'I': return sizeof(__Pyx_st_int) - sizeof(int);
    case 'l': case 'L': return sizeof(__Pyx_st_long) - sizeof(long);
#ifdef HAVE_LONG_LONG
    case 'q': case 'Q': return sizeof(__Pyx_st_longlong) - sizeof(PY_LONG_LONG);
#endif
    case 'f': return sizeof(__Pyx_st_float) - sizeof(float);
    case 'd': return sizeof(__Pyx_st_double) - sizeof(double);
    case 'g': return sizeof(__Pyx_st_longdouble) - sizeof(long double);
    case 'P': case 'O': return sizeof(__Pyx_st_void_p) - sizeof(void*);
    default:
      __Pyx_BufFmt_RaiseUnexpectedChar(ch);
      return 0;
    }
}
/* These are for computing the padding at the end of the struct to align
   on the first member of the struct. This will probably the same as above,
   but we don't have any guarantees.
 */
typedef struct { short x; char c; } __Pyx_pad_short;
typedef struct { int x; char c; } __Pyx_pad_int;
typedef struct { long x; char c; } __Pyx_pad_long;
typedef struct { float x; char c; } __Pyx_pad_float;
typedef struct { double x; char c; } __Pyx_pad_double;
typedef struct { long double x; char c; } __Pyx_pad_longdouble;
typedef struct { void *x; char c; } __Pyx_pad_void_p;
#ifdef HAVE_LONG_LONG
typedef struct { PY_LONG_LONG x; char c; } __Pyx_pad_longlong;
#endif
static size_t __Pyx_BufFmt_TypeCharToPadding(char ch, CYTHON_UNUSED int is_complex) {
  switch (ch) {
    case '?': case 'c': case 'b': case 'B': case 's': case 'p': return 1;
    case 'h': case 'H': return sizeof(__Pyx_pad_short) - sizeof(short);
    case 'i': case 'I': return sizeof(__Pyx_pad_int) - sizeof(int);
    case 'l': case 'L': return sizeof(__Pyx_pad_long) - sizeof(long);
#ifdef HAVE_LONG_LONG
    case 'q': case 'Q': return sizeof(__Pyx_pad_longlong) - sizeof(PY_LONG_LONG);
#endif
    case 'f': return sizeof(__Pyx_pad_float) - sizeof(float);
    case 'd': return sizeof(__Pyx_pad_double) - sizeof(double);
    case 'g': return sizeof(__Pyx_pad_longdouble) - sizeof(long double);
    case 'P': case 'O': return sizeof(__Pyx_pad_void_p) - sizeof(void*);
    default:
      __Pyx_BufFmt_RaiseUnexpectedChar(ch);
      return 0;
    }
}
static char __Pyx_BufFmt_TypeCharToGroup(char ch, int is_complex) {
  switch (ch) {
    case 'c':
        return 'H';
    case 'b': case 'h': case 'i':
    case 'l': case 'q': case 's': case 'p':
        return 'I';
    case '?': case 'B': case 'H': case 'I': case 'L': case 'Q':
        return 'U';
    case 'f': case 'd': case 'g':
        return (is_complex ? 'C' : 'R');
    case 'O':
        return 'O';
    case 'P':
        return 'P';
    default: {
      __Pyx_BufFmt_RaiseUnexpectedChar(ch);
      return 0;
    }
  }
}
static void __Pyx_BufFmt_RaiseExpected(__Pyx_BufFmt_Context* ctx) {
  if (ctx->head == NULL || ctx->head->field == &ctx->root) {
    const char* expected;
    const char* quote;
    if (ctx->head == NULL) {
      expected = "end";
      quote = "";
    } else {
      expected = ctx->head->field->type->name;
      quote = "'";
    }
    PyErr_Format(PyExc_ValueError,
                 "Buffer dtype mismatch, expected %s%s%s but got %s",
                 quote, expected, quote,
                 __Pyx_BufFmt_DescribeTypeChar(ctx->enc_type, ctx->is_complex));
  } else {
    __Pyx_StructField* field = ctx->head->field;
    __Pyx_StructField* parent = (ctx->head - 1)->field;
    PyErr_Format(PyExc_ValueError,
                 "Buffer dtype mismatch, expected '%s' but got %s in '%s.%s'",
                 field->type->name, __Pyx_BufFmt_DescribeTypeChar(ctx->enc_type, ctx->is_complex),
                 parent->type->name, field->name);
  }
}
static int __Pyx_BufFmt_ProcessTypeChunk(__Pyx_BufFmt_Context* ctx) {
  char group;
  size_t size, offset, arraysize = 1;
  if (ctx->enc_type == 0) return 0;
  if (ctx->head->field->type->arraysize[0]) {
    int i, ndim = 0;
    if (ctx->enc_type == 's' || ctx->enc_type == 'p') {
        ctx->is_valid_array = ctx->head->field->type->ndim == 1;
        ndim = 1;
        if (ctx->enc_count != ctx->head->field->type->arraysize[0]) {
            PyErr_Format(PyExc_ValueError,
                         "Expected a dimension of size %zu, got %zu",
                         ctx->head->field->type->arraysize[0], ctx->enc_count);
            return -1;
        }
    }
    if (!ctx->is_valid_array) {
      PyErr_Format(PyExc_ValueError, "Expected %d dimensions, got %d",
                   ctx->head->field->type->ndim, ndim);
      return -1;
    }
    for (i = 0; i < ctx->head->field->type->ndim; i++) {
      arraysize *= ctx->head->field->type->arraysize[i];
    }
    ctx->is_valid_array = 0;
    ctx->enc_count = 1;
  }
  group = __Pyx_BufFmt_TypeCharToGroup(ctx->enc_type, ctx->is_complex);
  do {
    __Pyx_StructField* field = ctx->head->field;
    __Pyx_TypeInfo* type = field->type;
    if (ctx->enc_packmode == '@' || ctx->enc_packmode == '^') {
      size = __Pyx_BufFmt_TypeCharToNativeSize(ctx->enc_type, ctx->is_complex);
    } else {
      size = __Pyx_BufFmt_TypeCharToStandardSize(ctx->enc_type, ctx->is_complex);
    }
    if (ctx->enc_packmode == '@') {
      size_t align_at = __Pyx_BufFmt_TypeCharToAlignment(ctx->enc_type, ctx->is_complex);
      size_t align_mod_offset;
      if (align_at == 0) return -1;
      align_mod_offset = ctx->fmt_offset % align_at;
      if (align_mod_offset > 0) ctx->fmt_offset += align_at - align_mod_offset;
      if (ctx->struct_alignment == 0)
          ctx->struct_alignment = __Pyx_BufFmt_TypeCharToPadding(ctx->enc_type,
                                                                 ctx->is_complex);
    }
    if (type->size != size || type->typegroup != group) {
      if (type->typegroup == 'C' && type->fields != NULL) {
        size_t parent_offset = ctx->head->parent_offset + field->offset;
        ++ctx->head;
        ctx->head->field = type->fields;
        ctx->head->parent_offset = parent_offset;
        continue;
      }
      if ((type->typegroup == 'H' || group == 'H') && type->size == size) {
      } else {
          __Pyx_BufFmt_RaiseExpected(ctx);
          return -1;
      }
    }
    offset = ctx->head->parent_offset + field->offset;
    if (ctx->fmt_offset != offset) {
      PyErr_Format(PyExc_ValueError,
                   "Buffer dtype mismatch; next field is at offset %" CYTHON_FORMAT_SSIZE_T "d but %" CYTHON_FORMAT_SSIZE_T "d expected",
                   (Py_ssize_t)ctx->fmt_offset, (Py_ssize_t)offset);
      return -1;
    }
    ctx->fmt_offset += size;
    if (arraysize)
      ctx->fmt_offset += (arraysize - 1) * size;
    --ctx->enc_count;
    while (1) {
      if (field == &ctx->root) {
        ctx->head = NULL;
        if (ctx->enc_count != 0) {
          __Pyx_BufFmt_RaiseExpected(ctx);
          return -1;
        }
        break;
      }
      ctx->head->field = ++field;
      if (field->type == NULL) {
        --ctx->head;
        field = ctx->head->field;
        continue;
      } else if (field->type->typegroup == 'S') {
        size_t parent_offset = ctx->head->parent_offset + field->offset;
        if (field->type->fields->type == NULL) continue;
        field = field->type->fields;
        ++ctx->head;
        ctx->head->field = field;
        ctx->head->parent_offset = parent_offset;
        break;
      } else {
        break;
      }
    }
  } while (ctx->enc_count);
  ctx->enc_type = 0;
  ctx->is_complex = 0;
  return 0;
}
static PyObject *
__pyx_buffmt_parse_array(__Pyx_BufFmt_Context* ctx, const char** tsp)
{
    const char *ts = *tsp;
    int i = 0, number, ndim;
    ++ts;
    if (ctx->new_count != 1) {
        PyErr_SetString(PyExc_ValueError,
                        "Cannot handle repeated arrays in format string");
        return NULL;
    }
    if (__Pyx_BufFmt_ProcessTypeChunk(ctx) == -1) return NULL;
    ndim = ctx->head->field->type->ndim;
    while (*ts && *ts != ')') {
        switch (*ts) {
            case ' ': case '\f': case '\r': case '\n': case '\t': case '\v':  continue;
            default:  break;
        }
        number = __Pyx_BufFmt_ExpectNumber(&ts);
        if (number == -1) return NULL;
        if (i < ndim && (size_t) number != ctx->head->field->type->arraysize[i])
            return PyErr_Format(PyExc_ValueError,
                        "Expected a dimension of size %zu, got %d",
                        ctx->head->field->type->arraysize[i], number);
        if (*ts != ',' && *ts != ')')
            return PyErr_Format(PyExc_ValueError,
                                "Expected a comma in format string, got '%c'", *ts);
        if (*ts == ',') ts++;
        i++;
    }
    if (i != ndim)
        return PyErr_Format(PyExc_ValueError, "Expected %d dimension(s), got %d",
                            ctx->head->field->type->ndim, i);
    if (!*ts) {
        PyErr_SetString(PyExc_ValueError,
                        "Unexpected end of format string, expected ')'");
        return NULL;
    }
    ctx->is_valid_array = 1;
    ctx->new_count = 1;
    *tsp = ++ts;
    return Py_None;
}
static const char* __Pyx_BufFmt_CheckString(__Pyx_BufFmt_Context* ctx, const char* ts) {
  int got_Z = 0;
  while (1) {
    switch(*ts) {
      case 0:
        if (ctx->enc_type != 0 && ctx->head == NULL) {
          __Pyx_BufFmt_RaiseExpected(ctx);
          return NULL;
        }
        if (__Pyx_BufFmt_ProcessTypeChunk(ctx) == -1) return NULL;
        if (ctx->head != NULL) {
          __Pyx_BufFmt_RaiseExpected(ctx);
          return NULL;
        }
        return ts;
      case ' ':
      case '\r':
      case '\n':
        ++ts;
        break;
      case '<':
        if (!__Pyx_Is_Little_Endian()) {
          PyErr_SetString(PyExc_ValueError, "Little-endian buffer not supported on big-endian compiler");
          return NULL;
        }
        ctx->new_packmode = '=';
        ++ts;
        break;
      case '>':
      case '!':
        if (__Pyx_Is_Little_Endian()) {
          PyErr_SetString(PyExc_ValueError, "Big-endian buffer not supported on little-endian compiler");
          return NULL;
        }
        ctx->new_packmode = '=';
        ++ts;
        break;
      case '=':
      case '@':
      case '^':
        ctx->new_packmode = *ts++;
        break;
      case 'T':
        {
          const char* ts_after_sub;
          size_t i, struct_count = ctx->new_count;
          size_t struct_alignment = ctx->struct_alignment;
          ctx->new_count = 1;
          ++ts;
          if (*ts != '{') {
            PyErr_SetString(PyExc_ValueError, "Buffer acquisition: Expected '{' after 'T'");
            return NULL;
          }
          if (__Pyx_BufFmt_ProcessTypeChunk(ctx) == -1) return NULL;
          ctx->enc_type = 0;
          ctx->enc_count = 0;
          ctx->struct_alignment = 0;
          ++ts;
          ts_after_sub = ts;
          for (i = 0; i != struct_count; ++i) {
            ts_after_sub = __Pyx_BufFmt_CheckString(ctx, ts);
            if (!ts_after_sub) return NULL;
          }
          ts = ts_after_sub;
          if (struct_alignment) ctx->struct_alignment = struct_alignment;
        }
        break;
      case '}':
        {
          size_t alignment = ctx->struct_alignment;
          ++ts;
          if (__Pyx_BufFmt_ProcessTypeChunk(ctx) == -1) return NULL;
          ctx->enc_type = 0;
          if (alignment && ctx->fmt_offset % alignment) {
            ctx->fmt_offset += alignment - (ctx->fmt_offset % alignment);
          }
        }
        return ts;
      case 'x':
        if (__Pyx_BufFmt_ProcessTypeChunk(ctx) == -1) return NULL;
        ctx->fmt_offset += ctx->new_count;
        ctx->new_count = 1;
        ctx->enc_count = 0;
        ctx->enc_type = 0;
        ctx->enc_packmode = ctx->new_packmode;
        ++ts;
        break;
      case 'Z':
        got_Z = 1;
        ++ts;
        if (*ts != 'f' && *ts != 'd' && *ts != 'g') {
          __Pyx_BufFmt_RaiseUnexpectedChar('Z');
          return NULL;
        }
        CYTHON_FALLTHROUGH;
      case '?': case 'c': case 'b': case 'B': case 'h': case 'H': case 'i': case 'I':
      case 'l': case 'L': case 'q': case 'Q':
      case 'f': case 'd': case 'g':
      case 'O': case 'p':
        if ((ctx->enc_type == *ts) && (got_Z == ctx->is_complex) &&
            (ctx->enc_packmode == ctx->new_packmode) && (!ctx->is_valid_array)) {
          ctx->enc_count += ctx->new_count;
          ctx->new_count = 1;
          got_Z = 0;
          ++ts;
          break;
        }
        CYTHON_FALLTHROUGH;
      case 's':
        if (__Pyx_BufFmt_ProcessTypeChunk(ctx) == -1) return NULL;
        ctx->enc_count = ctx->new_count;
        ctx->enc_packmode = ctx->new_packmode;
        ctx->enc_type = *ts;
        ctx->is_complex = got_Z;
        ++ts;
        ctx->new_count = 1;
        got_Z = 0;
        break;
      case ':':
        ++ts;
        while(*ts != ':') ++ts;
        ++ts;
        break;
      case '(':
        if (!__pyx_buffmt_parse_array(ctx, &ts)) return NULL;
        break;
      default:
        {
          int number = __Pyx_BufFmt_ExpectNumber(&ts);
          if (number == -1) return NULL;
          ctx->new_count = (size_t)number;
        }
    }
  }
}

/* BufferGetAndValidate */
    static CYTHON_INLINE void __Pyx_SafeReleaseBuffer(Py_buffer* info) {
  if (unlikely(info->buf == NULL)) return;
  if (info->suboffsets == __Pyx_minusones) info->suboffsets = NULL;
  __Pyx_ReleaseBuffer(info);
}
static void __Pyx_ZeroBuffer(Py_buffer* buf) {
  buf->buf = NULL;
  buf->obj = NULL;
  buf->strides = __Pyx_zeros;
  buf->shape = __Pyx_zeros;
  buf->suboffsets = __Pyx_minusones;
}
static int __Pyx__GetBufferAndValidate(
        Py_buffer* buf, PyObject* obj,  __Pyx_TypeInfo* dtype, int flags,
        int nd, int cast, __Pyx_BufFmt_StackElem* stack)
{
  buf->buf = NULL;
  if (unlikely(__Pyx_GetBuffer(obj, buf, flags) == -1)) {
    __Pyx_ZeroBuffer(buf);
    return -1;
  }
  if (unlikely(buf->ndim != nd)) {
    PyErr_Format(PyExc_ValueError,
                 "Buffer has wrong number of dimensions (expected %d, got %d)",
                 nd, buf->ndim);
    goto fail;
  }
  if (!cast) {
    __Pyx_BufFmt_Context ctx;
    __Pyx_BufFmt_Init(&ctx, stack, dtype);
    if (!__Pyx_BufFmt_CheckString(&ctx, buf->format)) goto fail;
  }
  if (unlikely((size_t)buf->itemsize != dtype->size)) {
    PyErr_Format(PyExc_ValueError,
      "Item size of buffer (%" CYTHON_FORMAT_SSIZE_T "d byte%s) does not match size of '%s' (%" CYTHON_FORMAT_SSIZE_T "d byte%s)",
      buf->itemsize, (buf->itemsize > 1) ? "s" : "",
      dtype->name, (Py_ssize_t)dtype->size, (dtype->size > 1) ? "s" : "");
    goto fail;
  }
  if (buf->suboffsets == NULL) buf->suboffsets = __Pyx_minusones;
  return 0;
fail:;
  __Pyx_SafeReleaseBuffer(buf);
  return -1;
}

/* BufferFallbackError */
    static void __Pyx_RaiseBufferFallbackError(void) {
  PyErr_SetString(PyExc_ValueError,
     "Buffer acquisition failed on assignment; and then reacquiring the old buffer failed too!");
}

/* GetItemInt */
    static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
    PyObject *r;
    if (!j) return NULL;
    r = PyObject_GetItem(o, j);
    Py_DECREF(j);
    return r;
}
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
                                                              CYTHON_NCP_UNUSED int wraparound,
                                                              CYTHON_NCP_UNUSED int boundscheck) {
#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    Py_ssize_t wrapped_i = i;
    if (wraparound & unlikely(i < 0)) {
        wrapped_i += PyList_GET_SIZE(o);
    }
    if ((!boundscheck) || likely(__Pyx_is_valid_index(wrapped_i, PyList_GET_SIZE(o)))) {
        PyObject *r = PyList_GET_ITEM(o, wrapped_i);
        Py_INCREF(r);
        return r;
    }
    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
#else
    return PySequence_GetItem(o, i);
#endif
}
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
                                                              CYTHON_NCP_UNUSED int wraparound,
                                                              CYTHON_NCP_UNUSED int boundscheck) {
#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    Py_ssize_t wrapped_i = i;
    if (wraparound & unlikely(i < 0)) {
        wrapped_i += PyTuple_GET_SIZE(o);
    }
    if ((!boundscheck) || likely(__Pyx_is_valid_index(wrapped_i, PyTuple_GET_SIZE(o)))) {
        PyObject *r = PyTuple_GET_ITEM(o, wrapped_i);
        Py_INCREF(r);
        return r;
    }
    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
#else
    return PySequence_GetItem(o, i);
#endif
}
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i, int is_list,
                                                     CYTHON_NCP_UNUSED int wraparound,
                                                     CYTHON_NCP_UNUSED int boundscheck) {
#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS && CYTHON_USE_TYPE_SLOTS
    if (is_list || PyList_CheckExact(o)) {
        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyList_GET_SIZE(o);
        if ((!boundscheck) || (likely(__Pyx_is_valid_index(n, PyList_GET_SIZE(o))))) {
            PyObject *r = PyList_GET_ITEM(o, n);
            Py_INCREF(r);
            return r;
        }
    }
    else if (PyTuple_CheckExact(o)) {
        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyTuple_GET_SIZE(o);
        if ((!boundscheck) || likely(__Pyx_is_valid_index(n, PyTuple_GET_SIZE(o)))) {
            PyObject *r = PyTuple_GET_ITEM(o, n);
            Py_INCREF(r);
            return r;
        }
    } else {
        PySequenceMethods *m = Py_TYPE(o)->tp_as_sequence;
        if (likely(m && m->sq_item)) {
            if (wraparound && unlikely(i < 0) && likely(m->sq_length)) {
                Py_ssize_t l = m->sq_length(o);
                if (likely(l >= 0)) {
                    i += l;
                } else {
                    if (!PyErr_ExceptionMatches(PyExc_OverflowError))
                        return NULL;
                    PyErr_Clear();
                }
            }
            return m->sq_item(o, i);
        }
    }
#else
    if (is_list || PySequence_Check(o)) {
        return PySequence_GetItem(o, i);
    }
#endif
    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
}

/* ObjectGetItem */
    #if CYTHON_USE_TYPE_SLOTS
static PyObject *__Pyx_PyObject_GetIndex(PyObject *obj, PyObject* index) {
    PyObject *runerr;
    Py_ssize_t key_value;
    PySequenceMethods *m = Py_TYPE(obj)->tp_as_sequence;
    if (unlikely(!(m && m->sq_item))) {
        PyErr_Format(PyExc_TypeError, "'%.200s' object is not subscriptable", Py_TYPE(obj)->tp_name);
        return NULL;
    }
    key_value = __Pyx_PyIndex_AsSsize_t(index);
    if (likely(key_value != -1 || !(runerr = PyErr_Occurred()))) {
        return __Pyx_GetItemInt_Fast(obj, key_value, 0, 1, 1);
    }
    if (PyErr_GivenExceptionMatches(runerr, PyExc_OverflowError)) {
        PyErr_Clear();
        PyErr_Format(PyExc_IndexError, "cannot fit '%.200s' into an index-sized integer", Py_TYPE(index)->tp_name);
    }
    return NULL;
}
static PyObject *__Pyx_PyObject_GetItem(PyObject *obj, PyObject* key) {
    PyMappingMethods *m = Py_TYPE(obj)->tp_as_mapping;
    if (likely(m && m->mp_subscript)) {
        return m->mp_subscript(obj, key);
    }
    return __Pyx_PyObject_GetIndex(obj, key);
}
#endif

/* PyErrFetchRestore */
    #if CYTHON_FAST_THREAD_STATE
static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    tmp_type = tstate->curexc_type;
    tmp_value = tstate->curexc_value;
    tmp_tb = tstate->curexc_traceback;
    tstate->curexc_type = type;
    tstate->curexc_value = value;
    tstate->curexc_traceback = tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
}
static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
    *type = tstate->curexc_type;
    *value = tstate->curexc_value;
    *tb = tstate->curexc_traceback;
    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
}
#endif

/* RaiseException */
    #if PY_MAJOR_VERSION < 3
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb,
                        CYTHON_UNUSED PyObject *cause) {
    __Pyx_PyThreadState_declare
    Py_XINCREF(type);
    if (!value || value == Py_None)
        value = NULL;
    else
        Py_INCREF(value);
    if (!tb || tb == Py_None)
        tb = NULL;
    else {
        Py_INCREF(tb);
        if (!PyTraceBack_Check(tb)) {
            PyErr_SetString(PyExc_TypeError,
                "raise: arg 3 must be a traceback or None");
            goto raise_error;
        }
    }
    if (PyType_Check(type)) {
#if CYTHON_COMPILING_IN_PYPY
        if (!value) {
            Py_INCREF(Py_None);
            value = Py_None;
        }
#endif
        PyErr_NormalizeException(&type, &value, &tb);
    } else {
        if (value) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto raise_error;
        }
        value = type;
        type = (PyObject*) Py_TYPE(type);
        Py_INCREF(type);
        if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
            PyErr_SetString(PyExc_TypeError,
                "raise: exception class must be a subclass of BaseException");
            goto raise_error;
        }
    }
    __Pyx_PyThreadState_assign
    __Pyx_ErrRestore(type, value, tb);
    return;
raise_error:
    Py_XDECREF(value);
    Py_XDECREF(type);
    Py_XDECREF(tb);
    return;
}
#else
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
    PyObject* owned_instance = NULL;
    if (tb == Py_None) {
        tb = 0;
    } else if (tb && !PyTraceBack_Check(tb)) {
        PyErr_SetString(PyExc_TypeError,
            "raise: arg 3 must be a traceback or None");
        goto bad;
    }
    if (value == Py_None)
        value = 0;
    if (PyExceptionInstance_Check(type)) {
        if (value) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto bad;
        }
        value = type;
        type = (PyObject*) Py_TYPE(value);
    } else if (PyExceptionClass_Check(type)) {
        PyObject *instance_class = NULL;
        if (value && PyExceptionInstance_Check(value)) {
            instance_class = (PyObject*) Py_TYPE(value);
            if (instance_class != type) {
                int is_subclass = PyObject_IsSubclass(instance_class, type);
                if (!is_subclass) {
                    instance_class = NULL;
                } else if (unlikely(is_subclass == -1)) {
                    goto bad;
                } else {
                    type = instance_class;
                }
            }
        }
        if (!instance_class) {
            PyObject *args;
            if (!value)
                args = PyTuple_New(0);
            else if (PyTuple_Check(value)) {
                Py_INCREF(value);
                args = value;
            } else
                args = PyTuple_Pack(1, value);
            if (!args)
                goto bad;
            owned_instance = PyObject_Call(type, args, NULL);
            Py_DECREF(args);
            if (!owned_instance)
                goto bad;
            value = owned_instance;
            if (!PyExceptionInstance_Check(value)) {
                PyErr_Format(PyExc_TypeError,
                             "calling %R should have returned an instance of "
                             "BaseException, not %R",
                             type, Py_TYPE(value));
                goto bad;
            }
        }
    } else {
        PyErr_SetString(PyExc_TypeError,
            "raise: exception class must be a subclass of BaseException");
        goto bad;
    }
    if (cause) {
        PyObject *fixed_cause;
        if (cause == Py_None) {
            fixed_cause = NULL;
        } else if (PyExceptionClass_Check(cause)) {
            fixed_cause = PyObject_CallObject(cause, NULL);
            if (fixed_cause == NULL)
                goto bad;
        } else if (PyExceptionInstance_Check(cause)) {
            fixed_cause = cause;
            Py_INCREF(fixed_cause);
        } else {
            PyErr_SetString(PyExc_TypeError,
                            "exception causes must derive from "
                            "BaseException");
            goto bad;
        }
        PyException_SetCause(value, fixed_cause);
    }
    PyErr_SetObject(type, value);
    if (tb) {
#if CYTHON_COMPILING_IN_PYPY
        PyObject *tmp_type, *tmp_value, *tmp_tb;
        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
        Py_INCREF(tb);
        PyErr_Restore(tmp_type, tmp_value, tb);
        Py_XDECREF(tmp_tb);
#else
        PyThreadState *tstate = __Pyx_PyThreadState_Current;
        PyObject* tmp_tb = tstate->curexc_traceback;
        if (tb != tmp_tb) {
            Py_INCREF(tb);
            tstate->curexc_traceback = tb;
            Py_XDECREF(tmp_tb);
        }
#endif
    }
bad:
    Py_XDECREF(owned_instance);
    return;
}
#endif

/* py_abs */
    #if CYTHON_USE_PYLONG_INTERNALS
static PyObject *__Pyx_PyLong_AbsNeg(PyObject *n) {
    if (likely(Py_SIZE(n) == -1)) {
        return PyLong_FromLong(((PyLongObject*)n)->ob_digit[0]);
    }
#if CYTHON_COMPILING_IN_CPYTHON
    {
        PyObject *copy = _PyLong_Copy((PyLongObject*)n);
        if (likely(copy)) {
            __Pyx_SET_SIZE(copy, -Py_SIZE(copy));
        }
        return copy;
    }
#else
    return PyNumber_Negative(n);
#endif
}
#endif

/* None */
    static CYTHON_INLINE void __Pyx_RaiseUnboundLocalError(const char *varname) {
    PyErr_Format(PyExc_UnboundLocalError, "local variable '%s' referenced before assignment", varname);
}

/* PyObjectGetMethod */
    static int __Pyx_PyObject_GetMethod(PyObject *obj, PyObject *name, PyObject **method) {
    PyObject *attr;
#if CYTHON_UNPACK_METHODS && CYTHON_COMPILING_IN_CPYTHON && CYTHON_USE_PYTYPE_LOOKUP
    PyTypeObject *tp = Py_TYPE(obj);
    PyObject *descr;
    descrgetfunc f = NULL;
    PyObject **dictptr, *dict;
    int meth_found = 0;
    assert (*method == NULL);
    if (unlikely(tp->tp_getattro != PyObject_GenericGetAttr)) {
        attr = __Pyx_PyObject_GetAttrStr(obj, name);
        goto try_unpack;
    }
    if (unlikely(tp->tp_dict == NULL) && unlikely(PyType_Ready(tp) < 0)) {
        return 0;
    }
    descr = _PyType_Lookup(tp, name);
    if (likely(descr != NULL)) {
        Py_INCREF(descr);
#if PY_MAJOR_VERSION >= 3
        #ifdef __Pyx_CyFunction_USED
        if (likely(PyFunction_Check(descr) || (Py_TYPE(descr) == &PyMethodDescr_Type) || __Pyx_CyFunction_Check(descr)))
        #else
        if (likely(PyFunction_Check(descr) || (Py_TYPE(descr) == &PyMethodDescr_Type)))
        #endif
#else
        #ifdef __Pyx_CyFunction_USED
        if (likely(PyFunction_Check(descr) || __Pyx_CyFunction_Check(descr)))
        #else
        if (likely(PyFunction_Check(descr)))
        #endif
#endif
        {
            meth_found = 1;
        } else {
            f = Py_TYPE(descr)->tp_descr_get;
            if (f != NULL && PyDescr_IsData(descr)) {
                attr = f(descr, obj, (PyObject *)Py_TYPE(obj));
                Py_DECREF(descr);
                goto try_unpack;
            }
        }
    }
    dictptr = _PyObject_GetDictPtr(obj);
    if (dictptr != NULL && (dict = *dictptr) != NULL) {
        Py_INCREF(dict);
        attr = __Pyx_PyDict_GetItemStr(dict, name);
        if (attr != NULL) {
            Py_INCREF(attr);
            Py_DECREF(dict);
            Py_XDECREF(descr);
            goto try_unpack;
        }
        Py_DECREF(dict);
    }
    if (meth_found) {
        *method = descr;
        return 1;
    }
    if (f != NULL) {
        attr = f(descr, obj, (PyObject *)Py_TYPE(obj));
        Py_DECREF(descr);
        goto try_unpack;
    }
    if (descr != NULL) {
        *method = descr;
        return 0;
    }
    PyErr_Format(PyExc_AttributeError,
#if PY_MAJOR_VERSION >= 3
                 "'%.50s' object has no attribute '%U'",
                 tp->tp_name, name);
#else
                 "'%.50s' object has no attribute '%.400s'",
                 tp->tp_name, PyString_AS_STRING(name));
#endif
    return 0;
#else
    attr = __Pyx_PyObject_GetAttrStr(obj, name);
    goto try_unpack;
#endif
try_unpack:
#if CYTHON_UNPACK_METHODS
    if (likely(attr) && PyMethod_Check(attr) && likely(PyMethod_GET_SELF(attr) == obj)) {
        PyObject *function = PyMethod_GET_FUNCTION(attr);
        Py_INCREF(function);
        Py_DECREF(attr);
        *method = function;
        return 1;
    }
#endif
    *method = attr;
    return 0;
}

/* PyObjectCallMethod1 */
    static PyObject* __Pyx__PyObject_CallMethod1(PyObject* method, PyObject* arg) {
    PyObject *result = __Pyx_PyObject_CallOneArg(method, arg);
    Py_DECREF(method);
    return result;
}
static PyObject* __Pyx_PyObject_CallMethod1(PyObject* obj, PyObject* method_name, PyObject* arg) {
    PyObject *method = NULL, *result;
    int is_method = __Pyx_PyObject_GetMethod(obj, method_name, &method);
    if (likely(is_method)) {
        result = __Pyx_PyObject_Call2Args(method, obj, arg);
        Py_DECREF(method);
        return result;
    }
    if (unlikely(!method)) return NULL;
    return __Pyx__PyObject_CallMethod1(method, arg);
}

/* append */
    static CYTHON_INLINE int __Pyx_PyObject_Append(PyObject* L, PyObject* x) {
    if (likely(PyList_CheckExact(L))) {
        if (unlikely(__Pyx_PyList_Append(L, x) < 0)) return -1;
    } else {
        PyObject* retval = __Pyx_PyObject_CallMethod1(L, __pyx_n_s_append, x);
        if (unlikely(!retval))
            return -1;
        Py_DECREF(retval);
    }
    return 0;
}

/* BufferIndexError */
    static void __Pyx_RaiseBufferIndexError(int axis) {
  PyErr_Format(PyExc_IndexError,
     "Out of bounds on buffer access (axis %d)", axis);
}

/* DictGetItem */
    #if PY_MAJOR_VERSION >= 3 && !CYTHON_COMPILING_IN_PYPY
static PyObject *__Pyx_PyDict_GetItem(PyObject *d, PyObject* key) {
    PyObject *value;
    value = PyDict_GetItemWithError(d, key);
    if (unlikely(!value)) {
        if (!PyErr_Occurred()) {
            if (unlikely(PyTuple_Check(key))) {
                PyObject* args = PyTuple_Pack(1, key);
                if (likely(args)) {
                    PyErr_SetObject(PyExc_KeyError, args);
                    Py_DECREF(args);
                }
            } else {
                PyErr_SetObject(PyExc_KeyError, key);
            }
        }
        return NULL;
    }
    Py_INCREF(value);
    return value;
}
#endif

/* SetItemInt */
    static int __Pyx_SetItemInt_Generic(PyObject *o, PyObject *j, PyObject *v) {
    int r;
    if (!j) return -1;
    r = PyObject_SetItem(o, j, v);
    Py_DECREF(j);
    return r;
}
static CYTHON_INLINE int __Pyx_SetItemInt_Fast(PyObject *o, Py_ssize_t i, PyObject *v, int is_list,
                                               CYTHON_NCP_UNUSED int wraparound, CYTHON_NCP_UNUSED int boundscheck) {
#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS && CYTHON_USE_TYPE_SLOTS
    if (is_list || PyList_CheckExact(o)) {
        Py_ssize_t n = (!wraparound) ? i : ((likely(i >= 0)) ? i : i + PyList_GET_SIZE(o));
        if ((!boundscheck) || likely(__Pyx_is_valid_index(n, PyList_GET_SIZE(o)))) {
            PyObject* old = PyList_GET_ITEM(o, n);
            Py_INCREF(v);
            PyList_SET_ITEM(o, n, v);
            Py_DECREF(old);
            return 1;
        }
    } else {
        PySequenceMethods *m = Py_TYPE(o)->tp_as_sequence;
        if (likely(m && m->sq_ass_item)) {
            if (wraparound && unlikely(i < 0) && likely(m->sq_length)) {
                Py_ssize_t l = m->sq_length(o);
                if (likely(l >= 0)) {
                    i += l;
                } else {
                    if (!PyErr_ExceptionMatches(PyExc_OverflowError))
                        return -1;
                    PyErr_Clear();
                }
            }
            return m->sq_ass_item(o, i, v);
        }
    }
#else
#if CYTHON_COMPILING_IN_PYPY
    if (is_list || (PySequence_Check(o) && !PyDict_Check(o)))
#else
    if (is_list || PySequence_Check(o))
#endif
    {
        return PySequence_SetItem(o, i, v);
    }
#endif
    return __Pyx_SetItemInt_Generic(o, PyInt_FromSsize_t(i), v);
}

/* CIntToDigits */
    static const char DIGIT_PAIRS_10[2*10*10+1] = {
    "00010203040506070809"
    "10111213141516171819"
    "20212223242526272829"
    "30313233343536373839"
    "40414243444546474849"
    "50515253545556575859"
    "60616263646566676869"
    "70717273747576777879"
    "80818283848586878889"
    "90919293949596979899"
};
static const char DIGIT_PAIRS_8[2*8*8+1] = {
    "0001020304050607"
    "1011121314151617"
    "2021222324252627"
    "3031323334353637"
    "4041424344454647"
    "5051525354555657"
    "6061626364656667"
    "7071727374757677"
};
static const char DIGITS_HEX[2*16+1] = {
    "0123456789abcdef"
    "0123456789ABCDEF"
};

/* BuildPyUnicode */
    static PyObject* __Pyx_PyUnicode_BuildFromAscii(Py_ssize_t ulength, char* chars, int clength,
                                                int prepend_sign, char padding_char) {
    PyObject *uval;
    Py_ssize_t uoffset = ulength - clength;
#if CYTHON_USE_UNICODE_INTERNALS
    Py_ssize_t i;
#if CYTHON_PEP393_ENABLED
    void *udata;
    uval = PyUnicode_New(ulength, 127);
    if (unlikely(!uval)) return NULL;
    udata = PyUnicode_DATA(uval);
#else
    Py_UNICODE *udata;
    uval = PyUnicode_FromUnicode(NULL, ulength);
    if (unlikely(!uval)) return NULL;
    udata = PyUnicode_AS_UNICODE(uval);
#endif
    if (uoffset > 0) {
        i = 0;
        if (prepend_sign) {
            __Pyx_PyUnicode_WRITE(PyUnicode_1BYTE_KIND, udata, 0, '-');
            i++;
        }
        for (; i < uoffset; i++) {
            __Pyx_PyUnicode_WRITE(PyUnicode_1BYTE_KIND, udata, i, padding_char);
        }
    }
    for (i=0; i < clength; i++) {
        __Pyx_PyUnicode_WRITE(PyUnicode_1BYTE_KIND, udata, uoffset+i, chars[i]);
    }
#else
    {
        PyObject *sign = NULL, *padding = NULL;
        uval = NULL;
        if (uoffset > 0) {
            prepend_sign = !!prepend_sign;
            if (uoffset > prepend_sign) {
                padding = PyUnicode_FromOrdinal(padding_char);
                if (likely(padding) && uoffset > prepend_sign + 1) {
                    PyObject *tmp;
                    PyObject *repeat = PyInt_FromSize_t(uoffset - prepend_sign);
                    if (unlikely(!repeat)) goto done_or_error;
                    tmp = PyNumber_Multiply(padding, repeat);
                    Py_DECREF(repeat);
                    Py_DECREF(padding);
                    padding = tmp;
                }
                if (unlikely(!padding)) goto done_or_error;
            }
            if (prepend_sign) {
                sign = PyUnicode_FromOrdinal('-');
                if (unlikely(!sign)) goto done_or_error;
            }
        }
        uval = PyUnicode_DecodeASCII(chars, clength, NULL);
        if (likely(uval) && padding) {
            PyObject *tmp = PyNumber_Add(padding, uval);
            Py_DECREF(uval);
            uval = tmp;
        }
        if (likely(uval) && sign) {
            PyObject *tmp = PyNumber_Add(sign, uval);
            Py_DECREF(uval);
            uval = tmp;
        }
done_or_error:
        Py_XDECREF(padding);
        Py_XDECREF(sign);
    }
#endif
    return uval;
}

/* CIntToPyUnicode */
    #ifdef _MSC_VER
    #ifndef _MSC_STDINT_H_
        #if _MSC_VER < 1300
           typedef unsigned short    uint16_t;
        #else
           typedef unsigned __int16  uint16_t;
        #endif
    #endif
#else
   #include <stdint.h>
#endif
static CYTHON_INLINE PyObject* __Pyx_PyUnicode_From_int(int value, Py_ssize_t width, char padding_char, char format_char) {
    char digits[sizeof(int)*3+2];
    char *dpos, *end = digits + sizeof(int)*3+2;
    const char *hex_digits = DIGITS_HEX;
    Py_ssize_t length, ulength;
    int prepend_sign, last_one_off;
    int remaining;
#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
#pragma GCC diagnostic push
#pragma GCC diagnostic ignored "-Wconversion"
#endif
    const int neg_one = (int) -1, const_zero = (int) 0;
#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
#pragma GCC diagnostic pop
#endif
    const int is_unsigned = neg_one > const_zero;
    if (format_char == 'X') {
        hex_digits += 16;
        format_char = 'x';
    }
    remaining = value;
    last_one_off = 0;
    dpos = end;
    do {
        int digit_pos;
        switch (format_char) {
        case 'o':
            digit_pos = abs((int)(remaining % (8*8)));
            remaining = (int) (remaining / (8*8));
            dpos -= 2;
            *(uint16_t*)dpos = ((const uint16_t*)DIGIT_PAIRS_8)[digit_pos];
            last_one_off = (digit_pos < 8);
            break;
        case 'd':
            digit_pos = abs((int)(remaining % (10*10)));
            remaining = (int) (remaining / (10*10));
            dpos -= 2;
            *(uint16_t*)dpos = ((const uint16_t*)DIGIT_PAIRS_10)[digit_pos];
            last_one_off = (digit_pos < 10);
            break;
        case 'x':
            *(--dpos) = hex_digits[abs((int)(remaining % 16))];
            remaining = (int) (remaining / 16);
            break;
        default:
            assert(0);
            break;
        }
    } while (unlikely(remaining != 0));
    if (last_one_off) {
        assert(*dpos == '0');
        dpos++;
    }
    length = end - dpos;
    ulength = length;
    prepend_sign = 0;
    if (!is_unsigned && value <= neg_one) {
        if (padding_char == ' ' || width <= length + 1) {
            *(--dpos) = '-';
            ++length;
        } else {
            prepend_sign = 1;
        }
        ++ulength;
    }
    if (width > ulength) {
        ulength = width;
    }
    if (ulength == 1) {
        return PyUnicode_FromOrdinal(*dpos);
    }
    return __Pyx_PyUnicode_BuildFromAscii(ulength, dpos, (int) length, prepend_sign, padding_char);
}

/* JoinPyUnicode */
    static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
                                      CYTHON_UNUSED Py_UCS4 max_char) {
#if CYTHON_USE_UNICODE_INTERNALS && CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    PyObject *result_uval;
    int result_ukind;
    Py_ssize_t i, char_pos;
    void *result_udata;
#if CYTHON_PEP393_ENABLED
    result_uval = PyUnicode_New(result_ulength, max_char);
    if (unlikely(!result_uval)) return NULL;
    result_ukind = (max_char <= 255) ? PyUnicode_1BYTE_KIND : (max_char <= 65535) ? PyUnicode_2BYTE_KIND : PyUnicode_4BYTE_KIND;
    result_udata = PyUnicode_DATA(result_uval);
#else
    result_uval = PyUnicode_FromUnicode(NULL, result_ulength);
    if (unlikely(!result_uval)) return NULL;
    result_ukind = sizeof(Py_UNICODE);
    result_udata = PyUnicode_AS_UNICODE(result_uval);
#endif
    char_pos = 0;
    for (i=0; i < value_count; i++) {
        int ukind;
        Py_ssize_t ulength;
        void *udata;
        PyObject *uval = PyTuple_GET_ITEM(value_tuple, i);
        if (unlikely(__Pyx_PyUnicode_READY(uval)))
            goto bad;
        ulength = __Pyx_PyUnicode_GET_LENGTH(uval);
        if (unlikely(!ulength))
            continue;
        if (unlikely(char_pos + ulength < 0))
            goto overflow;
        ukind = __Pyx_PyUnicode_KIND(uval);
        udata = __Pyx_PyUnicode_DATA(uval);
        if (!CYTHON_PEP393_ENABLED || ukind == result_ukind) {
            memcpy((char *)result_udata + char_pos * result_ukind, udata, (size_t) (ulength * result_ukind));
        } else {
            #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030300F0 || defined(_PyUnicode_FastCopyCharacters)
            _PyUnicode_FastCopyCharacters(result_uval, char_pos, uval, 0, ulength);
            #else
            Py_ssize_t j;
            for (j=0; j < ulength; j++) {
                Py_UCS4 uchar = __Pyx_PyUnicode_READ(ukind, udata, j);
                __Pyx_PyUnicode_WRITE(result_ukind, result_udata, char_pos+j, uchar);
            }
            #endif
        }
        char_pos += ulength;
    }
    return result_uval;
overflow:
    PyErr_SetString(PyExc_OverflowError, "join() result is too long for a Python string");
bad:
    Py_DECREF(result_uval);
    return NULL;
#else
    result_ulength++;
    value_count++;
    return PyUnicode_Join(__pyx_empty_unicode, value_tuple);
#endif
}

/* PyFloatBinop */
    #if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyFloat_EqObjC(PyObject *op1, PyObject *op2, double floatval, int inplace, int zerodivision_check) {
    const double b = floatval;
    double a;
    (void)inplace;
    (void)zerodivision_check;
    if (op1 == op2) {
        Py_RETURN_TRUE;
    }
    if (likely(PyFloat_CheckExact(op1))) {
        a = PyFloat_AS_DOUBLE(op1);
        
    } else
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        a = (double) PyInt_AS_LONG(op1);
        
    } else
    #endif
    if (likely(PyLong_CheckExact(op1))) {
        #if CYTHON_USE_PYLONG_INTERNALS
        const digit* digits = ((PyLongObject*)op1)->ob_digit;
        const Py_ssize_t size = Py_SIZE(op1);
        switch (size) {
            case  0: a = 0.0; break;
            case -1: a = -(double) digits[0]; break;
            case  1: a = (double) digits[0]; break;
            case -2:
            case 2:
                if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT && ((8 * sizeof(unsigned long) < 53) || (1 * PyLong_SHIFT < 53))) {
                    a = (double) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                    if ((8 * sizeof(unsigned long) < 53) || (2 * PyLong_SHIFT < 53) || (a < (double) ((PY_LONG_LONG)1 << 53))) {
                        if (size == -2)
                            a = -a;
                        break;
                    }
                }
                CYTHON_FALLTHROUGH;
            case -3:
            case 3:
                if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT && ((8 * sizeof(unsigned long) < 53) || (2 * PyLong_SHIFT < 53))) {
                    a = (double) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                    if ((8 * sizeof(unsigned long) < 53) || (3 * PyLong_SHIFT < 53) || (a < (double) ((PY_LONG_LONG)1 << 53))) {
                        if (size == -3)
                            a = -a;
                        break;
                    }
                }
                CYTHON_FALLTHROUGH;
            case -4:
            case 4:
                if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT && ((8 * sizeof(unsigned long) < 53) || (3 * PyLong_SHIFT < 53))) {
                    a = (double) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                    if ((8 * sizeof(unsigned long) < 53) || (4 * PyLong_SHIFT < 53) || (a < (double) ((PY_LONG_LONG)1 << 53))) {
                        if (size == -4)
                            a = -a;
                        break;
                    }
                }
                CYTHON_FALLTHROUGH;
            default:
        #else
        {
        #endif
            return (
                PyFloat_Type.tp_richcompare(op2, op1, Py_EQ));
        }
    } else {
        return (
            PyObject_RichCompare(op1, op2, Py_EQ));
    }
        if (a == b) {
            Py_RETURN_TRUE;
        } else {
            Py_RETURN_FALSE;
        }
}
#endif

/* PyErrExceptionMatches */
      #if CYTHON_FAST_THREAD_STATE
static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
    Py_ssize_t i, n;
    n = PyTuple_GET_SIZE(tuple);
#if PY_MAJOR_VERSION >= 3
    for (i=0; i<n; i++) {
        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
    }
#endif
    for (i=0; i<n; i++) {
        if (__Pyx_PyErr_GivenExceptionMatches(exc_type, PyTuple_GET_ITEM(tuple, i))) return 1;
    }
    return 0;
}
static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err) {
    PyObject *exc_type = tstate->curexc_type;
    if (exc_type == err) return 1;
    if (unlikely(!exc_type)) return 0;
    if (unlikely(PyTuple_Check(err)))
        return __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
    return __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
}
#endif

/* GetAttr */
      static CYTHON_INLINE PyObject *__Pyx_GetAttr(PyObject *o, PyObject *n) {
#if CYTHON_USE_TYPE_SLOTS
#if PY_MAJOR_VERSION >= 3
    if (likely(PyUnicode_Check(n)))
#else
    if (likely(PyString_Check(n)))
#endif
        return __Pyx_PyObject_GetAttrStr(o, n);
#endif
    return PyObject_GetAttr(o, n);
}

/* GetAttr3 */
      static PyObject *__Pyx_GetAttr3Default(PyObject *d) {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    if (unlikely(!__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
        return NULL;
    __Pyx_PyErr_Clear();
    Py_INCREF(d);
    return d;
}
static CYTHON_INLINE PyObject *__Pyx_GetAttr3(PyObject *o, PyObject *n, PyObject *d) {
    PyObject *r = __Pyx_GetAttr(o, n);
    return (likely(r)) ? r : __Pyx_GetAttr3Default(d);
}

/* SliceObject */
      static CYTHON_INLINE PyObject* __Pyx_PyObject_GetSlice(PyObject* obj,
        Py_ssize_t cstart, Py_ssize_t cstop,
        PyObject** _py_start, PyObject** _py_stop, PyObject** _py_slice,
        int has_cstart, int has_cstop, CYTHON_UNUSED int wraparound) {
#if CYTHON_USE_TYPE_SLOTS
    PyMappingMethods* mp;
#if PY_MAJOR_VERSION < 3
    PySequenceMethods* ms = Py_TYPE(obj)->tp_as_sequence;
    if (likely(ms && ms->sq_slice)) {
        if (!has_cstart) {
            if (_py_start && (*_py_start != Py_None)) {
                cstart = __Pyx_PyIndex_AsSsize_t(*_py_start);
                if ((cstart == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
            } else
                cstart = 0;
        }
        if (!has_cstop) {
            if (_py_stop && (*_py_stop != Py_None)) {
                cstop = __Pyx_PyIndex_AsSsize_t(*_py_stop);
                if ((cstop == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
            } else
                cstop = PY_SSIZE_T_MAX;
        }
        if (wraparound && unlikely((cstart < 0) | (cstop < 0)) && likely(ms->sq_length)) {
            Py_ssize_t l = ms->sq_length(obj);
            if (likely(l >= 0)) {
                if (cstop < 0) {
                    cstop += l;
                    if (cstop < 0) cstop = 0;
                }
                if (cstart < 0) {
                    cstart += l;
                    if (cstart < 0) cstart = 0;
                }
            } else {
                if (!PyErr_ExceptionMatches(PyExc_OverflowError))
                    goto bad;
                PyErr_Clear();
            }
        }
        return ms->sq_slice(obj, cstart, cstop);
    }
#endif
    mp = Py_TYPE(obj)->tp_as_mapping;
    if (likely(mp && mp->mp_subscript))
#endif
    {
        PyObject* result;
        PyObject *py_slice, *py_start, *py_stop;
        if (_py_slice) {
            py_slice = *_py_slice;
        } else {
            PyObject* owned_start = NULL;
            PyObject* owned_stop = NULL;
            if (_py_start) {
                py_start = *_py_start;
            } else {
                if (has_cstart) {
                    owned_start = py_start = PyInt_FromSsize_t(cstart);
                    if (unlikely(!py_start)) goto bad;
                } else
                    py_start = Py_None;
            }
            if (_py_stop) {
                py_stop = *_py_stop;
            } else {
                if (has_cstop) {
                    owned_stop = py_stop = PyInt_FromSsize_t(cstop);
                    if (unlikely(!py_stop)) {
                        Py_XDECREF(owned_start);
                        goto bad;
                    }
                } else
                    py_stop = Py_None;
            }
            py_slice = PySlice_New(py_start, py_stop, Py_None);
            Py_XDECREF(owned_start);
            Py_XDECREF(owned_stop);
            if (unlikely(!py_slice)) goto bad;
        }
#if CYTHON_USE_TYPE_SLOTS
        result = mp->mp_subscript(obj, py_slice);
#else
        result = PyObject_GetItem(obj, py_slice);
#endif
        if (!_py_slice) {
            Py_DECREF(py_slice);
        }
        return result;
    }
    PyErr_Format(PyExc_TypeError,
        "'%.200s' object is unsliceable", Py_TYPE(obj)->tp_name);
bad:
    return NULL;
}

/* Import */
      static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
    PyObject *empty_list = 0;
    PyObject *module = 0;
    PyObject *global_dict = 0;
    PyObject *empty_dict = 0;
    PyObject *list;
    #if PY_MAJOR_VERSION < 3
    PyObject *py_import;
    py_import = __Pyx_PyObject_GetAttrStr(__pyx_b, __pyx_n_s_import);
    if (!py_import)
        goto bad;
    #endif
    if (from_list)
        list = from_list;
    else {
        empty_list = PyList_New(0);
        if (!empty_list)
            goto bad;
        list = empty_list;
    }
    global_dict = PyModule_GetDict(__pyx_m);
    if (!global_dict)
        goto bad;
    empty_dict = PyDict_New();
    if (!empty_dict)
        goto bad;
    {
        #if PY_MAJOR_VERSION >= 3
        if (level == -1) {
            if ((1) && (strchr(__Pyx_MODULE_NAME, '.'))) {
                module = PyImport_ImportModuleLevelObject(
                    name, global_dict, empty_dict, list, 1);
                if (!module) {
                    if (!PyErr_ExceptionMatches(PyExc_ImportError))
                        goto bad;
                    PyErr_Clear();
                }
            }
            level = 0;
        }
        #endif
        if (!module) {
            #if PY_MAJOR_VERSION < 3
            PyObject *py_level = PyInt_FromLong(level);
            if (!py_level)
                goto bad;
            module = PyObject_CallFunctionObjArgs(py_import,
                name, global_dict, empty_dict, list, py_level, (PyObject *)NULL);
            Py_DECREF(py_level);
            #else
            module = PyImport_ImportModuleLevelObject(
                name, global_dict, empty_dict, list, level);
            #endif
        }
    }
bad:
    #if PY_MAJOR_VERSION < 3
    Py_XDECREF(py_import);
    #endif
    Py_XDECREF(empty_list);
    Py_XDECREF(empty_dict);
    return module;
}

/* ImportFrom */
      static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name) {
    PyObject* value = __Pyx_PyObject_GetAttrStr(module, name);
    if (unlikely(!value) && PyErr_ExceptionMatches(PyExc_AttributeError)) {
        PyErr_Format(PyExc_ImportError,
        #if PY_MAJOR_VERSION < 3
            "cannot import name %.230s", PyString_AS_STRING(name));
        #else
            "cannot import name %S", name);
        #endif
    }
    return value;
}

/* HasAttr */
      static CYTHON_INLINE int __Pyx_HasAttr(PyObject *o, PyObject *n) {
    PyObject *r;
    if (unlikely(!__Pyx_PyBaseString_Check(n))) {
        PyErr_SetString(PyExc_TypeError,
                        "hasattr(): attribute name must be string");
        return -1;
    }
    r = __Pyx_GetAttr(o, n);
    if (unlikely(!r)) {
        PyErr_Clear();
        return 0;
    } else {
        Py_DECREF(r);
        return 1;
    }
}

/* GetTopmostException */
      #if CYTHON_USE_EXC_INFO_STACK
static _PyErr_StackItem *
__Pyx_PyErr_GetTopmostException(PyThreadState *tstate)
{
    _PyErr_StackItem *exc_info = tstate->exc_info;
    while ((exc_info->exc_type == NULL || exc_info->exc_type == Py_None) &&
           exc_info->previous_item != NULL)
    {
        exc_info = exc_info->previous_item;
    }
    return exc_info;
}
#endif

/* SaveResetException */
      #if CYTHON_FAST_THREAD_STATE
static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
    #if CYTHON_USE_EXC_INFO_STACK
    _PyErr_StackItem *exc_info = __Pyx_PyErr_GetTopmostException(tstate);
    *type = exc_info->exc_type;
    *value = exc_info->exc_value;
    *tb = exc_info->exc_traceback;
    #else
    *type = tstate->exc_type;
    *value = tstate->exc_value;
    *tb = tstate->exc_traceback;
    #endif
    Py_XINCREF(*type);
    Py_XINCREF(*value);
    Py_XINCREF(*tb);
}
static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    #if CYTHON_USE_EXC_INFO_STACK
    _PyErr_StackItem *exc_info = tstate->exc_info;
    tmp_type = exc_info->exc_type;
    tmp_value = exc_info->exc_value;
    tmp_tb = exc_info->exc_traceback;
    exc_info->exc_type = type;
    exc_info->exc_value = value;
    exc_info->exc_traceback = tb;
    #else
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = type;
    tstate->exc_value = value;
    tstate->exc_traceback = tb;
    #endif
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
}
#endif

/* GetException */
      #if CYTHON_FAST_THREAD_STATE
static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb)
#else
static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb)
#endif
{
    PyObject *local_type, *local_value, *local_tb;
#if CYTHON_FAST_THREAD_STATE
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    local_type = tstate->curexc_type;
    local_value = tstate->curexc_value;
    local_tb = tstate->curexc_traceback;
    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
#else
    PyErr_Fetch(&local_type, &local_value, &local_tb);
#endif
    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
#if CYTHON_FAST_THREAD_STATE
    if (unlikely(tstate->curexc_type))
#else
    if (unlikely(PyErr_Occurred()))
#endif
        goto bad;
    #if PY_MAJOR_VERSION >= 3
    if (local_tb) {
        if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
            goto bad;
    }
    #endif
    Py_XINCREF(local_tb);
    Py_XINCREF(local_type);
    Py_XINCREF(local_value);
    *type = local_type;
    *value = local_value;
    *tb = local_tb;
#if CYTHON_FAST_THREAD_STATE
    #if CYTHON_USE_EXC_INFO_STACK
    {
        _PyErr_StackItem *exc_info = tstate->exc_info;
        tmp_type = exc_info->exc_type;
        tmp_value = exc_info->exc_value;
        tmp_tb = exc_info->exc_traceback;
        exc_info->exc_type = local_type;
        exc_info->exc_value = local_value;
        exc_info->exc_traceback = local_tb;
    }
    #else
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = local_type;
    tstate->exc_value = local_value;
    tstate->exc_traceback = local_tb;
    #endif
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
#else
    PyErr_SetExcInfo(local_type, local_value, local_tb);
#endif
    return 0;
bad:
    *type = 0;
    *value = 0;
    *tb = 0;
    Py_XDECREF(local_type);
    Py_XDECREF(local_value);
    Py_XDECREF(local_tb);
    return -1;
}

/* PyObject_GenericGetAttrNoDict */
      #if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
static PyObject *__Pyx_RaiseGenericGetAttributeError(PyTypeObject *tp, PyObject *attr_name) {
    PyErr_Format(PyExc_AttributeError,
#if PY_MAJOR_VERSION >= 3
                 "'%.50s' object has no attribute '%U'",
                 tp->tp_name, attr_name);
#else
                 "'%.50s' object has no attribute '%.400s'",
                 tp->tp_name, PyString_AS_STRING(attr_name));
#endif
    return NULL;
}
static CYTHON_INLINE PyObject* __Pyx_PyObject_GenericGetAttrNoDict(PyObject* obj, PyObject* attr_name) {
    PyObject *descr;
    PyTypeObject *tp = Py_TYPE(obj);
    if (unlikely(!PyString_Check(attr_name))) {
        return PyObject_GenericGetAttr(obj, attr_name);
    }
    assert(!tp->tp_dictoffset);
    descr = _PyType_Lookup(tp, attr_name);
    if (unlikely(!descr)) {
        return __Pyx_RaiseGenericGetAttributeError(tp, attr_name);
    }
    Py_INCREF(descr);
    #if PY_MAJOR_VERSION < 3
    if (likely(PyType_HasFeature(Py_TYPE(descr), Py_TPFLAGS_HAVE_CLASS)))
    #endif
    {
        descrgetfunc f = Py_TYPE(descr)->tp_descr_get;
        if (unlikely(f)) {
            PyObject *res = f(descr, obj, (PyObject *)tp);
            Py_DECREF(descr);
            return res;
        }
    }
    return descr;
}
#endif

/* PyObject_GenericGetAttr */
      #if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
static PyObject* __Pyx_PyObject_GenericGetAttr(PyObject* obj, PyObject* attr_name) {
    if (unlikely(Py_TYPE(obj)->tp_dictoffset)) {
        return PyObject_GenericGetAttr(obj, attr_name);
    }
    return __Pyx_PyObject_GenericGetAttrNoDict(obj, attr_name);
}
#endif

/* SetVTable */
      static int __Pyx_SetVtable(PyObject *dict, void *vtable) {
#if PY_VERSION_HEX >= 0x02070000
    PyObject *ob = PyCapsule_New(vtable, 0, 0);
#else
    PyObject *ob = PyCObject_FromVoidPtr(vtable, 0);
#endif
    if (!ob)
        goto bad;
    if (PyDict_SetItem(dict, __pyx_n_s_pyx_vtable, ob) < 0)
        goto bad;
    Py_DECREF(ob);
    return 0;
bad:
    Py_XDECREF(ob);
    return -1;
}

/* PyObjectGetAttrStrNoError */
      static void __Pyx_PyObject_GetAttrStr_ClearAttributeError(void) {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    if (likely(__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
        __Pyx_PyErr_Clear();
}
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name) {
    PyObject *result;
#if CYTHON_COMPILING_IN_CPYTHON && CYTHON_USE_TYPE_SLOTS && PY_VERSION_HEX >= 0x030700B1
    PyTypeObject* tp = Py_TYPE(obj);
    if (likely(tp->tp_getattro == PyObject_GenericGetAttr)) {
        return _PyObject_GenericGetAttrWithDict(obj, attr_name, NULL, 1);
    }
#endif
    result = __Pyx_PyObject_GetAttrStr(obj, attr_name);
    if (unlikely(!result)) {
        __Pyx_PyObject_GetAttrStr_ClearAttributeError();
    }
    return result;
}

/* SetupReduce */
      static int __Pyx_setup_reduce_is_named(PyObject* meth, PyObject* name) {
  int ret;
  PyObject *name_attr;
  name_attr = __Pyx_PyObject_GetAttrStr(meth, __pyx_n_s_name);
  if (likely(name_attr)) {
      ret = PyObject_RichCompareBool(name_attr, name, Py_EQ);
  } else {
      ret = -1;
  }
  if (unlikely(ret < 0)) {
      PyErr_Clear();
      ret = 0;
  }
  Py_XDECREF(name_attr);
  return ret;
}
static int __Pyx_setup_reduce(PyObject* type_obj) {
    int ret = 0;
    PyObject *object_reduce = NULL;
    PyObject *object_reduce_ex = NULL;
    PyObject *reduce = NULL;
    PyObject *reduce_ex = NULL;
    PyObject *reduce_cython = NULL;
    PyObject *setstate = NULL;
    PyObject *setstate_cython = NULL;
#if CYTHON_USE_PYTYPE_LOOKUP
    if (_PyType_Lookup((PyTypeObject*)type_obj, __pyx_n_s_getstate)) goto __PYX_GOOD;
#else
    if (PyObject_HasAttr(type_obj, __pyx_n_s_getstate)) goto __PYX_GOOD;
#endif
#if CYTHON_USE_PYTYPE_LOOKUP
    object_reduce_ex = _PyType_Lookup(&PyBaseObject_Type, __pyx_n_s_reduce_ex); if (!object_reduce_ex) goto __PYX_BAD;
#else
    object_reduce_ex = __Pyx_PyObject_GetAttrStr((PyObject*)&PyBaseObject_Type, __pyx_n_s_reduce_ex); if (!object_reduce_ex) goto __PYX_BAD;
#endif
    reduce_ex = __Pyx_PyObject_GetAttrStr(type_obj, __pyx_n_s_reduce_ex); if (unlikely(!reduce_ex)) goto __PYX_BAD;
    if (reduce_ex == object_reduce_ex) {
#if CYTHON_USE_PYTYPE_LOOKUP
        object_reduce = _PyType_Lookup(&PyBaseObject_Type, __pyx_n_s_reduce); if (!object_reduce) goto __PYX_BAD;
#else
        object_reduce = __Pyx_PyObject_GetAttrStr((PyObject*)&PyBaseObject_Type, __pyx_n_s_reduce); if (!object_reduce) goto __PYX_BAD;
#endif
        reduce = __Pyx_PyObject_GetAttrStr(type_obj, __pyx_n_s_reduce); if (unlikely(!reduce)) goto __PYX_BAD;
        if (reduce == object_reduce || __Pyx_setup_reduce_is_named(reduce, __pyx_n_s_reduce_cython)) {
            reduce_cython = __Pyx_PyObject_GetAttrStrNoError(type_obj, __pyx_n_s_reduce_cython);
            if (likely(reduce_cython)) {
                ret = PyDict_SetItem(((PyTypeObject*)type_obj)->tp_dict, __pyx_n_s_reduce, reduce_cython); if (unlikely(ret < 0)) goto __PYX_BAD;
                ret = PyDict_DelItem(((PyTypeObject*)type_obj)->tp_dict, __pyx_n_s_reduce_cython); if (unlikely(ret < 0)) goto __PYX_BAD;
            } else if (reduce == object_reduce || PyErr_Occurred()) {
                goto __PYX_BAD;
            }
            setstate = __Pyx_PyObject_GetAttrStr(type_obj, __pyx_n_s_setstate);
            if (!setstate) PyErr_Clear();
            if (!setstate || __Pyx_setup_reduce_is_named(setstate, __pyx_n_s_setstate_cython)) {
                setstate_cython = __Pyx_PyObject_GetAttrStrNoError(type_obj, __pyx_n_s_setstate_cython);
                if (likely(setstate_cython)) {
                    ret = PyDict_SetItem(((PyTypeObject*)type_obj)->tp_dict, __pyx_n_s_setstate, setstate_cython); if (unlikely(ret < 0)) goto __PYX_BAD;
                    ret = PyDict_DelItem(((PyTypeObject*)type_obj)->tp_dict, __pyx_n_s_setstate_cython); if (unlikely(ret < 0)) goto __PYX_BAD;
                } else if (!setstate || PyErr_Occurred()) {
                    goto __PYX_BAD;
                }
            }
            PyType_Modified((PyTypeObject*)type_obj);
        }
    }
    goto __PYX_GOOD;
__PYX_BAD:
    if (!PyErr_Occurred())
        PyErr_Format(PyExc_RuntimeError, "Unable to initialize pickling for %s", ((PyTypeObject*)type_obj)->tp_name);
    ret = -1;
__PYX_GOOD:
#if !CYTHON_USE_PYTYPE_LOOKUP
    Py_XDECREF(object_reduce);
    Py_XDECREF(object_reduce_ex);
#endif
    Py_XDECREF(reduce);
    Py_XDECREF(reduce_ex);
    Py_XDECREF(reduce_cython);
    Py_XDECREF(setstate);
    Py_XDECREF(setstate_cython);
    return ret;
}

/* TypeImport */
      #ifndef __PYX_HAVE_RT_ImportType
#define __PYX_HAVE_RT_ImportType
static PyTypeObject *__Pyx_ImportType(PyObject *module, const char *module_name, const char *class_name,
    size_t size, enum __Pyx_ImportType_CheckSize check_size)
{
    PyObject *result = 0;
    char warning[200];
    Py_ssize_t basicsize;
#ifdef Py_LIMITED_API
    PyObject *py_basicsize;
#endif
    result = PyObject_GetAttrString(module, class_name);
    if (!result)
        goto bad;
    if (!PyType_Check(result)) {
        PyErr_Format(PyExc_TypeError,
            "%.200s.%.200s is not a type object",
            module_name, class_name);
        goto bad;
    }
#ifndef Py_LIMITED_API
    basicsize = ((PyTypeObject *)result)->tp_basicsize;
#else
    py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
    if (!py_basicsize)
        goto bad;
    basicsize = PyLong_AsSsize_t(py_basicsize);
    Py_DECREF(py_basicsize);
    py_basicsize = 0;
    if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
        goto bad;
#endif
    if ((size_t)basicsize < size) {
        PyErr_Format(PyExc_ValueError,
            "%.200s.%.200s size changed, may indicate binary incompatibility. "
            "Expected %zd from C header, got %zd from PyObject",
            module_name, class_name, size, basicsize);
        goto bad;
    }
    if (check_size == __Pyx_ImportType_CheckSize_Error && (size_t)basicsize != size) {
        PyErr_Format(PyExc_ValueError,
            "%.200s.%.200s size changed, may indicate binary incompatibility. "
            "Expected %zd from C header, got %zd from PyObject",
            module_name, class_name, size, basicsize);
        goto bad;
    }
    else if (check_size == __Pyx_ImportType_CheckSize_Warn && (size_t)basicsize > size) {
        PyOS_snprintf(warning, sizeof(warning),
            "%s.%s size changed, may indicate binary incompatibility. "
            "Expected %zd from C header, got %zd from PyObject",
            module_name, class_name, size, basicsize);
        if (PyErr_WarnEx(NULL, warning, 0) < 0) goto bad;
    }
    return (PyTypeObject *)result;
bad:
    Py_XDECREF(result);
    return NULL;
}
#endif

/* CLineInTraceback */
      #ifndef CYTHON_CLINE_IN_TRACEBACK
static int __Pyx_CLineForTraceback(CYTHON_NCP_UNUSED PyThreadState *tstate, int c_line) {
    PyObject *use_cline;
    PyObject *ptype, *pvalue, *ptraceback;
#if CYTHON_COMPILING_IN_CPYTHON
    PyObject **cython_runtime_dict;
#endif
    if (unlikely(!__pyx_cython_runtime)) {
        return c_line;
    }
    __Pyx_ErrFetchInState(tstate, &ptype, &pvalue, &ptraceback);
#if CYTHON_COMPILING_IN_CPYTHON
    cython_runtime_dict = _PyObject_GetDictPtr(__pyx_cython_runtime);
    if (likely(cython_runtime_dict)) {
        __PYX_PY_DICT_LOOKUP_IF_MODIFIED(
            use_cline, *cython_runtime_dict,
            __Pyx_PyDict_GetItemStr(*cython_runtime_dict, __pyx_n_s_cline_in_traceback))
    } else
#endif
    {
      PyObject *use_cline_obj = __Pyx_PyObject_GetAttrStr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback);
      if (use_cline_obj) {
        use_cline = PyObject_Not(use_cline_obj) ? Py_False : Py_True;
        Py_DECREF(use_cline_obj);
      } else {
        PyErr_Clear();
        use_cline = NULL;
      }
    }
    if (!use_cline) {
        c_line = 0;
        PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
    }
    else if (use_cline == Py_False || (use_cline != Py_True && PyObject_Not(use_cline) != 0)) {
        c_line = 0;
    }
    __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
    return c_line;
}
#endif

/* CodeObjectCache */
      static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line) {
    int start = 0, mid = 0, end = count - 1;
    if (end >= 0 && code_line > entries[end].code_line) {
        return count;
    }
    while (start < end) {
        mid = start + (end - start) / 2;
        if (code_line < entries[mid].code_line) {
            end = mid;
        } else if (code_line > entries[mid].code_line) {
             start = mid + 1;
        } else {
            return mid;
        }
    }
    if (code_line <= entries[mid].code_line) {
        return mid;
    } else {
        return mid + 1;
    }
}
static PyCodeObject *__pyx_find_code_object(int code_line) {
    PyCodeObject* code_object;
    int pos;
    if (unlikely(!code_line) || unlikely(!__pyx_code_cache.entries)) {
        return NULL;
    }
    pos = __pyx_bisect_code_objects(__pyx_code_cache.entries, __pyx_code_cache.count, code_line);
    if (unlikely(pos >= __pyx_code_cache.count) || unlikely(__pyx_code_cache.entries[pos].code_line != code_line)) {
        return NULL;
    }
    code_object = __pyx_code_cache.entries[pos].code_object;
    Py_INCREF(code_object);
    return code_object;
}
static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object) {
    int pos, i;
    __Pyx_CodeObjectCacheEntry* entries = __pyx_code_cache.entries;
    if (unlikely(!code_line)) {
        return;
    }
    if (unlikely(!entries)) {
        entries = (__Pyx_CodeObjectCacheEntry*)PyMem_Malloc(64*sizeof(__Pyx_CodeObjectCacheEntry));
        if (likely(entries)) {
            __pyx_code_cache.entries = entries;
            __pyx_code_cache.max_count = 64;
            __pyx_code_cache.count = 1;
            entries[0].code_line = code_line;
            entries[0].code_object = code_object;
            Py_INCREF(code_object);
        }
        return;
    }
    pos = __pyx_bisect_code_objects(__pyx_code_cache.entries, __pyx_code_cache.count, code_line);
    if ((pos < __pyx_code_cache.count) && unlikely(__pyx_code_cache.entries[pos].code_line == code_line)) {
        PyCodeObject* tmp = entries[pos].code_object;
        entries[pos].code_object = code_object;
        Py_DECREF(tmp);
        return;
    }
    if (__pyx_code_cache.count == __pyx_code_cache.max_count) {
        int new_max = __pyx_code_cache.max_count + 64;
        entries = (__Pyx_CodeObjectCacheEntry*)PyMem_Realloc(
            __pyx_code_cache.entries, ((size_t)new_max) * sizeof(__Pyx_CodeObjectCacheEntry));
        if (unlikely(!entries)) {
            return;
        }
        __pyx_code_cache.entries = entries;
        __pyx_code_cache.max_count = new_max;
    }
    for (i=__pyx_code_cache.count; i>pos; i--) {
        entries[i] = entries[i-1];
    }
    entries[pos].code_line = code_line;
    entries[pos].code_object = code_object;
    __pyx_code_cache.count++;
    Py_INCREF(code_object);
}

/* AddTraceback */
      #include "compile.h"
#include "frameobject.h"
#include "traceback.h"
static PyCodeObject* __Pyx_CreateCodeObjectForTraceback(
            const char *funcname, int c_line,
            int py_line, const char *filename) {
    PyCodeObject *py_code = 0;
    PyObject *py_srcfile = 0;
    PyObject *py_funcname = 0;
    #if PY_MAJOR_VERSION < 3
    py_srcfile = PyString_FromString(filename);
    #else
    py_srcfile = PyUnicode_FromString(filename);
    #endif
    if (!py_srcfile) goto bad;
    if (c_line) {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
        #else
        py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
        #endif
    }
    else {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromString(funcname);
        #else
        py_funcname = PyUnicode_FromString(funcname);
        #endif
    }
    if (!py_funcname) goto bad;
    py_code = __Pyx_PyCode_New(
        0,
        0,
        0,
        0,
        0,
        __pyx_empty_bytes, /*PyObject *code,*/
        __pyx_empty_tuple, /*PyObject *consts,*/
        __pyx_empty_tuple, /*PyObject *names,*/
        __pyx_empty_tuple, /*PyObject *varnames,*/
        __pyx_empty_tuple, /*PyObject *freevars,*/
        __pyx_empty_tuple, /*PyObject *cellvars,*/
        py_srcfile,   /*PyObject *filename,*/
        py_funcname,  /*PyObject *name,*/
        py_line,
        __pyx_empty_bytes  /*PyObject *lnotab*/
    );
    Py_DECREF(py_srcfile);
    Py_DECREF(py_funcname);
    return py_code;
bad:
    Py_XDECREF(py_srcfile);
    Py_XDECREF(py_funcname);
    return NULL;
}
static void __Pyx_AddTraceback(const char *funcname, int c_line,
                               int py_line, const char *filename) {
    PyCodeObject *py_code = 0;
    PyFrameObject *py_frame = 0;
    PyThreadState *tstate = __Pyx_PyThreadState_Current;
    if (c_line) {
        c_line = __Pyx_CLineForTraceback(tstate, c_line);
    }
    py_code = __pyx_find_code_object(c_line ? -c_line : py_line);
    if (!py_code) {
        py_code = __Pyx_CreateCodeObjectForTraceback(
            funcname, c_line, py_line, filename);
        if (!py_code) goto bad;
        __pyx_insert_code_object(c_line ? -c_line : py_line, py_code);
    }
    py_frame = PyFrame_New(
        tstate,            /*PyThreadState *tstate,*/
        py_code,           /*PyCodeObject *code,*/
        __pyx_d,    /*PyObject *globals,*/
        0                  /*PyObject *locals*/
    );
    if (!py_frame) goto bad;
    __Pyx_PyFrame_SetLineNumber(py_frame, py_line);
    PyTraceBack_Here(py_frame);
bad:
    Py_XDECREF(py_code);
    Py_XDECREF(py_frame);
}

/* CIntFromPyVerify */
      #define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 0)
#define __PYX_VERIFY_RETURN_INT_EXC(target_type, func_type, func_value)\
    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 1)
#define __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, exc)\
    {\
        func_type value = func_value;\
        if (sizeof(target_type) < sizeof(func_type)) {\
            if (unlikely(value != (func_type) (target_type) value)) {\
                func_type zero = 0;\
                if (exc && unlikely(value == (func_type)-1 && PyErr_Occurred()))\
                    return (target_type) -1;\
                if (is_unsigned && unlikely(value < zero))\
                    goto raise_neg_overflow;\
                else\
                    goto raise_overflow;\
            }\
        }\
        return (target_type) value;\
    }

#if PY_MAJOR_VERSION < 3
static int __Pyx_GetBuffer(PyObject *obj, Py_buffer *view, int flags) {
    if (PyObject_CheckBuffer(obj)) return PyObject_GetBuffer(obj, view, flags);
    PyErr_Format(PyExc_TypeError, "'%.200s' does not have the buffer interface", Py_TYPE(obj)->tp_name);
    return -1;
}
static void __Pyx_ReleaseBuffer(Py_buffer *view) {
    PyObject *obj = view->obj;
    if (!obj) return;
    if (PyObject_CheckBuffer(obj)) {
        PyBuffer_Release(view);
        return;
    }
    if ((0)) {}
    view->obj = NULL;
    Py_DECREF(obj);
}
#endif


      /* Declarations */
      #if CYTHON_CCOMPLEX
  #ifdef __cplusplus
    static CYTHON_INLINE __pyx_t_float_complex __pyx_t_float_complex_from_parts(float x, float y) {
      return ::std::complex< float >(x, y);
    }
  #else
    static CYTHON_INLINE __pyx_t_float_complex __pyx_t_float_complex_from_parts(float x, float y) {
      return x + y*(__pyx_t_float_complex)_Complex_I;
    }
  #endif
#else
    static CYTHON_INLINE __pyx_t_float_complex __pyx_t_float_complex_from_parts(float x, float y) {
      __pyx_t_float_complex z;
      z.real = x;
      z.imag = y;
      return z;
    }
#endif

/* Arithmetic */
      #if CYTHON_CCOMPLEX
#else
    static CYTHON_INLINE int __Pyx_c_eq_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
       return (a.real == b.real) && (a.imag == b.imag);
    }
    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_sum_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
        __pyx_t_float_complex z;
        z.real = a.real + b.real;
        z.imag = a.imag + b.imag;
        return z;
    }
    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_diff_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
        __pyx_t_float_complex z;
        z.real = a.real - b.real;
        z.imag = a.imag - b.imag;
        return z;
    }
    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_prod_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
        __pyx_t_float_complex z;
        z.real = a.real * b.real - a.imag * b.imag;
        z.imag = a.real * b.imag + a.imag * b.real;
        return z;
    }
    #if 1
    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_quot_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
        if (b.imag == 0) {
            return __pyx_t_float_complex_from_parts(a.real / b.real, a.imag / b.real);
        } else if (fabsf(b.real) >= fabsf(b.imag)) {
            if (b.real == 0 && b.imag == 0) {
                return __pyx_t_float_complex_from_parts(a.real / b.real, a.imag / b.imag);
            } else {
                float r = b.imag / b.real;
                float s = (float)(1.0) / (b.real + b.imag * r);
                return __pyx_t_float_complex_from_parts(
                    (a.real + a.imag * r) * s, (a.imag - a.real * r) * s);
            }
        } else {
            float r = b.real / b.imag;
            float s = (float)(1.0) / (b.imag + b.real * r);
            return __pyx_t_float_complex_from_parts(
                (a.real * r + a.imag) * s, (a.imag * r - a.real) * s);
        }
    }
    #else
    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_quot_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
        if (b.imag == 0) {
            return __pyx_t_float_complex_from_parts(a.real / b.real, a.imag / b.real);
        } else {
            float denom = b.real * b.real + b.imag * b.imag;
            return __pyx_t_float_complex_from_parts(
                (a.real * b.real + a.imag * b.imag) / denom,
                (a.imag * b.real - a.real * b.imag) / denom);
        }
    }
    #endif
    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_neg_float(__pyx_t_float_complex a) {
        __pyx_t_float_complex z;
        z.real = -a.real;
        z.imag = -a.imag;
        return z;
    }
    static CYTHON_INLINE int __Pyx_c_is_zero_float(__pyx_t_float_complex a) {
       return (a.real == 0) && (a.imag == 0);
    }
    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_conj_float(__pyx_t_float_complex a) {
        __pyx_t_float_complex z;
        z.real =  a.real;
        z.imag = -a.imag;
        return z;
    }
    #if 1
        static CYTHON_INLINE float __Pyx_c_abs_float(__pyx_t_float_complex z) {
          #if !defined(HAVE_HYPOT) || defined(_MSC_VER)
            return sqrtf(z.real*z.real + z.imag*z.imag);
          #else
            return hypotf(z.real, z.imag);
          #endif
        }
        static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_pow_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
            __pyx_t_float_complex z;
            float r, lnr, theta, z_r, z_theta;
            if (b.imag == 0 && b.real == (int)b.real) {
                if (b.real < 0) {
                    float denom = a.real * a.real + a.imag * a.imag;
                    a.real = a.real / denom;
                    a.imag = -a.imag / denom;
                    b.real = -b.real;
                }
                switch ((int)b.real) {
                    case 0:
                        z.real = 1;
                        z.imag = 0;
                        return z;
                    case 1:
                        return a;
                    case 2:
                        return __Pyx_c_prod_float(a, a);
                    case 3:
                        z = __Pyx_c_prod_float(a, a);
                        return __Pyx_c_prod_float(z, a);
                    case 4:
                        z = __Pyx_c_prod_float(a, a);
                        return __Pyx_c_prod_float(z, z);
                }
            }
            if (a.imag == 0) {
                if (a.real == 0) {
                    return a;
                } else if (b.imag == 0) {
                    z.real = powf(a.real, b.real);
                    z.imag = 0;
                    return z;
                } else if (a.real > 0) {
                    r = a.real;
                    theta = 0;
                } else {
                    r = -a.real;
                    theta = atan2f(0.0, -1.0);
                }
            } else {
                r = __Pyx_c_abs_float(a);
                theta = atan2f(a.imag, a.real);
            }
            lnr = logf(r);
            z_r = expf(lnr * b.real - theta * b.imag);
            z_theta = theta * b.real + lnr * b.imag;
            z.real = z_r * cosf(z_theta);
            z.imag = z_r * sinf(z_theta);
            return z;
        }
    #endif
#endif

/* Declarations */
      #if CYTHON_CCOMPLEX
  #ifdef __cplusplus
    static CYTHON_INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(double x, double y) {
      return ::std::complex< double >(x, y);
    }
  #else
    static CYTHON_INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(double x, double y) {
      return x + y*(__pyx_t_double_complex)_Complex_I;
    }
  #endif
#else
    static CYTHON_INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(double x, double y) {
      __pyx_t_double_complex z;
      z.real = x;
      z.imag = y;
      return z;
    }
#endif

/* Arithmetic */
      #if CYTHON_CCOMPLEX
#else
    static CYTHON_INLINE int __Pyx_c_eq_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
       return (a.real == b.real) && (a.imag == b.imag);
    }
    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_sum_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
        __pyx_t_double_complex z;
        z.real = a.real + b.real;
        z.imag = a.imag + b.imag;
        return z;
    }
    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_diff_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
        __pyx_t_double_complex z;
        z.real = a.real - b.real;
        z.imag = a.imag - b.imag;
        return z;
    }
    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_prod_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
        __pyx_t_double_complex z;
        z.real = a.real * b.real - a.imag * b.imag;
        z.imag = a.real * b.imag + a.imag * b.real;
        return z;
    }
    #if 1
    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_quot_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
        if (b.imag == 0) {
            return __pyx_t_double_complex_from_parts(a.real / b.real, a.imag / b.real);
        } else if (fabs(b.real) >= fabs(b.imag)) {
            if (b.real == 0 && b.imag == 0) {
                return __pyx_t_double_complex_from_parts(a.real / b.real, a.imag / b.imag);
            } else {
                double r = b.imag / b.real;
                double s = (double)(1.0) / (b.real + b.imag * r);
                return __pyx_t_double_complex_from_parts(
                    (a.real + a.imag * r) * s, (a.imag - a.real * r) * s);
            }
        } else {
            double r = b.real / b.imag;
            double s = (double)(1.0) / (b.imag + b.real * r);
            return __pyx_t_double_complex_from_parts(
                (a.real * r + a.imag) * s, (a.imag * r - a.real) * s);
        }
    }
    #else
    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_quot_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
        if (b.imag == 0) {
            return __pyx_t_double_complex_from_parts(a.real / b.real, a.imag / b.real);
        } else {
            double denom = b.real * b.real + b.imag * b.imag;
            return __pyx_t_double_complex_from_parts(
                (a.real * b.real + a.imag * b.imag) / denom,
                (a.imag * b.real - a.real * b.imag) / denom);
        }
    }
    #endif
    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_neg_double(__pyx_t_double_complex a) {
        __pyx_t_double_complex z;
        z.real = -a.real;
        z.imag = -a.imag;
        return z;
    }
    static CYTHON_INLINE int __Pyx_c_is_zero_double(__pyx_t_double_complex a) {
       return (a.real == 0) && (a.imag == 0);
    }
    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_conj_double(__pyx_t_double_complex a) {
        __pyx_t_double_complex z;
        z.real =  a.real;
        z.imag = -a.imag;
        return z;
    }
    #if 1
        static CYTHON_INLINE double __Pyx_c_abs_double(__pyx_t_double_complex z) {
          #if !defined(HAVE_HYPOT) || defined(_MSC_VER)
            return sqrt(z.real*z.real + z.imag*z.imag);
          #else
            return hypot(z.real, z.imag);
          #endif
        }
        static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_pow_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
            __pyx_t_double_complex z;
            double r, lnr, theta, z_r, z_theta;
            if (b.imag == 0 && b.real == (int)b.real) {
                if (b.real < 0) {
                    double denom = a.real * a.real + a.imag * a.imag;
                    a.real = a.real / denom;
                    a.imag = -a.imag / denom;
                    b.real = -b.real;
                }
                switch ((int)b.real) {
                    case 0:
                        z.real = 1;
                        z.imag = 0;
                        return z;
                    case 1:
                        return a;
                    case 2:
                        return __Pyx_c_prod_double(a, a);
                    case 3:
                        z = __Pyx_c_prod_double(a, a);
                        return __Pyx_c_prod_double(z, a);
                    case 4:
                        z = __Pyx_c_prod_double(a, a);
                        return __Pyx_c_prod_double(z, z);
                }
            }
            if (a.imag == 0) {
                if (a.real == 0) {
                    return a;
                } else if (b.imag == 0) {
                    z.real = pow(a.real, b.real);
                    z.imag = 0;
                    return z;
                } else if (a.real > 0) {
                    r = a.real;
                    theta = 0;
                } else {
                    r = -a.real;
                    theta = atan2(0.0, -1.0);
                }
            } else {
                r = __Pyx_c_abs_double(a);
                theta = atan2(a.imag, a.real);
            }
            lnr = log(r);
            z_r = exp(lnr * b.real - theta * b.imag);
            z_theta = theta * b.real + lnr * b.imag;
            z.real = z_r * cos(z_theta);
            z.imag = z_r * sin(z_theta);
            return z;
        }
    #endif
#endif

/* CIntToPy */
      static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value) {
#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
#pragma GCC diagnostic push
#pragma GCC diagnostic ignored "-Wconversion"
#endif
    const int neg_one = (int) -1, const_zero = (int) 0;
#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
#pragma GCC diagnostic pop
#endif
    const int is_unsigned = neg_one > const_zero;
    if (is_unsigned) {
        if (sizeof(int) < sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(int) <= sizeof(unsigned long)) {
            return PyLong_FromUnsignedLong((unsigned long) value);
#ifdef HAVE_LONG_LONG
        } else if (sizeof(int) <= sizeof(unsigned PY_LONG_LONG)) {
            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
#endif
        }
    } else {
        if (sizeof(int) <= sizeof(long)) {
            return PyInt_FromLong((long) value);
#ifdef HAVE_LONG_LONG
        } else if (sizeof(int) <= sizeof(PY_LONG_LONG)) {
            return PyLong_FromLongLong((PY_LONG_LONG) value);
#endif
        }
    }
    {
        int one = 1; int little = (int)*(unsigned char *)&one;
        unsigned char *bytes = (unsigned char *)&value;
        return _PyLong_FromByteArray(bytes, sizeof(int),
                                     little, !is_unsigned);
    }
}

/* CIntFromPy */
      static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *x) {
#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
#pragma GCC diagnostic push
#pragma GCC diagnostic ignored "-Wconversion"
#endif
    const int neg_one = (int) -1, const_zero = (int) 0;
#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
#pragma GCC diagnostic pop
#endif
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        if (sizeof(int) < sizeof(long)) {
            __PYX_VERIFY_RETURN_INT(int, long, PyInt_AS_LONG(x))
        } else {
            long val = PyInt_AS_LONG(x);
            if (is_unsigned && unlikely(val < 0)) {
                goto raise_neg_overflow;
            }
            return (int) val;
        }
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_USE_PYLONG_INTERNALS
            const digit* digits = ((PyLongObject*)x)->ob_digit;
            switch (Py_SIZE(x)) {
                case  0: return (int) 0;
                case  1: __PYX_VERIFY_RETURN_INT(int, digit, digits[0])
                case 2:
                    if (8 * sizeof(int) > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) >= 2 * PyLong_SHIFT) {
                            return (int) (((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                        }
                    }
                    break;
                case 3:
                    if (8 * sizeof(int) > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) >= 3 * PyLong_SHIFT) {
                            return (int) (((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                        }
                    }
                    break;
                case 4:
                    if (8 * sizeof(int) > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) >= 4 * PyLong_SHIFT) {
                            return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                        }
                    }
                    break;
            }
#endif
#if CYTHON_COMPILING_IN_CPYTHON
            if (unlikely(Py_SIZE(x) < 0)) {
                goto raise_neg_overflow;
            }
#else
            {
                int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                if (unlikely(result < 0))
                    return (int) -1;
                if (unlikely(result == 1))
                    goto raise_neg_overflow;
            }
#endif
            if (sizeof(int) <= sizeof(unsigned long)) {
                __PYX_VERIFY_RETURN_INT_EXC(int, unsigned long, PyLong_AsUnsignedLong(x))
#ifdef HAVE_LONG_LONG
            } else if (sizeof(int) <= sizeof(unsigned PY_LONG_LONG)) {
                __PYX_VERIFY_RETURN_INT_EXC(int, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
#endif
            }
        } else {
#if CYTHON_USE_PYLONG_INTERNALS
            const digit* digits = ((PyLongObject*)x)->ob_digit;
            switch (Py_SIZE(x)) {
                case  0: return (int) 0;
                case -1: __PYX_VERIFY_RETURN_INT(int, sdigit, (sdigit) (-(sdigit)digits[0]))
                case  1: __PYX_VERIFY_RETURN_INT(int,  digit, +digits[0])
                case -2:
                    if (8 * sizeof(int) - 1 > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) - 1 > 2 * PyLong_SHIFT) {
                            return (int) (((int)-1)*(((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                        }
                    }
                    break;
                case 2:
                    if (8 * sizeof(int) > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) - 1 > 2 * PyLong_SHIFT) {
                            return (int) ((((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                        }
                    }
                    break;
                case -3:
                    if (8 * sizeof(int) - 1 > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) - 1 > 3 * PyLong_SHIFT) {
                            return (int) (((int)-1)*(((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                        }
                    }
                    break;
                case 3:
                    if (8 * sizeof(int) > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) - 1 > 3 * PyLong_SHIFT) {
                            return (int) ((((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                        }
                    }
                    break;
                case -4:
                    if (8 * sizeof(int) - 1 > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) - 1 > 4 * PyLong_SHIFT) {
                            return (int) (((int)-1)*(((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                        }
                    }
                    break;
                case 4:
                    if (8 * sizeof(int) > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(int) - 1 > 4 * PyLong_SHIFT) {
                            return (int) ((((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                        }
                    }
                    break;
            }
#endif
            if (sizeof(int) <= sizeof(long)) {
                __PYX_VERIFY_RETURN_INT_EXC(int, long, PyLong_AsLong(x))
#ifdef HAVE_LONG_LONG
            } else if (sizeof(int) <= sizeof(PY_LONG_LONG)) {
                __PYX_VERIFY_RETURN_INT_EXC(int, PY_LONG_LONG, PyLong_AsLongLong(x))
#endif
            }
        }
        {
#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
            PyErr_SetString(PyExc_RuntimeError,
                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
#else
            int val;
            PyObject *v = __Pyx_PyNumber_IntOrLong(x);
 #if PY_MAJOR_VERSION < 3
            if (likely(v) && !PyLong_Check(v)) {
                PyObject *tmp = v;
                v = PyNumber_Long(tmp);
                Py_DECREF(tmp);
            }
 #endif
            if (likely(v)) {
                int one = 1; int is_little = (int)*(unsigned char *)&one;
                unsigned char *bytes = (unsigned char *)&val;
                int ret = _PyLong_AsByteArray((PyLongObject *)v,
                                              bytes, sizeof(val),
                                              is_little, !is_unsigned);
                Py_DECREF(v);
                if (likely(!ret))
                    return val;
            }
#endif
            return (int) -1;
        }
    } else {
        int val;
        PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
        if (!tmp) return (int) -1;
        val = __Pyx_PyInt_As_int(tmp);
        Py_DECREF(tmp);
        return val;
    }
raise_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "value too large to convert to int");
    return (int) -1;
raise_neg_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "can't convert negative value to int");
    return (int) -1;
}

/* CIntFromPy */
      static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *x) {
#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
#pragma GCC diagnostic push
#pragma GCC diagnostic ignored "-Wconversion"
#endif
    const long neg_one = (long) -1, const_zero = (long) 0;
#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
#pragma GCC diagnostic pop
#endif
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        if (sizeof(long) < sizeof(long)) {
            __PYX_VERIFY_RETURN_INT(long, long, PyInt_AS_LONG(x))
        } else {
            long val = PyInt_AS_LONG(x);
            if (is_unsigned && unlikely(val < 0)) {
                goto raise_neg_overflow;
            }
            return (long) val;
        }
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_USE_PYLONG_INTERNALS
            const digit* digits = ((PyLongObject*)x)->ob_digit;
            switch (Py_SIZE(x)) {
                case  0: return (long) 0;
                case  1: __PYX_VERIFY_RETURN_INT(long, digit, digits[0])
                case 2:
                    if (8 * sizeof(long) > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) >= 2 * PyLong_SHIFT) {
                            return (long) (((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                        }
                    }
                    break;
                case 3:
                    if (8 * sizeof(long) > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) >= 3 * PyLong_SHIFT) {
                            return (long) (((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                        }
                    }
                    break;
                case 4:
                    if (8 * sizeof(long) > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) >= 4 * PyLong_SHIFT) {
                            return (long) (((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                        }
                    }
                    break;
            }
#endif
#if CYTHON_COMPILING_IN_CPYTHON
            if (unlikely(Py_SIZE(x) < 0)) {
                goto raise_neg_overflow;
            }
#else
            {
                int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                if (unlikely(result < 0))
                    return (long) -1;
                if (unlikely(result == 1))
                    goto raise_neg_overflow;
            }
#endif
            if (sizeof(long) <= sizeof(unsigned long)) {
                __PYX_VERIFY_RETURN_INT_EXC(long, unsigned long, PyLong_AsUnsignedLong(x))
#ifdef HAVE_LONG_LONG
            } else if (sizeof(long) <= sizeof(unsigned PY_LONG_LONG)) {
                __PYX_VERIFY_RETURN_INT_EXC(long, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
#endif
            }
        } else {
#if CYTHON_USE_PYLONG_INTERNALS
            const digit* digits = ((PyLongObject*)x)->ob_digit;
            switch (Py_SIZE(x)) {
                case  0: return (long) 0;
                case -1: __PYX_VERIFY_RETURN_INT(long, sdigit, (sdigit) (-(sdigit)digits[0]))
                case  1: __PYX_VERIFY_RETURN_INT(long,  digit, +digits[0])
                case -2:
                    if (8 * sizeof(long) - 1 > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                            return (long) (((long)-1)*(((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                        }
                    }
                    break;
                case 2:
                    if (8 * sizeof(long) > 1 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                            return (long) ((((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                        }
                    }
                    break;
                case -3:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                            return (long) (((long)-1)*(((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                        }
                    }
                    break;
                case 3:
                    if (8 * sizeof(long) > 2 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                            return (long) ((((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                        }
                    }
                    break;
                case -4:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                            return (long) (((long)-1)*(((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                        }
                    }
                    break;
                case 4:
                    if (8 * sizeof(long) > 3 * PyLong_SHIFT) {
                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                        } else if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                            return (long) ((((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                        }
                    }
                    break;
            }
#endif
            if (sizeof(long) <= sizeof(long)) {
                __PYX_VERIFY_RETURN_INT_EXC(long, long, PyLong_AsLong(x))
#ifdef HAVE_LONG_LONG
            } else if (sizeof(long) <= sizeof(PY_LONG_LONG)) {
                __PYX_VERIFY_RETURN_INT_EXC(long, PY_LONG_LONG, PyLong_AsLongLong(x))
#endif
            }
        }
        {
#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
            PyErr_SetString(PyExc_RuntimeError,
                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
#else
            long val;
            PyObject *v = __Pyx_PyNumber_IntOrLong(x);
 #if PY_MAJOR_VERSION < 3
            if (likely(v) && !PyLong_Check(v)) {
                PyObject *tmp = v;
                v = PyNumber_Long(tmp);
                Py_DECREF(tmp);
            }
 #endif
            if (likely(v)) {
                int one = 1; int is_little = (int)*(unsigned char *)&one;
                unsigned char *bytes = (unsigned char *)&val;
                int ret = _PyLong_AsByteArray((PyLongObject *)v,
                                              bytes, sizeof(val),
                                              is_little, !is_unsigned);
                Py_DECREF(v);
                if (likely(!ret))
                    return val;
            }
#endif
            return (long) -1;
        }
    } else {
        long val;
        PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
        if (!tmp) return (long) -1;
        val = __Pyx_PyInt_As_long(tmp);
        Py_DECREF(tmp);
        return val;
    }
raise_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "value too large to convert to long");
    return (long) -1;
raise_neg_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "can't convert negative value to long");
    return (long) -1;
}

/* CIntToPy */
      static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
#pragma GCC diagnostic push
#pragma GCC diagnostic ignored "-Wconversion"
#endif
    const long neg_one = (long) -1, const_zero = (long) 0;
#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
#pragma GCC diagnostic pop
#endif
    const int is_unsigned = neg_one > const_zero;
    if (is_unsigned) {
        if (sizeof(long) < sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(long) <= sizeof(unsigned long)) {
            return PyLong_FromUnsignedLong((unsigned long) value);
#ifdef HAVE_LONG_LONG
        } else if (sizeof(long) <= sizeof(unsigned PY_LONG_LONG)) {
            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
#endif
        }
    } else {
        if (sizeof(long) <= sizeof(long)) {
            return PyInt_FromLong((long) value);
#ifdef HAVE_LONG_LONG
        } else if (sizeof(long) <= sizeof(PY_LONG_LONG)) {
            return PyLong_FromLongLong((PY_LONG_LONG) value);
#endif
        }
    }
    {
        int one = 1; int little = (int)*(unsigned char *)&one;
        unsigned char *bytes = (unsigned char *)&value;
        return _PyLong_FromByteArray(bytes, sizeof(long),
                                     little, !is_unsigned);
    }
}

/* FastTypeChecks */
      #if CYTHON_COMPILING_IN_CPYTHON
static int __Pyx_InBases(PyTypeObject *a, PyTypeObject *b) {
    while (a) {
        a = a->tp_base;
        if (a == b)
            return 1;
    }
    return b == &PyBaseObject_Type;
}
static CYTHON_INLINE int __Pyx_IsSubtype(PyTypeObject *a, PyTypeObject *b) {
    PyObject *mro;
    if (a == b) return 1;
    mro = a->tp_mro;
    if (likely(mro)) {
        Py_ssize_t i, n;
        n = PyTuple_GET_SIZE(mro);
        for (i = 0; i < n; i++) {
            if (PyTuple_GET_ITEM(mro, i) == (PyObject *)b)
                return 1;
        }
        return 0;
    }
    return __Pyx_InBases(a, b);
}
#if PY_MAJOR_VERSION == 2
static int __Pyx_inner_PyErr_GivenExceptionMatches2(PyObject *err, PyObject* exc_type1, PyObject* exc_type2) {
    PyObject *exception, *value, *tb;
    int res;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&exception, &value, &tb);
    res = exc_type1 ? PyObject_IsSubclass(err, exc_type1) : 0;
    if (unlikely(res == -1)) {
        PyErr_WriteUnraisable(err);
        res = 0;
    }
    if (!res) {
        res = PyObject_IsSubclass(err, exc_type2);
        if (unlikely(res == -1)) {
            PyErr_WriteUnraisable(err);
            res = 0;
        }
    }
    __Pyx_ErrRestore(exception, value, tb);
    return res;
}
#else
static CYTHON_INLINE int __Pyx_inner_PyErr_GivenExceptionMatches2(PyObject *err, PyObject* exc_type1, PyObject *exc_type2) {
    int res = exc_type1 ? __Pyx_IsSubtype((PyTypeObject*)err, (PyTypeObject*)exc_type1) : 0;
    if (!res) {
        res = __Pyx_IsSubtype((PyTypeObject*)err, (PyTypeObject*)exc_type2);
    }
    return res;
}
#endif
static int __Pyx_PyErr_GivenExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
    Py_ssize_t i, n;
    assert(PyExceptionClass_Check(exc_type));
    n = PyTuple_GET_SIZE(tuple);
#if PY_MAJOR_VERSION >= 3
    for (i=0; i<n; i++) {
        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
    }
#endif
    for (i=0; i<n; i++) {
        PyObject *t = PyTuple_GET_ITEM(tuple, i);
        #if PY_MAJOR_VERSION < 3
        if (likely(exc_type == t)) return 1;
        #endif
        if (likely(PyExceptionClass_Check(t))) {
            if (__Pyx_inner_PyErr_GivenExceptionMatches2(exc_type, NULL, t)) return 1;
        } else {
        }
    }
    return 0;
}
static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches(PyObject *err, PyObject* exc_type) {
    if (likely(err == exc_type)) return 1;
    if (likely(PyExceptionClass_Check(err))) {
        if (likely(PyExceptionClass_Check(exc_type))) {
            return __Pyx_inner_PyErr_GivenExceptionMatches2(err, NULL, exc_type);
        } else if (likely(PyTuple_Check(exc_type))) {
            return __Pyx_PyErr_GivenExceptionMatchesTuple(err, exc_type);
        } else {
        }
    }
    return PyErr_GivenExceptionMatches(err, exc_type);
}
static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches2(PyObject *err, PyObject *exc_type1, PyObject *exc_type2) {
    assert(PyExceptionClass_Check(exc_type1));
    assert(PyExceptionClass_Check(exc_type2));
    if (likely(err == exc_type1 || err == exc_type2)) return 1;
    if (likely(PyExceptionClass_Check(err))) {
        return __Pyx_inner_PyErr_GivenExceptionMatches2(err, exc_type1, exc_type2);
    }
    return (PyErr_GivenExceptionMatches(err, exc_type1) || PyErr_GivenExceptionMatches(err, exc_type2));
}
#endif

/* CheckBinaryVersion */
      static int __Pyx_check_binary_version(void) {
    char ctversion[4], rtversion[4];
    PyOS_snprintf(ctversion, 4, "%d.%d", PY_MAJOR_VERSION, PY_MINOR_VERSION);
    PyOS_snprintf(rtversion, 4, "%s", Py_GetVersion());
    if (ctversion[0] != rtversion[0] || ctversion[2] != rtversion[2]) {
        char message[200];
        PyOS_snprintf(message, sizeof(message),
                      "compiletime version %s of module '%.100s' "
                      "does not match runtime version %s",
                      ctversion, __Pyx_MODULE_NAME, rtversion);
        return PyErr_WarnEx(NULL, message, 1);
    }
    return 0;
}

/* InitStrings */
      static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
    while (t->p) {
        #if PY_MAJOR_VERSION < 3
        if (t->is_unicode) {
            *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
        } else if (t->intern) {
            *t->p = PyString_InternFromString(t->s);
        } else {
            *t->p = PyString_FromStringAndSize(t->s, t->n - 1);
        }
        #else
        if (t->is_unicode | t->is_str) {
            if (t->intern) {
                *t->p = PyUnicode_InternFromString(t->s);
            } else if (t->encoding) {
                *t->p = PyUnicode_Decode(t->s, t->n - 1, t->encoding, NULL);
            } else {
                *t->p = PyUnicode_FromStringAndSize(t->s, t->n - 1);
            }
        } else {
            *t->p = PyBytes_FromStringAndSize(t->s, t->n - 1);
        }
        #endif
        if (!*t->p)
            return -1;
        if (PyObject_Hash(*t->p) == -1)
            return -1;
        ++t;
    }
    return 0;
}

static CYTHON_INLINE PyObject* __Pyx_PyUnicode_FromString(const char* c_str) {
    return __Pyx_PyUnicode_FromStringAndSize(c_str, (Py_ssize_t)strlen(c_str));
}
static CYTHON_INLINE const char* __Pyx_PyObject_AsString(PyObject* o) {
    Py_ssize_t ignore;
    return __Pyx_PyObject_AsStringAndSize(o, &ignore);
}
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT
#if !CYTHON_PEP393_ENABLED
static const char* __Pyx_PyUnicode_AsStringAndSize(PyObject* o, Py_ssize_t *length) {
    char* defenc_c;
    PyObject* defenc = _PyUnicode_AsDefaultEncodedString(o, NULL);
    if (!defenc) return NULL;
    defenc_c = PyBytes_AS_STRING(defenc);
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
    {
        char* end = defenc_c + PyBytes_GET_SIZE(defenc);
        char* c;
        for (c = defenc_c; c < end; c++) {
            if ((unsigned char) (*c) >= 128) {
                PyUnicode_AsASCIIString(o);
                return NULL;
            }
        }
    }
#endif
    *length = PyBytes_GET_SIZE(defenc);
    return defenc_c;
}
#else
static CYTHON_INLINE const char* __Pyx_PyUnicode_AsStringAndSize(PyObject* o, Py_ssize_t *length) {
    if (unlikely(__Pyx_PyUnicode_READY(o) == -1)) return NULL;
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
    if (likely(PyUnicode_IS_ASCII(o))) {
        *length = PyUnicode_GET_LENGTH(o);
        return PyUnicode_AsUTF8(o);
    } else {
        PyUnicode_AsASCIIString(o);
        return NULL;
    }
#else
    return PyUnicode_AsUTF8AndSize(o, length);
#endif
}
#endif
#endif
static CYTHON_INLINE const char* __Pyx_PyObject_AsStringAndSize(PyObject* o, Py_ssize_t *length) {
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT
    if (
#if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
            __Pyx_sys_getdefaultencoding_not_ascii &&
#endif
            PyUnicode_Check(o)) {
        return __Pyx_PyUnicode_AsStringAndSize(o, length);
    } else
#endif
#if (!CYTHON_COMPILING_IN_PYPY) || (defined(PyByteArray_AS_STRING) && defined(PyByteArray_GET_SIZE))
    if (PyByteArray_Check(o)) {
        *length = PyByteArray_GET_SIZE(o);
        return PyByteArray_AS_STRING(o);
    } else
#endif
    {
        char* result;
        int r = PyBytes_AsStringAndSize(o, &result, length);
        if (unlikely(r < 0)) {
            return NULL;
        } else {
            return result;
        }
    }
}
static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject* x) {
   int is_true = x == Py_True;
   if (is_true | (x == Py_False) | (x == Py_None)) return is_true;
   else return PyObject_IsTrue(x);
}
static CYTHON_INLINE int __Pyx_PyObject_IsTrueAndDecref(PyObject* x) {
    int retval;
    if (unlikely(!x)) return -1;
    retval = __Pyx_PyObject_IsTrue(x);
    Py_DECREF(x);
    return retval;
}
static PyObject* __Pyx_PyNumber_IntOrLongWrongResultType(PyObject* result, const char* type_name) {
#if PY_MAJOR_VERSION >= 3
    if (PyLong_Check(result)) {
        if (PyErr_WarnFormat(PyExc_DeprecationWarning, 1,
                "__int__ returned non-int (type %.200s).  "
                "The ability to return an instance of a strict subclass of int "
                "is deprecated, and may be removed in a future version of Python.",
                Py_TYPE(result)->tp_name)) {
            Py_DECREF(result);
            return NULL;
        }
        return result;
    }
#endif
    PyErr_Format(PyExc_TypeError,
                 "__%.4s__ returned non-%.4s (type %.200s)",
                 type_name, type_name, Py_TYPE(result)->tp_name);
    Py_DECREF(result);
    return NULL;
}
static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x) {
#if CYTHON_USE_TYPE_SLOTS
  PyNumberMethods *m;
#endif
  const char *name = NULL;
  PyObject *res = NULL;
#if PY_MAJOR_VERSION < 3
  if (likely(PyInt_Check(x) || PyLong_Check(x)))
#else
  if (likely(PyLong_Check(x)))
#endif
    return __Pyx_NewRef(x);
#if CYTHON_USE_TYPE_SLOTS
  m = Py_TYPE(x)->tp_as_number;
  #if PY_MAJOR_VERSION < 3
  if (m && m->nb_int) {
    name = "int";
    res = m->nb_int(x);
  }
  else if (m && m->nb_long) {
    name = "long";
    res = m->nb_long(x);
  }
  #else
  if (likely(m && m->nb_int)) {
    name = "int";
    res = m->nb_int(x);
  }
  #endif
#else
  if (!PyBytes_CheckExact(x) && !PyUnicode_CheckExact(x)) {
    res = PyNumber_Int(x);
  }
#endif
  if (likely(res)) {
#if PY_MAJOR_VERSION < 3
    if (unlikely(!PyInt_Check(res) && !PyLong_Check(res))) {
#else
    if (unlikely(!PyLong_CheckExact(res))) {
#endif
        return __Pyx_PyNumber_IntOrLongWrongResultType(res, name);
    }
  }
  else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_TypeError,
                    "an integer is required");
  }
  return res;
}
static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject* b) {
  Py_ssize_t ival;
  PyObject *x;
#if PY_MAJOR_VERSION < 3
  if (likely(PyInt_CheckExact(b))) {
    if (sizeof(Py_ssize_t) >= sizeof(long))
        return PyInt_AS_LONG(b);
    else
        return PyInt_AsSsize_t(b);
  }
#endif
  if (likely(PyLong_CheckExact(b))) {
    #if CYTHON_USE_PYLONG_INTERNALS
    const digit* digits = ((PyLongObject*)b)->ob_digit;
    const Py_ssize_t size = Py_SIZE(b);
    if (likely(__Pyx_sst_abs(size) <= 1)) {
        ival = likely(size) ? digits[0] : 0;
        if (size == -1) ival = -ival;
        return ival;
    } else {
      switch (size) {
         case 2:
           if (8 * sizeof(Py_ssize_t) > 2 * PyLong_SHIFT) {
             return (Py_ssize_t) (((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case -2:
           if (8 * sizeof(Py_ssize_t) > 2 * PyLong_SHIFT) {
             return -(Py_ssize_t) (((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case 3:
           if (8 * sizeof(Py_ssize_t) > 3 * PyLong_SHIFT) {
             return (Py_ssize_t) (((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case -3:
           if (8 * sizeof(Py_ssize_t) > 3 * PyLong_SHIFT) {
             return -(Py_ssize_t) (((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case 4:
           if (8 * sizeof(Py_ssize_t) > 4 * PyLong_SHIFT) {
             return (Py_ssize_t) (((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case -4:
           if (8 * sizeof(Py_ssize_t) > 4 * PyLong_SHIFT) {
             return -(Py_ssize_t) (((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
      }
    }
    #endif
    return PyLong_AsSsize_t(b);
  }
  x = PyNumber_Index(b);
  if (!x) return -1;
  ival = PyInt_AsSsize_t(x);
  Py_DECREF(x);
  return ival;
}
static CYTHON_INLINE PyObject * __Pyx_PyBool_FromLong(long b) {
  return b ? __Pyx_NewRef(Py_True) : __Pyx_NewRef(Py_False);
}
static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
    return PyInt_FromSize_t(ival);
}


#endif /* Py_PYTHON_H */
